(function(){var rsplit=function(e,t){var n=t.exec(e),r=new Array,i,s,o;while(n!=null)i=n.index,s=t.lastIndex,i!=0&&(o=e.substring(0,i),r.push(e.substring(0,i)),e=e.slice(i)),r.push(n[0]),e=e.slice(n[0].length),n=t.exec(e);return!e==""&&r.push(e),r},chop=function(e){return e.substr(0,e.length-1)},extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};EJS=function(e){e=typeof e=="string"?{view:e}:e,this.set_options(e);if(e.precompiled){this.template={},this.template.process=e.precompiled,EJS.update(this.name,this);return}if(e.element){if(typeof e.element=="string"){var t=e.element;e.element=document.getElementById(e.element);if(e.element==null)throw t+"does not exist!"}e.element.value?this.text=e.element.value:this.text=e.element.innerHTML,this.name=e.element.id,this.type="["}else if(e.url){e.url=EJS.endExt(e.url,this.extMatch),this.name=this.name?this.name:e.url;var n=e.url,r=EJS.get(this.name,this.cache);if(r)return r;if(r==EJS.INVALID_PATH)return null;try{this.text=EJS.request(n+(this.cache?"":"?"+Math.random()))}catch(i){}if(this.text==null)throw{type:"EJS",message:"There is no template at "+n}}var r=new EJS.Compiler(this.text,this.type);r.compile(e,this.name),EJS.update(this.name,this),this.template=r},EJS.prototype={render:function(e,t){e=e||{},this._extra_helpers=t;var n=new EJS.Helpers(e,t||{});return this.template.process.call(e,e,n)},update:function(element,options){typeof element=="string"&&(element=document.getElementById(element));if(options==null)return _template=this,function(e){EJS.prototype.update.call(_template,element,e)};typeof options=="string"?(params={},params.url=options,_template=this,params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)},EJS.ajax_request(params)):element.innerHTML=this.render(options)},out:function(){return this.template.out},set_options:function(e){this.type=e.type||EJS.type,this.cache=e.cache!=null?e.cache:EJS.cache,this.text=e.text||null,this.name=e.name||null,this.ext=e.ext||EJS.ext,this.extMatch=new RegExp(this.ext.replace(/\./,"."))}},EJS.endExt=function(e,t){return e?(t.lastIndex=0,e+(t.test(e)?"":this.ext)):null},EJS.Scanner=function(e,t,n){extend(this,{left_delimiter:t+"%",right_delimiter:"%"+n,double_left:t+"%%",double_right:"%%"+n,left_equal:t+"%=",left_comment:t+"%#"}),this.SplitRegexp=t=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)"),this.source=e,this.stag=null,this.lines=0},EJS.Scanner.to_text=function(e){return e==null||e===undefined?"":e instanceof Date?e.toDateString():e.toString?e.toString():""},EJS.Scanner.prototype={scan:function(e){scanline=this.scanline,regex=this.SplitRegexp;if(!this.source==""){var t=rsplit(this.source,/\n/);for(var n=0;n<t.length;n++){var r=t[n];this.scanline(r,regex,e)}}},scanline:function(e,t,n){this.lines++;var r=rsplit(e,t);for(var i=0;i<r.length;i++){var s=r[i];if(s!=null)try{n(s,this)}catch(o){throw{type:"EJS.Scanner",line:this.lines}}}}},EJS.Buffer=function(e,t){this.line=new Array,this.script="",this.pre_cmd=e,this.post_cmd=t;for(var n=0;n<this.pre_cmd.length;n++)this.push(e[n])},EJS.Buffer.prototype={push:function(e){this.line.push(e)},cr:function(){this.script=this.script+this.line.join("; "),this.line=new Array,this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var e=0;e<this.post_cmd.length;e++)this.push(pre_cmd[e]);this.script=this.script+this.line.join("; "),line=null}}},EJS.Compiler=function(e,t){this.pre_cmd=["var ___ViewO = [];"],this.post_cmd=new Array,this.source=" ",e!=null&&(typeof e=="string"?(e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),this.source=e):e.innerHTML&&(this.source=e.innerHTML),typeof this.source!="string"&&(this.source="")),t=t||"<";var n=">";switch(t){case"[":n="]";break;case"<":break;default:throw t+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,t,n),this.out=""},EJS.Compiler.prototype={compile:function(options,name){options=options||{},this.out="";var put_cmd="___ViewO.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(this.pre_cmd,this.post_cmd),content="",clean=function(e){return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/"/g,'\\"'),e};this.scanner.scan(function(e,t){if(t.stag==null)switch(e){case"\n":content+="\n",buff.push(put_cmd+'"'+clean(content)+'");'),buff.cr(),content="";break;case t.left_delimiter:case t.left_equal:case t.left_comment:t.stag=e,content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),content="";break;case t.double_left:content+=t.left_delimiter;break;default:content+=e}else switch(e){case t.right_delimiter:switch(t.stag){case t.left_delimiter:content[content.length-1]=="\n"?(content=chop(content),buff.push(content),buff.cr()):buff.push(content);break;case t.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))")}t.stag=null,content="";break;case t.double_right:content+=t.right_delimiter;break;default:content+=e}}),content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),buff.close(),this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if(typeof JSLINT=="undefined")throw e;JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if(error.reason!="Unnecessary semicolon."){error.line++;var e=new Error;throw e.lineNumber=error.line,e.message=error.reason,options.view&&(e.fileName=options.view),e}}}}},EJS.config=function(e){EJS.cache=e.cache!=null?e.cache:EJS.cache,EJS.type=e.type!=null?e.type:EJS.type,EJS.ext=e.ext!=null?e.ext:EJS.ext;var t=EJS.templates_directory||{};EJS.templates_directory=t,EJS.get=function(e,n){return n==0?null:t[e]?t[e]:null},EJS.update=function(e,n){if(e==null)return;t[e]=n},EJS.INVALID_PATH=-1},EJS.config({cache:!0,type:"<",ext:".ejs"}),EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={view:function(e,t,n){return n||(n=this._extras),t||(t=this._data),(new EJS(e)).render(t,n)},to_text:function(e,t){return e==null||e===undefined?t||"":e instanceof Date?e.toDateString():e.toString?e.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}},EJS.newRequest=function(){var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var t=0;t<e.length;t++)try{var n=e[t]();if(n!=null)return n}catch(r){continue}},EJS.request=function(e){var t=new EJS.newRequest;t.open("GET",e,!1);try{t.send(null)}catch(n){return null}return t.status==404||t.status==2||t.status==0&&t.responseText==""?null:t.responseText},EJS.ajax_request=function(e){e.method=e.method?e.method:"GET";var t=new EJS.newRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200?e.onComplete(t):e.onComplete(t))},t.open(e.method,e.url),t.send(null)}})(),function(e,t){typeof exports=="object"?module.exports=t(global):typeof define=="function"&&define.amd?define([],function(){return t(e)}):t(e)}(this,function(e){"use strict";function t(e){return i=e,i}function n(){return i=typeof Float32Array!="undefined"?Float32Array:Array,i}var r={};(function(){if(typeof Float32Array!="undefined"){var e=new Float32Array(1),t=new Int32Array(e.buffer);r.invsqrt=function(n){var r=n*.5;e[0]=n;var i=1.5;t[0]=1597463007-(t[0]>>1);var s=e[0];return s*(i-r*s*s)}}else r.invsqrt=function(e){return 1/Math.sqrt(e)}})();var i=null;n();var s={};s.create=function(e){var t=new i(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},s.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},s.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n)},s.subtract=function(e,t,n){return!n||e===n?(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e):(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n)},s.multiply=function(e,t,n){return!n||e===n?(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e):(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n)},s.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},s.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e[2]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n)},s.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=Math.sqrt(n*n+r*r+i*i);return s?s===1?(t[0]=n,t[1]=r,t[2]=i,t):(s=1/s,t[0]=n*s,t[1]=r*s,t[2]=i*s,t):(t[0]=0,t[1]=0,t[2]=0,t)},s.cross=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2];return n[0]=i*a-s*u,n[1]=s*o-r*a,n[2]=r*u-i*o,n},s.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},s.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],o=Math.sqrt(r*r+i*i+s*s);return o?(o=1/o,n[0]=r*o,n[1]=i*o,n[2]=s*o,n):(n[0]=0,n[1]=0,n[2]=0,n)},s.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r},s.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)};var o=null,u=new i(4);s.unproject=function(e,t,n,r,i){i||(i=e),o||(o=h.create());var s=o,a=u;return a[0]=(e[0]-r[0])*2/r[2]-1,a[1]=(e[1]-r[1])*2/r[3]-1,a[2]=2*e[2]-1,a[3]=1,h.multiply(n,t,s),h.inverse(s)?(h.multiplyVec4(s,a),a[3]===0?null:(i[0]=a[0]/a[3],i[1]=a[1]/a[3],i[2]=a[2]/a[3],i)):null};var a=s.create([1,0,0]),f=s.create([0,1,0]),l=s.create([0,0,1]);s.rotationTo=function(e,t,n){n||(n=p.create());var r=s.dot(e,t),i=s.create();if(r>=1)p.set(d,n);else if(r<1e-6-1)s.cross(a,e,i),i.length<1e-6&&s.cross(f,e,i),i.length<1e-6&&s.cross(l,e,i),s.normalize(i),p.fromAxisAngle(i,Math.PI,n);else{var o=Math.sqrt((1+r)*2),u=1/o;s.cross(e,t,i),n[0]=i[0]*u,n[1]=i[1]*u,n[2]=i[2]*u,n[3]=o*.5,p.normalize(n)}return n[3]>1?n[3]=1:n[3]<-1&&(n[3]=-1),n},s.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var c={};c.create=function(e){var t=new i(9);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]):t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=0,t},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},c.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],h=l*o-u*f,p=-l*s+u*a,d=f*s-o*a,v=n*h+r*p+i*d,m;return v?(m=1/v,t||(t=c.create()),t[0]=h*m,t[1]=(-l*r+i*f)*m,t[2]=(u*r-i*o)*m,t[3]=p*m,t[4]=(l*n-i*a)*m,t[5]=(-u*n+i*s)*m,t[6]=d*m,t[7]=(-f*n+r*a)*m,t[8]=(o*n-r*s)*m,t):null},c.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],g=t[5],y=t[6],b=t[7],w=t[8];return n[0]=h*r+p*o+d*f,n[1]=h*i+p*u+d*l,n[2]=h*s+p*a+d*c,n[3]=v*r+m*o+g*f,n[4]=v*i+m*u+g*l,n[5]=v*s+m*a+g*c,n[6]=y*r+b*o+w*f,n[7]=y*i+b*u+w*l,n[8]=y*s+b*a+w*c,n},c.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[3]+e[6],n[1]=r*e[1]+i*e[4]+e[7],n},c.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2];return n[0]=r*e[0]+i*e[3]+s*e[6],n[1]=r*e[1]+i*e[4]+s*e[7],n[2]=r*e[2]+i*e[5]+s*e[8],n},c.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.identity=function(e){return e||(e=c.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},c.toMat4=function(e,t){return t||(t=h.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},c.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var h={};h.create=function(e){var t=new i(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},h.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(e){return e||(e=h.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},h.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return p*l*u*i-f*d*u*i-p*o*c*i+s*d*c*i+f*o*v*i-s*l*v*i-p*l*r*a+f*d*r*a+p*n*c*a-t*d*c*a-f*n*v*a+t*l*v*a+p*o*r*h-s*d*r*h-p*n*u*h+t*d*u*h+s*n*v*h-t*o*v*h-f*o*r*m+s*l*r*m+f*n*u*m-t*l*u*m-s*n*c*m+t*o*c*m},h.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T,M;return O?(M=1/O,t[0]=(u*A-a*L+f*k)*M,t[1]=(-r*A+i*L-s*k)*M,t[2]=(v*x-m*S+g*E)*M,t[3]=(-c*x+h*S-p*E)*M,t[4]=(-o*A+a*C-f*N)*M,t[5]=(n*A-i*C+s*N)*M,t[6]=(-d*x+m*w-g*b)*M,t[7]=(l*x-h*w+p*b)*M,t[8]=(o*L-u*C+f*T)*M,t[9]=(-n*L+r*C-s*T)*M,t[10]=(d*S-v*w+g*y)*M,t[11]=(-l*S+c*w-p*y)*M,t[12]=(-o*k+u*N-a*T)*M,t[13]=(n*k-r*N+i*T)*M,t[14]=(-d*E+v*b-m*y)*M,t[15]=(l*E-c*b+h*y)*M,t):null},h.toRotationMat=function(e,t){return t||(t=h.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.toMat3=function(e,t){return t||(t=c.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},h.toInverseMat3=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],u=e[6],a=e[8],f=e[9],l=e[10],h=l*o-u*f,p=-l*s+u*a,d=f*s-o*a,v=n*h+r*p+i*d,m;return v?(m=1/v,t||(t=c.create()),t[0]=h*m,t[1]=(-l*r+i*f)*m,t[2]=(u*r-i*o)*m,t[3]=p*m,t[4]=(l*n-i*a)*m,t[5]=(-u*n+i*s)*m,t[6]=d*m,t[7]=(-f*n+r*a)*m,t[8]=(o*n-r*s)*m,t):null},h.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=t[0],w=t[1],E=t[2],S=t[3],x=t[4],T=t[5],N=t[6],C=t[7],k=t[8],L=t[9],A=t[10],O=t[11],M=t[12],_=t[13],D=t[14],P=t[15];return n[0]=b*r+w*u+E*c+S*v,n[1]=b*i+w*a+E*h+S*m,n[2]=b*s+w*f+E*p+S*g,n[3]=b*o+w*l+E*d+S*y,n[4]=x*r+T*u+N*c+C*v,n[5]=x*i+T*a+N*h+C*m,n[6]=x*s+T*f+N*p+C*g,n[7]=x*o+T*l+N*d+C*y,n[8]=k*r+L*u+A*c+O*v,n[9]=k*i+L*a+A*h+O*m,n[10]=k*s+L*f+A*p+O*g,n[11]=k*o+L*l+A*d+O*y,n[12]=M*r+_*u+D*c+P*v,n[13]=M*i+_*a+D*h+P*m,n[14]=M*s+_*f+D*p+P*g,n[15]=M*o+_*l+D*d+P*y,n},h.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12],n[1]=e[1]*r+e[5]*i+e[9]*s+e[13],n[2]=e[2]*r+e[6]*i+e[10]*s+e[14],n},h.multiplyVec4=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=t[3];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12]*o,n[1]=e[1]*r+e[5]*i+e[9]*s+e[13]*o,n[2]=e[2]*r+e[6]*i+e[10]*s+e[14]*o,n[3]=e[3]*r+e[7]*i+e[11]*s+e[15]*o,n},h.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o,u,a,f,l,c,h,p,d,v,m,g;return!n||e===n?(e[12]=e[0]*r+e[4]*i+e[8]*s+e[12],e[13]=e[1]*r+e[5]*i+e[9]*s+e[13],e[14]=e[2]*r+e[6]*i+e[10]*s+e[14],e[15]=e[3]*r+e[7]*i+e[11]*s+e[15],e):(o=e[0],u=e[1],a=e[2],f=e[3],l=e[4],c=e[5],h=e[6],p=e[7],d=e[8],v=e[9],m=e[10],g=e[11],n[0]=o,n[1]=u,n[2]=a,n[3]=f,n[4]=l,n[5]=c,n[6]=h,n[7]=p,n[8]=d,n[9]=v,n[10]=m,n[11]=g,n[12]=o*r+l*i+d*s+e[12],n[13]=u*r+c*i+v*s+e[13],n[14]=a*r+h*i+m*s+e[14],n[15]=f*r+p*i+g*s+e[15],n)},h.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2];return!n||e===n?(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=s,e[9]*=s,e[10]*=s,e[11]*=s,e):(n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)},h.rotate=function(e,t,n,r){var i=n[0],s=n[1],o=n[2],u=Math.sqrt(i*i+s*s+o*o),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;return u?(u!==1&&(u=1/u,i*=u,s*=u,o*=u),a=Math.sin(t),f=Math.cos(t),l=1-f,c=e[0],h=e[1],p=e[2],d=e[3],v=e[4],m=e[5],g=e[6],y=e[7],b=e[8],w=e[9],E=e[10],S=e[11],x=i*i*l+f,T=s*i*l+o*a,N=o*i*l-s*a,C=i*s*l-o*a,k=s*s*l+f,L=o*s*l+i*a,A=i*o*l+s*a,O=s*o*l-i*a,M=o*o*l+f,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=c*x+v*T+b*N,r[1]=h*x+m*T+w*N,r[2]=p*x+g*T+E*N,r[3]=d*x+y*T+S*N,r[4]=c*C+v*k+b*L,r[5]=h*C+m*k+w*L,r[6]=p*C+g*k+E*L,r[7]=d*C+y*k+S*L,r[8]=c*A+v*O+b*M,r[9]=h*A+m*O+w*M,r[10]=p*A+g*O+E*M,r[11]=d*A+y*O+S*M,r):null},h.rotateX=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[4]=s*i+f*r,n[5]=o*i+l*r,n[6]=u*i+c*r,n[7]=a*i+h*r,n[8]=s*-r+f*i,n[9]=o*-r+l*i,n[10]=u*-r+c*i,n[11]=a*-r+h*i,n},h.rotateY=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*-r,n[1]=o*i+l*-r,n[2]=u*i+c*-r,n[3]=a*i+h*-r,n[8]=s*r+f*i,n[9]=o*r+l*i,n[10]=u*r+c*i,n[11]=a*r+h*i,n},h.rotateZ=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7];return n?e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*r,n[1]=o*i+l*r,n[2]=u*i+c*r,n[3]=a*i+h*r,n[4]=s*-r+f*i,n[5]=o*-r+l*i,n[6]=u*-r+c*i,n[7]=a*-r+h*i,n},h.frustum=function(e,t,n,r,i,s,o){o||(o=h.create());var u=t-e,a=r-n,f=s-i;return o[0]=i*2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i*2/a,o[6]=0,o[7]=0,o[8]=(t+e)/u,o[9]=(r+n)/a,o[10]=-(s+i)/f,o[11]=-1,o[12]=0,o[13]=0,o[14]=-(s*i*2)/f,o[15]=0,o},h.perspective=function(e,t,n,r,i){var s=n*Math.tan(e*Math.PI/360),o=s*t;return h.frustum(-o,o,-s,s,n,r,i)},h.ortho=function(e,t,n,r,i,s,o){o||(o=h.create());var u=t-e,a=r-n,f=s-i;return o[0]=2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/f,o[11]=0,o[12]=-(e+t)/u,o[13]=-(r+n)/a,o[14]=-(s+i)/f,o[15]=1,o},h.lookAt=function(e,t,n,r){r||(r=h.create());var i,s,o,u,a,f,l,c,p,d,v=e[0],m=e[1],g=e[2],y=n[0],b=n[1],w=n[2],E=t[0],S=t[1],x=t[2];return v===E&&m===S&&g===x?h.identity(r):(l=v-E,c=m-S,p=g-x,d=1/Math.sqrt(l*l+c*c+p*p),l*=d,c*=d,p*=d,i=b*p-w*c,s=w*l-y*p,o=y*c-b*l,d=Math.sqrt(i*i+s*s+o*o),d?(d=1/d,i*=d,s*=d,o*=d):(i=0,s=0,o=0),u=c*o-p*s,a=p*i-l*o,f=l*s-c*i,d=Math.sqrt(u*u+a*a+f*f),d?(d=1/d,u*=d,a*=d,f*=d):(u=0,a=0,f=0),r[0]=i,r[1]=u,r[2]=l,r[3]=0,r[4]=s,r[5]=a,r[6]=c,r[7]=0,r[8]=o,r[9]=f,r[10]=p,r[11]=0,r[12]=-(i*v+s*m+o*g),r[13]=-(u*v+a*m+f*g),r[14]=-(l*v+c*m+p*g),r[15]=1,r)},h.fromRotationTranslation=function(e,t,n){n||(n=h.create());var r=e[0],i=e[1],s=e[2],o=e[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,p=r*f,d=i*a,v=i*f,m=s*f,g=o*u,y=o*a,b=o*f;return n[0]=1-(d+m),n[1]=c+b,n[2]=p-y,n[3]=0,n[4]=c-b,n[5]=1-(l+m),n[6]=v+g,n[7]=0,n[8]=p+y,n[9]=v-g,n[10]=1-(l+d),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},h.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var p={};p.create=function(e){var t=new i(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},p.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},p.identity=function(e){return e||(e=p.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var d=p.identity();p.calculateW=function(e,t){var n=e[0],r=e[1],i=e[2];return!t||e===t?(e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e):(t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t)},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return!t||e===t?(e[0]*=-u,e[1]*=-u,e[2]*=-u,e[3]*=u,e):(t[0]=-e[0]*u,t[1]=-e[1]*u,t[2]=-e[2]*u,t[3]=e[3]*u,t)},p.conjugate=function(e,t){return!t||e===t?(e[0]*=-1,e[1]*=-1,e[2]*=-1,e):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t)},p.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},p.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i+s*s);return o===0?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(o=1/o,t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t)},p.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n)},p.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=t[0],a=t[1],f=t[2],l=t[3];return n[0]=r*l+o*u+i*f-s*a,n[1]=i*l+o*a+s*u-r*f,n[2]=s*l+o*f+r*a-i*u,n[3]=o*l-r*u-i*a-s*f,n},p.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=e[0],u=e[1],a=e[2],f=e[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return n[0]=l*f+p*-o+c*-a-h*-u,n[1]=c*f+p*-u+h*-o-l*-a,n[2]=h*f+p*-a+l*-u-c*-o,n},p.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n)},p.toMat3=function(e,t){t||(t=c.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,h=n*a,p=r*u,d=r*a,v=i*a,m=s*o,g=s*u,y=s*a;return t[0]=1-(p+v),t[1]=l+y,t[2]=h-g,t[3]=l-y,t[4]=1-(f+v),t[5]=d+m,t[6]=h+g,t[7]=d-m,t[8]=1-(f+p),t},p.toMat4=function(e,t){t||(t=h.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,p=r*u,d=r*a,v=i*a,m=s*o,g=s*u,y=s*a;return t[0]=1-(p+v),t[1]=l+y,t[2]=c-g,t[3]=0,t[4]=l-y,t[5]=1-(f+v),t[6]=d+m,t[7]=0,t[8]=c+g,t[9]=d-m,t[10]=1-(f+p),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.slerp=function(e,t,n,r){r||(r=e);var i=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],s,o,u,a;return Math.abs(i)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(s=Math.acos(i),o=Math.sqrt(1-i*i),Math.abs(o)<.001?(r[0]=e[0]*.5+t[0]*.5,r[1]=e[1]*.5+t[1]*.5,r[2]=e[2]*.5+t[2]*.5,r[3]=e[3]*.5+t[3]*.5,r):(u=Math.sin((1-n)*s)/o,a=Math.sin(n*s)/o,r[0]=e[0]*u+t[0]*a,r[1]=e[1]*u+t[1]*a,r[2]=e[2]*u+t[2]*a,r[3]=e[3]*u+t[3]*a,r))},p.fromRotationMatrix=function(e,t){t||(t=p.create());var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[7]-e[5])*r,t[1]=(e[2]-e[6])*r,t[2]=(e[3]-e[1])*r;else{var i=p.fromRotationMatrix.s_iNext=p.fromRotationMatrix.s_iNext||[1,2,0],s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var o=i[s],u=i[o];r=Math.sqrt(e[s*3+s]-e[o*3+o]-e[u*3+u]+1),t[s]=.5*r,r=.5/r,t[3]=(e[u*3+o]-e[o*3+u])*r,t[o]=(e[o*3+s]+e[s*3+o])*r,t[u]=(e[u*3+s]+e[s*3+u])*r}return t},c.toQuat4=p.fromRotationMatrix,function(){var e=c.create();p.fromAxes=function(t,n,r,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=t[0],e[5]=t[1],e[8]=t[2],p.fromRotationMatrix(e,i)}}(),p.identity=function(e){return e||(e=p.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.fromAngleAxis=function(e,t,n){n||(n=p.create());var r=e*.5,i=Math.sin(r);return n[3]=Math.cos(r),n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n},p.toAngleAxis=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(n>0){t[3]=2*Math.acos(e[3]);var i=r.invsqrt(n);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},p.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var v={};v.create=function(e){var t=new i(2);return e?(t[0]=e[0],t[1]=e[1]):(t[0]=0,t[1]=0),t},v.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},v.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},v.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n},v.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n},v.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},v.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},v.set=function(e,t){return t[0]=e[0],t[1]=e[1],t},v.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t},v.normalize=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1];return n>0?(n=Math.sqrt(n),t[0]=e[0]/n,t[1]=e[1]/n):t[0]=t[1]=0,t},v.cross=function(e,t,n){var r=e[0]*t[1]-e[1]*t[0];return n?(n[0]=n[1]=0,n[2]=r,n):r},v.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},v.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},v.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],s=r*r+i*i;return s?(s=1/Math.sqrt(s),n[0]=r*s,n[1]=i*s,n):(n[0]=0,n[1]=0,n[2]=0,n)},v.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r},v.str=function(e){return"["+e[0]+", "+e[1]+"]"};var m={};m.create=function(e){var t=new i(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},m.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},m.identity=function(e){return e||(e=m.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},m.transpose=function(e,t){if(!t||e===t){var n=e[1];return e[1]=e[2],e[2]=n,e}return t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t},m.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},m.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=n*s-i*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null},m.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3];return n[0]=r*t[0]+i*t[2],n[1]=r*t[1]+i*t[3],n[2]=s*t[0]+o*t[2],n[3]=s*t[1]+o*t[3],n},m.rotate=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=Math.sin(t),a=Math.cos(t);return n[0]=r*a+i*u,n[1]=r*-u+i*a,n[2]=s*a+o*u,n[3]=s*-u+o*a,n},m.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[1],n[1]=r*e[2]+i*e[3],n},m.scale=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=t[0],a=t[1];return n[0]=r*u,n[1]=i*a,n[2]=s*u,n[3]=o*a,n},m.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var g={};return g.create=function(e){var t=new i(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},g.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},g.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},g.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},g.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},g.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},g.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},g.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},g.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r[3]=e[3]+n*(t[3]-e[3]),r},g.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},e&&(e.glMatrixArrayType=i,e.MatrixArray=i,e.setMatrixArrayType=t,e.determineMatrixArrayType=n,e.glMath=r,e.vec2=v,e.vec3=s,e.vec4=g,e.mat2=m,e.mat3=c,e.mat4=h,e.quat4=p),{glMatrixArrayType:i,MatrixArray:i,setMatrixArrayType:t,determineMatrixArrayType:n,glMath:r,vec2:v,vec3:s,vec4:g,mat2:m,mat3:c,mat4:h,quat4:p}}),mat4.IDENTITY=mat4.identity(mat4.create()),quat4.IDENTITY=quat4.create([0,0,0,1]),vec3.UNIT_X=vec3.create([1,0,0]),vec3.UNIT_Y=vec3.create([0,1,0]),vec3.UNIT_Z=vec3.create([0,0,1]),function(){}.call(this);var Jax={PRODUCTION:1,VERSION:"2.0.8",webgl_not_supported_path:null,getGlobal:function(){var e;return typeof global!="undefined"?e=global:e=window,Jax.getGlobal=function(){return e},Jax.getGlobal()},reraise:function(e,t){throw e._stack?t._stack=e._stack:e.stack&&(t._stack=e.stack),t},click_speed:.2};(function(){var e=0;Jax.guid=function(){return e++}})(),Jax.default_shader="basic",Jax.shaders={},Jax._shader_data={},Jax.import_shader_code=function(e,t){return Jax.shader_data(e)[t]},Jax.shader_data=function(e){return Jax._shader_data[e]=Jax._shader_data[e]||{name:e},Jax._shader_data[e]},Jax.loaded=!0,Jax.update_speed=33,Jax.max_lights=undefined,Jax.uptime=0,glMatrixArrayType.prototype.toString!=Array.prototype.toString&&(glMatrixArrayType.prototype.toString=function(){var e="["+glMatrixArrayType.name+": ",t=!1;for(var n in this)parseInt(n)==n&&(t&&(e+=","),e+=this[n],t=!0);return e+="]",e}),Jax.$A=function(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();var t=e.length||0,n=new Array(t);while(t--)n[t]=e[t];return n},Object.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"},Object.isUndefined=function(e){return typeof e=="undefined"},Object.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},Object.extend=function(e,t){for(var n in t)e[n]=t[n];return e},Object.extend(Function.prototype,function(){function e(e,t){var n=e.length,r=t.length;while(r--)e[n+r]=t[r];return e}function t(t,n){return t=l.call(t,0),e(t,n)}function n(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e}function r(e){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var n=this,r=l.call(arguments,1);return function(){var i=t(r,arguments);return n.apply(e,i)}}function i(t){var n=this,r=l.call(arguments,1);return function(i){var s=e([i||window.event],r);return n.apply(t,s)}}function s(){if(!arguments.length)return this;var e=this,n=l.call(arguments,0);return function(){var r=t(n,arguments);return e.apply(this,r)}}function o(e){var t=this,n=l.call(arguments,1);return e*=1e3,window.setTimeout(function(){return t.apply(t,n)},e)}function u(){var t=e([.01],arguments);return this.delay.apply(this,t)}function a(t){var n=this;return function(){var r=e([n.bind(this)],arguments);return t.apply(this,r)}}function f(){if(this._methodized)return this._methodized;var t=this;return this._methodized=function(){var n=e([this],arguments);return t.apply(null,n)}}var l=Array.prototype.slice;return{argumentNames:n,bind:r,bindAsEventListener:i,curry:s,delay:o,defer:u,wrap:a,methodize:f}}()),Jax.Class=function(){function e(e,t){var t=t&&t.prototype,n=Object.keys(e);i&&(e.toString!=Object.prototype.toString&&n.push("toString"),e.valueOf!=Object.prototype.valueOf&&n.push("valueOf"));for(var r=0,s=n.length;r<s;r++){var o=n[r],u=e[o];if(t&&Object.isFunction(u)&&u.argumentNames()[0]=="$super"){var a=u;u=function(e){return function(){if(e==="initialize"&&!t[e])return t.constructor.apply(this,arguments);if(!t[e])throw new Error("ancestor has no method "+e);return t[e].apply(this,arguments)}}(o).wrap(a),u.valueOf=a.valueOf.bind(a),u.toString=a.toString.bind(a)}this.prototype[o]=u}return this}var t=Object.prototype.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=Array.prototype.slice,i=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}();return{Methods:{addMethods:e},create:function(){var e,t;return arguments.length>1?(e=arguments[0],t=arguments[1]):(e=null,t=arguments[0]),function(e){function r(){Jax.Util.addRequestedHelpers(this),this.initialize&&this.initialize.apply(this,arguments)}return e&&n(r,e),Object.extend(r,Jax.Class.Methods),r.addMethods(t,e),r}(e)}}}(),function(){var Delegator=Jax.Class.create({initialize:function(e,t){throw new Error("Delegator has been phased out, please don't call it (with "+JSON.stringify(e)+", "+JSON.stringify(t)+")")},into:function(destination,dest_klass){var methods={},method_name,alias_chain_regexps=[];for(var i=0;i<this.methods.length;i++)if(typeof this.methods[i]=="string")method_name=this.methods[i],methods[method_name]=eval("(function() { return this."+destination+"."+method_name+".apply(this."+destination+", arguments); })");else if(this.methods[i].test){var method_regexp=this.methods[i];if(dest_klass)for(method_name in dest_klass.prototype)method_regexp.test(method_name)&&(methods[method_name]=eval("(function() { return this."+destination+"."+method_name+".apply(this."+destination+", arguments); })"));else alias_chain_regexps.push
(method_regexp)}this.target.addMethods(methods);if(alias_chain_regexps.length>0){if(!this.target.alias_chain_regexps){this.target.alias_chain_regexps={};var original_initialize_method=this.target.prototype.initialize,fn="(function(){if (original_initialize_method) original_initialize_method.apply(this, arguments);var i, j, method_name, destination, method_regexp, self = this;destination = this."+destination+";"+"for (i = 0; i < this.klass.alias_chain_regexps['"+destination+"'].length; i++) {"+"method_regexp = this.klass.alias_chain_regexps['"+destination+"'][i];"+"for (j in destination) {"+"method_name = j;"+"if (method_regexp.test(method_name)) "+"this[method_name] = eval('(function(){return self."+destination+".'+method_name+"+"'.apply(self."+destination+", arguments);})');"+"}"+"}"+"})";this.target.prototype.initialize=eval(fn)}this.target.alias_chain_regexps[destination]=this.target.alias_chain_regexps[destination]||[];for(i=0;i<alias_chain_regexps.length;i++)this.target.alias_chain_regexps[destination].push(alias_chain_regexps[i])}}});Jax.Class.InstanceMethods={isKindOf:function(){throw new Error("isKindOf is deprecated; please use instanceof instead.")}};var original_create=Jax.Class.create;Jax.Class.create=function(){var e=original_create.apply(Jax.Class,arguments);return e.prototype.klass=e,e.addMethods(Jax.Class.InstanceMethods),e},Jax.Class.Methods.delegate=function(){return new Delegator(this,arguments)}}(),function(){var e,t,n,r,i;e=0,n=["ms","moz","webkit","o"],this.cancelAnimationFrame||(this.cancelAnimationFrame=this.cancelRequestAnimationFrame);if(!this.requestAnimationFrame)for(r=0,i=n.length;r<i;r++)t=n[r],this.requestAnimationFrame||(this.requestAnimationFrame=this[t+"RequestAnimationFrame"]),this.cancelAnimationFrame=this.cancelRequestAnimationFrame||(this.cancelRequestAnimationFrame=this[t+"CancelRequestAnimationFrame"]);this.requestAnimationFrame||(this.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=this.setTimeout(function(){return t(r+s)},s),e=r+s,i}),this.cancelAnimationFrame||(this.cancelAnimationFrame=this.cancelRequestAnimationFrame=function(e){return clearTimeout(e)})}.call(this),Jax.Buffer=function(){function e(e,t){for(var n in e.gl)t(e.gl[n].context,e.gl[n].buffer)}return Jax.Class.create({initialize:function(e,t,n,r,i,s){if(!i)throw new Error("Expected an itemSize - how many JS array elements represent a single buffered element?");this.itemSize=i,this.js=r,this.gl={},this.numItems=this.length=r.length/i,this.bufferType=e,this.drawType=n,s?this.dataType=s:r instanceof Float32Array&&(this.dataType=GL_FLOAT),r instanceof Uint8Array&&(this.dataType=GL_UNSIGNED_BYTE),r instanceof Uint16Array&&(this.dataType=GL_UNSIGNED_SHORT),r instanceof Uint32Array&&(this.dataType=GL_UNSIGNED_INT);if(!this.dataType)throw new Error("Couldn't detect dataType")},refresh:function(){var t=this,n=this.refreshTypedArray();if(!t.gl)return;return e(t,function(e,r){e.gl.bindBuffer(t.bufferType,r),e.gl.bufferData(t.bufferType,n,t.drawType)}),this},refreshTypedArray:function(){var e=this,t=this.js;return e.numItems=e.length=e.js.length/e.itemSize,t},dispose:function(){var t=this;return e(this,function(e,n){e.gl.deleteBuffer(n),t.gl[e.id]=null}),t.gl={},t},isDisposed:function(){return!this.gl},bind:function(e){return e.gl.bindBuffer(this.bufferType,this.getGLBuffer(e)),this},getGLBuffer:function(e){if(!e||typeof e.id=="undefined")throw new Error("Cannot build a buffer without a context!");if(!this.gl[e.id]){var t=e.gl.createBuffer();t.itemSize=this.itemSize,this.gl[e.id]={context:e,buffer:t},this.refresh()}return this.gl[e.id].buffer}})}(),function(){var e=[].slice;Function.prototype.define=function(e,t){return Object.defineProperty(this.prototype,e,t)},Function.prototype.setter=function(e,t){return Object.defineProperty(this.prototype,e,{set:t})},Function.prototype.getter=function(e,t){return Object.defineProperty(this.prototype,e,{get:t})},Function.prototype.accessor=function(e,t,n){return Object.defineProperty(this.prototype,e,{get:n,set:t})},Function.prototype.extend=function(){var t,n,r,i,s,o,u;r=1<=arguments.length?e.call(arguments,0):[],u=[];for(s=0,o=r.length;s<o;s++)n=r[s],u.push(function(){var e;e=[];for(i in n)t=n[i],this.hasOwnProperty(i)?e.push(void 0):e.push(this[i]=t);return e}.call(this));return u},Function.prototype.include=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],Function.prototype.extend.apply(this.prototype,t)}}.call(this),typeof KeyEvent=="undefined"&&(KeyEvent={fake:!0,DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};e=function(e){function t(){var e;e=new Error,this.name=e.name=this.__proto__.constructor.name,e.stack&&(this.stack=e.stack)}return n(t,e),t}(Error),Jax.Error=e}.call(this),Jax.EventEmitter={getEventListeners:function(e){return this.event_listeners=this.event_listeners||{},this.event_listeners[e]=this.event_listeners[e]||{length:0}},addEventListener:function(e,t){var n=this.getEventListeners(e),r=n.length++;return n[r]=t,r},removeEventListener:function(e,t){if(!e||t==undefined)throw new Error("both event type and listener index are required");var n=this.getEventListeners(e);if(t instanceof Function){for(var r=0;r<n.length;r++)if(n[r]===t)return this.removeEventListener(e,r)}else{var i=n[t];n[t]&&delete n[t]}return i},fireEvent:function(e,t){var n=this.getEventListeners(e);t&&t.type==undefined&&(t.type=e);for(var r in n){if(r=="length")continue;n[r].call(this,t)}}},Jax.Framebuffer=function(){function e(e,n){var r=e.gl.createFramebuffer(),i=n.options.width,s=n.options.height;n.setHandle(e,r),e.gl.bindFramebuffer(GL_FRAMEBUFFER,r),(n.extension=e.gl.getExtension("WEBKIT_WEBGL_depth_texture")||e.gl.getExtension("MOZ_WEBGL_depth_texture")||e.gl.getExtension("WEBGL_depth_texture"))?(n.options.depth&&(n.depthTexture=e.gl.createTexture(),e.gl.bindTexture(GL_TEXTURE_2D,n.depthTexture),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE),e.gl.texImage2D(GL_TEXTURE_2D,0,GL_DEPTH_COMPONENT,n.options.width,n.options.height,0,GL_DEPTH_COMPONENT,GL_UNSIGNED_SHORT,null)),n.options.stencil&&(n.stencilTexture=e.gl.createTexture(),e.gl.bindTexture(GL_TEXTURE_2D,n.stencilTexture),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE),e.gl.texParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE),e.gl.texImage2D(GL_TEXTURE_2D,0,GL_DEPTH_COMPONENT,n.options.width,n.options.height,0,GL_DEPTH_COMPONENT,GL_UNSIGNED_SHORT,null))):(n.options.depth&&n.options.stencil&&(r.depthstencilbuffer=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(GL_RENDERBUFFER,r.depthstencilbuffer),e.gl.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_STENCIL,i,s),e.gl.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_STENCIL_ATTACHMENT,GL_RENDERBUFFER,r.depthstencilbuffer),e.gl.bindRenderbuffer(GL_RENDERBUFFER,null)),n.options.depth&&!n.options.stencil&&(r.depthbuffer=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(GL_RENDERBUFFER,r.depthbuffer),e.gl.renderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_COMPONENT16,i,s),e.gl.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_RENDERBUFFER,r.depthbuffer),e.gl.bindRenderbuffer(GL_RENDERBUFFER,null)),n.options.stencil&&!n.options.depth&&(r.stencilbuffer=e.gl.createRenderbuffer(),e.gl.bindRenderbuffer(GL_RENDERBUFFER,r.stencilbuffer),e.gl.renderbufferStorage(GL_RENDERBUFFER,GL_STENCIL_INDEX8,i,s),e.gl.framebufferRenderbuffer(GL_FRAMEBUFFER,GL_STENCIL_ATTACHMENT,GL_RENDERBUFFER,r.stencilbuffer),e.gl.bindRenderbuffer(GL_RENDERBUFFER,null))),r.textures=[];var o=GL_COLOR_ATTACHMENT0;for(var u=0;u<n.options.colors.length;u++){var a=n.options.colors[u],f={format:GL_RGBA,width:i,height:s,min_filter:n.options.min_filter,mag_filter:n.options.mag_filter,wrap_s:n.options.wrap_s,wrap_t:n.options.wrap_t,generate_mipmap:n.options.generate_mipmap,data_type:n.options.data_type};typeof a!="number"?f=Jax.Util.merge(a,f):f.format=a,r.textures[u]=new Jax.Texture(f),r.textures[u].getTarget()==GL_TEXTURE_2D?e.gl.framebufferTexture2D(GL_FRAMEBUFFER,o,GL_TEXTURE_2D,r.textures[u].getHandle(e),0):e.gl.framebufferTexture2D(GL_FRAMEBUFFER,o,GL_TEXTURE_CUBE_MAP_POSITIVE_X,r.textures[u].getHandle(e),0),o++}try{t(e,n)}catch(l){throw n.dispose(e),l}}function t(e,t){var n=e.gl.checkFramebufferStatus(GL_FRAMEBUFFER);t.unbind(e);switch(n){case GL_FRAMEBUFFER_COMPLETE:break;case GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Jax.Framebuffer: one or more attachments is incomplete. (GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Jax.Framebuffer: there are no images attached to the framebuffer. (GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Jax.Framebuffer: all attachments must have the same dimensions. (GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS)");case GL_FRAMEBUFFER_UNSUPPORTED:throw new Error("Jax.Framebuffer: the requested framebuffer layout is unsupported on this hardware. (GL_FRAMEBUFFER_UNSUPPORTED)");case Jax.getGlobal().GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER||36059:throw new Error("Jax.Framebuffer: make sure the framebuffer has at least 1 texture attachment. (GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER)");default:var r;for(r in e.gl)if(e.gl[r]==n)throw new Error("Jax.Framebuffer: an unknown error occurred. ("+n+" - "+r+")");throw new Error("Jax.Framebuffer: an unknown error occurred. ("+n+")")}}return Jax.Class.create({dispose:function(e){if(!this.handles)return;var t=this.getHandle(e);if(!t)return;t.stencilbuffer&&(e.gl.deleteRenderbuffer(t.stencilbuffer),delete t.stencilbuffer),t.depthbuffer&&(e.gl.deleteRenderbuffer(t.depthbuffer),delete t.depthbuffer),t.depthstencilbuffer&&(e.gl.deleteRenderbuffer(t.depthstencilbuffer),delete t.depthstencilbuffer);if(t.textures){while(t.textures.length>0)t.textures[0].dispose(e),t.textures.splice(0,1);delete t.textures}e.gl.deleteFramebuffer(t),this.setHandle(e,null)},initialize:function(e){var t={depth:!1,stencil:!1,width:512,height:512,data_type:GL_UNSIGNED_BYTE,min_filter:GL_LINEAR,mag_filter:GL_LINEAR,wrap_s:GL_CLAMP_TO_EDGE,wrap_t:GL_CLAMP_TO_EDGE,generate_mipmap:!1};if(!e||!e.color&&!e.colors)t.colors=[GL_RGBA];this.handles={},this.options=e=Jax.Util.merge(e,t),e.color!=undefined&&(e.colors!=undefined?e.colors.push(e.color):e.colors=[e.color],delete e.color)},bindCubeFace:function(e,t,n,r){var i=this.getTexture(e,t);if(i.options.target!=GL_TEXTURE_CUBE_MAP)throw new Error("Texture at index "+t+" is not a cube map!");return this.bind(e),e.gl.framebufferTexture2D(GL_FRAMEBUFFER,window["GL_COLOR_ATTACHMENT"+t],n,i.getHandle(e),0),r&&(r(),this.unbind(e)),this},bind:function(e,t){return this.validate(e),e.gl.bindFramebuffer(GL_FRAMEBUFFER,this.getHandle(e)),t&&(t.call(this),this.unbind(e)),this},validate:function(t){return this.getHandle(t)||e(t,this),this},countTextures:function(e){return this.validate().getHandle(e).textures.length},unbind:function(e){return e.gl.bindFramebuffer(GL_FRAMEBUFFER,null),this},viewport:function(e){return e.gl.viewport(0,0,this.options.width,this.options.height),this},getDepthTexture:function(e){return this.validate(e),this.depthTexture},getStencilTexture:function(e){return this.validate(e),self.stencilTexture},getTexture:function(e,t){return this.validate(e),this.getHandle(e).textures[t||0]},getTextureHandle:function(e,t){return this.getTexture(e,t).getHandle(e)},getHandle:function(e){return this.handles[e.id]},setHandle:function(e,t){return t?this.handles[e.id]=t:this.handles[e.id]&&delete this.handles[e.id],this}})}(),function(){var e;e=Jax.getGlobal(),e.GL_DEPTH_BUFFER_BIT=256,e.GL_STENCIL_BUFFER_BIT=1024,e.GL_COLOR_BUFFER_BIT=16384,e.GL_POINTS=0,e.GL_LINES=1,e.GL_LINE_LOOP=2,e.GL_LINE_STRIP=3,e.GL_TRIANGLES=4,e.GL_TRIANGLE_STRIP=5,e.GL_TRIANGLE_FAN=6,e.GL_ZERO=0,e.GL_ONE=1,e.GL_SRC_COLOR=768,e.GL_ONE_MINUS_SRC_COLOR=769,e.GL_SRC_ALPHA=770,e.GL_ONE_MINUS_SRC_ALPHA=771,e.GL_DST_ALPHA=772,e.GL_ONE_MINUS_DST_ALPHA=773,e.GL_DST_COLOR=774,e.GL_ONE_MINUS_DST_COLOR=775,e.GL_SRC_ALPHA_SATURATE=776,e.GL_FUNC_ADD=32774,e.GL_BLEND_EQUATION=32777,e.GL_BLEND_EQUATION_RGB=32777,e.GL_BLEND_EQUATION_ALPHA=34877,e.GL_FUNC_SUBTRACT=32778,e.GL_FUNC_REVERSE_SUBTRACT=32779,e.GL_BLEND_DST_RGB=32968,e.GL_BLEND_SRC_RGB=32969,e.GL_BLEND_DST_ALPHA=32970,e.GL_BLEND_SRC_ALPHA=32971,e.GL_CONSTANT_COLOR=32769,e.GL_ONE_MINUS_CONSTANT_COLOR=32770,e.GL_CONSTANT_ALPHA=32771,e.GL_ONE_MINUS_CONSTANT_ALPHA=32772,e.GL_BLEND_COLOR=32773,e.GL_ARRAY_BUFFER=34962,e.GL_ELEMENT_ARRAY_BUFFER=34963,e.GL_ARRAY_BUFFER_BINDING=34964,e.GL_ELEMENT_ARRAY_BUFFER_BINDING=34965,e.GL_STREAM_DRAW=35040,e.GL_STATIC_DRAW=35044,e.GL_DYNAMIC_DRAW=35048,e.GL_BUFFER_SIZE=34660,e.GL_BUFFER_USAGE=34661,e.GL_CURRENT_VERTEX_ATTRIB=34342,e.GL_FRONT=1028,e.GL_BACK=1029,e.GL_FRONT_AND_BACK=1032,e.GL_CULL_FACE=2884,e.GL_BLEND=3042,e.GL_DITHER=3024,e.GL_STENCIL_TEST=2960,e.GL_DEPTH_TEST=2929,e.GL_SCISSOR_TEST=3089,e.GL_POLYGON_OFFSET_FILL=32823,e.GL_SAMPLE_ALPHA_TO_COVERAGE=32926,e.GL_SAMPLE_COVERAGE=32928,e.GL_NO_ERROR=0,e.GL_INVALID_ENUM=1280,e.GL_INVALID_VALUE=1281,e.GL_INVALID_OPERATION=1282,e.GL_OUT_OF_MEMORY=1285,e.GL_CW=2304,e.GL_CCW=2305,e.GL_LINE_WIDTH=2849,e.GL_ALIASED_POINT_SIZE_RANGE=33901,e.GL_ALIASED_LINE_WIDTH_RANGE=33902,e.GL_CULL_FACE_MODE=2885,e.GL_FRONT_FACE=2886,e.GL_DEPTH_RANGE=2928,e.GL_DEPTH_WRITEMASK=2930,e.GL_DEPTH_CLEAR_VALUE=2931,e.GL_DEPTH_FUNC=2932,e.GL_STENCIL_CLEAR_VALUE=2961,e.GL_STENCIL_FUNC=2962,e.GL_STENCIL_FAIL=2964,e.GL_STENCIL_PASS_DEPTH_FAIL=2965,e.GL_STENCIL_PASS_DEPTH_PASS=2966,e.GL_STENCIL_REF=2967,e.GL_STENCIL_VALUE_MASK=2963,e.GL_STENCIL_WRITEMASK=2968,e.GL_STENCIL_BACK_FUNC=34816,e.GL_STENCIL_BACK_FAIL=34817,e.GL_STENCIL_BACK_PASS_DEPTH_FAIL=34818,e.GL_STENCIL_BACK_PASS_DEPTH_PASS=34819,e.GL_STENCIL_BACK_REF=36003,e.GL_STENCIL_BACK_VALUE_MASK=36004,e.GL_STENCIL_BACK_WRITEMASK=36005,e.GL_VIEWPORT=2978,e.GL_SCISSOR_BOX=3088,e.GL_COLOR_CLEAR_VALUE=3106,e.GL_COLOR_WRITEMASK=3107,e.GL_UNPACK_ALIGNMENT=3317,e.GL_PACK_ALIGNMENT=3333,e.GL_MAX_TEXTURE_SIZE=3379,e.GL_MAX_VIEWPORT_DIMS=3386,e.GL_SUBPIXEL_BITS=3408,e.GL_RED_BITS=3410,e.GL_GREEN_BITS=3411,e.GL_BLUE_BITS=3412,e.GL_ALPHA_BITS=3413,e.GL_DEPTH_BITS=3414,e.GL_STENCIL_BITS=3415,e.GL_POLYGON_OFFSET_UNITS=10752,e.GL_POLYGON_OFFSET_FACTOR=32824,e.GL_TEXTURE_BINDING_2D=32873,e.GL_SAMPLE_BUFFERS=32936,e.GL_SAMPLES=32937,e.GL_SAMPLE_COVERAGE_VALUE=32938,e.GL_SAMPLE_COVERAGE_INVERT=32939,e.GL_COMPRESSED_TEXTURE_FORMATS=34467,e.GL_DONT_CARE=4352,e.GL_FASTEST=4353,e.GL_NICEST=4354,e.GL_GENERATE_MIPMAP_HINT=33170,e.GL_BYTE=5120,e.GL_UNSIGNED_BYTE=5121,e.GL_SHORT=5122,e.GL_UNSIGNED_SHORT=5123,e.GL_INT=5124,e.GL_UNSIGNED_INT=5125,e.GL_FLOAT=5126,e.GL_DEPTH_COMPONENT=6402,e.GL_ALPHA=6406,e.GL_RGB=6407,e.GL_RGBA=6408,e.GL_LUMINANCE=6409,e.GL_LUMINANCE_ALPHA=6410,e.GL_UNSIGNED_SHORT_4_4_4_4=32819,e.GL_UNSIGNED_SHORT_5_5_5_1=32820,e.GL_UNSIGNED_SHORT_5_6_5=33635,e.GL_FRAGMENT_SHADER=35632,e.GL_VERTEX_SHADER=35633,e.GL_MAX_VERTEX_ATTRIBS=34921,e.GL_MAX_VERTEX_UNIFORM_VECTORS=36347,e.GL_MAX_VARYING_VECTORS=36348,e.GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,e.GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,e.GL_MAX_TEXTURE_IMAGE_UNITS=34930,e.GL_MAX_FRAGMENT_UNIFORM_VECTORS=36349,e.GL_SHADER_TYPE=35663,e.GL_DELETE_STATUS=35712,e.GL_LINK_STATUS=35714,e.GL_VALIDATE_STATUS=35715,e.GL_ATTACHED_SHADERS=35717,e.GL_ACTIVE_UNIFORMS=35718,e.GL_ACTIVE_ATTRIBUTES=35721,e.GL_SHADING_LANGUAGE_VERSION=35724,e.GL_CURRENT_PROGRAM=35725,e.GL_NEVER=512,e.GL_LESS=513,e.GL_EQUAL=514,e.GL_LEQUAL=515,e.GL_GREATER=516,e.GL_NOTEQUAL=517,e.GL_GEQUAL=518,e.GL_ALWAYS=519,e.GL_KEEP=7680,e.GL_REPLACE=7681,e.GL_INCR=7682,e.GL_DECR=7683,e.GL_INVERT=5386,e.GL_INCR_WRAP=34055,e.GL_DECR_WRAP=34056,e.GL_VENDOR=7936,e.GL_RENDERER=7937,e.GL_VERSION=7938,e.GL_NEAREST=9728,e.GL_LINEAR=9729,e.GL_NEAREST_MIPMAP_NEAREST=9984,e.GL_LINEAR_MIPMAP_NEAREST=9985,e.GL_NEAREST_MIPMAP_LINEAR=9986,e.GL_LINEAR_MIPMAP_LINEAR=9987,e.GL_TEXTURE_MAG_FILTER=10240,e.GL_TEXTURE_MIN_FILTER=10241,e.GL_TEXTURE_WRAP_S=10242,e.GL_TEXTURE_WRAP_T=10243,e.GL_TEXTURE_2D=3553,e.GL_TEXTURE=5890,e.GL_TEXTURE_CUBE_MAP=34067,e.GL_TEXTURE_BINDING_CUBE_MAP=34068,e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=34069,e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=34070,e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=34071,e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=34073,e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,e.GL_MAX_CUBE_MAP_TEXTURE_SIZE=34076,e.GL_TEXTURE0=33984,e.GL_TEXTURE1=33985,e.GL_TEXTURE2=33986,e.GL_TEXTURE3=33987,e.GL_TEXTURE4=33988,e.GL_TEXTURE5=33989,e.GL_TEXTURE6=33990,e.GL_TEXTURE7=33991,e.GL_TEXTURE8=33992,e.GL_TEXTURE9=33993,e.GL_TEXTURE10=33994,e.GL_TEXTURE11=33995,e.GL_TEXTURE12=33996,e.GL_TEXTURE13=33997,e.GL_TEXTURE14=33998,e.GL_TEXTURE15=33999,e.GL_TEXTURE16=34e3,e.GL_TEXTURE17=34001,e.GL_TEXTURE18=34002,e.GL_TEXTURE19=34003,e.GL_TEXTURE20=34004,e.GL_TEXTURE21=34005,e.GL_TEXTURE22=34006,e.GL_TEXTURE23=34007,e.GL_TEXTURE24=34008,e.GL_TEXTURE25=34009,e.GL_TEXTURE26=34010,e.GL_TEXTURE27=34011,e.GL_TEXTURE28=34012,e.GL_TEXTURE29=34013,e.GL_TEXTURE30=34014,e.GL_TEXTURE31=34015,e.GL_ACTIVE_TEXTURE=34016,e.GL_REPEAT=10497,e.GL_CLAMP_TO_EDGE=33071,e.GL_MIRRORED_REPEAT=33648,e.GL_FLOAT_VEC2=35664,e.GL_FLOAT_VEC3=35665,e.GL_FLOAT_VEC4=35666,e.GL_INT_VEC2=35667,e.GL_INT_VEC3=35668,e.GL_INT_VEC4=35669,e.GL_BOOL=35670,e.GL_BOOL_VEC2=35671,e.GL_BOOL_VEC3=35672,e.GL_BOOL_VEC4=35673,e.GL_FLOAT_MAT2=35674,e.GL_FLOAT_MAT3=35675,e.GL_FLOAT_MAT4=35676,e.GL_SAMPLER_2D=35678,e.GL_SAMPLER_CUBE=35680,e.GL_VERTEX_ATTRIB_ARRAY_ENABLED=34338,e.GL_VERTEX_ATTRIB_ARRAY_SIZE=34339,e.GL_VERTEX_ATTRIB_ARRAY_STRIDE=34340,e.GL_VERTEX_ATTRIB_ARRAY_TYPE=34341,e.GL_VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,e.GL_VERTEX_ATTRIB_ARRAY_POINTER=34373,e.GL_VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,e.GL_COMPILE_STATUS=35713,e.GL_LOW_FLOAT=36336,e.GL_MEDIUM_FLOAT=36337,e.GL_HIGH_FLOAT=36338,e.GL_LOW_INT=36339,e.GL_MEDIUM_INT=36340,e.GL_HIGH_INT=36341,e.GL_FRAMEBUFFER=36160,e.GL_RENDERBUFFER=36161,e.GL_RGBA4=32854,e.GL_RGB5_A1=32855,e.GL_RGB565=36194,e.GL_DEPTH_COMPONENT16=33189,e.GL_STENCIL_INDEX=6401,e.GL_STENCIL_INDEX8=36168,e.GL_DEPTH_STENCIL=34041,e.GL_RENDERBUFFER_WIDTH=36162,e.GL_RENDERBUFFER_HEIGHT=36163,e.GL_RENDERBUFFER_INTERNAL_FORMAT=36164,e.GL_RENDERBUFFER_RED_SIZE=36176,e.GL_RENDERBUFFER_GREEN_SIZE=36177,e.GL_RENDERBUFFER_BLUE_SIZE=36178,e.GL_RENDERBUFFER_ALPHA_SIZE=36179,e.GL_RENDERBUFFER_DEPTH_SIZE=36180,e.GL_RENDERBUFFER_STENCIL_SIZE=36181,e.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,e.GL_FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,e.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,e.GL_FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,e.GL_COLOR_ATTACHMENT0=36064,e.GL_DEPTH_ATTACHMENT=36096,e.GL_STENCIL_ATTACHMENT=36128,e.GL_DEPTH_STENCIL_ATTACHMENT=33306,e.GL_NONE=0,e.GL_FRAMEBUFFER_COMPLETE=36053,e.GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,e.GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,e.GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,e.GL_FRAMEBUFFER_UNSUPPORTED=36061,e.GL_FRAMEBUFFER_BINDING=36006,e.GL_RENDERBUFFER_BINDING=36007,e.GL_MAX_RENDERBUFFER_SIZE=34024,e.GL_INVALID_FRAMEBUFFER_OPERATION=1286,e.GL_UNPACK_FLIP_Y_WEBGL=37440,e.GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,e.GL_CONTEXT_LOST_WEBGL=37442,e.GL_UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,e.GL_BROWSER_DEFAULT_WEBGL=37444}.call(this),Jax.Helper={instances:[],create:function(e){return Jax.Helper.instances.push(e),e}},Math.EPSILON=Math.EPSILON||1e-5,Math.radToDeg=Math.radToDeg||function(e){return e*180/Math.PI},Math.rad2deg=Math.rad2deg||Math.radToDeg,Math.degToRad=Math.degToRad||function(e){return e*Math.PI/180},Math.deg2rad=Math.deg2rad||Math.degToRad,Math.equalish=Math.equalish||function(e,t){if(!e.length&&!t.length)return Math.abs(e-t)<=Math.EPSILON;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]===undefined||t[n]===undefined||isNaN(e[n])!==isNaN(t[n])||isFinite(e[n])!==isFinite(t[n])||Math.abs(e[n]-t[n])>Math.EPSILON)return!1;return!0},function(){Jax.MatrixStack=function(){function e(){this.maxDepth=0,this.valid={inverseModel:[!0],normal:[!0],inverseView:[!0],viewNormal:[!0],modelNormal:[!0],inverseViewNormal:[!0],modelView:[!0],inverseModelView:[!0],inverseProjection:[!0],modelViewProjection:[!0]},this.matrices={model:[mat4.identity()],inverseModel:[mat4.identity()],normal:[mat3.identity()],modelNormal:[mat3.identity()],view:[mat4.identity()],inverseView:[mat4.identity()],viewNormal:[mat3.identity()],inverseViewNormal:[mat3.identity()],modelView:[mat4.identity()],inverseModelView:[mat4.identity()],projection:[mat4.identity()],inverseProjection:[mat4.identity()],modelViewProjection:[mat4.identity()]},this.reset()}var t;return t=["model","view","projection","inverseModel","inverseView","inverseProjection","normal","viewNormal","modelNormal","inverseViewNormal","modelView","modelViewProjection","inverseModelView"],e.prototype.reset=function(){return this.depth=0},e.prototype.push=function(){var e,t,n,r;this.depth++;if(this.depth>this.maxDepth){n=this.matrices;for(t in n){e=n[t];while(e.length<=this.depth)e.push(new Float32Array(e[e.length-1]))}r=this.valid;for(t in r){e=r[t];while(e.length<=this.depth)e.push(e[e.length-1])}this.maxDepth=this.depth}return this.loadModelMatrix(this.matrices.model[this.depth-1]),this.loadViewMatrix(this.matrices.view[this.depth-1]),this.loadProjectionMatrix(this.matrices.projection[this.depth-1]),!0},e.prototype.pop=function(){return this.depth<1&&(this.depth=1),this.depth--},e.prototype.loadModelMatrix=function(e){return this.valid.inverseModel[this.depth]=!1,this.valid.normal[this.depth]=!1,this.valid.modelNormal[this.depth]=!1,this.valid.modelView[this.depth]=!1,this.valid.inverseModelView[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.set(e,this.getModelMatrix())},e.prototype.loadViewMatrix=function(e){return this.valid.inverseView[this.depth]=!1,this.valid.viewNormal[this.depth]=!1,this.valid.inverseViewNormal[this.depth]=!1,this.valid.modelView[this.depth]=!1,this.valid.inverseModelView[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.set(e,this.getViewMatrix())},e.prototype.loadProjectionMatrix=function(e){return this.valid.inverseProjection[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.set(e,this.getProjectionMatrix())},e.prototype.multModelMatrix=function(e){return this.valid.inverseModel[this.depth]=!1,this.valid.normal[this.depth]=!1,this.valid.modelNormal[this.depth]=!1,this.valid.modelView[this.depth]=!1,this.valid.inverseModelView[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.multiply(this.getModelMatrix(),e,this.getModelMatrix())},e.prototype.multViewMatrix=function(e){return this.valid.inverseView[this.depth]=!1,this.valid.viewNormal[this.depth]=!1,this.valid.inverseViewNormal[this.depth]=!1,this.valid.modelView[this.depth]=!1,this.valid.inverseModelView[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.multiply(this.getViewMatrix(),e,this.getViewMatrix())},e.prototype.multProjectionMatrix=function(e){return this.valid.inverseProjection[this.depth]=!1,this.valid.modelViewProjection[this.depth]=!1,mat4.multiply(this.getProjectionMatrix(),e,this.getProjectionMatrix())},e.prototype.getModelMatrix=function(){return this.matrices.model[this.depth]},e.prototype.getViewMatrix=function(){return this.matrices.view[this.depth]},e.prototype.getProjectionMatrix=function(){return this.matrices.projection[this.depth]},e.prototype.getModelViewMatrix=function(){return this.valid.modelView[this.depth]?this.matrices.modelView[this.depth]:(this.valid.modelView[this.depth]=!0,mat4.multiply(this.getViewMatrix(),this.getModelMatrix(),this.matrices.modelView[this.depth]))},e.prototype.getInverseModelViewMatrix=function(){return this.valid.inverseModelView[this.depth]?this.matrices.inverseModelView[this.depth]:(this.valid.inverseModelView[this.depth]=!0,mat4.inverse(this.getModelViewMatrix(),this.matrices.inverseModelView[this.depth]))},e.prototype.getModelViewProjectionMatrix=function(){return this.valid.modelViewProjection[this.depth]?this.matrices.modelViewProjection[this.depth]:(this.valid.modelViewProjection[this.depth]=!0,mat4.multiply(this.getProjectionMatrix(),this.getModelViewMatrix(),this.matrices.modelViewProjection[this.depth]))},e.prototype.getNormalMatrix=function(){return this.valid.normal[this.depth]?this.matrices.normal[this.depth]:(this.valid.normal[this.depth]=!0,mat4.toInverseMat3(this.getModelViewMatrix(),this.matrices.normal[this.depth]),mat3.transpose(this.matrices.normal[this.depth]))},e.prototype.getViewNormalMatrix=function(){return this.valid.viewNormal[this.depth]?this.matrices.viewNormal[this.depth]:(this.valid.viewNormal[this.depth]=!0,mat4.toInverseMat3(this.getViewMatrix(),this.matrices.viewNormal[this.depth]),mat3.transpose(this.matrices.viewNormal[this.depth]))},e.prototype.getInverseViewNormalMatrix=function(){return this.valid.inverseViewNormal[this.depth]?this.matrices.inverseViewNormal[this.depth]:(this.valid.inverseViewNormal[this.depth]=!0,mat4.toInverseMat3(this.getInverseViewMatrix(),this.matrices.inverseViewNormal[this.depth]),mat3.transpose(this.matrices.inverseViewNormal[this.depth]))},e.prototype.getModelNormalMatrix=function(){return this.valid.modelNormal[this.depth]?this.matrices.modelNormal[this.depth]:(this.valid.modelNormal[this.depth]=!0,mat4.toInverseMat3(this.getModelMatrix(),this.matrices.modelNormal[this.depth]),mat3.transpose(this.matrices.modelNormal[this.depth]))},e.prototype.getInverseModelMatrix=function(){return this.valid.inverseModel[this.depth]?this.matrices.inverseModel[this.depth]:(this.valid.inverseModel[this.depth]=!0,mat4.inverse(this.getModelMatrix(),this.matrices.inverseModel[this.depth]))},e.prototype.getInverseViewMatrix=function(){return this.valid.inverseView[this.depth]?this.matrices.inverseView[this.depth]:(this.valid.inverseView[this.depth]=!0,mat4.inverse(this.getViewMatrix(),this.matrices.inverseView[this.depth]))},e.prototype.getInverseProjectionMatrix=function(){return this.valid.inverseProjection[this.depth]?this.matrices.inverseProjection[this.depth]:(this.valid.inverseProjection[this.depth]=!0,mat4.inverse(this.getProjectionMatrix(),this.matrices.inverseProjection[this.depth]))},e}()}.call(this),Jax.NORMAL_MAP=1,Jax.Texture=function(){function e(e,t){throw new Error("Texture image '"+e.image.src+"' failed to load!")}function t(e){return e&&(e&-e)==e}function n(e,n,r){var i=e.options.onload||e.onload;if(!t(r.width)||!t(r.height))e.options.mag_filter=GL_LINEAR,e.options.min_filter=GL_LINEAR,e.options.wrap_s=GL_CLAMP_TO_EDGE,e.options.wrap_t=GL_CLAMP_TO_EDGE,e.options.generate_mipmap=!1;n?(e.images.load_count++,e.images.load_count==e.images.length&&(i&&i.call(e,e.image),e.loaded=!0)):(i&&i.call(e,e.image),e.loaded=!0)}function r(e,t){e.handles[t.id]=t.gl.createTexture()}function i(e,t){var n=t.options.data_type,r=t.options.format,i=t.options.target;if(t.image)switch(i){case GL_TEXTURE_2D:e.gl.texImage2D(i,0,r,r,n,t.image);break;case GL_TEXTURE_CUBE_MAP:e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X,0,r,r,n,t.image),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,r,n,t.image),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,r,n,t.image),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,r,n,t.image),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,r,n,t.image),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,r,n,t.image);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}else if(t.images)switch(i){case GL_TEXTURE_2D:e.gl.texImage2D(i,0,r,r,n,t.images[0]);break;case GL_TEXTURE_CUBE_MAP:e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_X]||t.images[0]),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_Y]||t.images[1]),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_Z]||t.images[2]),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_X]||t.images[3]),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_Y]||t.images[4]),e.gl.texImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_Z]||t.images[5]);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}else{var s=t.options.width,o=t.options.height;if(!s||!o)throw new Error("Can't build an empty texture without at least a width and height");function u(t){try{e.gl.texImage2D(t,0,r,s,o,0,r,n,null)}catch(i){var u=new Uint8Array(s*o*Jax.Util.sizeofFormat(r));e.gl.texImage2D(t,0,r,s,o,0,r,n,u)}}switch(i){case GL_TEXTURE_2D:u(GL_TEXTURE_2D);break;case GL_TEXTURE_CUBE_MAP:u(GL_TEXTURE_CUBE_MAP_POSITIVE_X),u(GL_TEXTURE_CUBE_MAP_POSITIVE_Y),u(GL_TEXTURE_CUBE_MAP_POSITIVE_Z),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_X),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}}}function s(e,t,n){t==null&&(t=Jax.Texture._level++),e.textureLevel=t,e.SLOT=n.gl["TEXTURE"+t],n.gl.activeTexture(e.SLOT)}function o(e,t){Jax.Texture._level=e.textureLevel-1,Jax.Texture._level<0&&(Jax.Texture._level=0),delete e.textureLevel,e.SLOT=null}return Jax.Class.create({initialize:function(t,r){this.handles={},this.loaded=!1,this.valid={},!r&&typeof t=="object"&&t.length==undefined&&(r=t,t=r.path||null,delete r.path);var i=this;this.options=r=r||{},r.min_filter=r.min_filter||GL_NEAREST,r.mag_filter=r.mag_filter||GL_NEAREST,r.generate_mipmap=r.generate_mipmap===undefined?!0:r.generate_mipmap,r.mipmap_hint=r.mipmap_hint||GL_DONT_CARE,r.format=r.format||GL_RGBA,r.target=r.target||null,r.data_type=r.data_type||GL_UNSIGNED_BYTE,r.wrap_s=r.wrap_s||GL_REPEAT,r.wrap_t=r.wrap_t||GL_REPEAT,r.flip_y=r.flip_y===undefined?!1:r.flip_y,r.premultiply_alpha=r.premultiply_alpha===undefined?!1:r.premultiply_alpha,r.colorspace_conversion=r.colorspace_conversion===undefined?!0:r.colorspace_conversion,r.onload=r.onload||null;var s,o=["min_filter","mag_filter","mipmap_hint","format","target","data_type","wrap_s","wrap_t"],u=Jax.getGlobal();for(s=0;s<o.length;s++)typeof this.options[o[s]]=="string"&&(this.options[o[s]]=u[this.options[o[s]]]);if(t)if(typeof t=="string")this.options.target=this.options.target||GL_TEXTURE_2D,this.image=new Image,this.image.onload=function(){n(i,!1,this)},this.image.onerror=this.image.onabort=function(){e(i,this)},this.image.src=t;else{var a=function(){n(i,!0,this)};this.options.target=
this.options.target||GL_TEXTURE_CUBE_MAP,this.images=[],this.images.load_count=0;for(s=0;s<t.length;s++)this.images[s]=new Image,this.images[s].onload=a,this.images[s].onerror=this.images[s].onabort=function(){e(i,this)},this.images[s].src=t[s]}else this.options.target=this.options.target||GL_TEXTURE_2D,this.options.generate_mipmap=!!r&&!!r.generate_mipmap,this.loaded=!0},getTarget:function(){return this.options.target},getMinFilter:function(){return this.options.min_filter},getMagFilter:function(){return this.options.mag_filter},getGeneratesMipmaps:function(){return this.options.generate_mipmap},getMipmapHint:function(){return this.options.mipmap_hint},getFormat:function(){return this.options.format},getDataType:function(){return this.options.data_type},getWrapS:function(){return this.options.wrap_s},getWrapT:function(){return this.options.wrap_t},getFlipY:function(){return this.options.flip_y},getPremultipliesAlpha:function(){return this.options.premultiply_alpha},getDoesColorspaceConversion:function(){return this.options.colorspace_conversion},getOnloadFunc:function(){return this.options.onload},refresh:function(e){if(!this.ready())return;return e.gl.bindTexture(this.options.target,this.getHandle(e)),i(e,this),e.gl.texParameteri(this.options.target,GL_TEXTURE_MAG_FILTER,this.options.mag_filter),e.gl.texParameteri(this.options.target,GL_TEXTURE_MIN_FILTER,this.options.min_filter),e.gl.texParameteri(this.options.target,GL_TEXTURE_WRAP_S,this.options.wrap_s),e.gl.texParameteri(this.options.target,GL_TEXTURE_WRAP_T,this.options.wrap_t),e.gl.pixelStorei(GL_UNPACK_FLIP_Y_WEBGL,this.options.flip_y),e.gl.pixelStorei(GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiply_alpha),e.gl.pixelStorei(GL_UNPACK_COLORSPACE_CONVERSION_WEBGL,this.options.colorspace_conversion?GL_BROWSER_DEFAULT_WEBGL:GL_NONE),this.options.generate_mipmap&&this.generateMipmap(e),e.gl.bindTexture(this.options.target,null),this.valid[e.id]=!0,this},generateMipmap:function(e){return e.gl.generateMipmap(this.options.target),this},invalidate:function(){return this.valid.clear(),this},dispose:function(e){e.gl.deleteTexture(this.getHandle(e)),delete this.handles[e.id]},getHandle:function(e){return this.handles[e.id]||(r(this,e),this.refresh(e)),this.handles[e.id]},isValid:function(e){return!!this.valid[e.id]},bind:function(e,t,n){if(!this.ready())return;return this.isValid(e)||this.refresh(e),typeof t=="number"?s(this,t,e):typeof t=="function"&&(n=t,s(this,null,e)),e.gl.bindTexture(this.options.target,this.getHandle(e)),n&&(n.call(this,this.textureLevel),this.unbind(e)),this},unbind:function(e){return this.textureLevel!=undefined&&e.gl.activeTexture(this.SLOT),e.gl.bindTexture(this.options.target,null),o(this,e),this},ready:function(){return this.loaded}})}(),Jax.Texture._level=0,Jax.Util={findMaterial:function(e){if(typeof e=="string")return Jax.Material.find(e);if(e instanceof Jax.Material)return e;throw new Error("Material must be an instance of Jax.Material, or a string representing a material in the Jax material registry")},hash:function(e){var t=0;if(e.length==0)return t;for(i=0;i<e.length;i++){var n=e.charCodeAt(i);t=(t<<5)-t+n,t&=t}return t},scan:function(e,t,n,r,i,s,o,u){t=t||")",n=n||"(",r=r||t,s=s||"//",o=o||"/*",u=u||"*/",i=i||0;var a=0,f="",l=0;for(var c=i;c<e.length;c++){var h=e[c];switch(h){case n:l||a++;break;case r:l||a--}if(a<0)break;f+=h,f.length>=s.length&&f.substring(f.length-s.length,f.length)===s&&(l=1),l===1&&h==="\n"&&(l=0),!l&&f.length>=o.length&&f.substring(f.length-o.length,f.length)===o&&(l=2),l===2&&f.length>=u.length&&f.substring(f.length-u.length,f.length)===u&&(l=0)}return f},gsub:function(e,t,n){var r,i,s,o;if(t==null||n==null)return e;i="";while(e.length>0)if(r=e.match(t)){o=n;while(s=o.match(/\\(\d+)/))o=o.replace("\\"+s[1],r[s[1]]);i+=e.slice(0,r.index),i+=o,e=e.slice(r.index+r[0].length)}else i+=e,e="";return i},underscore:function(e){e=Jax.Util.gsub(e,/::/,"/"),e=Jax.Util.gsub(e,/([A-Z]+)([A-Z][a-z])/,"\\1_\\2"),e=Jax.Util.gsub(e,/([a-z\d])([A-Z])/,"\\1_\\2");while(e.indexOf("-")!=-1)e=e.replace("-","_");return e.toLowerCase()},decodePickingColor:function(e,t,n,r){return n==1&&(e*=255,t*=255),e*256+t},vectorize:function(e){if(e){var t=[];if(typeof e=="string"){var n=e.split(/[,\s]+/);if(n.length>=2)for(var r=0;r<n.length;r++)t[r]=parseFloat(n[r]);return t}if(e.length&&e.length>=3)return vec3.set(e,t);if(e.length==2)return[e[0],e[1]];if((t[0]=e.x)!=undefined&&(t[1]=e.y)!=undefined)return e.z!=undefined&&(t[2]=e.z),t;if((t[0]=e[0])!=undefined&&(t[1]=e[1])!=undefined)return e[2]!=undefined&&(t[2]=e[2]),t}throw new Error("Input argument for Jax.Util.vectorize not recognized: "+JSON.stringify(e))},colorize:function(e){if(e){var t=[0,0,0,0];if(typeof e=="string"){var n=e.split(/[,\s]+/);if(n.length>=3)for(var r=0;r<4;r++)n.length<=r?t[r]=1:t[r]=parseFloat(n[r]);return t}if(e.length&&e.length>=3)return t[0]=e[0],t[1]=e[1],t[2]=e[2],(t[3]=e[3])==undefined?t[3]=1:t[3]=1,t;if((t[0]=e.r)!=undefined&&(t[1]=e.g)!=undefined&&(t[2]=e.b)!=undefined)return(t[3]=e.a)==undefined&&(t[3]=1),t;if((t[0]=e.red)!=undefined&&(t[1]=e.green)!=undefined&&(t[2]=e.blue)!=undefined)return(t[3]=e.alpha)==undefined&&(t[3]=1),t;if((t[0]=e[0])!=undefined&&(t[1]=e[1])!=undefined&&(t[2]=e[2])!=undefined)return(t[3]=e[3])==undefined&&(t[3]=1),t}throw new Error("Input argument for Jax.Util.colorize not recognized: "+JSON.stringify(e))},properties:function(e){var t=[];for(var n in e)t.push(n);return t},merge:function(e,t){function n(n){if(e[n]==null)t[n]=null;else if(e[n].klass)t[n]=e[n];else if(Object.isArray(e[n]))Jax.Util.merge(e[n],t[n]=t[n]||[]);else if(typeof e[n]=="object"){if(Object.isArray(t[n])){s={};for(i=0;i<t[n].length;i++)s[i]=t[n][i];t[n]=s}Jax.Util.merge(e[n],t[n]=t[n]||new function(){})}else t[n]=e[n]}if(!e)return t;var r,i,s;if(Object.isArray(e))for(r=0;r<e.length;r++)n(r);else for(r in e)n(r);return t},normalizeOptions:function(e,t){var n=new function(){};return Jax.Util.merge(t,n),Jax.Util.merge(e,n),n},sizeofFormat:function(e){switch(e){case GL_ALPHA:return 1;case GL_LUMINANCE:return 1;case GL_RGB:return 3;case GL_RGBA:return 4;case GL_LUMINANCE_ALPHA:return 2}throw new Error("Unrecognized format: "+Jax.Util.enumName(e))},enumName:function(e){var t=Jax.getGlobal();for(var n in t)if(n.indexOf("GL_")==0&&t[n]==e)return n;return"(unrecognized enum: "+e+" [0x"+parseInt(e).toString(16)+"])"},addRequestedHelpers:function(e){var t=[],n;if(typeof ApplicationHelper!="undefined"){t.push(ApplicationHelper);for(n in ApplicationHelper)e.hasOwnProperty(n)||(e[n]=ApplicationHelper[n])}if(e.helpers){var r;typeof e.helpers=="function"?r=e.helpers():r=e.helpers;for(var i=0;i<r.length;i++){t.push(r[i]);for(n in r[i])e.hasOwnProperty(n)||(e[n]=r[i][n])}}return t}},function(){function e(e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}var t=["initialize","toString","getControllerName","constructor","fireAction","eraseResult"];Jax.Controller=function(){return Jax.Class.create({index:function(){},fireAction:function(e){this.eraseResult(),this.action_name=e;if(!this[e])throw new Error("Call to missing action: '"+e+"' in controller '"+this.getControllerName()+"'");return this[e].call(this,[]),this.rendered_or_redirected||(this.view_key=this.getControllerName()+"/"+this.action_name),this.rendered_or_redirected=!0,this},eraseResult:function(){return this.rendered_or_redirected=!1,this.view_key=null,this}})}();var n={invoke:function(e,t){var n=new this;return n.context=t,n.world=t&&t.world,n.activeCamera=t.world.cameras[0],Object.defineProperty(n,"player",{get:function(){return t.player}}),n.fireAction(e),n}};Jax.Controller.create=function(e,t,r){typeof e!="string"&&(r=t,t=e,e="generic");var i;return r?i=Jax.Class.create(t,r):i=Jax.Class.create(Jax.Controller,t),Object.extend(i,n),Object.extend(i,{getControllerName:function(){return e||"generic"}}),i.addMethods({getControllerName:function(){return e||"generic"}}),e&&Jax.routes.map(e,i),i}}(),function(){function e(e,t){t&&t.mesh&&(e.mesh=t.mesh,delete t.mesh),t=Jax.Util.merge(t,{});var n;if(t)for(n in t)switch(n){case"position":e.camera.position=Jax.Util.vectorize(t[n]);break;case"direction":e.camera.direction=Jax.Util.vectorize(t[n]);break;default:e[n]=t[n]}}Jax.Model=function(){return Jax.Class.create({initialize:function(t){var n=this;this.__unique_id=Jax.guid(),this.camera=new Jax.Camera,this.camera.addEventListener("updated",function(){n.fireEvent("transformed")}),e(this,Jax.Model.default_properties),this._klass&&this._klass.resources&&e(this,this._klass.resources["default"]),e(this,t),this.after_initialize&&this.after_initialize()},isShadowCaster:function(){return this.shadow_caster},isShadowcaster:function(){return this.shadow_caster},disableShadows:function(){var e=this.shadow_caster;return this.shadow_caster=!1,e},render:function(e,t){this.mesh&&(Jax.Model.__instances[this.__unique_id]||(Jax.Model.__instances[this.__unique_id]=this),this.pushMatrices(e),this.mesh.render(e,this,t),this.popMatrices(e))},pushMatrices:function(e){e.matrix_stack.push(),e.matrix_stack.multModelMatrix(this.camera.getTransformationMatrix())},popMatrices:function(e){e.matrix_stack.pop()},getBoundingCube:function(){return this.mesh?this.mesh.bounds:{left:0,right:0,bottom:0,top:0,front:0,back:0,width:0,height:0,depth:0}},getBoundingSphereRadius:function(){var e=this.getBoundingCube();return Math.max(e.width,Math.max(e.height,e.depth))},dispose:function(){this.mesh&&this.mesh.dispose(),Jax.Model.__instances[this.__unique_id]&&delete Jax.Model.__instances[this.__unique_id]},isLit:function(){return this.lit},setColor:function(e,t,n,r){return arguments.length>1?this.mesh.setColor(e,t,n,r):this.mesh.setColor(e),this},inspect:function(){result={};for(var e in this)!Object.isFunction(this[e])&&e!="_klass"&&(result[e]=this[e]);return JSON.stringify(result)}})}();var t={find:function(e){for(var t in this.resources)if(e==t)return new this(this.resources[e]);throw new Error("Resource '"+e+"' not found!")},addResources:function(e){this.resources=this.resources||{};for(var t in e){if(this.resources[t])throw new Error("Duplicate resource ID: "+t);this.resources[t]=e[t]}},removeAllResources:function(){this.resources={}}};Jax.Model.default_properties={receiveShadow:!0,castShadow:!0,illuminated:!0,cull:!0},Object.defineProperty(Jax.Model.prototype,"position",{get:function(){return this.camera.position},set:function(e){return this.camera.position=e}}),Object.defineProperty(Jax.Model.prototype,"direction",{get:function(){return this.camera.direction},set:function(e){return this.camera.direction=e}}),Jax.Model.create=function(e,t){var n;return t?n=Jax.Class.create(e,t):n=Jax.Class.create(Jax.Model,e),n.addMethods({_klass:n}),n},Jax.Model.addMethods(Jax.EventEmitter),Jax.Model.__instances={},Object.extend(Jax.Model,t)}(),Jax.RouteSet=function(){return Jax.Class.create({initialize:function(){this.clear()},clear:function(){return this._map={},this},map:function(e,t){if(!e)throw new Error("path is required");var n=e.split(/\//),r=Jax.Util.underscore(n[0]);this._map[r]=t},getControllerNames:function(){return Jax.Util.properties(this._map)},recognizeRoute:function(e){var t=e.split(/\//);if(t.length>2||t.length==0)throw new Error("Invalid path format. String should look like 'controller/action'.");var n=Jax.Util.underscore(t[0]),r=t[1]||"index",i=this._map[Jax.Util.underscore(n)];if(!i||!i.prototype)throw new Error("Route not recognized: '"+e+"' (controller not found)");if(!i.prototype[r])throw new Error("Invalid action name '"+r+"' for controller '"+n+"'.\n\n"+"Valid action names: "+JSON.stringify(Jax.Util.properties(i.prototype)));return{controller:i,action:r}},isRouted:function(e){return!!self._map[e]},dispatch:function(e,t){var n=this.recognizeRoute(e);return n.controller.invoke(n.action,t)}})}(),Jax.View=function(){return Jax.Class.create({initialize:function(e){this.view_func=e},render:function(){return this.view_func(),this}})}(),Jax.ViewManager=function(){return Jax.Class.create({initialize:function(){this.views={}},push:function(e,t){this.views[Jax.Util.underscore(e)]=t},find:function(e){return this.views[Jax.Util.underscore(e)]?new Jax.View(this.views[Jax.Util.underscore(e)]):null},remove:function(e){var t=this.views[Jax.Util.underscore(e)];return delete this.views[Jax.Util.underscore(e)],t},exists:function(e){return!!this.views[Jax.Util.underscore(e)]}})}(),function(){Jax.views=new Jax.ViewManager,Jax.routes=new Jax.RouteSet}.call(this),function(){var e,t,n,r=[].slice;e="0123456789abcdef",t=function(t){var n,r;return n=e.indexOf(t.slice(0,1)),r=e.indexOf(t.slice(1,2)),(n*16+r)/255},n=function(e){var r,i,s,o,u;switch(e.length){case 3:return n(e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+"ff");case 4:return n(e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]);case 6:return n(e+"ff");case 8:return e=e.toLowerCase(),u=[t(e.slice(0,2)),t(e.slice(2,4)),t(e.slice(4,6)),t(e.slice(6,8))],o=u[0],s=u[1],i=u[2],r=u[3],new Jax.Color(o,s,i,r);default:throw new Error("Hex color #"+e+" is invalid: must be 3, 4, 6, or 8 characters")}},Jax.Color=function(){function e(e,t,n,r){e==null&&(e=1),t==null&&(t=1),n==null&&(n=1),r==null&&(r=1),this._vec=vec4.create(arguments),this.set(e,t,n,r)}return e.prototype.toVec4=function(){return this._vec},e.prototype.set=function(e,t,n,i){var s;return this._red=e,this._green=t,this._blue=n,this._alpha=i,s=[this._red,this._green,this._blue,this._alpha],this._vec=1<=s.length?r.call(s,0):[],s},e.define("red",{get:function(){return this._red},set:function(e){return this._red=e,this._vec[0]=this._red}}),e.define("green",{get:function(){return this._green},set:function(e){return this._green=e,this._vec[1]=this._green}}),e.define("blue",{get:function(){return this._blue},set:function(e){return this._blue=e,this._vec[2]=this._blue}}),e.define("alpha",{get:function(){return this._alpha},set:function(e){return this._alpha=e,this._vec[3]=this._alpha}}),e.parse=function(e){var t,r;return typeof e=="string"&&e[0]==="#"?n(e.slice(1)):typeof e=="string"&&(r=e.split(" ")).length!==0?function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Jax.Color,function(){var e,n,i;i=[];for(e=0,n=r.length;e<n;e++)t=r[e],i.push(parseFloat(t));return i}(),function(){}):(e!=null?e.toVec4:void 0)?function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Jax.Color,e.toVec4(),function(){}):(e!=null?e.length:void 0)?function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Jax.Color,e,function(){}):function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t),s=typeof i;return s=="object"||s=="function"?i||r:r}(Jax.Color,Jax.Util.colorize(e),function(){})},e}()}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(){function e(e){var t,n;this._valid=!1,this.data=new Jax.Mesh.Data,this._bounds=new Jax.Mesh.Bounds,this._color=new Jax.Color,this._initialized=!1,this.draw_mode||(this.draw_mode=GL_POINTS);if(e){e.init&&(this.init=e.init),e.draw_mode&&(this.draw_mode=e.draw_mode),this.material=e.material||Jax.default_material,e.color&&(this.color=e.color),delete e.init,delete e.draw_mode,delete e.material,delete e.color;for(t in e)n=e[t],this[t]=n}else this.material=Jax.default_material}var t,n;return e.include(Jax.EventEmitter),e.define("material",{get:function(){return this._invalid||this.validate(),this._material},set:function(e){return e?(e instanceof Jax.Material?this._material=e:this._material=Jax.Material.find(e),this._material.name):this._material=null}}),e.define("data",{get:function(){return this._valid||this.validate(),this._data},set:function(e){var t=this;return this.invalidate(),this._initialized=!0,this._data&&this._data.dispose(),this._data=e,this._data.addEventListener("colorChanged",function(){return t.fireEvent("colorChanged")}),this._data.addEventListener("shouldRecalculateNormals",function(){return t.recalculateNormals()}),this._data.addEventListener("shouldRecalculateTangents",function(){return t.recalculateTangents()}),this._data.addEventListener("shouldRecalculateBitangents",function(){return t.recalculateBitangents()})}}),e.define("color",{get:function(){return this._color},set:function(e){return this._color=e,this._data.color=this._color,this.fireEvent("colorChanged")}}),e.define("vertices",{get:function(){return this._valid||this.validate(),this.data.vertices}}),e.define("indices",{get:function(){return this._valid||this.validate(),this.data.indexBuffer}}),e.define("bounds",{get:function(){return this._valid||this.validate(),this._bounds}}),e.define("submesh",{get:function(){return this._valid||this.validate(),this._submesh},set:function(e){return this._submesh&&this._submesh.dispose(),this._submesh=e}}),e.prototype.draw_mode=GL_POINTS,t=vec3.create(),e.prototype.recalculateNormals=function(){var e,n,r,i,s,o;r=this.data.normalBuffer,i=this.data.vertexBuffer,e=this.bounds.center;for(n=s=0,o=i.length;s<o;n=s+=3)t[0]=i[n],t[1]=i[n+1],t[2]=i[n+2],vec3.subtract(t,e,t),vec3.normalize(t),r[n]=t[0],r[n+1]=t[1],r[n+2]=t[2];return!0},e.prototype.recalculateTangents=function(){throw new Error("Can't calculate tangents for "+this.__proto__.constructor.name)},e.prototype.recalculateBitangents=function(){throw new Error("Can't calculate bitangents for "+this.__proto__.constructor.name)},e.prototype.render=function(e,t,n){return this._valid||this.validate(),n?n instanceof Jax.Material||(n=Jax.Material.find(n)):n=this._material,n.render(e,this,t)},e.prototype.isValid=function(){return this._valid},e.prototype.invalidate=function(e){return e==null&&(e=!1),e&&(this._initialized=!1),this._valid=!1},e.prototype.validate=function(){if(this._valid)return;if(this.__validating)throw new Error("Already validating -- look for recursion errors!");return this.__validating=!0,this._initialized||this.rebuild(),this._material||(this._material=Jax.Material.find("default")),this.recalculateBounds(),this._data.indices_buf&&this._data.indices_buf.dispose(),this._data.indices_buf=new Jax.Buffer(GL_ELEMENT_ARRAY_BUFFER,this._data.indexFormat,GL_STATIC_DRAW,this._data.indexBuffer,1),this.__validating=!1,this._valid=!0,this.fireEvent("validated"),this},e.prototype.rebuild=function(){var e,t,n,r,i,s,o,u;if(!this.init)return;return this.dispose(),this.__validating?(u=[[],[],[],[],[],[],[]],o=u[0],t=u[1],s=u[2],r=u[3],n=u[4],i=u[5],e=u[6],this.init(o,t,s,r,n,i,e),o.length>196605&&(this.submesh=this.split(o,t,s,r,n,i,e)),this.data=new Jax.Mesh.Data(o,t,s,r,n,i,e),this._data.color=this._color,this.fireEvent("rebuilt"),this._initialized=!0,this):this.validate()},e.prototype.split=function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y;a=65535;if(e.length<=a*3)return null;y=h=g=v=null,p=[],y=e.splice(a*3,e.length),t.length>=a*4&&(h=t.splice(a*4,t.length)),n.length>=a*2&&(g=n.splice(a*2,n.length)),r.length>=a*3&&(v=r.splice(a*3,r.length)),s.length>=a*4&&(l=s.splice(a*4,s.length)),o.length>=a*3&&(c=o.splice(a*3,o.length));for(u=d=0,m=i.length;0<=m?d<m:d>m;u=0<=m?++d:--d)i[u]>a&&(p.push(i[u]),i.splice(u,1),u--);return f=new this.__proto__.constructor({init:function(e,t,n,r,i){var s,o,u,a,f,d,m,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D;for(b=0,E=y.length;b<E;b++)m=y[b],e.push(m);if(h)for(w=0,S=h.length;w<S;w++)u=h[w],t.push(u);if(g)for(L=0,x=g.length;L<x;L++)d=g[L],n.push(d);if(v)for(A=0,T=v.length;A<T;A++)f=v[A],r.push(f);if(l)for(O=0,N=l.length;O<N;O++)s=l[O],r.push(s);if(c)for(M=0,C=c.length;M<C;M++)o=c[M],r.push(o);D=[];for(_=0,k=p.length;_<k;_++)a=p[_],D.push(i.push(a-65535));return D}})},n=vec3.create(),e.prototype.recalculateBounds=function(){var e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;m=[this._bounds.left,this._bounds.right,this._bounds.top,this._bounds.bottom,this._bounds.front,this._bounds.back],f=m[0],h=m[1],p=m[2],r=m[3],o=m[4],e=m[5],i=this._bounds.center,l=this._data.vertexBuffer.length,c=n,t=0;for(a=v=0;v<l;a=v+=3)c[0]=this._data.vertexBuffer[a],c[1]=this._data.vertexBuffer[a+1],c[2]=this._data.vertexBuffer[a+2],a===0?(vec3.set(c,f),vec3.set(c,h),vec3.set(c,p),vec3.set(c,r),vec3.set(c,o),vec3.set(c,e)):(c[0]<f[0]&&vec3.set(c,f),c[0]>h[0]&&vec3.set(c,h),c[1]<r[1]&&vec3.set(c,r),c[1]>p[1]&&vec3.set(c,p),c[2]<e[2]&&vec3.set(c,e),c[2]>o[2]&&vec3.set(c,o));return d=h[0]-f[0],u=p[1]-r[1],s=o[2]-e[2],t=d>u&&d>s?d:u>s?u:s,i[0]=f[0]+d*.5,i[1]=r[1]+u*.5,i[2]=e[2]+s*.5,d<Math.EPSILON&&(d=1e-4),u<Math.EPSILON&&(u=1e-4),s<Math.EPSILON&&(s=1e-4),g=[d,u,s],this._bounds.width=g[0],this._bounds.height=g[1],this._bounds.depth=g[2],this._bounds.radius=t/2,this._bounds},e.prototype.getIndexBuffer=function(){return this._valid||this.validate(),this.data.indices_buf},e.prototype.setColor=function(e){return arguments.length>1?this.color=arguments:this.color=e},e.prototype.dispose=function(){return this._data&&this._data.dispose(),this._submesh&&this._submesh.dispose(),this._initialized=!1,this.invalidate()},e}(),e.Deprecated=function(e){function t(){var e,n;e=1<=arguments.length?r.call(arguments,0):[],n="Using Jax.Mesh directly has been deprecated. Please use Jax.Mesh.Triangles or a similar variant instead.";if(typeof console=="undefined")throw new Error(n);console.log((new Error(n)).stack),t.__super__.constructor.apply(this,e)}return n(t,e),t}(e),Jax.Mesh=e.Deprecated,Jax.Mesh.Base=e}.call(this),function(){Jax.Mesh.Bounds=function(){function e(){this.left=vec3.create(),this.right=vec3.create(),this.top=vec3.create(),this.bottom=vec3.create(),this.front=vec3.create(),this.back=vec3.create(),this.center=vec3.create(),this.width=0,this.height=0,this.depth=0}return e}()}.call(this),function(){var e;e=function(){function e(e,t){this.buffer=e,this.itemSize=t,this.offset=e.byteOffset}return e.prototype.bind=function(){},e}(),Jax.Mesh.Data=function(){function t(e,t,n,r,i,s,o){var u,a,f,l,c;e==null&&(e=[]),t==null&&(t=[]),n==null&&(n=[]),r==null&&(r=[]),i==null&&(i=[]),s==null&&(s=[]),o==null&&(o=[]),typeof e=="number"&&(e=new Array(e));if(e%3)throw new Error("Vertex data length must be given in multiples of 3");this._offsets={},this._buffers={},this._wrappers={},this.allocateBuffers(e.length,i.length||e.length/3);if(i.length===0)for(u=a=0,l=this.length;0<=l?a<l:a>l;u=0<=l?++a:--a)i.push(u);this.assignVertexData(e,t,n,r,s,o),this.freezeColors();for(u=f=0,c=i.length;0<=c?f<c:f>c;u=0<=c?++f:--f)this.indexBuffer[u]=i[u];this.usage=GL_STATIC_DRAW,this.target=GL_ARRAY_BUFFER,this._glBuffers={},this._valid={}}var n,r,i;return t.include(Jax.EventEmitter),t.endpoints={},r=function(e){return e<256?Uint8Array:e<65536?Uint16Array:Uint32Array},n=function(e,t,n){var r,i,s,o;s=0,o=Jax.Mesh.Data.endpoints;for(r in o)i=o[r],s+=i;return s*e*Float32Array.BYTES_PER_ELEMENT+e*9*Float32Array.BYTES_PER_ELEMENT+e*2*Float32Array.BYTES_PER_ELEMENT+e*8*Float32Array.BYTES_PER_ELEMENT+t*n.BYTES_PER_ELEMENT},t.define("color",{get:function(){return this._color},set:function(e){var t,n,r,i;this.fireEvent("colorChanged"),this.invalidate(),this._color=Jax.Color.parse(e),i=[];for(t=n=0,r=this.colorBuffer.length;n<r;t=n+=4)this.colorBuffer[t]=this.originalColors[t]*this._color.red,this.colorBuffer[t+1]=this.originalColors[t+1]*this._color.green,this.colorBuffer[t+2]=this.originalColors[t+2]*this._color.blue,i.push(this.colorBuffer[t+3]=this.originalColors[t+3]*this._color.alpha);return i}}),t.define("context",{set:function(e){return this._bound=!1,this._context=e}}),t.getter("tangentBuffer",function(){return this.shouldRecalculateTangents()&&this.recalculateTangents(),this._tangentBuffer}),t.getter("bitangentBuffer",function(){return this.shouldRecalculateBitangents()&&this.recalculateBitangents(),this._bitangentBuffer}),t.getter("normalBuffer",function(){return this.shouldRecalculateNormals()&&this.recalculateNormals(),this._normalBuffer}),t.prototype.freezeColors=function(){var e,t,n,r;this.originalColors||(this.originalColors=new Float32Array(this.colorBuffer.length)),r=[];for(e=t=0,n=this.colorBuffer.length;0<=n?t<n:t>n;e=0<=n?++t:--t)r.push(this.originalColors[e]=this.colorBuffer[e]);return r},t.prototype.invalidate=function(){var e,t;t=[];for(e in this._valid)t.push(this._valid[e]=!1);return t},t.prototype.dispose=function(){var e,t,n,r;n=this._glBuffers,r=[];for(t in n)e=n[t],r.push(delete this._glBuffers.id);return r},t.prototype.bind=function(e){var t,n,r,i;return e&&(this.context=e),r=this._context.id,n=this._context.gl,(t=(i=this._glBuffers[r])!=null?i.buffer:void 0)?(n.bindBuffer(GL_ARRAY_BUFFER,t),this._valid[r]||n.bufferData(GL_ARRAY_BUFFER,this._array_buffer,GL_STATIC_DRAW)):(this._glBuffers[r]={gl:n,buffer:n.createBuffer()},n.bindBuffer(GL_ARRAY_BUFFER,this._glBuffers[r].buffer),n.bufferData(GL_ARRAY_BUFFER,this._array_buffer,GL_STATIC_DRAW)),this._valid[r]=!0,this._bound=!0},t.prototype.set=function(e,t){var n,r,i;if(!this._context)throw new Error("Jax context for this pass is not set");if(t===void 0)throw new Error("Expected two arguments, mapping is undefined");this._bound||this.bind(this._context),i=[];for(n in t){r=t[n];switch(n){case"vertices":i.push(e[r]=this.vertexWrapper);break;case"colors":i.push(e[r]=this.colorWrapper);break;case"textures":i.push(e[r]=this.textureCoordsWrapper);break;case"normals":this.shouldRecalculateNormals()&&this.recalculateNormals(),i.push(e[r]=this.normalWrapper);break;case"tangents":this.shouldRecalculateTangents()&&this.recalculateTangents(),i.push(e[r]=this.tangentWrapper);break;case"bitangents":this.shouldRecalculateBitangents()&&this.recalculateBitangents(),i.push(e[r]=this.bitangentWrapper);break;default:if(!this._wrappers[n])throw new Error("Mapping key must be one of 'vertices', 'colors', "+("'textures', 'normals', 'tangents', 'bitangents' (got: "+n+")"));i.push(e[r]=this._wrappers[n])}}return i},t.prototype.recalculateNormals=function(){return this._shouldRecalculateNormals=!1,this.fireEvent("shouldRecalculateNormals"),this.invalidate(),!0},t.prototype.recalculateTangents=function(){return this._shouldRecalculateTangents=!1,this.fireEvent("shouldRecalculateTangents"),this.invalidate(),!0},t.prototype.recalculateBitangents=function(){return this._shouldRecalculateBitangents=!1,this.fireEvent("shouldRecalculateBitangents"),this.invalidate(),!0},t.prototype.shouldRecalculateNormals=function(){return this._shouldRecalculateNormals},t.prototype.shouldRecalculateTangents=function(){return this._shouldRecalculateTangents},t.prototype.shouldRecalculateBitangents=function(){return this._shouldRecalculateBitangents},t.prototype.allocateBuffers=function(t,i){var s,o,u,a,f,l,c,h;this.length=t/3,this.indexFormat=r(this.length),o=n(this.length,i,this.indexFormat),this._array_buffer=new ArrayBuffer(o),this.vertexBufferOffset=0,this.vertexBuffer=new Float32Array(this._array_buffer,this.vertexBufferOffset,this.length*3),this.vertexWrapper=new e(this.vertexBuffer,3),this.textureCoordsBufferOffset=this.vertexBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.vertexBuffer.length,this.textureCoordsBuffer=new Float32Array(this._array_buffer,this.textureCoordsBufferOffset,this.length*2),this.textureCoordsWrapper=new e(this.textureCoordsBuffer,2),this.normalBufferOffset=this.textureCoordsBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.textureCoordsBuffer.length,this._normalBuffer=new Float32Array(this._array_buffer,this.normalBufferOffset,this.length*3),this.normalWrapper=new e(this._normalBuffer,3),this.colorBufferOffset=this.normalBufferOffset+Float32Array.BYTES_PER_ELEMENT*this._normalBuffer.length,this.colorBuffer=new Float32Array(this._array_buffer,this.colorBufferOffset,this.length*4),this.colorWrapper=new e(this.colorBuffer,4),this.tangentBufferOffset=this.colorBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.colorBuffer.length,this._tangentBuffer=new Float32Array(this._array_buffer,this.tangentBufferOffset,this.length*4),this.tangentWrapper=new e(this._tangentBuffer,4),this.bitangentBufferOffset=this.tangentBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.tangentBuffer.length,this._bitangentBuffer=new Float32Array(this._array_buffer,this.bitangentBufferOffset,this.length*3),this.bitangentWrapper=new e(this._bitangentBuffer,3),f=this.bitangentBufferOffset+Float32Array.BYTES_PER_ELEMENT*this.bitangentBuffer.length,u=function(e){return function(){return this._buffers[e]}},h=Jax.Mesh.Data.endpoints;for(a in h)l=h[a],s=new Float32Array(this._array_buffer,f,this.length*l),c=new e(s,l),this._offsets[a]=f,this._buffers[a]=s,this._wrappers[a]=c,f+=s.length*Float32Array.BYTES_PER_ELEMENT,Object.defineProperty(this,a,{get:u(a)});return this.indexBufferOffset=f,this.indexBuffer=new this.indexFormat(this._array_buffer,this.indexBufferOffset,i)},i=vec3.create(),t.prototype.assignVertexData=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;v=[this.vertexBuffer,this._normalBuffer,this.colorBuffer,this.textureCoordsBuffer,this._tangentBuffer,this._bitangentBuffer],w=v[0],d=v[1],h=v[2],b=v[3],y=v[4],c=v[5],o=this.length,this._shouldRecalculateNormals=r.length===0,this._shouldRecalculateTangents=i.length===0,this._shouldRecalculateBitangents=s.length===0,g=[];for(u=p=0;0<=o?p<o:p>o;u=0<=o?++p:--p)m=[u*2,u*3,u*4],a=m[0],f=m[1],l=m[2],w[f]=e[f],w[f+1]=e[f+1],w[f+2]=e[f+2],d[f]=r[f],d[f+1]=r[f+1],d[f+2]=r[f+2],y[l]=i[l],y[l+1]=i[l+1],y[l+2]=i[l+2],y[l+3]=i[l+3],c[l]=s[f],c[l+1]=s[f+1],c[l+2]=s[f+2],b[a]=n[a]||0,b[a+1]=n[a+1]||0,t.length<=l?g.push(h[l]=h[l+1]=h[l+2]=h[l+3]=1):(h[l]=t[l],h[l+1]=t[l+1],h[l+2]=t[l+2],g.push(h[l+3]=t[l+3]));return g},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.Mesh.Lines=function(e){function r(){var e;e=1<=arguments.length?n.call(arguments,0):[],this.draw_mode||(this.draw_mode=GL_LINES),r.__super__.constructor.apply(this,e)}return t(r,e),r}(Jax.Mesh.Base)}.call(this),Jax.Geometry={DISJOINT:0,COINCIDE:1,INTERSECT:2},Jax.Geometry.Line=function(){var e={},t=Jax.Class.create({initialize:function(e,t){this.a=vec3.create(),this.b=vec3.create(),this.normal=vec3.create(),this.length=0,arguments.length&&this.set(e,t)},set:function(e,t){return vec3.set(e,this.a),vec3.set(t,this.b),vec3.subtract(t,e,this.normal),this.length=vec3.length(this.normal),vec3.normalize(this.normal),this},contains:function(t){var n=vec3.subtract(this.b,this.a,e.ba||(e.ba=vec3.create())),r=vec3.subtract(t,this.a,e.ba||(e.pa=vec3.create())),i=vec3.subtract(this.a,this.b,e.ba||(e.ab=vec3.create())),s=vec3.subtract(t,this.b,e.ba||(e.pb=vec3.create()));return vec3.normalize(n),vec3.normalize(r),vec3.normalize(i),vec3.normalize(s),Math.equalish(n,r)&&Math.equalish(i,s)},intersectLineSegment:function(t,n){var r=vec3.subtract(this.b,this.a,vec3.create()),i=vec3.subtract(t.b,t.a,vec3.create()),s=vec3.subtract(this.a,t.a,vec3.create()),o=r[0]*i[1]-r[1]*i[0],u=n&&!(n instanceof Jax.Geometry.Line);if(Math.abs(o)<Math.EPSILON){if(r[0]*s[1]-r[1]*s[0]!=0||i[0]*s[1]-i[1]*s[0]!=0)return Jax.Geometry.DISJOINT;var a=vec3.dot(r,r),f=vec3.dot(i,i);if(a==0&&f==0)return Math.equalish(this.a,t.a)?(n&&(u?vec3.set(t.a,n):vec3.set(t.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;if(a==0)return t.contains(this.a)?(n&&(u?vec3.set(this.a,n):vec3.set(this.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;if(f==0)return this.contains(t.a)?(n&&(u?vec3.set(t.a,n):vec3.set(t.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;var l,c,h=vec3.subtract(this.a,t.a,vec3.create());i[0]!=0?(l=s[0]/i[0],c=h[0]/i[0]):(l=s[1]/i[1],c=h[1]/i[1]);if(l>c){var p=l;l=c,c=p}if(l>1||c<0)return Jax.Geometry.DISJOINT;l=l<0?0:l,c=c>1?1:c;if(l==c&&t){if(n){var d=u?n:n.a;vec3.add(t.a,vec3.scale(i,l,d),d)}return Jax.Geometry.INTERSECT}if(n)if(u){var v=e.tmp||(e.tmp=vec3.create());vec3.add(t.a,vec3.scale(i,l,n),n),vec3.add(t.b,vec3.scale(i,c,v),n),vec3.scale(n,.5,n)}else vec3.add(t.a,vec3.scale(i,l,n.a),n),vec3.add(t.b,vec3.scale(i,c,n.b),n);return Jax.Geometry.COINCIDENT}var m=(i[0]*s[1]-i[1]*s[0])/o;if(m<0||m>1)return Jax.Geometry.DISJOINT;var g=(r[0]*s[1]-r[1]*s[0])/o;return g<0||g>1?Jax.Geometry.DISJOINT:(n&&vec3.add(this.a,vec3.scale(r,m,n),n),Jax.Geometry.INTERSECT)},toString:function(){return"[Line a:"+this.a+", b:"+this.b+"]"}});return Object.defineProperty(t.prototype,0,{get:function(){return this.a},set:function(e){return this.a=e},enumerable:!1,configurable:!1}),Object.defineProperty(t.prototype,1,{get:function(){return this.b},set:function(e){return this.b=e},enumerable:!1,configurable:!1}),t}(),Jax.Geometry.Plane=function(){function e(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r}var t={},n=Jax.Class.create({toString:function(){return"[Plane normal:"+this.normal+"; D:"+
this.d+"]"},intersectTriangle:function(e,n){var r=this.classifyVec3(e.a),i=this.classifyVec3(e.b),s=this.classifyVec3(e.c),o=r*i,u=i*s;if(o>0&&u>0)return!1;if(!n)return!0;var a,f,l;o>0?(f=e.a,l=e.b,a=e.c):u>0?(a=e.a,f=e.b,l=e.c):(f=e.a,a=e.b,l=e.c);var c=t.tri_seg1=t.tri_seg1||new Jax.Geometry.Line,h=t.tri_seg2=t.tri_seg2||new Jax.Geometry.Line;c.set(a,f),h.set(a,l);var p=t.tri_p1=t.tri_p1||vec3.create(),d=t.tri_p2=t.tri_p2||vec3.create();return this.intersectLineSegment(c,p),this.intersectLineSegment(h,d),n.set(p,d)},intersectLineSegment:function(e,n){var r=vec3.subtract(e.b,e.a,t.lineseg_u=t.lineseg_u||vec3.create()),i=vec3.subtract(e.a,this.point,t.lineseg_w=t.lineseg_w||vec3.create()),s=vec3.dot(this.normal,r),o=-vec3.dot(this.normal,i);if(Math.abs(s)<Math.EPSILON)return o==0?Jax.Geometry.COINCIDE:Jax.Geometry.DISJOINT;var u=o/s;return u<0||u>1?Jax.Geometry.DISJOINT:(n&&vec3.add(e.a,vec3.scale(r,u,n),n),Jax.Geometry.INTERSECT)},intersectRay:function(e,t){var n=vec3.dot(this.normal,e)+this.d,r=vec3.dot(this.normal,t);if(r==0)return!1;var i=-(n/r);return-(n/r)},intersectPlane:function(e,n){var r=this.d,i=e.d,s=this.normal,o=e.normal,u=t.u=t.u||vec3.create();vec3.cross(s,o,u);var a=u[0]>=0?u[0]:-u[0],f=u[1]>=0?u[1]:-u[1],l=u[2]>=0?u[2]:-u[2];if(a+f+l<Math.EPSILON)return Math.equalish(r,i)?Jax.Geometry.COINCIDE:Jax.Geometry.DISJOINT;if(n){var c;a>f?a>l?c=0:c=2:f>l?c=1:c=2;var h=t.iP=t.iP||vec3.create();switch(c){case 0:h[0]=0,h[1]=(i*s[2]-r*o[2])/u[0],h[2]=(r*o[1]-i*s[1])/u[0];break;case 1:h[0]=(r*o[2]-i*s[2])/u[1],h[1]=0,h[2]=(i*s[0]-r*o[0])/u[1];break;case 2:h[0]=(i*s[1]-r*o[1])/u[2],h[1]=(r*o[0]-i*s[0])/u[2],h[2]=0}vec3.set(h,n[0]),vec3.add(h,u,n[1])}return Jax.Geometry.INTERSECT},initialize:function(e){this.point=vec3.create(),this.normal=vec3.create([0,1,0]),this.d=0,arguments.length&&this.set.apply(this,arguments)},classifyVec3:function(e){return e.array?vec3.dot(this.normal,e.array)+this.d:vec3.dot(this.normal,e)+this.d},classify:function(e,t,n){var r=this.normal;return r[0]*e+r[1]*t+r[2]*n+this.d},set:function(){if(arguments.length==2)vec3.set(arguments[1],this.normal),this.d=-vec3.dot(arguments[1],arguments[0]);else{var e=this.normal,t=vec3.create(),n=arguments;arguments.length!=3&&(n=arguments[0]),typeof n[0]=="object"&&n[0].array?(vec3.subtract(n[1].array,n[0].array,e),vec3.subtract(n[2].array,n[0].array,t),vec3.normalize(vec3.cross(e,t,this.normal)),this.d=-vec3.dot(this.normal,n[0].array)):(vec3.subtract(n[1],n[0],e),vec3.subtract(n[2],n[0],t),vec3.normalize(vec3.cross(e,t,this.normal)),this.d=-vec3.dot(this.normal,n[0]))}return vec3.scale(this.normal,this.d,this.point),this},setCoefficients:function(e,t,n,r){var i=Math.sqrt(e*e+t*t+n*n);return this.normal[0]=e/i,this.normal[1]=t/i,this.normal[2]=n/i,this.d=r/i,this},whereis:function(){var e;arguments.length==3?e=arguments:arguments[0].array?e=arguments[0].array:e=arguments[0];var t=this.distance(e);return t>0?Jax.Geometry.Plane.FRONT:t<0?Jax.Geometry.Plane.BACK:Jax.Geometry.Plane.INTERSECT}});return n.prototype.distance=n.prototype.classifyVec3,n}(),Jax.Geometry.Plane.FRONT=1,Jax.Geometry.Plane.BACK=2,Jax.Geometry.Plane.INTERSECT=3,Jax.Geometry.Triangle=function(){function e(e,n,r){var i=t.slowtri_line1=t.slowtri_line1||new Jax.Geometry.Line,s=t.slowtri_line2=t.slowtri_line2||new Jax.Geometry.Line;return e.plane.intersectTriangle(n,i)&&n.plane.intersectTriangle(e,s)?(i.intersectLineSegment(s,r),!0):!1}var t={},n=Jax.Class.create({initialize:function(e,t,n){this.a=vec3.create(),this.b=vec3.create(),this.c=vec3.create(),this.center=vec3.create(),this.normal=vec3.create(),arguments.length>0&&this.set.apply(this,arguments)},set:function(e,t,n){return this.assign(vec3.create(e),vec3.create(t),vec3.create(n))},assign:function(e,t,n){return this.a=e,this.b=t,this.c=n,this.recalculateCenter(),this.recalculateNormal(),this.updateDescription(),this},setComponents:function(e,t,n,r,i,s,o,u,a){return this.a[0]=e,this.a[1]=t,this.a[2]=n,this.b[0]=r,this.b[1]=i,this.b[2]=s,this.c[0]=o,this.c[1]=u,this.c[2]=a,this.recalculateCenter(),this.recalculateNormal(),this.updateDescription(),this},recalculateCenter:function(){return vec3.add(this.a,this.b,this.center),vec3.add(this.c,this.center,this.center),vec3.scale(this.center,1/3),this.center},recalculateNormal:function(){var e=t.tmp=t.tmp||vec3.create();return vec3.subtract(this.b,this.a,this.normal),vec3.subtract(this.c,this.a,e),vec3.cross(this.normal,e,this.normal),vec3.normalize(this.normal),this.normal},getNormal:function(){return this.normal},toString:function(){return"Triangle: "+this.a+"; "+this.b+"; "+this.c},intersectRay:function(e,t,n,r){var i=this._p=this._p||new Jax.Geometry.Plane;i.set(this.a,this.b,this.c);var s=vec3.dot(i.normal,t);if(Math.abs(s)<Math.EPSILON)return!1;var o=-(i.d+vec3.dot(i.normal,e))/s;return o<=0?!1:r!=undefined&&o>r?!1:(vec3.set(t,n),vec3.scale(n,o,n),vec3.add(e,n,n),this.pointInTri(n)?(n[3]=o,!0):!1)},intersectSphere:function(e,n,r){var i=this._p=this._p||new Jax.Geometry.Plane;i.set(this.a,this.b,this.c);var s=i.classify(e);if(Math.abs(s)>n)return!1;var o=this._point=this._point||vec3.create();vec3.scale(i.normal,s,o),vec3.subtract(e,o,o);if(this.pointInTri(o))return r&&vec3.set(o,r),!0;var u=t.v=t.v||[],a=t.u=t.u||vec3.create(),f=t.pa=t.pa||vec3.create(),l=t.tmp=t.tmp||vec3.create(),c=n*n;u[0]=this.a,u[1]=this.b,u[2]=this.c,u[3]=this.a;for(var h=0;h<3;h++){vec3.subtract(u[h+1],u[h],a),vec3.subtract(e,u[h],f);var p=vec3.dot(a,f)/vec3.dot(a,a);p<0?vec3.set(u[h],l):p>1?vec3.set(u[h+1],l):(vec3.scale(a,p,l),vec3.add(u[h],l,l)),r&&vec3.set(l,r),vec3.subtract(e,l,l);var d=vec3.dot(l,l);if(d<=c)return!0}return!1},intersectTriangle:function(t,n){return n?e(this,t,n):Jax.Geometry.Triangle.tri_tri_intersect(this.a,this.b,this.c,t.a,t.b,t.c)},updateDescription:function(){var e=this.plane=this.plane||new Jax.Geometry.Plane(this.a,this.b,this.c),t=e.normal,n=[Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)];return n[0]>n[1]?n[0]>n[2]?(this._i1=1,this._i2=2):(this._i1=0,this._i2=1):n[1]>n[2]?(this._i1=0,this._i2=2):(this._i1=0,this._i2=1),this},pointInTri:function(e){var t=this._u=this._u||vec3.create(),n=this._v=this._v||vec3.create();t[0]=e[this._i1]-this.a[this._i1],t[1]=this.b[this._i1]-this.a[this._i1],t[2]=this.c[this._i1]-this.a[this._i1],n[0]=e[this._i2]-this.a[this._i2],n[1]=this.b[this._i2]-this.a[this._i2],n[2]=this.c[this._i2]-this.a[this._i2];var r,i;if(t[1]==0){i=t[0]/t[2];if(!(i>=0&&i<=1))return!1;r=(n[0]-i*n[2])/n[1]}else{i=(n[0]*t[1]-t[0]*n[1])/(n[2]*t[1]-t[2]*n[1]);if(!(i>=0&&i<=1))return!1;r=(t[0]-i*t[2])/t[1]}return r>=0&&r+i<=1}});return Object.defineProperty(n.prototype,0,{get:function(){return this.a},set:function(e){return this.a=e},enumerable:!1,configurable:!1}),Object.defineProperty(n.prototype,1,{get:function(){return this.b},set:function(e){return this.b=e},enumerable:!1,configurable:!1}),Object.defineProperty(n.prototype,2,{get:function(){return this.c},set:function(e){return this.c=e},enumerable:!1,configurable:!1}),n}(),function(){function e(e,n,r,i,s,o,u){var a=t.tritri_A=t.tritri_A||vec3.create(),f,l;a[0]=Math.abs(e[0]),a[1]=Math.abs(e[1]),a[2]=Math.abs(e[2]),a[0]>a[1]?a[0]>a[2]?(f=1,l=2):(f=0,l=1):a[2]>a[1]?(f=0,l=1):(f=0,l=2);var c,h,p,d,v,m,g,y,b;c=r[f]-n[f],h=r[l]-n[l],p=s[f]-o[f],d=s[l]-o[l],v=n[f]-s[f],m=n[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=n[f]-o[f],m=n[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=n[f]-u[f],m=n[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var c,h,p,d,v,m,g,y,b;c=i[f]-r[f],h=i[l]-r[l],p=s[f]-o[f],d=s[l]-o[l],v=r[f]-s[f],m=r[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=r[f]-o[f],m=r[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=r[f]-u[f],m=r[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var c,h,p,d,v,m,g,y,b;c=n[f]-i[f],h=n[l]-i[l],p=s[f]-o[f],d=s[l]-o[l],v=i[f]-s[f],m=i[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=i[f]-o[f],m=i[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=i[f]-u[f],m=i[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var w,E,S,x,T,N;w=o[l]-s[l],E=-(o[f]-s[f]),S=-w*s[f]-E*s[l],x=w*n[f]+E*n[l]+S,w=u[l]-o[l],E=-(u[f]-o[f]),S=-w*o[f]-E*o[l],T=w*n[f]+E*n[l]+S,w=s[l]-u[l],E=-(s[f]-u[f]),S=-w*u[f]-E*u[l],N=w*n[f]+E*n[l]+S;if(x*T>0&&x*N>0)return!0;var w,E,S,x,T,N;return w=r[l]-n[l],E=-(r[f]-n[f]),S=-w*n[f]-E*n[l],x=w*s[f]+E*s[l]+S,w=i[l]-r[l],E=-(i[f]-r[f]),S=-w*r[f]-E*r[l],T=w*s[f]+E*s[l]+S,w=n[l]-i[l],E=-(n[f]-i[f]),S=-w*i[f]-E*i[l],N=w*s[f]+E*s[l]+S,x*T>0&&x*N>0?!0:!1}var t;typeof t=="undefined"&&(t={}),Jax.Geometry.Triangle.tri_tri_intersect=function(n,r,i,s,o,u){var a=t.tritri_E1=t.tritri_E1||vec3.create(),f=t.tritri_E2=t.tritri_E2||vec3.create(),l=t.tritri_N1=t.tritri_N1||vec3.create(),c=t.tritri_N2=t.tritri_N2||vec3.create(),h=t.tritri_D=t.tritri_D||vec3.create(),p=t.tritri_isect1=t.tritri_isect1||vec2.create(),d=t.tritri_isect2=t.tritri_isect2||vec2.create(),v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;vec3.subtract(r,n,a),vec3.subtract(i,n,f),vec3.cross(a,f,l),v=-vec3.dot(l,n),g=vec3.dot(l,s)+v,y=vec3.dot(l,o)+v,b=vec3.dot(l,u)+v,Math.abs(g)<Math.EPSILON&&(g=0),Math.abs(y)<Math.EPSILON&&(y=0),Math.abs(b)<Math.EPSILON&&(b=0),x=g*y,T=g*b;if(x>0&&T>0)return!1;vec3.subtract(o,s,a),vec3.subtract(u,s,f),vec3.cross(a,f,c),m=-vec3.dot(c,s),w=vec3.dot(c,n)+m,E=vec3.dot(c,r)+m,S=vec3.dot(c,i)+m,Math.abs(w)<Math.EPSILON&&(w=0),Math.abs(E)<Math.EPSILON&&(E=0),Math.abs(S)<Math.EPSILON&&(S=0),N=w*E,C=w*S;if(N>0&&C>0)return!1;vec3.cross(l,c,h),B=Math.abs(h[0]),k=0,P=Math.abs(h[1]),H=Math.abs(h[2]),P>B&&(B=P,k=1),H>B&&(B=H,k=2),L=n[k],A=r[k],O=i[k],M=s[k],_=o[k],D=u[k];try{if(N>0)p[0]=O+(L-O)*S/(S-w),p[1]=O+(A-O)*S/(S-E);else if(C>0)p[0]=A+(L-A)*E/(E-w),p[1]=A+(O-A)*E/(E-S);else if(E*S>0||w!=0)p[0]=L+(A-L)*w/(w-E),p[1]=L+(O-L)*w/(w-S);else if(E!=0)p[0]=A+(L-A)*E/(E-w),p[1]=A+(O-A)*E/(E-S);else{if(S==0)return e(l,n,r,i,s,o,u);p[0]=O+(L-O)*S/(S-w),p[1]=O+(A-O)*S/(S-E)}if(x>0)d[0]=D+(M-D)*b/(b-g),d[1]=D+(_-D)*b/(b-y);else if(T>0)d[0]=_+(M-_)*y/(y-g),d[1]=_+(D-_)*y/(y-b);else if(y*b>0||g!=0)d[0]=M+(_-M)*g/(g-y),d[1]=M+(D-M)*g/(g-b);else if(y!=0)d[0]=_+(M-_)*y/(y-g),d[1]=_+(D-_)*y/(y-b);else{if(b==0)return e(l,n,r,i,s,o,u);d[0]=D+(M-D)*b/(b-g),d[1]=D+(_-D)*b/(b-y)}}catch(j){if(j==1)return e(l,n,r,i,s,o,u);throw j}if(p[0]>p[1]){var H;H=p[0],p[0]=p[1],p[1]=H}if(d[0]>p[1]){var H;H=d[0],d[0]=p[1],p[1]=H}return p[1]<d[0]||d[1]<p[0]?!1:!0}}(),function(){var e;e={vec:vec3.create(),tri:new Jax.Geometry.Triangle},Jax.Mesh.Normals={recalculateNormals:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V;T=e.vec,A=e.tri,N={},g=this.data,F=[g.vertexBuffer,g.colorBuffer,g.textureCoordsBuffer,g.normalBuffer],M=F[0],p=F[1],L=F[2],S=F[3],O=this.triangleOrder,x=O.length;for(y=H=0;H<x;y=H+=3)I=[O[y],O[y+1],O[y+2]],t=I[0],o=I[1],c=I[2],q=[t*3,o*3,c*3],n=q[0],u=q[1],h=q[2],R=[M[n],M[n+1],M[n+2]],r=R[0],i=R[1],s=R[2],U=[M[u],M[u+1],M[u+2]],a=U[0],f=U[1],l=U[2],z=[M[h],M[h+1],M[h+2]],d=z[0],v=z[1],m=z[2],A.setComponents(r,i,s,a,f,l,d,v,m),E=A.getNormal(),C=N[t]||(N[t]=[]),C.push(E[0],E[1],E[2]),C=N[o]||(N[o]=[]),C.push(E[0],E[1],E[2]),C=N[c]||(N[c]=[]),C.push(E[0],E[1],E[2]);V=[];for(y=B=0,W=g.length;0<=W?B<W:B>W;y=0<=W?++B:--B){b=y*3,X=[M[b],M[b+1],M[b+2]],_=X[0],D=X[1],P=X[2],T[0]=T[1]=T[2]=0,C=N[y]||(N[y]=[]),k=C.length;for(w=j=0;j<k;w=j+=3)T[0]+=C[w],T[1]+=C[w+1],T[2]+=C[w+2];vec3.scale(T,3/k),g.normalBuffer[b]=T[0],g.normalBuffer[b+1]=T[1],V.push(g.normalBuffer[b+2]=T[2])}return V}}}.call(this),function(){var e;e={v1:vec3.create(),v2:vec3.create(),v3:vec3.create(),w1:vec2.create(),w2:vec2.create(),w3:vec2.create(),sdir:vec3.create(),tdir:vec3.create(),n:vec3.create(),t:vec3.create(),tan:vec3.create()},Jax.Mesh.Tangents={recalculateBitangents:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p;r=this.data,r.shouldRecalculateTangents()&&this.recalculateTangents(),h=[r.tangentBuffer,r.bitangentBuffer,r.normalBuffer],l=h[0],n=h[1],f=h[2],u=r.length,t=e.tan,a=e.n,p=[];for(i=c=0;0<=u?c<u:c>u;i=0<=u?++c:--c)s=i*3,o=i*4,t[0]=l[o],t[1]=l[o+1],t[2]=l[o+2],a[0]=f[s],a[1]=f[s+1],a[2]=f[s+2],vec3.cross(a,t,t),vec3.scale(t,l[o+3]),n[s]=t[0],n[s+1]=t[1],p.push(n[s+2]=t[2]);return p},recalculateTangents:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et;this.data.shouldRecalculateNormals()&&this.recalculateNormals(),s=this.data,m=3*s.length,i=new ArrayBuffer(m*Float32Array.BYTES_PER_ELEMENT*2),C=new Float32Array(i,0,m),k=new Float32Array(i,m*Float32Array.BYTES_PER_ELEMENT,m),J=[e.v1,e.v2,e.v3],M=J[0],_=J[1],D=J[2],K=[e.w1,e.w2,e.w3],P=K[0],H=K[1],B=K[2],Q=[e.sdir,e.tdir],w=Q[0],L=Q[1],G=[e.n,e.t,e.tan],p=G[0],S=G[1],N=G[2],E=function(e,t,n,r){return e[0]=s.vertexBuffer[r],e[1]=s.vertexBuffer[r+1],e[2]=s.vertexBuffer[r+2],t[0]=s.textureCoordsBuffer[n*2],t[1]=s.textureCoordsBuffer[n*2+1]},A=this.triangleOrder,O=A.length;for(t=V=0;V<O;t=V+=3)Y=[A[t],A[t+1],A[t+2]],u=Y[0],f=Y[1],c=Y[2],Z=[u*3,f*3,c*3],a=Z[0],l=Z[1],h=Z[2],E(M,P,u,a),E(_,H,f,l),E(D,B,c,h),F=_[0]-M[0],I=D[0]-M[0],R=_[1]-M[1],U=D[1]-M[1],W=_[2]-M[2],X=D[2]-M[2],y=H[0]-P[0],b=B[0]-P[0],x=H[1]-P[1],T=B[1]-P[1],g=1/(y*T-b*x),g===1/0&&(g=0),w[0]=(T*F-x*I)*g,w[1]=(T*R-x*U)*g,w[2]=(T*W-x*X)*g,L[0]=(y*I-b*F)*g,L[1]=(y*U-b*R)*g,L[2]=(y*X-b*W)*g,C[a]+=w[0],C[a+1]+=w[1],C[a+2]+=w[2],C[l]+=w[0],C[l+1]+=w[1],C[l+2]+=w[2],C[h]+=w[0],C[h+1]+=w[1],C[h+2]+=w[2],k[a]+=L[0],k[a+1]+=L[1],k[a+2]+=L[2],k[l]+=L[0],k[l+1]+=L[1],k[l+2]+=L[2],k[h]+=L[0],k[h+1]+=L[1],k[h+2]+=L[2];v=s.tangentBuffer.length/4,et=[];for(t=$=0;0<=v?$<v:$>v;t=0<=v?++$:--$)n=t*3,r=t*4,p[0]=s.normalBuffer[n],p[1]=s.normalBuffer[n+1],p[2]=s.normalBuffer[n+2],S[0]=C[n],S[1]=C[n+1],S[2]=C[n+2],o=vec3.dot(p,S),j=S[0]-p[0]*o,q=S[1]-p[1]*o,z=S[2]-p[2]*o,d=1/Math.sqrt(j*j+q*q+z*z),s.tangentBuffer[r]=j*d,s.tangentBuffer[r+1]=q*d,s.tangentBuffer[r+2]=z*d,N[0]=k[n],N[1]=k[n+1],N[2]=k[n+2],et.push(s.tangentBuffer[r+3]=vec3.dot(vec3.cross(p,S),N)<0?-1:1);return et}}}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.Mesh.TriangleFan=function(e){function r(){var e,t=this;e=1<=arguments.length?n.call(arguments,0):[],this.draw_mode||(this.draw_mode=GL_TRIANGLE_FAN),r.__super__.constructor.apply(this,e),this.triangleOrder=[],this.addEventListener("validated",function(){return t.updateTriangleOrder()})}return t(r,e),r.include(Jax.Mesh.Tangents),r.include(Jax.Mesh.Normals),r.prototype.updateTriangleOrder=function(){var e,t,n,r,i,s;r=this.triangleOrder,t=this.data.indexBuffer,n=t.length,r.splice(0,r.length),s=[];for(e=i=2;2<=n?i<n:i>n;e=2<=n?++i:--i)s.push(r.push(t[0],t[e-1],t[e]));return s},r}(Jax.Mesh.Base)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.Mesh.TriangleStrip=function(e){function r(){var e,t=this;e=1<=arguments.length?n.call(arguments,0):[],this.draw_mode||(this.draw_mode=GL_TRIANGLE_STRIP),r.__super__.constructor.apply(this,e),this.triangleOrder=[],this.addEventListener("validated",function(){return t.updateTriangleOrder()})}return t(r,e),r.include(Jax.Mesh.Tangents),r.include(Jax.Mesh.Normals),r.prototype.updateTriangleOrder=function(){var e,t,n,r,i,s;r=this.triangleOrder,t=this.data.indexBuffer,n=t.length,r.splice(0,r.length),s=[];for(e=i=2;i<n;e=i+=2)r.push(t[e-2],t[e-1],t[e]),e<n-1?s.push(r.push(t[e],t[e-1],t[e+1])):s.push(void 0);return s},r}(Jax.Mesh.Base)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.Mesh.Triangles=function(e){function r(){var e,t=this;e=1<=arguments.length?n.call(arguments,0):[],this.draw_mode||(this.draw_mode=GL_TRIANGLES),r.__super__.constructor.apply(this,e),this.triangleOrder=[],this.addEventListener("validated",function(){return t.updateTriangleOrder()})}var i;return t(r,e),r.include(Jax.Mesh.Tangents),r.include(Jax.Mesh.Normals),i=6,r.prototype.updateTriangleOrder=function(){var e,t,n,r,i,s;r=this.triangleOrder,t=this.data.indexBuffer,n=t.length,r.splice(0,r.length),s=[];for(e=i=0;i<n;e=i+=3)s.push(r.push(t[e],t[e+1],t[e+2]));return s},r.prototype.hash=function(e,t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){return r==null&&(r=0),s==null&&(s=0),o==null&&(o=0),u==null&&(u=0),a==null&&(a=0),f==null&&(f=0),l==null&&(l=0),c==null&&(c=0),h==null&&(h=0),p==null&&(p=0),d==null&&(d=0),v==null&&(v=0),m==null&&(m=0),g==null&&(g=0),y==null&&(y=0),b==null&&(b=0),""+e.toFixed(i)+","+t.toFixed(i)+","+n.toFixed(i)+","+(""+r.toFixed(i)+","+s.toFixed(i)+","+o.toFixed(i)+",")+(""+u.toFixed(i)+","+a.toFixed(i)+","+f.toFixed(i)+",")+(""+l.toFixed(i)+","+c.toFixed(i)+","+h.toFixed(i)+",")+(""+p.toFixed(i)+","+d.toFixed(i)+","+v.toFixed(i)+",")+(""+m.toFixed(i)+","+g.toFixed(i)+","+y.toFixed(i)+",")+(""+b.toFixed(i))},r.prototype.split=function(e,t,n,r,i,s,o){var u,f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at;T=65535;if(e.length<=T*3)return null;j=[],ut=[],R=[],at=[],I=[],H=[],B=[],A={},i.length===0&&(i=function(){var t,n,r;r=[];for(w=t=0,n=e.length;t<n;w=t+=3)r.push(w/3);return r}());for(w=q=0,U=i.length;q<U;w=q+=3){E=i[w],S=i[w+1],x=i[w+2];if(E>T||S>T||x>T)z=[e[E*3],e[E*3+1],e[E*3+2]],_=z[0],D=z[1],P=z[2],Z=[r[E*3],r[E*3+1],r[E*3+2]],C=Z[0],k=Z[1],L=Z[2],et=[n[E*2],n[E*2+1]],O=et[0],M=et[1],tt=[t[E*4],t[E*4+1],t[E*4+2],t[E*4+3]],y=tt[0],g=tt[1],m=tt[2],v=tt[3],nt=[s[E*4],s[E*4+1],s[E*4+2],s[E*4+3]],f=nt[0],l=nt[1],c=nt[2],u=nt[3],rt=[o[E*3],o[E*3+1],o[E*3+2]],p=rt[0],h=rt[1],d=rt[2],F=this.hash(_,D,P,C,k,L,O,M,y,g,m,v,f,l,c,u,p,h,d),A[F]?I.push(A[F]):(I.push(A[F]=at.length/3),at.push(_,D,P),t.length&&j.push(y,g,m,v),n.length&&ut.push(O,M),r.length&&R.push(C,k,L),s.length&&H.push(f,l,c,u),o.length&&B.push(p,h,d)),it=[e[S*3],e[S*3+1],e[S*3+2]],_=it[0],D=it[1],P=it[2],st=[r[S*3],r[S*3+1],r[S*3+2]],C=st[0],k=st[1],L=st[2],ot=[n[S*2],n[S*2+1]],O=ot[0],M=ot[1],W=[t[S*4],t[S*4+1],t[S*4+2],t[S*4+3]],y=W[0],g=W[1],m=W[2],v=W[3],X=[s[S*4],s[S*4+1],s[S*4+2],s[S*4+3]],f=X[0],l=X[1],c=X[2],u=X[3],V=[o[S*3],o[S*3+1],o[S*3+2]],p=V[0],h=V[1],d=V[2],F=this.hash(_,D,P,C,k,L,O,M,y,g,m,v,f,l,c,u,p,h,d),A[F]?I.push(A[F]):(I.push(A[F]=at.length/3),at.push(_,D,P),t.length&&j.push(y,g,m,v),n.length&&ut.push(O,M),r.length&&R.push(C,k,L),s.length&&H.push(f,l,c,u),o.length&&B.push(p,h,d)),$=[e[x*3],e[x*3+1],e[x*3+2]],_=$[0],D=$[1],P=$[2],J=[r[x*3],r[x*3+1],r[x*3+2]],C=J[0],k=J[1],L=J[2],K=[n[x*2],n[x*2+1]],O=K[0],M=K[1],Q=[t[x*4],t[x*4+1],t[x*4+2],t[x*4+3]],y=Q[0],g=Q[1],m=Q[2],v=Q[3],G=[s[x*4],s[x*4+1],s[x*4+2],s[x*4+3]],f=G[0],l=G[1],c=G[2],u=G[3],Y=[o[x*3],o[x*3+1],o[x*3+2]],p=Y[0],h=Y[1],d=Y[2],F=this.hash(_,D,P,C,k,L,O,M,y,g,m,v,f,l,c,u,p,h,d),A[F]?I.push(A[F]):(I.push(A[F]=at.length/3),at.push(_,D,P),t.length&&j.push(y,g,m,v),n.length&&ut.push(O,M),r.length&&R.push(C,k,L),s.length&&H.push(f,l,c,u),o.length&&B.push(p,h,d)),i.splice(w,3),w-=3}return e.splice(T*3,e.length),t.length&&t.splice(T*4,t.length),n.length&&n.splice(T*2,n.length),r.length&&r.splice(T*3,r.length),s.length&&s.splice(T*4,s.length),s.length&&o.splice(T*3,s.length),N=new this.__proto__.constructor({init:function(e,t,n,r,i){var s,o,u,f,l,c,h,p,d,v,m,g,y,w,E,S,x,T,N,C,k,L;for(p=0,v=at.length;p<v;p++)h=at[p],e.push(h);if(j)for(d=0,m=j.length;d<m;d++)u=j[d],t.push(u);if(ut)for(x=0,g=ut.length;x<g;x++)c=ut[x],n.push(c);if(R)for(T=0,y=R.length;T<y;T++)l=R[T],r.push(l);if(H)for(N=0,w=H.length;N<w;N++)s=H[N],a.push(s);if(B)for(C=0,E=B.length;C<E;C++)o=B[C],b.push(o);L=[];for(k=0,S=I.length;k<S;k++)f=I[k],L.push(i.push(f));return L}})},r}(Jax.Mesh.Base)}.call(this),function(){Jax.Renderer=function(){function e(){}return e.registeredOrder=[],e.register=function(e){return this.registeredOrder.push(e)},e.attemptThese=function(e,t,n){var r,i,s;for(i=0,s=t.length;i<s;i++){r=t[i];try{r instanceof Function||(r=Jax.Renderer[renderer]);if(r)return new r(e,n)}catch(o){console.log("Instantiation of renderer "+renderer+" failed with: "+o)}}throw new Error("Could not find a compatible renderer.")},e}()}.call(this),function(){Jax.Context=function(){function e(e,t){var n=this;this.canvas=e,arguments.length===1&&(this.canvas instanceof HTMLElement||typeof this.canvas=="string"||(t=this.canvas,this.canvas=t.canvas,delete t.canvas)),typeof this.canvas=="string"&&(this.canvas=document.getElementById(this.canvas)),this._isDisposed=!1,this._isRendering=!1,this._isUpdating=!1,this._renderHandle=this._updateHandle=null,this._framesPerSecond=this._updatesPerSecond=0,this._renderStartTime=null,this._errorFunc=function(e,t,r){var i;return n.controller&&n.controller.error?i=n.controller.error(e,t,r):typeof ApplicationController!="undefined"&&ApplicationController.prototype.error&&(i=ApplicationController.prototype.error.apply(n.controller||new ApplicationController,arguments)),i===!0?(n.restart(),!0):(n.stopRendering(),n.stopUpdating(),!1)},this._updateFunc=function(){var e;e=n.refreshUPS(),n.update(e);if(n.isUpdating())return n.requestUpdateFrame()},this._renderFunc=function(e){e*=.001,n._renderStartTime===null&&(n._renderStartTime=e),n.uptime=e-n._renderStartTime,n._calculateFrameRate&&n.refreshFPS(),n.render();if(n.isRendering())return n.requestRenderFrame()},window.addEventListener("error",this._errorFunc),this.id=Jax.guid(),this.world=new Jax.World(this),this.uptime=0,this.matrix_stack=new Jax.MatrixStack,this.framerateSampleRatio=.9,this.updateSpeed=33,this.setupCamera(),this.setupInputDevices(t.focus),this.setupRenderer(t),this.startUpdating(),(t!=null?t.root:void 0)&&this.redirectTo(t.root)}return e.include(Jax.EventEmitter),e.getter("player",function(){return console.log((new Error("Jax.Context#player is deprecated; it only contained `camera`, so you should use Jax.Controller#activeCamera instead.")).stack),{camera:this.activeCamera}}),e.define("activeCamera",{set:function(e){var t;return(t=this.controller)!=null?t.activeCamera=e:void 0},get:function(){return this.controller?this.controller.activeCamera:this.world.cameras[0]}}),e.prototype.isDisposed=function(){return this._isDisposed},e.prototype.isRendering=function(){return this._isRendering},e.prototype.isUpdating=function(){return this._isUpdating},e.prototype.reloadMatrices=function(){return this.matrix_stack.reset(),this.matrix_stack.loadModelMatrix(mat4.IDENTITY),this.matrix_stack.loadViewMatrix(this.activeCamera.getInverseTransformationMatrix()),this.matrix_stack.loadProjectionMatrix(this.activeCamera.getProjectionMatrix()),this.matrix_stack},e.prototype.update=function(e){var t;return(t=this.controller)!=null&&typeof t.update=="function"&&t.update(e),this.world.update(e)},e.prototype.prepare=function(){return this.reloadMatrices(),this.renderer.prepare()},e.prototype.viewport=function(){return this.renderer.viewport()},e.prototype.render=function(){return this.prepare(),this.view?this.view.render():(this.renderer.clear(),this.world.render())},e.prototype.refreshUPS=function(){var e,t,n;return e=this.uptime,this._lastUpdateStart||(this._lastUpdateStart=e),t=e-this._lastUpdateStart,this._calculateUpdateRate&&(this._timeToUpdate=(this._timeToUpdate||0)*this.framerateSampleRatio+t*(1-this.framerateSampleRatio),this._updatesPerSecond=1/this._timeToUpdate),n=e-this._lastUpdateStart,this._lastUpdateStart=e,Math.min(n,.25)},e.prototype.refreshFPS=function(){var e,t;return e=this.uptime,this._lastRenderStart||(this._lastRenderStart=this.uptime),t=e-this._lastRenderStart,this._timeToRender=(this._timeToRender||0)*this.framerateSampleRatio+t*(1-this.framerateSampleRatio),this._framesPerSecond=1/this._timeToRender,this._lastRenderStart=e},e.prototype.startUpdating=function(){if(this.isUpdating()||this.isDisposed())return;return this._isUpdating=!0,this.requestUpdateFrame()},e.prototype.startRendering=function(){if(this.isRendering()||this.isDisposed())return;return this._isRendering=!0,this.requestRenderFrame()},e.prototype.stopUpdating=function(){if(!this.isUpdating())return;return this.abortUpdateFrame(),this._isUpdating=!1},e.prototype.stopRendering=function(){if(!this.isRendering())return;return this._renderHandle!==null&&this.abortRenderFrame(),this._renderStartTime=null,this._isRendering=!1},e.prototype.restart=function(){return this.stopRendering(),this.stopUpdating(),this.startRendering(),this.startUpdating()},e.prototype.requestUpdateFrame=function(){var e,t;return e=(new Date).getTime(),t=Math.max(0,this.updateSpeed-(e-(this._requestUpdateLastTime||0))),this._updateHandle=setTimeout(this._updateFunc,t),this._requestUpdateLastTime=e+t},e.prototype.abortUpdateFrame=function(){return this._updateHandle!==null&&clearTimeout(this._updateHandle),this._updateHandle=null},e.prototype.requestRenderFrame=function(){var e,t,n=this;return Jax.useRequestAnimFrame&&this.useRequestAnimFrame?(this._requestedAnimFrame=!0,this._renderHandle=requestAnimationFrame(this._renderFunc,this.canvas)):(this._requestedAnimFrame=!1,e=(new Date).getTime(),t=Math.max(0,16-(e-(this._requestFrameLastTime||0))),this._renderHandle=setTimeout(function(){return n._renderFunc(e+t)},t),this._requestFrameLastTime=e+t)},e.prototype.abortRenderFrame=function(){return this._requestedAnimFrame?cancelAnimationFrame(this._renderHandle):clearTimeout(this._renderHandle),this._renderHandle=null},e.prototype.setupRenderer=function(e){e=Jax.Util.normalizeOptions(e,{renderers:Jax.Renderer.registeredOrder});if(!this.canvas)return;return this.renderer=Jax.Renderer.attemptThese(this.canvas,e.renderers,e),this.gl=this.renderer.context},e.prototype.setupInputDevices=function(e){var t,n;e==null&&(e=!1);if(this.canvas){if((t=Jax.Input)!=null?t.Mouse:void 0)this.mouse=new Jax.Input.Mouse(this.canvas);if((n=Jax.Input)!=null?n.Keyboard:void 0)return this.keyboard=new Jax.Input.Keyboard(this.canvas,{focus:e})}},e.prototype.redirectTo=function(e){var t;return this.unregisterListeners(),this.stopUpdating(),this.stopRendering(),t=Jax.routes.recognizeRoute(e),t.action!=="index"&&this.controller&&this.controller instanceof t.controller?(this.controller.fireAction(t.action),Jax.views.exists(this.controller.view_key)&&(this.view=Jax.views.find(this.controller.view_key),this.setupView(this.view))):(this.unloadScene(),this.controller=Jax.routes.dispatch(e,this),this.view=Jax.views.find(this.controller.view_key),this.view&&this.setupView(this.view)),this.registerListeners(),this.startRendering(),this.startUpdating(),this.controller},e.prototype.setupView=function(e){return e.context=this,e.world=this.world,e},e.prototype.unloadScene=function(){return this.world.dispose(),this.world.cameras=1,this.world.cameras[0].reset(),this.setupCamera(),delete this._player},e.prototype.setupCamera=function(){if(this.world&&this.canvas)return this.world.cameras[0].perspective({width:this.canvas.clientWidth||this.canvas.width,height:this.canvas.clientHeight||this.canvas.height})},e.prototype.dispose=function(){return window.removeEventListener("error",this._errorFunc),this.stopUpdating(),this.stopRendering(),this.world.dispose(),this.unregisterListeners(),this._isDisposed=!0},e.prototype.registerListeners=function(){var e=this;if(!this.controller)return;return this.mouse&&(this.controller.mouse_pressed&&this.mouse.listen("press",function(t){return e.controller.mouse_pressed(t)}),this.controller.mouse_released&&this.mouse.listen("release",function(t){return e.controller.mouse_released(t)}),this.controller.mouse_clicked&&this.mouse.listen("click",function(t){return e.controller.mouse_clicked(t)}),this.controller.mouse_moved&&this.mouse.listen("move",function(t){return e.controller.mouse_moved(t)}),this.controller.mouse_entered&&this.mouse.listen("enter",function(t){return e.controller.mouse_entered(t)}),this.controller.mouse_exited&&this.mouse.listen("exit",function(t){return e.controller.mouse_exited(t)}),this.controller.mouse_dragged&&this.mouse.listen("drag",function(t){return e.controller.mouse_dragged(t)}),this.controller.mouse_over&&this.mouse.listen("over",function(t){return e.controller.mouse_over(t)})),this.keyboard&&(this.controller.key_pressed&&this.keyboard.listen("press",function(t){return e.controller.key_pressed(t)}),this.controller.key_released&&this.keyboard.listen("release",function(t){return e.controller.key_released(t)}),this.controller.key_typed&&this.keyboard.listen("type",function(t){return e.controller.key_typed(t)})),!0},e.prototype.unregisterListeners=function(){this.mouse&&this.mouse.stopListening();if(this.keyboard)return this.keyboard.stopListening()},e.prototype.getUpdatesPerSecond=function(){return this._calculateUpdateRate=!0,this._updatesPerSecond},e.prototype.getFramesPerSecond=function(){return this._calculateFrameRate=!0,this._framesPerSecond},e.prototype.disableUpdateSpeedCalculations=function(){return this._calculateUpdateRate=!1},e.prototype.disableFrameSpeedCalculations=function(){return this._calculateFrameRate=!1},e}()}.call(this),function(){Jax.Renderer.register(Jax.Renderer.WebGL=function(){function e(e,t){if(!e.getContext)throw new Error("WebGL not supported!");this.context=e.getContext("experimental-webgl",t);if(!this.context)throw new Error("WebGL not supported!");this.context.clearColor(0,0,0,1),this.context.clearDepth(1),this.context.enable(GL_DEPTH_TEST),this.context.depthFunc(GL_LESS),this.context.enable(GL_BLEND),this.context.blendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA),this.context.enable(GL_CULL_FACE)}return e.prototype.clear=function(){return this.context.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT|GL_STENCIL_BUFFER_BIT)},e.prototype.prepare=function(){return this.viewport()},e.prototype.viewport=function(){var e,t;return t=this.context.canvas.clientWidth||this.context.canvas.width,e=this.context.canvas.clientHeight||this.context.canvas.height,this.context.viewport(0,0,t,e)},e}())}.call(this),function(){Jax.Input=function(){function e(e,t){var n=this;this.receiver=e,this.options=t!=null?t:{},this._listeners={},this.receiver.getEventListeners=function(e){return n.getReceiverEventListeners(e)}}return e.include(Jax.EventEmitter),e.prototype.getReceiverEventListeners=function(e){var t;return(t=this._listeners)[e]||(t[e]=[])},e.prototype.update=function(e){},e.prototype.trigger=function(e,t){throw new Error(""+this.__proto__.constructor.name+" can't trigger event type "+e+": not implemented")},e.prototype.processEvent=function(e,t){var n,r,i,s;s=this.getReceiverEventListeners(e);for(r=0,i=s.length;r<i;r++)n=s[r],n.call(this,t);return!0},e.prototype.attach=function(e,t){var n,r=this;return n=this.getReceiverEventListeners(e),n["interface"]||(n["interface"]=function(t){return t.preventDefault(),r.processEvent(e,t)},this.receiver.addEventListener(e,n["interface"])),n.push(t)},e.prototype.stopListening=function(){var e,t,n;n=[];for(t in this._listeners)e=this.getReceiverEventListeners(t),e["interface"]?(this.receiver.removeEventListener(t,e["interface"]),e.length=0,n.push(delete e["interface"])):n.push(void 0);return n},e.prototype.listen=function(e,t){var n,r;if(!this[e])throw new Error("Invalid "+this.__proto__.constructor.name+" input type: "+e);if(!(n=(r=this.__proto__.constructor.eventTypes)!=null?r[e]:void 0))throw new Error("BUG: Method `"+e+"` exists but no corresponding DOM event type associated");this.attach(n,this[e]);if(t)return this.addEventListener(e,t)},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Input.Keyboard=function(e){function n(e,t){var r;n.__super__.constructor.call(this,e,t),r=!1,this.receiver.getAttribute("tabindex"
)===null&&(r=!0,this.receiver.setAttribute("tabindex","0"));if(t!=null?t.focus:void 0)r&&this.receiver.focus(),this.receiver.addEventListener("mouseover",this._captureFocus=function(e){return this.focus()})}return t(n,e),n.eventTypes={press:"keydown",release:"keyup",type:"keypress"},n.prototype.trigger=function(e,t){var n;return t==null&&(t={}),n=document.createEvent("KeyboardEvent"),n.initKeyboardEvent(e,!0,!0,null,t.ctrl,t.alt,t.shift,t.meta,t.keyCode,t.charCode),this.receiver.dispatchEvent(n)},n.prototype.stopListening=function(){return this.receiver.removeEventListener("mouseover",this._captureFocus),n.__super__.stopListening.call(this)},n.prototype.press=function(e){return this.fireEvent("press",e)},n.prototype.release=function(e){return this.fireEvent("release",e)},n.prototype.type=function(e){return this.fireEvent("type",e)},n}(Jax.Input)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Input.Mouse=function(e){function n(e){n.__super__.constructor.call(this,e),this._pendingClicks={},this._clickCount={},this._buttonState={}}var r;return t(n,e),n.eventTypes={press:"mousedown",release:"mouseup",move:"mousemove",over:"mouseover",exit:"mouseout"},n.define("clickSpeed",{get:function(){return this._clickSpeed||(this._clickSpeed=.25)},set:function(e){return this._clickSpeed=e}}),r=[0,0],n.prototype.getCumulativeOffset=function(){var e,t,n,i;i=[0,0],t=i[0],n=i[1],e=this.receiver;while(e)t+=(e.offsetLeft||0)+1,n+=(e.offsetTop||0)+1,e=e.offsetParent;return r[0]=t,r[1]=n,r},n.prototype.trigger=function(e,t){var n;return t==null&&(t={}),n=document.createEvent("MouseEvents"),n.initMouseEvent(e,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,t.button,null),this.receiver.dispatchEvent(n)},n.prototype.processEvent=function(e,t){return this.normalizeEvent(t),n.__super__.processEvent.call(this,e,t)},n.prototype.normalizeEvent=function(e){var t,n,r,i,s,o,u;e.pageX===void 0&&e.clientX!==null&&(i=e.target.ownerDocument||document,r=i.documentElement,t=i.body,e.pageX=e.clientX+(r&&r.scrollLeft||t&&t.scrollLeft||0)-(r&&r.clientLeft||t&&t.clientLeft||0),e.pageY=e.clientY+(r&&r.scrollTop||t&&t.scrollTop||0)-(r&&r.clientTop||t&&t.clientTop||0)),n=this.getCumulativeOffset(),s=[e.pageX-n[0],e.pageY-n[1]],e.x=s[0],e.y=s[1];if(this.receiver.width||this.receiver.height)e.x*=this.receiver.width/this.receiver.clientWidth,e.y*=this.receiver.height/this.receiver.clientHeight;return this._lastx===void 0?e.diffx=e.diffy=0:(o=[e.x-this._lastx,e.y-this._lasty],e.diffx=o[0],e.diffy=o[1]),u=[e.x,e.y],this._lastx=u[0],this._lasty=u[1],e},n.prototype.update=function(e){var t;for(t in this._pendingClicks)this._pendingClicks[t]+=e,this._pendingClicks[t]>=this.clickSpeed&&this.clearClick(t);return!0},n.prototype.logClickStart=function(e){return this._pendingClicks[e]=0,this._clickCount[e]=(this._clickCount[e]||0)+1},n.prototype.clearClick=function(e){return delete this._pendingClicks[e],delete this._clickCount[e]},n.prototype.listen=function(e,t){switch(e){case"enter":n.__super__.listen.call(this,"over"),n.__super__.listen.call(this,"exit");if(t)return this.addEventListener("enter",t);break;case"move":case"click":n.__super__.listen.call(this,"move"),n.__super__.listen.call(this,"press"),n.__super__.listen.call(this,"release");if(t)return this.addEventListener(e,t);break;case"drag":n.__super__.listen.call(this,"move"),n.__super__.listen.call(this,"press"),n.__super__.listen.call(this,"release"),n.__super__.listen.call(this,"exit");if(t)return this.addEventListener(e,t);break;default:return n.__super__.listen.call(this,e,t)}},n.prototype.press=function(e){return this.fireEvent("press",e),this.logClickStart(e.button),this._buttonState[e.button]=!0},n.prototype.release=function(e){this.fireEvent("release",e),this._buttonState[e.button]=!1;if(this._pendingClicks[e.button]!==void 0)return e.clickCount=this._clickCount[e.button],this.fireEvent("click",e)},n.prototype.move=function(e){var t;if(this._buttonState[e.button]){for(t in this._pendingClicks)this.clearClick(t);return this.fireEvent("drag",e)}return this.fireEvent("move",e)},n.prototype.over=function(e){this.fireEvent("over",e);if(!this._entered)return this._entered=!0,this.fireEvent("enter",e)},n.prototype.exit=function(e){var t;this._entered=!1;for(t in this._buttonState)delete this._buttonState[t];return this.fireEvent("exit",e)},n}(Jax.Input)}.call(this),function(){Jax.Noise=function(){function e(e){e==null&&(e=null),this.grad=r(),e&&this.prepare(e)}var t,n,r,i;return i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],n=null,r=function(){var e,r,s,o,u,a,f,l,c;a=new Jax.Texture({min_filter:GL_NEAREST,mag_filter:GL_NEAREST,width:256,height:256});if(!n){u=new Array(262144);for(r=l=0;l<256;r=++l)for(s=c=0;c<256;s=++c)o=(r*256+s)*4,f=i[s+i[r]&255],e=f&15,u[o]=t[e][0]*64+128,u[o+1]=t[e][1]*64+128,u[o+2]=t[e][2]*64+t[e][3]*16+128,u[o+3]=f;n=new Uint8Array(u)}return a},e.prototype.prepare=function(e){return this.grad.bind(e,function(){return e.gl.texImage2D(GL_TEXTURE_2D,0,GL_RGBA,256,256,0,GL_RGBA,GL_UNSIGNED_BYTE,n)})},e.prototype.bind=function(e,t){return this.isPrepared(e)||this.prepare(e),t.gradTexture=this.grad},e.prototype.isPrepared=function(e){return this.grad.isValid(e)},e}(),Jax.noise=new Jax.Noise}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Cone=function(e){function n(e){e||(e={}),e.sides||(e.sides=8),e.size||(e.size=1),e.radius||(e.radius=e.size/2),e.height||(e.height=e.size),n.__super__.constructor.call(this,e);if(this.sides<3)throw new Error("Cone requires minimum 3 sides")}return t(n,e),n.prototype.init=function(e,t,n,r){var i,s,o,u,a,f,l;e.push(0,this.height/2,0),n.push(0,0),i=Math.PI*2/this.sides,l=[];for(s=a=0,f=-this.sides;0<=f?a<=f:a>=f;s=0<=f?++a:--a)o=Math.cos(s*i),u=Math.sin(s*i),e.push(o*this.radius,-this.height/2,u*this.radius),l.push(n.push(o*.5+.5,u*.5+.5));return l},n}(Jax.Mesh.TriangleFan)}.call(this),Jax.Mesh.Cube=function(){var e=["left","right","top","bottom","front","back"],t=vec3.create();return Jax.Class.create(Jax.Mesh.Triangles,{initialize:function($super,e){e||(e={});var t=e.size=e.size||1;e.width=e.width||e.size,e.depth=e.depth||e.size,e.height=e.height||e.size,$super(e);var n=this,r=function(){n.invalidate(!0)},i=e.width,s=e.height,o=e.depth;this.left=new Jax.Model({mesh:new Jax.Mesh.Quad(o,s)}),this.left.camera.reorient([-1,0,0],[-i/2,0,0]),this.left.mesh.addEventListener("colorChanged",r),this.left.camera.addEventListener("updated",r),Object.defineProperty(this.left,"color",{get:function(){return n.left.mesh.color},set:function(e){n.left.mesh.color=e}}),this.right=new Jax.Model({mesh:new Jax.Mesh.Quad(o,s)}),this.right.camera.reorient([1,0,0],[i/2,0,0]),this.right.mesh.addEventListener("colorChanged",r),this.right.camera.addEventListener("updated",r),Object.defineProperty(this.right,"color",{get:function(){return n.right.mesh.color},set:function(e){return n.right.mesh.color=e}}),this.front=new Jax.Model({mesh:new Jax.Mesh.Quad(i,s)}),this.front.camera.reorient([0,0,1],[0,0,o/2]),this.front.mesh.addEventListener("colorChanged",r),this.front.camera.addEventListener("updated",r),Object.defineProperty(this.front,"color",{get:function(){return n.front.mesh.color},set:function(e){return n.front.mesh.color=e}}),this.back=new Jax.Model({mesh:new Jax.Mesh.Quad(i,s)}),this.back.camera.reorient([0,0,-1],[0,0,-o/2]),this.back.mesh.addEventListener("colorChanged",r),this.back.camera.addEventListener("updated",r),Object.defineProperty(this.back,"color",{get:function(){return n.back.mesh.color},set:function(e){return n.back.mesh.color=e}}),this.top=new Jax.Model({mesh:new Jax.Mesh.Quad(i,o)}),this.top.camera.reorient([0,1,0],[0,s/2,0]),this.top.mesh.addEventListener("colorChanged",r),this.top.camera.addEventListener("updated",r),Object.defineProperty(this.top,"color",{get:function(){return n.top.mesh.color},set:function(e){return n.top.mesh.color=e}}),this.bottom=new Jax.Model({mesh:new Jax.Mesh.Quad(i,o)}),this.bottom.camera.reorient([0,-1,0],[0,-s/2,0]),this.bottom.mesh.addEventListener("colorChanged",r),this.bottom.camera.addEventListener("updated",r),Object.defineProperty(this.bottom,"color",{get:function(){return n.bottom.mesh.color},set:function(e){return n.bottom.mesh.color=e}})},init:function(n,r,i,s){var o;for(var u=0;u<e.length;u++){var a=this[e[u]],f=a.mesh.data,l=a.camera.getTransformationMatrix(),c=a.camera.getNormalMatrix();for(var h=0;h<f.length;h++){var p=h*3,d=h*2,v=h*4;t[0]=f.vertexBuffer[p],t[1]=f.vertexBuffer[p+1],t[2]=f.vertexBuffer[p+2],mat4.multiplyVec3(l,t,t),n.push(-t[0],-t[1],-t[2]),t[0]=f.normalBuffer[p],t[1]=f.normalBuffer[p+1],t[2]=f.normalBuffer[p+2],mat3.multiplyVec3(c,t,t),s.push(t[0],t[1],t[2]),r.push(f.colorBuffer[v],f.colorBuffer[v+1],f.colorBuffer[v+2],f.colorBuffer[v+3]),i.push(f.textureCoordsBuffer[d],f.textureCoordsBuffer[d+1])}}}})}(),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.LineCube=function(e){function n(e,t){this.halfSize=e!=null?e:.5,this.offset=t!=null?t:[0,0,0],typeof this.halfSize!="number"?(n.__super__.constructor.call(this,this.halfSize),this.halfSize=this.size/2):n.__super__.constructor.call(this)}return t(n,e),n.prototype.init=function(e,t,n,r,i){var s,o,u;return s=this.halfSize,o=this.offset,u=vec3.create(),e.push.apply(e,vec3.add(vec3.scale([-1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([-1,-1,-1],s),o)),e.push.apply(e,vec3.add(vec3.scale([1,-1,-1],s),o)),!0},n}(Jax.Mesh.Lines)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Plane=function(e){function n(e){this.fn=function(e,t){return 0},this.size=(e!=null?e.size:void 0)||500,this.segments=(e!=null?e.segments:void 0)||20,this.width=this.depth=this.size,this.xSegments=this.zSegments=this.segments,n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.init=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;s={},E=[this.width,this.depth,this.xSegments,this.zSegments],l=E[0],i=E[1],p=E[2],m=E[3],S=[l/p,i/m],h=S[0],v=S[1],x=[];for(c=g=1;g<p;c=g+=2){for(d=y=0;0<=m?y<m:y>m;d=0<=m?++y:--y)o=h*c-l/2,f=v*d-i/2,u=s[b=""+c+";"+d]||(s[b]=this.fn(c,d)),a=s[w=""+(c-1)+";"+d]||(s[w]=this.fn(c-1,d)),e.push(o,f,u),e.push(o-h,f,a),n.push(c/(p-1),d/(m-1)),n.push((c-1)/(p-1),d/(m-1));c++,x.push(function(){var t,r,g,y,b;b=[];for(d=t=y=m-1;y<=0?t<=0:t>=0;d=y<=0?++t:--t)o=h*c-l/2,f=v*d-i/2,u=s[r=""+c+";"+d]||(s[r]=this.fn(c,d)),a=s[g=""+(c-1)+";"+d]||(s[g]=this.fn(c-1,d)),e.push(o-h,f,a),e.push(o,f,u),n.push((c-1)/(p-1),d/(m-1)),b.push(n.push(c/(p-1),d/(m-1)));return b}.call(this))}return x},n}(Jax.Mesh.TriangleStrip)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.Mesh.PLY=function(e){function r(e){var t,n;typeof e=="string"&&(e={path:e}),this.size=1,this.path=e!=null?e.path:void 0,this.method=(e!=null?e.method:void 0)||"GET",(e!=null?e.path:void 0)&&delete e.path,(e!=null?e.method:void 0)&&delete e.method,r.__super__.constructor.call(this,e),n=new XMLHttpRequest,t=this,n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState===n.DONE){if(n.status===200)return t.parser=new Jax.Mesh.PLY.Parser(n.response),t.rebuild();throw new Error("Request for "+t.path+" returned status "+n.status)}},n.open(this.method,this.path),n.send()}return t(r,e),r.prototype.init=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;if(!this.parser)return;o=vec3.create(),h=0,x=this.parser.vertex||this.parser.vertices;for(m=0,w=x.length;m<w;m++)v=x[m],e.push(v.x,v.y,v.z),T=[v.x,v.y,v.z],o[0]=T[0],o[1]=T[1],o[2]=T[2],c=vec3.length(o),h<c&&(h=c),v.nx!==void 0&&r.push(v.nx,v.ny,v.nz),l=v.intensity===void 0?1:v.intensity,v.red===void 0?(N=[1,1,1],p=N[0],a=N[1],s=N[2]):(C=[v.red,v.green,v.blue],p=C[0],a=C[1],s=C[2]),t.push(p*l,a*l,s*l,1);for(d=g=0,k=e.length;0<=k?g<k:g>k;d=0<=k?++g:--g)e[d]=e[d]/h*this.size;L=this.parser.face;for(y=0,E=L.length;y<E;y++){u=L[y],A=u.vertex_index||u.vertex_indices;for(b=0,S=A.length;b<S;b++)f=A[b],i.push(f),(l=u.intensity)!==void 0&&(t[f*4+0]*=l,t[f*4+1]*=l,t[f*4+2]*=l,t[f*4+3]*=l)}return null},r.prototype.render=function(){var e;e=1<=arguments.length?n.call(arguments,0):[];if(!this.parser)return;return r.__super__.render.apply(this,e)},r}(Jax.Mesh.Triangles)}.call(this),function(){Jax.Mesh.PLY.Parser=function(){function e(e){var r,i,s;this.comments=[],typeof e=="string"?r=new Uint8Array(this.stringToBytes(e)):r=new Uint8Array(e),s=this.parseHeader(r),i=this.processHeader(s),r=new Uint8Array(r.buffer,s.length);switch(this.format){case"ascii":this.processASCII(i,this.bytesToString(r).split(/\n/));break;case"binary_big_endian":this.processBinary(i,r,t);break;case"binary_little_endian":this.processBinary(i,r,n);break;default:throw new Error("format "+this.format+" ("+this.version+") is not supported")}}var t,n,r,i;return t=1,n=2,e.prototype.sizeOf=function(e){switch(e){case"char":return Int8Array.BYTES_PER_ELEMENT;case"uchar":return Uint8Array.BYTES_PER_ELEMENT;case"short":return Int16Array.BYTES_PER_ELEMENT;case"ushort":return Uint16Array.BYTES_PER_ELEMENT;case"int":return Int32Array.BYTES_PER_ELEMENT;case"uint":return Uint32Array.BYTES_PER_ELEMENT;case"float":return Float32Array.BYTES_PER_ELEMENT;case"double":return Float64Array.BYTES_PER_ELEMENT;default:throw new Error("Unexpected data type: "+e)}},e.prototype.readType=function(e,t,r,i){i==null&&(i=0);switch(t){case"char":return e.getInt8(i);case"uchar":return e.getUint8(i);case"short":return e.getInt16(i,r===n);case"ushort":return e.getUint16(i,r===n);case"int":return e.getInt32(i,r===n);case"uint":return e.getUint32(i,r===n);case"float":return e.getFloat32(i,r===n);case"double":return e.getFloat64(i,r===n);default:throw new Error("Unexpected data type: "+t)}},e.prototype.stringToBytes=function(e){var t,n,r,i,s,o;r=[];for(n=s=0,o=e.length;0<=o?s<o:s>o;n=0<=o?++s:--s){t=e.charCodeAt(n),i=[],i.unshift(t&255),t>>=8;while(t)i.unshift(t&255),t>>=8;r=r.concat(i)}return r},e.prototype.bytesToString=function(e,t){var n,r,i,s;t==null&&(t=0),r="";for(n=i=t,s=e.length;t<=s?i<s:i>s;n=t<=s?++i:--i)r+=String.fromCharCode(e[n]);return r},e.prototype.parseHeader=function(e){var t,n,r,i;n="";for(r=0,i=e.length;r<i;r++){t=e[r],n+=String.fromCharCode(t);if(n.indexOf("end_header\n")!==-1)break}return n},e.prototype.processHeader=function(e){var t,n,r,i,s;e=e.trim().split(/\n/);if(e.shift()!=="ply")throw new Error("Not a PLY!");if(e.pop()!=="end_header")throw new Error("Could not detect end of header!");n=[];while(e.length>0){r=e.shift(),i=r.split(/\s+/);switch(i[0]){case"format":s=[i[1],i[2]],this.format=s[0],this.version=s[1];break;case"comment":this.comments.push(i.slice(1).join(" "));break;case"element":n.push(t={name:i[1],count:parseInt(i[2]),properties:[]});break;case"property":t.properties.push(i.slice(1))}if(r==="end_header")break}return n},r={},i={},e.prototype.readBinaryValue=function(e,t,n,s){var o,u,a;s==null&&(s=0),o=this.sizeOf(t),r[o]||(r[o]=new ArrayBuffer(o)),i[o]||(i[o]=new DataView(r[o]));for(u=a=0;0<=o?a<o:a>o;u=0<=o?++a:--a)i[o].setUint8(u,e[s+u]);return this.readType(i[o],t)},e.prototype.processBinary=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;l=0;for(p=0,g=e.length;p<g;p++){i=e[p],this[i.name]=new Array(i.count);for(u=d=0,b=i.count;0<=b?d<b:d>b;u=0<=b?++d:--d){this[i.name][u]=r={},w=i.properties;for(v=0,y=w.length;v<y;v++){c=w[v];if(c[0]==="list"){f=this.readBinaryValue(t,c[1],n,l),l+=this.sizeOf(c[1]),o=c[2],s=this.sizeOf(o),r[c[3]]=new Array(f);for(a=m=0;0<=f?m<f:m>f;a=0<=f?++m:--m)r[c[3]][a]=this.readBinaryValue(t,o,n,l),l+=s}else h=this.readBinaryValue(t,c[0],n,l),l+=this.sizeOf(c[0]),r[c[1]]=h}}}return l},e.prototype.processASCII=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;for(c=0,d=e.length;c<d;c++){i=e[c],this[i.name]=new Array(i.count);for(s=h=0,m=i.count;0<=m?h<m:h>m;s=0<=m?++h:--h){l=t.shift().split(/\s+/),this[i.name][s]=n={},g=i.properties;for(p=0,v=g.length;p<v;p++){f=g[p];switch(f[0]){case"float":n[f[1]]=parseFloat(l.shift());break;case"list":a=f[1],o=f[2],u=parseInt(l.shift()),n[f[3]]=function(){var e,t;t=[];for(r=e=0;0<=u?e<u:e>u;r=0<=u?++e:--e)t.push(parseInt(l.shift()));return t}();break;default:throw new Error("Unrecognized property: "+JSON.stringify(f))}}}}return!0},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Quad=function(e){function n(e){typeof e=="number"&&(e={size:e}),e||(e={}),e.width||(e.width=e.size||1),e.height||(e.height=e.size||1),n.__super__.constructor.call(this,e)}return t(n,e),n.define("width",{get:function(){return this._width},set:function(e){return this._width=e,this.invalidate()}}),n.define("height",{get:function(){return this._height},set:function(e){return this._height=e,this.invalidate()}}),n.prototype.init=function(e,t,n,r,i){var s,o;return o=this._width/2,s=this._height/2,e.push(-o,s,0),e.push(-o,-s,0),e.push(o,s,0),e.push(o,s,0),e.push(-o,-s,0),e.push(o,-s,0),n.push(0,1),n.push(0,0),n.push(1,1),n.push(1,1),n.push(0,0),n.push(1,0),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1)},n}(Jax.Mesh.Triangles)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Sphere=function(e){function n(e){this.slices=30,this.stacks=30,this.radius=.5,n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.init=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;C=[this.slices,this.stacks,this.radius],d=C[0],m=C[1],f=C[2];for(v=x=0;0<=m?x<=m:x>=m;v=0<=m?++x:--x)for(p=T=0;0<=d?T<=d:T>=d;p=0<=d?++T:--T)g=v*Math.PI/m,a=p*2*Math.PI/d,h=Math.sin(g),c=Math.sin(a),o=Math.cos(g),s=Math.cos(a),w=s*h,E=c*h,S=o,y=1-v/m,b=1-p/d,Math.equalish(w,0)&&(w=0),Math.equalish(E,0)&&(E=0),Math.equalish(S,0)&&(S=0),e.push(w*f,E*f,S*f),r.push(w,E,S),n.push(y,b);L=d+1,k=[];for(v=N=0;0<=m?N<m:N>m;v=0<=m?++N:--N)k.push(function(){var e,t;t=[];for(p=e=0;0<=d?e<=d:e>=d;p=0<=d?++e:--e)u=v*L+p%L,l=(v+1)*L+p%L,t.push(i.push(u,l));return t}());return k},n}(Jax.Mesh.TriangleStrip)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Teapot=function(e){function n(e){this.size=1,n.__super__.constructor.call(this,e)}var r;return t(n,e),r={vertices:[5.929688,4.125,0,5.387188,4.125,2.7475,5.2971,4.494141,2.70917,5.832031,4.494141,0,5.401602,4.617188,2.753633,5.945313,4.617188,0,5.614209,4.494141,2.844092,6.175781,4.494141,0,5.848437,4.125,2.94375,6.429688,4.125,0,3.899688,4.125,4.97,3.830352,4.494141,4.900664,3.910782,4.617188,4.981094,4.074414,4.494141,5.144727,4.254687,4.125,5.325,1.677188,4.125,6.4575,1.638858,4.494141,6.367412,1.68332,4.617188,6.471914,1.77378,4.494141,6.684522,1.873438,4.125,6.91875,-1.070312,4.125,7,-1.070312,4.494141,6.902344,-1.070312,4.617188,7.015625,-1.070312,4.494141,7.246094,-1.070312,4.125,7.5,-1.070312,4.125,7,-4.007656,4.125,6.4575,-3.859572,4.494141,6.367412,-1.070312,4.494141,6.902344,-3.847676,4.617188,6.471914,-1.070312,4.617188,7.015625,-3.917371,4.494141,6.684522,-1.070312,4.494141,7.246094,-4.014062,4.125,6.91875,-1.070312,4.125,7.5,-6.209063,4.125,4.97,-6.042168,4.494141,4.900664,-6.0725,4.617188,4.981094,-6.217675,4.494141,5.144727,-6.395312,4.125,5.325,-7.591093,4.125,2.7475,-7.464421,4.494141,2.70917,-7.550137,4.617188,2.753633,-7.755822,4.494141,2.844092,-7.989062,4.125,2.94375,-8.070313,4.125,0,-7.972656,4.494141,0,-8.085938,4.617188,0,-8.316406,4.494141,0,-8.570313,4.125,0,-8.070313,4.125,0,-7.527812,4.125,-2.7475,-7.437724,4.494141,-2.70917,-7.972656,4.494141,0,-7.542227,4.617188,-2.753633,-8.085938,4.617188,0,-7.754834,4.494141,-2.844092,-8.316406,4.494141,0,-7.989062,4.125,-2.94375,-8.570313,4.125,0,-6.040312,4.125,-4.97,-5.970977,4.494141,-4.900664,-6.051406,4.617188,-4.981094,-6.215039,4.494141,-5.144727,-6.395312,4.125,-5.325,-3.817812,4.125,-6.4575,-3.779482,4.494141,-6.367412,-3.823945,4.617188,-6.471914,-3.914404,4.494141,-6.684522,-4.014062,4.125,-6.91875,-1.070312,4.125,-7,-1.070312,4.494141,-6.902344,-1.070312,4.617188,-7.015625,-1.070312,4.494141,-7.246094,-1.070312,4.125,-7.5,-1.070312,4.125,-7,1.677188,4.125,-6.4575,1.638858,4.494141,-6.367412,-1.070312,4.494141,-6.902344,1.68332,4.617188,-6.471914,-1.070312,4.617188,-7.015625,1.77378,4.494141,-6.684522,-1.070312,4.494141,-7.246094,1.873438,4.125,-6.91875,-1.070312,4.125,-7.5,3.899688,4.125,-4.97,3.830352,4.494141,-4.900664,3.910782,4.617188,-4.981094,4.074414,4.494141,-5.144727,4.254687,4.125,-5.325,5.387188,4.125,-2.7475,5.2971,4.494141,-2.70917,5.401602,4.617188,-2.753633,5.614209,4.494141,-2.844092,5.848437,4.125,-2.94375,5.929688,4.125,0,5.832031,4.494141,0,5.945313,4.617188,0,6.175781,4.494141,0,6.429688,4.125,0,6.429688,4.125,0,5.848437,4.125,2.94375,6.695264,2.162109,3.304053,7.347656,2.162109,0,7.433985,.234375,3.61836,8.148438,.234375,0,7.956494,-1.623047,3.840674,8.714844,-1.623047,0,8.154688,-3.375,3.925,8.929688,-3.375,0,4.254687,4.125,5.325,4.906446,2.162109,5.976758,5.475,.234375,6.545312,5.877149,-1.623047,6.947461,6.029688,-3.375,7.1,1.873438,4.125,6.91875,2.23374,2.162109,7.765576,2.548047,.234375,8.504297,2.770362,-1.623047,9.026807,2.854688,-3.375,9.225,-1.070312,4.125,7.5,-1.070312,2.162109,8.417969,-1.070312,.234375,9.21875,-1.070312,-1.623047,9.785156,-1.070312,-3.375,10,-1.070312,4.125,7.5,-4.014062,4.125,6.91875,-4.374365,2.162109,7.765576,-1.070312,2.162109,8.417969,-4.688672,.234375,8.504297,-1.070312,.234375,9.21875,-4.910986,-1.623047,9.026807,-1.070312,-1.623047,9.785156,-4.995313,-3.375,9.225,-1.070312,-3.375,10,-6.395312,4.125,5.325,-7.047071,2.162109,5.976758,-7.615624,.234375,6.545312,-8.017773,-1.623047,6.947461,-8.170312,-3.375,7.1,-7.989062,4.125,2.94375,-8.835889,2.162109,3.304053,-9.57461,.234375,3.61836,-10.097119,-1.623047,3.840674,-10.295313,-3.375,3.925,-8.570313,4.125,0,-9.488281,2.162109,0,-10.289063,.234375,0,-10.855469,-1.623047,0,-11.070313,-3.375,0,-8.570313,4.125,0,-7.989062,4.125,-2.94375,-8.835889,2.162109,-3.304053,-9.488281,2.162109,0,-9.57461,.234375,-3.61836,-10.289063,.234375,0,-10.097119,-1.623047,-3.840674,-10.855469,-1.623047,0,-10.295313,-3.375,-3.925,-11.070313,-3.375,0,-6.395312,4.125,-5.325,-7.047071,2.162109,-5.976758,-7.615624,.234375,-6.545312,-8.017773,-1.623047,-6.947461,-8.170312,-3.375,-7.1,-4.014062,4.125,-6.91875,-4.374365,2.162109,-7.765576,-4.688672,.234375,-8.504297,-4.910986,-1.623047,-9.026807,-4.995313,-3.375,-9.225,-1.070312,4.125,-7.5,-1.070312,2.162109,-8.417969,-1.070312,.234375,-9.21875,-1.070312,-1.623047,-9.785156,-1.070312,-3.375,-10,-1.070312,4.125,-7.5,1.873438,4.125,-6.91875,2.23374,2.162109,-7.765576,-1.070312,2.162109,-8.417969,2.548047,.234375,-8.504297,-1.070312,.234375,-9.21875,2.770362,-1.623047,-9.026807,-1.070312,-1.623047,-9.785156,2.854688,-3.375,-9.225,-1.070312,-3.375,-10,4.254687,4.125,-5.325,4.906446,2.162109,-5.976758,5.475,.234375,-6.545312,5.877149,-1.623047,-6.947461,6.029688,-3.375,-7.1,5.848437,4.125,-2.94375,6.695264,2.162109,-3.304053,7.433985,.234375,-3.61836,7.956494,-1.623047,-3.840674,8.154688,-3.375,-3.925,6.429688,4.125,0,7.347656,2.162109,0,8.148438,.234375,0,8.714844,-1.623047,0,8.929688,-3.375,0,8.929688,-3.375,0,8.154688,-3.375,3.925,7.794336,-4.857422,3.77168,8.539063,-4.857422,0,7.001562,-5.953125,3.434375,7.679688,-5.953125,0,6.208789,-6.697266,3.09707,6.820313,-6.697266,0,5.848437,-7.125,2.94375,6.429688,-7.125,0,6.029688,-3.375,7.1,5.752343,-4.857422,6.822656,5.142187,-5.953125,6.2125,4.532031,-6.697266,5.602344,4.254687,-7.125,5.325,2.854688,-3.375,9.225,2.701367,-4.857422,8.864649,2.364063,-5.953125,8.071875,2.026758,-6.697266,7.279101,1.873438,-7.125,6.91875,-1.070312,-3.375,10,-1.070312,-4.857422,9.609375,-1.070312,-5.953125,8.75,-1.070312,-6.697266,7.890625,-1.070312,-7.125,7.5,-1.070312,-3.375,10,-4.995313,-3.375,9.225,-4.841992,-4.857422,8.864649,-1.070312,-4.857422,9.609375,-4.504687,-5.953125,8.071875,-1.070312,-5.953125,8.75,-4.167383,-6.697266,7.279101,-1.070312,-6.697266,7.890625,-4.014062,-7.125,6.91875,-1.070312,-7.125,7.5,-8.170312,-3.375,7.1,-7.892968,-4.857422,6.822656,-7.282812,-5.953125,6.2125,-6.672656,-6.697266,5.602344,-6.395312,-7.125,5.325,-10.295313,-3.375,3.925,-9.934961,-4.857422,3.77168,-9.142187,-5.953125,3.434375,-8.349414,-6.697266,3.09707,-7.989062,-7.125,2.94375,-11.070313,-3.375,0,-10.679688,-4.857422,0,-9.820313,-5.953125,0,-8.960938,-6.697266,0,-8.570313,-7.125,0,-11.070313,-3.375,0,-10.295313,-3.375,-3.925,-9.934961,-4.857422,-3.77168,-10.679688,-4.857422,0,-9.142187,-5.953125,-3.434375,-9.820313,-5.953125,0,-8.349414,-6.697266,-3.09707,-8.960938,-6.697266,0,-7.989062,-7.125,-2.94375,-8.570313,-7.125,0,-8.170312,-3.375,-7.1,-7.892968,-4.857422,-6.822656,-7.282812,-5.953125,-6.2125,-6.672656,-6.697266,-5.602344,-6.395312,-7.125,-5.325,-4.995313,-3.375,-9.225,-4.841992,-4.857422,-8.864649,-4.504687,-5.953125,-8.071875,-4.167383,-6.697266,-7.279101,-4.014062,-7.125,-6.91875,-1.070312,-3.375,-10,-1.070312,-4.857422,-9.609375,-1.070312,-5.953125,-8.75,-1.070312,-6.697266,-7.890625,-1.070312,-7.125,-7.5,-1.070312,-3.375,-10,2.854688,-3.375,-9.225,2.701367,-4.857422,-8.864649,-1.070312,-4.857422,-9.609375,2.364063,-5.953125,-8.071875,-1.070312,-5.953125,-8.75,2.026758,-6.697266,-7.279101,-1.070312,-6.697266,-7.890625,1.873438,-7.125,-6.91875,-1.070312,-7.125,-7.5,6.029688,-3.375,-7.1,5.752343,-4.857422,-6.822656,5.142187,-5.953125,-6.2125,4.532031,-6.697266,-5.602344,4.254687,-7.125,-5.325,8.154688,-3.375,-3.925,7.794336,-4.857422,-3.77168,7.001562,-5.953125,-3.434375,6.208789,-6.697266,-3.09707,5.848437,-7.125,-2.94375,8.929688,-3.375,0,8.539063,-4.857422,0,7.679688,-5.953125,0,6.820313,-6.697266,0,6.429688,-7.125,0,6.429688,-7.125,0,5.848437,-7.125,2.94375,5.691685,-7.400391,2.877056,6.259766,-7.400391,0,4.853868,-7.640625,2.520586,5.351563,-7.640625,0,2.783648,-7.810547,1.639761,3.107422,-7.810547,0,-1.070312,-7.875,0,4.254687,-7.125,5.325,4.134043,-7.400391,5.204355,3.489219,-7.640625,4.559531,1.895879,-7.810547,2.966191,-1.070312,-7.875,0,1.873438,-7.125,6.91875,1.806743,-7.400391,6.761997,1.450274,-7.640625,5.92418,.569448,-7.810547,3.85396,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-1.070312,-7.400391,7.330078,-1.070312,-7.640625,6.421875,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-4.014062,-7.125,6.91875,-3.947368,-7.400391,6.761997,-1.070312,-7.400391,7.330078,-3.590898,-7.640625,5.92418,-1.070312,-7.640625,6.421875,-2.710073,-7.810547,3.85396,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-6.395312,-7.125,5.325,-6.274668,-7.400391,5.204355,-5.629844,-7.640625,4.559531,-4.036504,-7.810547,2.966191,-1.070312,-7.875,0,-7.989062,-7.125,2.94375,-7.832309,-7.400391,2.877056,-6.994492,-7.640625,2.520586,-4.924272,-7.810547,1.639761,-1.070312,-7.875,0,-8.570313,-7.125,0,-8.400391,-7.400391,0,-7.492188,-7.640625,0,-5.248047,-7.810547,0,-1.070312,-7.875,0,-8.570313,-7.125,0,-7.989062,-7.125,-2.94375,-7.832309,-7.400391,-2.877056,-8.400391,-7.400391,0,-6.994492,-7.640625,-2.520586,-7.492188,-7.640625,0,-4.924272,-7.810547,-1.639761,-5.248047,-7.810547,0,-1.070312,-7.875,0,-6.395312,-7.125,-5.325,-6.274668,-7.400391,-5.204355,-5.629844,-7.640625,-4.559531,-4.036504,-7.810547,-2.966191,-1.070312,-7.875,0,-4.014062,-7.125,-6.91875,-3.947368,-7.400391,-6.761997,-3.590898,-7.640625,-5.92418,-2.710073,-7.810547,-3.85396,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,-1.070312,-7.400391,-7.330078,-1.070312,-7.640625,-6.421875,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,1.873438,-7.125,-6.91875,1.806743,-7.400391,-6.761997,-1.070312,-7.400391,-7.330078,1.450274,-7.640625,-5.92418,-1.070312,-7.640625,-6.421875,.569448,-7.810547,-3.85396,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,4.254687,-7.125,-5.325,4.134043,-7.400391,-5.204355,3.489219,-7.640625,-4.559531,1.895879,-7.810547,-2.966191,-1.070312,-7.875,0,5.848437,-7.125,-2.94375,5.691685,-7.400391,-2.877056,4.853868,-7.640625,-2.520586,2.783648,-7.810547,-1.639761,-1.070312,-7.875,0,6.429688,-7.125,0,6.259766,-7.400391,0,5.351563,-7.640625,0,3.107422,-7.810547,0,-1.070312,-7.875,0,-9.070313,2.25,0,-8.992188,2.425781,.84375,-11.47583,2.405457,.84375,-11.40625,2.232422,0,-13.298828,2.263184,.84375,-13.132813,2.109375,0,-14.421631,1.877014,.84375,-14.203125,1.775391,0,-14.804688,1.125,.84375,-14.570313,1.125,0,-8.820313,2.8125,1.125,-11.628906,2.786134,1.125,-13.664063,2.601563,1.125,-14.902344,2.100586,1.125,-15.320313,1.125,1.125,-8.648438,3.199219,.84375,-11.781982,3.166809,.84375,-14.029297,2.939941,.84375,-15.383057,2.324158,.84375,-15.835938,1.125,.84375,-8.570313,3.375,0,-11.851563,3.339844,0,-14.195313,3.09375,0,-15.601563,2.425781,0,-16.070313,1.125,0,-8.570313,3.375,0,-8.648438,3.199219,-0.84375,-11.781982,3.166809,-0.84375,-11.851563,3.339844,0,-14.029297,2.939941,-0.84375,-14.195313,3.09375,0,-15.383057,2.324158,-0.84375,-15.601563,2.425781,0,-15.835938,1.125,-0.84375,-16.070313,1.125,0,-8.820313,2.8125,-1.125,-11.628906,2.786134,-1.125,-13.664063,2.601563,-1.125,-14.902344,2.100586,-1.125,-15.320313,1.125,-1.125,-8.992188,2.425781,-0.84375,-11.47583,2.405457,-0.84375,-13.298828,2.263184,-0.84375,-14.421631,1.877014,-0.84375,-14.804688,1.125,-0.84375,-9.070313,2.25,0,-11.40625,2.232422,0,-13.132813,2.109375,0,-14.203125,1.775391,0,-14.570313,1.125,0,-14.570313,1.125,0,-14.804688,1.125,.84375,-14.588013,.00705,.84375,-14.375,.105469,0,-13.90918,-1.275146,.84375,-13.757813,-1.125,0,-12.724976,-2.540863,.84375,-12.671875,-2.355469,0,-10.992188
,-3.609375,.84375,-11.070313,-3.375,0,-15.320313,1.125,1.125,-15.056641,-0.209473,1.125,-14.242188,-1.605469,1.125,-12.841797,-2.94873,1.125,-10.820313,-4.125,1.125,-15.835938,1.125,.84375,-15.525269,-0.425995,.84375,-14.575195,-1.935791,.84375,-12.958618,-3.356598,.84375,-10.648438,-4.640625,.84375,-16.070313,1.125,0,-15.738281,-0.524414,0,-14.726563,-2.085938,0,-13.011719,-3.541992,0,-10.570313,-4.875,0,-16.070313,1.125,0,-15.835938,1.125,-0.84375,-15.525269,-0.425995,-0.84375,-15.738281,-0.524414,0,-14.575195,-1.935791,-0.84375,-14.726563,-2.085938,0,-12.958618,-3.356598,-0.84375,-13.011719,-3.541992,0,-10.648438,-4.640625,-0.84375,-10.570313,-4.875,0,-15.320313,1.125,-1.125,-15.056641,-0.209473,-1.125,-14.242188,-1.605469,-1.125,-12.841797,-2.94873,-1.125,-10.820313,-4.125,-1.125,-14.804688,1.125,-0.84375,-14.588013,.00705,-0.84375,-13.90918,-1.275146,-0.84375,-12.724976,-2.540863,-0.84375,-10.992188,-3.609375,-0.84375,-14.570313,1.125,0,-14.375,.105469,0,-13.757813,-1.125,0,-12.671875,-2.355469,0,-11.070313,-3.375,0,7.429688,-0.75,0,7.429688,-1.394531,1.85625,10.01123,-0.677124,1.676074,9.828125,-0.199219,0,11.101563,.84668,1.279688,10.867188,1.125,0,11.723145,2.629761,.883301,11.4375,2.730469,0,12.898438,4.125,.703125,12.429688,4.125,0,7.429688,-2.8125,2.475,10.414063,-1.728516,2.234766,11.617188,.234375,1.70625,12.351563,2.408203,1.177734,13.929688,4.125,.9375,7.429688,-4.230469,1.85625,10.816895,-2.779907,1.676074,12.132813,-0.37793,1.279688,12.97998,2.186646,.883301,14.960938,4.125,.703125,7.429688,-4.875,0,11,-3.257813,0,12.367188,-0.65625,0,13.265625,2.085938,0,15.429688,4.125,0,7.429688,-4.875,0,7.429688,-4.230469,-1.85625,10.816895,-2.779907,-1.676074,11,-3.257813,0,12.132813,-0.37793,-1.279688,12.367188,-0.65625,0,12.97998,2.186646,-0.883301,13.265625,2.085938,0,14.960938,4.125,-0.703125,15.429688,4.125,0,7.429688,-2.8125,-2.475,10.414063,-1.728516,-2.234766,11.617188,.234375,-1.70625,12.351563,2.408203,-1.177734,13.929688,4.125,-0.9375,7.429688,-1.394531,-1.85625,10.01123,-0.677124,-1.676074,11.101563,.84668,-1.279688,11.723145,2.629761,-0.883301,12.898438,4.125,-0.703125,7.429688,-0.75,0,9.828125,-0.199219,0,10.867188,1.125,0,11.4375,2.730469,0,12.429688,4.125,0,12.429688,4.125,0,12.898438,4.125,.703125,13.291077,4.346237,.65918,12.789063,4.335938,0,13.525879,4.422729,.5625,13.054688,4.40625,0,13.532898,4.350357,.46582,13.132813,4.335938,0,13.242188,4.125,.421875,12.929688,4.125,0,13.929688,4.125,.9375,14.395508,4.368896,.878906,14.5625,4.458984,.75,14.413086,4.38208,.621094,13.929688,4.125,.5625,14.960938,4.125,.703125,15.499939,4.391556,.65918,15.599121,4.495239,.5625,15.293274,4.413804,.46582,14.617188,4.125,.421875,15.429688,4.125,0,16.001953,4.401855,0,16.070313,4.511719,0,15.693359,4.428224,0,14.929688,4.125,0,15.429688,4.125,0,14.960938,4.125,-0.703125,15.499939,4.391556,-0.65918,16.001953,4.401855,0,15.599121,4.495239,-0.5625,16.070313,4.511719,0,15.293274,4.413804,-0.46582,15.693359,4.428224,0,14.617188,4.125,-0.421875,14.929688,4.125,0,13.929688,4.125,-0.9375,14.395508,4.368896,-0.878906,14.5625,4.458984,-0.75,14.413086,4.38208,-0.621094,13.929688,4.125,-0.5625,12.898438,4.125,-0.703125,13.291077,4.346237,-0.65918,13.525879,4.422729,-0.5625,13.532898,4.350357,-0.46582,13.242188,4.125,-0.421875,12.429688,4.125,0,12.789063,4.335938,0,13.054688,4.40625,0,13.132813,4.335938,0,12.929688,4.125,0,.501414,7.628906,.670256,.632813,7.628906,0,-1.070312,7.875,0,.429278,7.03125,.639395,.554688,7.03125,0,-0.162029,6.292969,.38696,-0.085937,6.292969,0,-0.147812,5.625,.3925,-0.070312,5.625,0,.140489,7.628906,1.210801,-1.070312,7.875,0,.084844,7.03125,1.155156,-0.370879,6.292969,.699434,-0.360312,5.625,.71,-0.400056,7.628906,1.571726,-1.070312,7.875,0,-0.430918,7.03125,1.49959,-0.683352,6.292969,.908284,-0.677812,5.625,.9225,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.070312,7.03125,1.625,-1.070312,6.292969,.984375,-1.070312,5.625,1,-1.740569,7.628906,1.571726,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.709707,7.03125,1.49959,-1.070312,7.03125,1.625,-1.457273,6.292969,.908284,-1.070312,6.292969,.984375,-1.462812,5.625,.9225,-1.070312,5.625,1,-2.281113,7.628906,1.210801,-1.070312,7.875,0,-2.225469,7.03125,1.155156,-1.769746,6.292969,.699434,-1.780312,5.625,.71,-2.642038,7.628906,.670256,-1.070312,7.875,0,-2.569902,7.03125,.639395,-1.978596,6.292969,.38696,-1.992812,5.625,.3925,-2.773438,7.628906,0,-1.070312,7.875,0,-2.695313,7.03125,0,-2.054687,6.292969,0,-2.070312,5.625,0,-2.642038,7.628906,-0.670256,-2.773438,7.628906,0,-1.070312,7.875,0,-2.569902,7.03125,-0.639395,-2.695313,7.03125,0,-1.978596,6.292969,-0.38696,-2.054687,6.292969,0,-1.992812,5.625,-0.3925,-2.070312,5.625,0,-2.281113,7.628906,-1.210801,-1.070312,7.875,0,-2.225469,7.03125,-1.155156,-1.769746,6.292969,-0.699434,-1.780312,5.625,-0.71,-1.740569,7.628906,-1.571726,-1.070312,7.875,0,-1.709707,7.03125,-1.49959,-1.457273,6.292969,-0.908284,-1.462812,5.625,-0.9225,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-1.070312,7.03125,-1.625,-1.070312,6.292969,-0.984375,-1.070312,5.625,-1,-0.400056,7.628906,-1.571726,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-0.430918,7.03125,-1.49959,-1.070312,7.03125,-1.625,-0.683352,6.292969,-0.908284,-1.070312,6.292969,-0.984375,-0.677812,5.625,-0.9225,-1.070312,5.625,-1,.140489,7.628906,-1.210801,-1.070312,7.875,0,.084844,7.03125,-1.155156,-0.370879,6.292969,-0.699434,-0.360312,5.625,-0.71,.501414,7.628906,-0.670256,-1.070312,7.875,0,.429278,7.03125,-0.639395,-0.162029,6.292969,-0.38696,-0.147812,5.625,-0.3925,.632813,7.628906,0,-1.070312,7.875,0,.554688,7.03125,0,-0.085937,6.292969,0,-0.070312,5.625,0,-0.070312,5.625,0,-0.147812,5.625,.3925,1.034141,5.179688,.895391,1.210938,5.179688,0,2.735,4.875,1.619062,3.054688,4.875,0,4.262891,4.570313,2.26914,4.710938,4.570313,0,4.925938,4.125,2.55125,5.429688,4.125,0,-0.360312,5.625,.71,.549375,5.179688,1.619688,1.858438,4.875,2.92875,3.034375,4.570313,4.104687,3.544688,4.125,4.615,-0.677812,5.625,.9225,-0.174922,5.179688,2.104453,.54875,4.875,3.805313,1.198828,4.570313,5.333203,1.480938,4.125,5.99625,-1.070312,5.625,1,-1.070312,5.179688,2.28125,-1.070312,4.875,4.125,-1.070312,4.570313,5.78125,-1.070312,4.125,6.5,-1.070312,5.625,1,-1.462812,5.625,.9225,-1.965703,5.179688,2.104453,-1.070312,5.179688,2.28125,-2.689375,4.875,3.805313,-1.070312,4.875,4.125,-3.339453,4.570313,5.333203,-1.070312,4.570313,5.78125,-3.621562,4.125,5.99625,-1.070312,4.125,6.5,-1.780312,5.625,.71,-2.69,5.179688,1.619688,-3.999062,4.875,2.92875,-5.174999,4.570313,4.104687,-5.685312,4.125,4.615,-1.992812,5.625,.3925,-3.174765,5.179688,.895391,-4.875625,4.875,1.619062,-6.403516,4.570313,2.26914,-7.066563,4.125,2.55125,-2.070312,5.625,0,-3.351562,5.179688,0,-5.195313,4.875,0,-6.851563,4.570313,0,-7.570313,4.125,0,-2.070312,5.625,0,-1.992812,5.625,-0.3925,-3.174765,5.179688,-0.895391,-3.351562,5.179688,0,-4.875625,4.875,-1.619062,-5.195313,4.875,0,-6.403516,4.570313,-2.26914,-6.851563,4.570313,0,-7.066563,4.125,-2.55125,-7.570313,4.125,0,-1.780312,5.625,-0.71,-2.69,5.179688,-1.619688,-3.999062,4.875,-2.92875,-5.174999,4.570313,-4.104687,-5.685312,4.125,-4.615,-1.462812,5.625,-0.9225,-1.965703,5.179688,-2.104453,-2.689375,4.875,-3.805313,-3.339453,4.570313,-5.333203,-3.621562,4.125,-5.99625,-1.070312,5.625,-1,-1.070312,5.179688,-2.28125,-1.070312,4.875,-4.125,-1.070312,4.570313,-5.78125,-1.070312,4.125,-6.5,-1.070312,5.625,-1,-0.677812,5.625,-0.9225,-0.174922,5.179688,-2.104453,-1.070312,5.179688,-2.28125,.54875,4.875,-3.805313,-1.070312,4.875,-4.125,1.198828,4.570313,-5.333203,-1.070312,4.570313,-5.78125,1.480938,4.125,-5.99625,-1.070312,4.125,-6.5,-0.360312,5.625,-0.71,.549375,5.179688,-1.619688,1.858438,4.875,-2.92875,3.034375,4.570313,-4.104687,3.544688,4.125,-4.615,-0.147812,5.625,-0.3925,1.034141,5.179688,-0.895391,2.735,4.875,-1.619062,4.262891,4.570313,-2.26914,4.925938,4.125,-2.55125,-0.070312,5.625,0,1.210938,5.179688,0,3.054688,4.875,0,4.710938,4.570313,0,5.429688,4.125,0],normals:[-0.966742,-0.255752,0,-0.893014,-0.256345,-0.369882,-0.893437,.255996,-0.369102,-0.966824,.255443,0,-0.083877,.995843,-0.035507,-0.092052,.995754,0,.629724,.73186,.260439,.68205,.731305,0,.803725,.49337,.332584,.870301,.492521,0,-0.683407,-0.256728,-0.683407,-0.683531,.256068,-0.683531,-0.064925,.995776,-0.064925,.481399,.732469,.481399,.614804,.493997,.614804,-0.369882,-0.256345,-0.893014,-0.369102,.255996,-0.893437,-0.035507,.995843,-0.083877,.260439,.73186,.629724,.332584,.493369,.803725,-0.002848,-0.257863,-0.966177,-0.001923,.254736,-0.967009,-0.000266,.995734,-0.09227,24e-6,.731295,.682061,0,.492521,.870301,-0.002848,-0.257863,-0.966177,.379058,-0.3593,-0.852771,.37711,.149085,-0.914091,-0.001923,.254736,-0.967009,.027502,.992081,-0.122552,-0.000266,.995734,-0.09227,-0.26101,.726762,.635367,24e-6,.731295,.682061,-0.332485,.492546,.804271,0,.492521,.870301,.663548,-0.41079,-0.625264,.712664,.073722,-0.697621,.099726,.987509,-0.121983,-0.48732,.723754,.488569,-0.615242,.492602,.615484,.880028,-0.332906,-0.338709,.917276,.167113,-0.361493,.113584,.992365,-0.04807,-0.63415,.727508,.261889,-0.804126,.492634,.332705,.96669,-0.255738,.010454,.967442,.252962,.008103,.093436,.995624,.001281,-0.682167,.731196,-0.000343,-0.870322,.492483,-0.000054,.96669,-0.255738,.010454,.893014,-0.256345,.369882,.893437,.255996,.369102,.967442,.252962,.008103,.083877,.995843,.035507,.093436,.995624,.001281,-0.629724,.73186,-0.260439,-0.682167,.731196,-0.000343,-0.803725,.49337,-0.332584,-0.870322,.492483,-0.000054,.683407,-0.256728,.683407,.683531,.256068,.683531,.064925,.995776,.064925,-0.481399,.732469,-0.481399,-0.614804,.493997,-0.614804,.369882,-0.256345,.893014,.369102,.255996,.893437,.035507,.995843,.083877,-0.260439,.73186,-0.629724,-0.332584,.493369,-0.803725,0,-0.255752,.966742,0,.255443,.966824,0,.995754,.092052,0,.731305,-0.68205,0,.492521,-0.870301,0,-0.255752,.966742,-0.369882,-0.256345,.893014,-0.369102,.255996,.893437,0,.255443,.966824,-0.035507,.995843,.083877,0,.995754,.092052,.260439,.73186,-0.629724,0,.731305,-0.68205,.332584,.49337,-0.803725,0,.492521,-0.870301,-0.683407,-0.256728,.683407,-0.683531,.256068,.683531,-0.064925,.995776,.064925,.481399,.732469,-0.481399,.614804,.493997,-0.614804,-0.893014,-0.256345,.369882,-0.893437,.255996,.369102,-0.083877,.995843,.035507,.629724,.73186,-0.260439,.803725,.493369,-0.332584,-0.966742,-0.255752,0,-0.966824,.255443,0,-0.092052,.995754,0,.68205,.731305,0,.870301,.492521,0,.870301,.492521,0,.803725,.49337,.332584,.845438,.403546,.349835,.915321,.402725,0,.869996,.336859,.360047,.941808,.336151,0,.904193,.205791,.37428,.97869,.205342,0,.921879,-0.06637,.381752,.997804,-0.06624,0,.614804,.493997,.614804,.646802,.404096,.646802,.665655,.337351,.665655,.691923,.20612,.691923,.705543,-0.06648,.705542,.332584,.493369,.803725,.349835,.403546,.845438,.360047,.336859,.869996,.37428,.205791,.904193,.381752,-0.066369,.921879,0,.492521,.870301,0,.402725,.915321,0,.336151,.941808,0,.205342,.97869,0,-0.06624,.997804,0,.492521,.870301,-0.332485,.492546,.804271,-0.349835,.403546,.845438,0,.402725,.915321,-0.360047,.336859,.869996,0,.336151,.941808,-0.37428,.205791,.904193,0,.205342,.97869,-0.381752,-0.06637,.921879,0,-0.06624,.997804,-0.615242,.492602,.615484,-0.646802,.404096,.646802,-0.665655,.337351,.665655,-0.691923,.20612,.691923,-0.705542,-0.06648,.705543,-0.804126,.492634,.332705,-0.845438,.403546,.349835,-0.869996,.336859,.360047,-0.904193,.205791,.37428,-0.921879,-0.066369,.381752,-0.870322,.492483,-0.000054,-0.915321,.402725,0,-0.941808,.336151,0,-0.97869,.205342,0,-0.997804,-0.06624,0,-0.870322,.492483,-0.000054,-0.803725,.49337,-0.332584,-0.845438,.403546,-0.349835,-0.915321,.402725,0,-0.869996,.336859,-0.360047,-0.941808,.336151,0,-0.904193,.205791,-0.37428,-0.97869,.205342,0,-0.921879,-0.06637,-0.381752,-0.997804,-0.06624,0,-0.614804,.493997,-0.614804,-0.646802,.404096,-0.646802,-0.665655,.337351,-0.665655,-0.691923,.20612,-0.691923,-0.705543,-0.06648,-0.705542,-0.332584,.493369,-0.803725,-0.349835,.403546,-0.845438,-0.360047,.336859,-0.869996,-0.37428,.205791,-0.904193,-0.381752,-0.066369,-0.921879,0,.492521,-0.870301,0,.402725,-0.915321,0,.336151,-0.941808,0,.205342,-0.97869,0,-0.06624,-0.997804,0,.492521,-0.870301,.332584,.49337,-0.803725,.349835,.403546,-0.845438,0,.402725,-0.915321,.360047,.336859,-0.869996,0,.336151,-0.941808,.37428,.205791,-0.904193,0,.205342,-0.97869,.381752,-0.06637,-0.921879,0,-0.06624,-0.997804,.614804,.493997,-0.614804,.646802,.404096,-0.646802,.665655,.337351,-0.665655,.691923,.20612,-0.691923,.705542,-0.06648,-0.705543,.803725,.493369,-0.332584,.845438,.403546,-0.349835,.869996,.336859,-0.360047,.904193,.205791,-0.37428,.921879,-0.066369,-0.381752,.870301,.492521,0,.915321,.402725,0,.941808,.336151,0,.97869,.205342,0,.997804,-0.06624,0,.997804,-0.06624,0,.921879,-0.06637,.381752,.831437,-0.43618,.344179,.900182,-0.435513,0,.673512,-0.684666,.278594,.729611,-0.683863,0,.640399,-0.720924,.264874,.693951,-0.720022,0,.732949,-0.608995,.303167,.79395,-0.607983,0,.705543,-0.06648,.705542,.636092,-0.436778,.636092,.514965,-0.68529,.514965,.489651,-0.721446,.489651,.560555,-0.609554,.560555,.381752,-0.066369,.921879,.344179,-0.43618,.831437,.278595,-0.684666,.673512,.264874,-0.720924,.640399,.303167,-0.608995,.732949,0,-0.06624,.997804,0,-0.435513,.900182,0,-0.683863,.729611,0,-0.720022,.693951,0,-0.607983,.79395,0,-0.06624,.997804,-0.381752,-0.06637,.921879,-0.344179,-0.43618,.831437,0,-0.435513,.900182,-0.278594,-0.684666,.673512,0,-0.683863,.729611,-0.264874,-0.720924,.640399,0,-0.720022,.693951,-0.303167,-0.608995,.732949,0,-0.607983,.79395,-0.705542,-0.06648,.705543,-0.636092,-0.436778,.636092,-0.514965,-0.68529,.514965,-0.489651,-0.721446,.489651,-0.560555,-0.609554,.560555,-0.921879,-0.066369,.381752,-0.831437,-0.43618,.344179,-0.673512,-0.684666,.278595,-0.640399,-0.720924,.264874,-0.732949,-0.608995,.303167,-0.997804,-0.06624,0,-0.900182,-0.435513,0,-0.729611,-0.683863,0,-0.693951,-0.720022,0,-0.79395,-0.607983,0,-0.997804,-0.06624,0,-0.921879,-0.06637,-0.381752,-0.831437,-0.43618,-0.344179,-0.900182,-0.435513,0,-0.673512,-0.684666,-0.278594,-0.729611,-0.683863,0,-0.640399,-0.720924,-0.264874,-0.693951,-0.720022,0,-0.732949,-0.608995,-0.303167,-0.79395,-0.607983,0,-0.705543,-0.06648,-0.705542,-0.636092,-0.436778,-0.636092,-0.514965,-0.68529,-0.514965,-0.489651,-0.721446,-0.489651,-0.560555,-0.609554,-0.560555,-0.381752,-0.066369,-0.921879,-0.344179,-0.43618,-0.831437,-0.278595,-0.684666,-0.673512,-0.264874,-0.720924,-0.640399,-0.303167,-0.608995,-0.732949,0,-0.06624,-0.997804,0,-0.435513,-0.900182,0,-0.683863,-0.729611,0,-0.720022,-0.693951,0,-0.607983,-0.79395,0,-0.06624,-0.997804,.381752,-0.06637,-0.921879,.344179,-0.43618,-0.831437,0,-0.435513,-0.900182,.278594,-0.684666,-0.673512,0,-0.683863,-0.729611,.264874,-0.720924,-0.640399,0,-0.720022,-0.693951,.303167,-0.608995,-0.732949,0,-0.607983,-0.79395,.705542,-0.06648,-0.705543,.636092,-0.436778,-0.636092,.514965,-0.68529,-0.514965,.489651,-0.721446,-0.489651,.560555,-0.609554,-0.560555,.921879,-0.066369,-0.381752,.831437,-0.43618,-0.344179,.673512,-0.684666,-0.278595,.640399,-0.720924,-0.264874,.732949,-0.608995,-0.303167,.997804,-0.06624,0,.900182,-0.435513,0,.729611,-0.683863,0,.693951,-0.720022,0,.79395,-0.607983,0,.79395,-0.607983,0,.732949,-0.608995,.303167,.57623,-0.781801,.238217,.62386,-0.781536,0,.163628,-0.984208,.067527,.177291,-0.984159,0,.045422,-0.998792,.018736,.049207,-0.998789,0,0,-1,0,.560555,-0.609554,.560555,.440416,-0.782348,.440416,.124903,-0.984276,.124903,.034662,-0.998798,.034662,0,-1,0,.303167,-0.608995,.732949,.238217,-0.781801,.57623,.067527,-0.984208,.163628,.018736,-0.998792,.045422,0,-1,0,0,-0.607983,.79395,0,-0.781536,.62386,0,-0.984159,.177291,0,-0.998789,.049207,0,-1,0,0,-0.607983,.79395,-0.303167,-0.608995,.732949,-0.238217,-0.781801,.57623,0,-0.781536,.62386,-0.067527,-0.984208,.163628,0,-0.984159,.177291,-0.018736,-0.998792,.045422,0,-0.998789,.049207,0,-1,0,-0.560555,-0.609554,.560555,-0.440416,-0.782348,.440416,-0.124903,-0.984276,.124903,-0.034662,-0.998798,.034662,0,-1,0,-0.732949,-0.608995,.303167,-0.57623,-0.781801,.238217,-0.163628,-0.984208,.067527,-0.045422,-0.998792,.018736,0,-1,0,-0.79395,-0.607983,0,-0.62386,-0.781536,0,-0.177291,-0.984159,0,-0.049207,-0.998789,0,0,-1,0,-0.79395,-0.607983,0,-0.732949,-0.608995,-0.303167,-0.57623,-0.781801,-0.238217,-0.62386,-0.781536,0,-0.163628,-0.984208,-0.067527,-0.177291,-0.984159,0,-0.045422,-0.998792,-0.018736,-0.049207,-0.998789,0,0,-1,0,-0.560555,-0.609554,-0.560555,-0.440416,-0.782348,-0.440416,-0.124903,-0.984276,-0.124903,-0.034662,-0.998798,-0.034662,0,-1,0,-0.303167,-0.608995,-0.732949,-0.238217,-0.781801,-0.57623,-0.067527,-0.984208,-0.163628,-0.018736,-0.998792,-0.045422,0,-1,0,0,-0.607983,-0.79395,0,-0.781536,-0.62386,0,-0.984159,-0.177291,0,-0.998789,-0.049207,0,-1,0,0,-0.607983,-0.79395,.303167,-0.608995,-0.732949,.238217,-0.781801,-0.57623,0,-0.781536,-0.62386,.067527,-0.984208,-0.163628,0,-0.984159,-0.177291,.018736,-0.998792,-0.045422,0,-0.998789,-0.049207,0,-1,0,.560555,-0.609554,-0.560555,.440416,-0.782348,-0.440416,.124903,-0.984276,-0.124903,.034662,-0.998798,-0.034662,0,-1,0,.732949,-0.608995,-0.303167,.57623,-0.781801,-0.238217,.163628,-0.984208,-0.067527,.045422,-0.998792,-0.018736,0,-1,0,.79395,-0.607983,0,.62386,-0.781536,0,.177291,-0.984159,0,.049207,-0.998789,0,0,-1,0,.007786,-0.99997,-0.000216,.007039,-0.812495,.582926,.036127,-0.837257,.545614,.039138,-0.999233,-0.000989,.161846,-0.810421,.563048,.179512,-0.983746,-0.004369,.482365,-0.595148,.642746,.612299,-0.790557,-0.01046,.73872,-0.114594,.664199,.986152,-0.165708,-0.00667,-0.001909,.162121,.986769,.002762,.017107,.99985,.010533,.073398,.997247,-0.066041,.13007,.989303,-0.094427,.016594,.995393,-0.009203,.871509,.490293,-0.048606,.840609,.539457,-0.223298,.80288,.552739,-0.596365,.559971,.575135,-0.803337,.068236,.591603,-0.010561,.999944,103e-6,-0.058798,.99827,71e-5,-0.28071,.959787,.003269,-0.749723,.661738,.004268,-0.997351,.072714,.002059,-0.010561,.999944,103e-6,-0.008792,.871493,-0.49033,-0.046494,.841178,-0.538756,-0.058798,.99827,71e-5,-0.217909,.806807,-0.549161,-0.28071,.959787,.003269,-0.597291,.560026,-0.574121,-0.749723,.661738,.004268,-0.804,.062913,-0.591292,-0.997351,.072714,.002059,-0.001806,.161691,-0.98684,.002031,.014555,-0.999892,.009215,.060069,-0.998152,-0.059334,.113865,-0.991723,-0.086899,.01229,-0.996141,.006418,-0.812379,-0.583095,.033783,-0.837512,-0.545373,.157113,-0.811947,-0.56219,.484406,-0.589366,-0.646528,.73887,-0.10132,-0.666187,.007786,-0.99997,-0.000216,.039138,-0.999233,-0.000989,.179512,-0.983746,-0.004369,.612299,-0.790557,-0.01046,.986152,-0.165708,-0.00667,.986152,-0.165708,-0.00667,.73872,-0.114594,.664199,.725608,.259351,.637361,.946512,.32265,-0.003357,.645945,.461988,.607719,.82583,.56387,-0.007452,.531615,.63666,.558614,.650011,.759893,-0.006937,.424964,.681717,.59554,.532429,.846459,-0.005245,-0.094427,.016594,.995393,-0.049562,-0.019755,.998576,-0.037816,-0.035624,.99865,-0.037914,-0.036512,.998614,-0.168854,-0.297945,.93953,-0.803337,.068236,.591603,-0.742342,-0.299166,.599523,-0.619602,-0.529406,.579502,-0.483708,-0.68576,.543837,-0.445293,-0.794355,.413177,-0.997351,.072714,.002059,-0.926513,-0.376258,.001996,-0.75392,-0.656952,.004317,-0.566224,-0.824244,.003461,-0.481804,-0.876277,.00185,-0.997351,.072714,.002059,-0.804,.062913,-0.591292,-0.744675,-0.294425,-0.598977,-0.926513,-0.376258,.001996,-0.621949,-0.528114,-0.578165,-0.75392,-0.656952,.004317,-0.481171,-0.68834,-0.542828,-0.566224,-0.824244,.003461,-0.438055,-0.797035,-0.415744,-0.481804,-0.876277,.00185,-0.086899,.01229,-0.996141,-0.044337,-0.017056,-0.998871,-0.026176,-0.028166,-0.99926,-0.025294,-0.028332,-0.999278,-0.157482,-0.289392,-0.944167,.73887,-0.10132,-0.666187,.728244,.25241,-0.637142,.647055,.459725,-0.608254,.522994,.640657,-0.56217,.409978,.682857,-0.604669,.986152,-0.165708,-0.00667,.946512,.32265,-0.003357,.82583,.56387,-0.007452,.650011,.759893,-0.006937,.532429,.846459,-0.005245,-0.230787,.972982,-0.006523,-0.152877,.687211,.71019,-0.316721,.63775,.702113,-0.548936,.835863,-0.001511,-0.601067,.471452,.64533,-0.875671,.482806,.009893,-0.635889,.44609,.629801,-0.877554,.479097,.019092,-0.435746,.601008,.670011,-0.69619,.717439,.024497,.111113,-0.08507,.99016,.22331,.00654,.974726,.190097,.154964,.969458,.005271,.189482,.98187,-0.011752,.246688,.969024,.343906,-0.722796,.599412,.572489,-0.567656,.591627,.787436,-0.256459,.560512,.647097,-0.306374,.698141,.427528,-0.499343,.753576,.410926,-0.911668,.001284,.67152,-0.740986,-0.000899,.922026,-0.38706,-0.007253,.84691,-0.531556,-0.013854,.535924,-0.844201,-0.010505,.410926,-0.911668,.001284,.341188,-0.722823,-0.600931,.578664,-0.561139,-0.591838,.67152,-0.740986,-0.000899,.784869,-0.25102,-0.566542,.922026,-0.38706,-0.007253,.642681,-0.302257,-0.70399,.84691,-0.531556,-0.013854,.418589,-0.500042,-0.758117,.535924,-0.844201,-0.010505,.115806,-0.079139,-0.990114,.232811,.012565,-0.972441,.206662,.153601,-0.96628,.0245,.161443,-0.986578,.003382,.211115,-0.977455,-0.134912,.687491,-0.713551,-0.31954,.633073,-0.705063,-0.603902,.461442,-0.649903,-0.631815,.437169,-0.640072,-0.424306,.612706,-0.66675,-0.230787,.972982,-0.006523,-0.548936,.835863,-0.001511,-0.875671,.482806,.009893,-0.877554,.479097,.019092,-0.69619,.717439,.024497,-0.69619,.717439,.024497,-0.435746,.601008,.670011,-0.259858,.791937,.552548,-0.425801,.904753,.010805,.009539,.99972,-0.021674,.022046,.999756,.001623,.410157,.332912,-0.849082,.999598,.025875,.011556,.541523,-0.548619,-0.637001,.709587,-0.704552,.009672,-0.011752,.246688,.969024,.046311,.455223,.889172,-0.010688,.988794,.1489,-0.044376,.682946,-0.72912,.122824,.009233,-0.992385,.427528,-0.499343,.753576,.481839,-0.18044,.85748,.455272,.736752,.499925,-0.220542,.907193,-0.358277,-0.235919,.65725,-0.715797,.535924,-0.844201,-0.010505,.728094,-0.6853,-0.015585,.888738,.458112,-0.016679,-0.260098,.965582,8e-4,-0.371611,.928378,-0.004418,.535924,-0.844201,-0.010505,.418589,-0.500042,-0.758117,.480165,-0.178362,-0.858853,.728094,-0.6853,-0.015585,.488102,.716802,-0.497947,.888738,.458112,-0.016679,-0.222004,.905399,.361892,-0.260098,.965582,8e-4,-0.235405,.66318,.710477,-0.371611,.928378,-0.004418,.003382,.211115,-0.977455,.05872,.437702,-0.8972,.001326,.986459,-0.164002,-0.04419,.681675,.730319,.138801,-0.034188,.98973,-0.424306,.612706,-0.66675,-0.25889,.797206,-0.54538,.01227,.999739,.019287,.398632,.35489,.845663,.537564,-0.581398,.610738,-0.69619,.717439,.024497,-0.425801,.904753,.010805,.022046,.999756,.001623,.999598,.025875,.011556,.709587,-0.704552,.009672,.76264,.565035,.314825,.82454,.565804,17e-6,0,1,0,.847982,-0.397998,.350034,.917701,-0.397272,34e-6,.864141,-0.355261,.356441,.935269,-0.353939,113e-6,.720992,.625625,.297933,.780712,.62489,75e-6,.583357,.565165,.583338,0,1,0,.648485,-0.398726,.648448,.660872,-0.355894,.660748,.551862,.62529,.55178,.314824,.565051,.762629,0,1,0,.350045,-0.397976,.847988,.356474,-0.355199,.864153,.297983,.625515,.721067,-0.000017,.565804,.82454,0,1,0,-0.000034,-0.397272,.917701,-0.000113,-0.353939,.935269,-0.000075,.62489,.780712,-0.314825,.565035,.76264,-0.000017,.565804,.82454,0,1,0,-0.350034,-0.397998,.847982,-0.000034,-0.397272,.917701,-0.356441,-0.355261,.864141,-0.000113,-0.353939,.935269,-0.297933,.625625,.720992,-0.000075,.62489,.780712,-0.583338,.565165,.583357,0,1,0,-0.648448,-0.398726,.648485,-0.660748,-0.355894,.660872,-0.55178,.62529,.551862,-0.762629,.565051,.314824,0,1,0,-0.847988,-0.397976,.350045,-0.864153,-0.355199,.356474,-0.721067,.625515,.297983,-0.82454,.565804,-0.000017,0,1,0,-0.917701,-0.397272,-0.000034,-0.935269,-0.353939,-0.000113,-0.780712,.62489,-0.000075,-0.76264,.565035,-0.314825,-0.82454,.565804,-0.000017,0,1,0,-0.847982,-0.397998,-0.350034,-0.917701,-0.397272,-0.000034,-0.864141,-0.355261,-0.356441,-0.935269,-0.353939,-0.000113,-0.720992,.625625,-0.297933,-0.780712,.62489,-0.000075,-0.583357,.565165,-0.583338,0,1,0,-0.648485,-0.398726,-0.648448,-0.660872,-0.355894,-0.660748,-0.551862,.62529,-0.55178,-0.314824,.565051,-0.762629,0,1,0,-0.350045,-0.397976,-0.847988,-0.356474,-0.355199,-0.864153,-0.297983,.625515,-0.721067,17e-6,.565804,-0.82454,0,1,0,34e-6,-0.397272,-0.917701,113e-6,-0.353939,-0.935269,75e-6,.62489,-0.780712,.314825,.565035,-0.76264,17e-6,.565804,-0.82454,0,1,0,.350034,-0.397998,-0.847982,34e-6,-0.397272,-0.917701,.356441,-0.355261,-0.864141,113e-6,-0.353939,-0.935269,.297933,.625625,-0.720992,75e-6,.62489,-0.780712,.583338,.565165,-0.583357,0,1,0,.648448,-0.398726,-0.648485,.660748,-0.355894,-0.660872,.55178,.62529,-0.551862,.762629,.565051,-0.314824,0,1,0,.847988,-0.397976,-0.350045,.864153,-0.355199,-0.356474,.721067,.625515,-0.297983,.82454,.565804,17e-6,0,1,0,.917701,-0.397272,34e-6,.935269,-0.353939,113e-6,.780712,.62489,75e-6,.780712,.62489,75e-6,.720992,.625625,.297933,.217978,.971775,.090216,.236583,.971611,0,.159589,.984977,.065961,.173084,.984907,0,.350498,.925311,.14474,.379703,.925108,0,.48559,.850653,.201474,.526673,.850068,0,.551862,.62529,.55178,.166631,.971838,.166631,.121908,.985026,.121908,.267668,.925585,.267668,.371315,.851029,.371315,.297983,.625515,.721067,.090216,.971775,.217978,.065961,.984977,.159589,.14474,.925311,.350498,.201475,.850653,.48559,-0.000075,.62489,.780712,0,.971611,.236583,0,.984907,.173084,0,.925108,.379703,0,.850068,.526673,-0.000075,.62489,.780712,-0.297933,.625625,.720992,-0.090216,.971775,.217978,0,.971611,.236583,-0.065961,.984977,.159589,0,.984907,.173084,-0.14474,.925311,.350498,0,.925108,.379703,-0.201474,.850653,.48559,0,.850068,.526673,-0.55178,.62529,.551862,-0.166631,.971838,.166631,-0.121908,.985026,.121908,-0.267668,.925585,.267668,-0.371315,.851029,.371315,-0.721067,.625515,.297983,-0.217978,.971775,.090216,-0.159589,.984977,.065961,-0.350498,.925311,.14474,-0.48559,.850653,.201475,-0.780712,.62489,-0.000075,-0.236583,.971611,0,-0.173084,.984907,0,-0.379703,.925108,0,-0.526673,.850068,0,-0.780712,.62489,-0.000075,-0.720992,.625625,-0.297933,-0.217978,.971775,-0.090216,-0.236583,.971611,0,-0.159589,.984977,-0.065961,-0.173084,.984907,0,-0.350498,.925311,-0.14474,-0.379703,.925108,0,-0.48559,.850653,-0.201474,-0.526673,.850068,0,-0.551862,.62529,-0.55178,-0.166631,.971838,-0.166631,-0.121908,.985026,-0.121908,-0.267668,.925585,-0.267668,-0.371315,.851029,-0.371315,-0.297983,.625515,-0.721067,-0.090216,.971775,-0.217978,-0.065961,.984977,-0.159589,-0.14474,.925311,-0.350498,-0.201475,.850653,-0.48559,75e-6,.62489,-0.780712,0,.971611,-0.236583,0,.984907,-0.173084,0,.925108,-0.379703,0,.850068,-0.526673,75e-6,.62489,-0.780712,.297933,.625625,-0.720992,.090216,.971775,-0.217978,0,.971611,-0.236583,.065961,.984977,-0.159589,0,.984907,-0.173084,.14474,.925311,-0.350498,0,.925108,-0.379703,.201474,.850653,-0.48559,0,.850068,-0.526673,.55178,.62529,-0.551862,.166631,.971838,-0.166631,.121908,.985026,-0.121908,.267668,.925585,-0.267668,.371315,.851029,-0.371315,.721067,.625515,-0.297983,.217978,.971775,-0.090216,.159589,.984977,-0.065961,.350498,.925311,-0.14474,.48559,.850653,-0.201475,.780712,.62489,75e-6,.236583,.971611,0,.173084,.984907,0,.379703,.925108,0,.526673,.850068,0],textureCoords:[2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,.75,2,.75,1.975,1,1.975,.75,1.95,1,1.95,.75,1.925,1,1.925,.75,1.9,1,1.9,.5,2,.5,1.975,.5,1.95,.5,1.925,.5,1.9,.25,2,.25,1.975,.25,1.95,.25,1.925,.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,.75,2,.75,1.975,1,1.975,.75,1.95,1,1.95,.75,1.925,1,1.925,.75,1.9,1,1.9,.5,2,.5,1.975,.5,1.95,.5,1.925,.5,1.9,.25,2,.25,1.975,.25,1.95,.25,1.925,.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,.75,1.9,.75,1.675,1,1.675,.75,1.45,1,1.45,.75,1.225,1,1.225,.75,1,1,1,.5,1.9,.5,1.675,.5,1.45,.5,1.225,.5,1,.25,1.9,.25,1.675,.25,1.45,.25,1.225,.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,.75,1.9,.75,1.675,1,1.675,.75,1.45,1,1.45,.75,1.225,1,1.225,.75,1,1,1,.5,1.9,.5,1.675,.5,1.45,.5,1.225,.5,1,.25,1.9,.25,1.675,.25,1.45,.25,1.225,.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1,1.75,1,1.75,.85,2,.85,1.75,.7,2,.7,1.75,.55,2,.55,1.75,.4,2,.4,1.5,1,1.5,.85,1.5,.7,1.5,.55,1.5,.4,1.25,1,1.25,.85,1.25,.7,1.25,.55,1.25,.4,1,1,1,.85,1,.7,1,.55,1,.4,1,1,.75,1,.75,.85,1,.85,.75,.7,1,.7,.75,.55,1,.55,.75,.4,1,.4,.5,1,.5,.85,.5,.7,.5,.55,.5,.4,.25,1,.25,.85,.25,.7,.25,.55,.25,.4,0,1,0,.85,0,.7,0,.55,0,.4,2,1,1.75,1,1.75,.85,2,.85,1.75,.7,2,.7,1.75,.55,2,.55,1.75,.4,2,.4,1.5,1,1.5,.85,1.5,.7,1.5,.55,1.5,.4,1.25,1,1.25,.85,1.25,.7,1.25,.55,1.25,.4,1,1,1,.85,1,.7,1,.55,1,.4,1,1,.75,1,.75,.85,1,.85,.75,.7,1,.7,.75,.55,1,.55,.75,.4,1,.4,.5,1,.5,.85,.5,.7,.5,.55,.5,.4,.25,1,.25,.85,.25,.7,.25,.55,.25,.4,0,1,0,.85,0,.7,0,.55,0,.4,2,.4,1.75,.4,1.75,.3,2,.3,1.75,.2,2,.2,1.75,.1,2,.1,1.75,0,1.5,.4,1.5,.3,1.5,.2,1.5,.1,1.5,0,1.25,.4,1.25,.3,1.25,.2,1.25,.1,1.25,0,1,.4,1,.3,1,.2,1,.1,1,0,1,.4,.75,.4,.75,.3,1,.3,.75,.2,1,.2,.75,.1,1,.1,.75,0,.5,.4,.5,.3,.5,.2,.5,.1,.5,0,.25,.4,.25,.3,.25,.2,.25,.1,.25,0,0,.4,0,.3,0,.2,0,.1,0,0,2,.4,1.75,.4,1.75,.3,2,.3,1.75,.2,2,.2,1.75,.1,2,.1,1.75,0,1.5,.4,1.5,.3,1.5,.2,1.5,.1,1.5,0,1.25,.4,1.25,.3,1.25,.2,1.25,.1,1.25,0,1,.4,1,.3,1,.2,1,.1,1,0,1,.4,.75,.4,.75,.3,1,.3,.75,.2,1,.2,.75,.1,1,.1,.75,0,.5,.4,.5,.3,.5,.2,.5,.1,.5,0,.25,.4,.25,.3,.25,.2,.25,.1,.25,0,0,.4,0,.3,0,.2,0,.1,0,0,1,1,.875,1,.875,.875,1,.875,.875,.75,1,.75,.875,.625,1,.625,.875,.5,1,.5,.75,1,.75,.875,.75,.75,.75,.625,.75,.5,.625,1,.625,.875,.625,.75,.625,.625,.625,.5,.5,1,.5,.875,.5,.75,.5,.625,.5,.5,.5,1,.375,1,.375,.875,.5,.875,.375,.75,.5,.75,.375,.625,.5,.625,.375,.5,.5,.5,.25,1,.25,.875,.25,.75,.25,.625,.25,.5,.125,1,.125,.875,.125,.75,.125,.625,.125,.5,0,1,0,.875,0,.75,0,.625,0,.5,1,.5,.875,.5,.875,.375,1,.375,.875,.25,1,.25,.875,.125,1,.125,.875,0,1,0,.75,.5,.75,.375,.75,.25,.75,.125,.75,0,.625,.5,.625,.375,.625,.25,.625,.125,.625,0,.5,.5,.5,.375,.5,.25,.5,.125,.5,0,.5,.5,.375,.5,.375,.375,.5,.375,.375,.25,.5,.25,.375,.125,.5,.125,.375,0,.5,0,.25,.5,.25,.375,.25,.25,.25,.125,.25,0,.125,.5,.125,.375,.125,.25,.125,.125,.125,0,0,.5,0,.375,0,.25,0,.125,0,0,.5,0,.625,0,.625,.225,.5,.225,.625,.45,.5,.45,.625,.675,.5,.675,.625,.9,.5,.9,.75,0,.75,.225,.75,.45,.75,.675,.75,.9,.875,0,.875,.225,.875,.45,.875,.675,.875,.9,1,0,1,.225,1,.45,1,.675,1,.9,0,0,.125,0,.125,.225,0,.225,.125,.45,0,.45,.125,.675,0,.675,.125,.9,0,.9,.25,0,.25,.225,.25,.45,.25,.675,.25,.9,.375,0,.375,.225,.375,.45,.375,.675,.375,.9,.5,0,.5,.225,.5,.45,.5,.675,.5,.9,.5,.9,.625,.9,.625,.925,.5,.925,.625,.95,.5,.95,.625,.975,.5,.975,.625,1,.5,1,.75,.9,.75,.925,.75,.95,.75,.975,.75,1,.875,.9,.875,.925,.875,.95,.875,.975,.875,1,1,.9,1,.925,1,.95,1,.975,1,1,0,.9,.125,.9,.125,.925,0,.925,.125,.95,0,.95,.125,.975,0,.975,.125,1,0,1,.25,.9,.25,.925,.25,.95,.25,.975,.25,1,.375,.9,.375,.925,.375,.95,.375,.975,.375,1,.5,.9,.5,.925,.5,.95,.5,.975,.5,1,.875,.75,1,.75,1,1,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,.75,.875,1,.75,.5,.75,.25,.75,0,.625,.75,.75,1,.625,.5,.625,.25,.625,0,.5,.75,.625,1,.5,.5,.5,.25,.5,0,.375,.75,.5,.75,.5,1,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,.75,.375,1,.25,.5,.25,.25,.25,0,.125,.75,.25,1,.125,.5,.125,.25,.125,0,0,.75,.125,1,0,.5,0,.25,0,0,.875,.75,1,.75,1,1,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,.75,.875,1,.75,.5,.75,.25,.75,0,.625,.75,.75,1,.625,.5,.625,.25,.625,0,.5,.75,.625,1,.5,.5,.5,.25,.5,0,.375,.75,.5,.75,.5,1,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,.75,.375,1,.25,.5,.25,.25,.25,0,.125,.75,.25,1,.125,.5,.125,.25,.125,0,0,.75,.125,1,0,.5,0,.25,0,0,1,1,.875,1,.875,.75,1,.75,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,1,.75,.75,.75,.5,.75,.25,.75,0,.625,1,.625,.75,.625,.5,.625,.25,.625,0,.5,1,.5,.75,.5,.5,.5,.25,.5,0,.5,1,.375,1,.375,.75,.5,.75,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,1,.25,.75,.25,.5,.25,.25,.25,0,.125,1,.125,.75,.125,.5,.125,.25,.125,0,0,1,0,.75,0,.5,0,.25,0,0,1,1,.875,1,.875,.75,1,.75,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,1,.75,.75,.75,.5,.75,.25,.75,0,.625,1,.625,.75,.625,.5,.625,.25,.625,0,.5,1,.5,.75,.5,.5,.5,.25,.5,0,.5,1,.375,1,.375,.75,.5,.75,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,1,.25,.75,.25,.5,.25,.25,.25
,0,.125,1,.125,.75,.125,.5,.125,.25,.125,0,0,1,0,.75,0,.5,0,.25,0,0],indices:[0,1,2,2,3,0,3,2,4,4,5,3,5,4,6,6,7,5,7,6,8,8,9,7,1,10,11,11,2,1,2,11,12,12,4,2,4,12,13,13,6,4,6,13,14,14,8,6,10,15,16,16,11,10,11,16,17,17,12,11,12,17,18,18,13,12,13,18,19,19,14,13,15,20,21,21,16,15,16,21,22,22,17,16,17,22,23,23,18,17,18,23,24,24,19,18,25,26,27,27,28,25,28,27,29,29,30,28,30,29,31,31,32,30,32,31,33,33,34,32,26,35,36,36,27,26,27,36,37,37,29,27,29,37,38,38,31,29,31,38,39,39,33,31,35,40,41,41,36,35,36,41,42,42,37,36,37,42,43,43,38,37,38,43,44,44,39,38,40,45,46,46,41,40,41,46,47,47,42,41,42,47,48,48,43,42,43,48,49,49,44,43,50,51,52,52,53,50,53,52,54,54,55,53,55,54,56,56,57,55,57,56,58,58,59,57,51,60,61,61,52,51,52,61,62,62,54,52,54,62,63,63,56,54,56,63,64,64,58,56,60,65,66,66,61,60,61,66,67,67,62,61,62,67,68,68,63,62,63,68,69,69,64,63,65,70,71,71,66,65,66,71,72,72,67,66,67,72,73,73,68,67,68,73,74,74,69,68,75,76,77,77,78,75,78,77,79,79,80,78,80,79,81,81,82,80,82,81,83,83,84,82,76,85,86,86,77,76,77,86,87,87,79,77,79,87,88,88,81,79,81,88,89,89,83,81,85,90,91,91,86,85,86,91,92,92,87,86,87,92,93,93,88,87,88,93,94,94,89,88,90,95,96,96,91,90,91,96,97,97,92,91,92,97,98,98,93,92,93,98,99,99,94,93,100,101,102,102,103,100,103,102,104,104,105,103,105,104,106,106,107,105,107,106,108,108,109,107,101,110,111,111,102,101,102,111,112,112,104,102,104,112,113,113,106,104,106,113,114,114,108,106,110,115,116,116,111,110,111,116,117,117,112,111,112,117,118,118,113,112,113,118,119,119,114,113,115,120,121,121,116,115,116,121,122,122,117,116,117,122,123,123,118,117,118,123,124,124,119,118,125,126,127,127,128,125,128,127,129,129,130,128,130,129,131,131,132,130,132,131,133,133,134,132,126,135,136,136,127,126,127,136,137,137,129,127,129,137,138,138,131,129,131,138,139,139,133,131,135,140,141,141,136,135,136,141,142,142,137,136,137,142,143,143,138,137,138,143,144,144,139,138,140,145,146,146,141,140,141,146,147,147,142,141,142,147,148,148,143,142,143,148,149,149,144,143,150,151,152,152,153,150,153,152,154,154,155,153,155,154,156,156,157,155,157,156,158,158,159,157,151,160,161,161,152,151,152,161,162,162,154,152,154,162,163,163,156,154,156,163,164,164,158,156,160,165,166,166,161,160,161,166,167,167,162,161,162,167,168,168,163,162,163,168,169,169,164,163,165,170,171,171,166,165,166,171,172,172,167,166,167,172,173,173,168,167,168,173,174,174,169,168,175,176,177,177,178,175,178,177,179,179,180,178,180,179,181,181,182,180,182,181,183,183,184,182,176,185,186,186,177,176,177,186,187,187,179,177,179,187,188,188,181,179,181,188,189,189,183,181,185,190,191,191,186,185,186,191,192,192,187,186,187,192,193,193,188,187,188,193,194,194,189,188,190,195,196,196,191,190,191,196,197,197,192,191,192,197,198,198,193,192,193,198,199,199,194,193,200,201,202,202,203,200,203,202,204,204,205,203,205,204,206,206,207,205,207,206,208,208,209,207,201,210,211,211,202,201,202,211,212,212,204,202,204,212,213,213,206,204,206,213,214,214,208,206,210,215,216,216,211,210,211,216,217,217,212,211,212,217,218,218,213,212,213,218,219,219,214,213,215,220,221,221,216,215,216,221,222,222,217,216,217,222,223,223,218,217,218,223,224,224,219,218,225,226,227,227,228,225,228,227,229,229,230,228,230,229,231,231,232,230,232,231,233,233,234,232,226,235,236,236,227,226,227,236,237,237,229,227,229,237,238,238,231,229,231,238,239,239,233,231,235,240,241,241,236,235,236,241,242,242,237,236,237,242,243,243,238,237,238,243,244,244,239,238,240,245,246,246,241,240,241,246,247,247,242,241,242,247,248,248,243,242,243,248,249,249,244,243,250,251,252,252,253,250,253,252,254,254,255,253,255,254,256,256,257,255,257,256,258,258,259,257,251,260,261,261,252,251,252,261,262,262,254,252,254,262,263,263,256,254,256,263,264,264,258,256,260,265,266,266,261,260,261,266,267,267,262,261,262,267,268,268,263,262,263,268,269,269,264,263,265,270,271,271,266,265,266,271,272,272,267,266,267,272,273,273,268,267,268,273,274,274,269,268,275,276,277,277,278,275,278,277,279,279,280,278,280,279,281,281,282,280,282,281,283,283,284,282,276,285,286,286,277,276,277,286,287,287,279,277,279,287,288,288,281,279,281,288,289,289,283,281,285,290,291,291,286,285,286,291,292,292,287,286,287,292,293,293,288,287,288,293,294,294,289,288,290,295,296,296,291,290,291,296,297,297,292,291,292,297,298,298,293,292,293,298,299,299,294,293,300,301,302,302,303,300,303,302,304,304,305,303,305,304,306,306,307,305,307,306,308,301,309,310,310,302,301,302,310,311,311,304,302,304,311,312,312,306,304,306,312,313,309,314,315,315,310,309,310,315,316,316,311,310,311,316,317,317,312,311,312,317,318,314,319,320,320,315,314,315,320,321,321,316,315,316,321,322,322,317,316,317,322,323,324,325,326,326,327,324,327,326,328,328,329,327,329,328,330,330,331,329,331,330,332,325,333,334,334,326,325,326,334,335,335,328,326,328,335,336,336,330,328,330,336,337,333,338,339,339,334,333,334,339,340,340,335,334,335,340,341,341,336,335,336,341,342,338,343,344,344,339,338,339,344,345,345,340,339,340,345,346,346,341,340,341,346,347,348,349,350,350,351,348,351,350,352,352,353,351,353,352,354,354,355,353,355,354,356,349,357,358,358,350,349,350,358,359,359,352,350,352,359,360,360,354,352,354,360,361,357,362,363,363,358,357,358,363,364,364,359,358,359,364,365,365,360,359,360,365,366,362,367,368,368,363,362,363,368,369,369,364,363,364,369,370,370,365,364,365,370,371,372,373,374,374,375,372,375,374,376,376,377,375,377,376,378,378,379,377,379,378,380,373,381,382,382,374,373,374,382,383,383,376,374,376,383,384,384,378,376,378,384,385,381,386,387,387,382,381,382,387,388,388,383,382,383,388,389,389,384,383,384,389,390,386,391,392,392,387,386,387,392,393,393,388,387,388,393,394,394,389,388,389,394,395,396,397,398,398,399,396,399,398,400,400,401,399,401,400,402,402,403,401,403,402,404,404,405,403,397,406,407,407,398,397,398,407,408,408,400,398,400,408,409,409,402,400,402,409,410,410,404,402,406,411,412,412,407,406,407,412,413,413,408,407,408,413,414,414,409,408,409,414,415,415,410,409,411,416,417,417,412,411,412,417,418,418,413,412,413,418,419,419,414,413,414,419,420,420,415,414,421,422,423,423,424,421,424,423,425,425,426,424,426,425,427,427,428,426,428,427,429,429,430,428,422,431,432,432,423,422,423,432,433,433,425,423,425,433,434,434,427,425,427,434,435,435,429,427,431,436,437,437,432,431,432,437,438,438,433,432,433,438,439,439,434,433,434,439,440,440,435,434,436,441,442,442,437,436,437,442,443,443,438,437,438,443,444,444,439,438,439,444,445,445,440,439,446,447,448,448,449,446,449,448,450,450,451,449,451,450,452,452,453,451,453,452,454,454,455,453,447,456,457,457,448,447,448,457,458,458,450,448,450,458,459,459,452,450,452,459,460,460,454,452,456,461,462,462,457,456,457,462,463,463,458,457,458,463,464,464,459,458,459,464,465,465,460,459,461,466,467,467,462,461,462,467,468,468,463,462,463,468,469,469,464,463,464,469,470,470,465,464,471,472,473,473,474,471,474,473,475,475,476,474,476,475,477,477,478,476,478,477,479,479,480,478,472,481,482,482,473,472,473,482,483,483,475,473,475,483,484,484,477,475,477,484,485,485,479,477,481,486,487,487,482,481,482,487,488,488,483,482,483,488,489,489,484,483,484,489,490,490,485,484,486,491,492,492,487,486,487,492,493,493,488,487,488,493,494,494,489,488,489,494,495,495,490,489,496,497,498,498,499,496,499,498,500,500,501,499,501,500,502,502,503,501,503,502,504,504,505,503,497,506,507,507,498,497,498,507,508,508,500,498,500,508,509,509,502,500,502,509,510,510,504,502,506,511,512,512,507,506,507,512,513,513,508,507,508,513,514,514,509,508,509,514,515,515,510,509,511,516,517,517,512,511,512,517,518,518,513,512,513,518,519,519,514,513,514,519,520,520,515,514,521,522,523,523,524,521,524,523,525,525,526,524,526,525,527,527,528,526,528,527,529,529,530,528,522,531,532,532,523,522,523,532,533,533,525,523,525,533,534,534,527,525,527,534,535,535,529,527,531,536,537,537,532,531,532,537,538,538,533,532,533,538,539,539,534,533,534,539,540,540,535,534,536,541,542,542,537,536,537,542,543,543,538,537,538,543,544,544,539,538,539,544,545,545,540,539,546,547,548,548,549,546,549,548,550,550,551,549,551,550,552,552,553,551,553,552,554,554,555,553,547,556,557,557,548,547,548,557,558,558,550,548,550,558,559,559,552,550,552,559,560,560,554,552,556,561,562,562,557,556,557,562,563,563,558,557,558,563,564,564,559,558,559,564,565,565,560,559,561,566,567,567,562,561,562,567,568,568,563,562,563,568,569,569,564,563,564,569,570,570,565,564,571,572,573,573,574,571,574,573,575,575,576,574,576,575,577,577,578,576,578,577,579,579,580,578,572,581,582,582,573,572,573,582,583,583,575,573,575,583,584,584,577,575,577,584,585,585,579,577,581,586,587,587,582,581,582,587,588,588,583,582,583,588,589,589,584,583,584,589,590,590,585,584,586,591,592,592,587,586,587,592,593,593,588,587,588,593,594,594,589,588,589,594,595,595,590,589,596,597,598,597,596,599,599,600,597,600,599,601,601,602,600,602,601,603,603,604,602,605,596,606,596,605,607,607,599,596,599,607,608,608,601,599,601,608,609,609,603,601,610,605,611,605,610,612,612,607,605,607,612,613,613,608,607,608,613,614,614,609,608,615,610,616,610,615,617,617,612,610,612,617,618,618,613,612,613,618,619,619,614,613,620,621,622,621,620,623,623,624,621,624,623,625,625,626,624,626,625,627,627,628,626,629,620,630,620,629,631,631,623,620,623,631,632,632,625,623,625,632,633,633,627,625,634,629,635,629,634,636,636,631,629,631,636,637,637,632,631,632,637,638,638,633,632,639,634,640,634,639,641,641,636,634,636,641,642,642,637,636,637,642,643,643,638,637,644,645,646,645,644,647,647,648,645,648,647,649,649,650,648,650,649,651,651,652,650,653,644,654,644,653,655,655,647,644,647,655,656,656,649,647,649,656,657,657,651,649,658,653,659,653,658,660,660,655,653,655,660,661,661,656,655,656,661,662,662,657,656,663,658,664,658,663,665,665,660,658,660,665,666,666,661,660,661,666,667,667,662,661,668,669,670,669,668,671,671,672,669,672,671,673,673,674,672,674,673,675,675,676,674,677,668,678,668,677,679,679,671,668,671,679,680,680,673,671,673,680,681,681,675,673,682,677,683,677,682,684,684,679,677,679,684,685,685,680,679,680,685,686,686,681,680,687,682,688,682,687,689,689,684,682,684,689,690,690,685,684,685,690,691,691,686,685,692,693,694,694,695,692,695,694,696,696,697,695,697,696,698,698,699,697,699,698,700,700,701,699,693,702,703,703,694,693,694,703,704,704,696,694,696,704,705,705,698,696,698,705,706,706,700,698,702,707,708,708,703,702,703,708,709,709,704,703,704,709,710,710,705,704,705,710,711,711,706,705,707,712,713,713,708,707,708,713,714,714,709,708,709,714,715,715,710,709,710,715,716,716,711,710,717,718,719,719,720,717,720,719,721,721,722,720,722,721,723,723,724,722,724,723,725,725,726,724,718,727,728,728,719,718,719,728,729,729,721,719,721,729,730,730,723,721,723,730,731,731,725,723,727,732,733,733,728,727,728,733,734,734,729,728,729,734,735,735,730,729,730,735,736,736,731,730,732,737,738,738,733,732,733,738,739,739,734,733,734,739,740,740,735,734,735,740,741,741,736,735,742,743,744,744,745,742,745,744,746,746,747,745,747,746,748,748,749,747,749,748,750,750,751,749,743,752,753,753,744,743,744,753,754,754,746,744,746,754,755,755,748,746,748,755,756,756,750,748,752,757,758,758,753,752,753,758,759,759,754,753,754,759,760,760,755,754,755,760,761,761,756,755,757,762,763,763,758,757,758,763,764,764,759,758,759,764,765,765,760,759,760,765,766,766,761,760,767,768,769,769,770,767,770,769,771,771,772,770,772,771,773,773,774,772,774,773,775,775,776,774,768,777,778,778,769,768,769,778,779,779,771,769,771,779,780,780,773,771,773,780,781,781,775,773,777,782,783,783,778,777,778,783,784,784,779,778,779,784,785,785,780,779,780,785,786,786,781,780,782,787,788,788,783,782,783,788,789,789,784,783,784,789,790,790,785,784,785,790,791,791,786,785]},n.prototype.init=function(e,t,n,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;o=null,b=r.vertices;for(f=0,p=b.length;f<p;f++){a=b[f];if(o===null||a>o)o=a}u=this.size/o,w=r.vertices;for(l=0,d=w.length;l<d;l++)a=w[l],e.push(a*u);E=r.normals;for(c=0,v=E.length;c<v;c++)a=E[c],i.push(a);S=r.textureCoords;for(h=0,m=S.length;h<m;h++)a=S[h],n.push(a);x=r.indices,T=[];for(y=0,g=x.length;y<g;y++)a=x[y],T.push(s.push(a));return T},n}(Jax.Mesh.Triangles)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Mesh.Torus=function(e){function n(e){this.innerRadius=.6,this.outerRadius=1.8,this.sides=64,this.rings=128,n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.init=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;f=this.innerRadius,c=this.outerRadius,m=this.sides,d=this.rings,v=2*Math.PI/m,p=2*Math.PI/d,w=y=0,s=1,N=[];for(a=S=T=d-1;T<=0?S<=0:S>=0;a=T<=0?++S:--S){E=w+p,o=Math.cos(E),b=Math.sin(E),h=0;for(l=x=m;m<=0?x<=0:x>=0;l=m<=0?++x:--x)h+=v,i=Math.cos(h),g=Math.sin(h),u=c+f*i,r.push(o*i,-b*i,g),e.push(o*u,-b*u,f*g),r.push(s*i,-y*i,g),e.push(s*u,-y*u,f*g);w=E,s=o,N.push(y=b)}return N},n}(Jax.Mesh.TriangleStrip)}.call(this),function(){}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Framerate=function(e){function n(e){e==null&&(e={}),e.width||(e.width=128),e.height||(e.height=64),e.position||(e.position=[e.width/2,e.height/2,-0.1001]),e.castShadow||(e.castShadow=!1),e.receiveShadow||(e.receiveShadow=!1),e.illuminated||(e.illuminated=!1),n.__super__.constructor.call(this,e),this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.font||(this.font="10pt Arial"),this.fps_points=[],this.ups_points=[],this.current=-1,this.max_fps=this.max_ups=100,this.ema===void 0&&(this.ema=30),this.ema_exponent=2/(this.ema+1),this._max_data_width=this.width/3,this._fps_label_left=0,this._ups_label_left=this.width/3+this.width/6,this._one_quarter_height=this.height*.25,this._two_quarter_height=this.height*.5,this._three_quarter_height=this.height*.75,this._12_pcnt_height=this.height*.12,this._marker_offset=this.width-this._12_pcnt_height,this._max_queue_size=Math.round(this.width-this._12_pcnt_height),this.glTex=new Jax.Texture({width:this.width,height:this.height,mag_filter:GL_LINEAR,min_filter:GL_LINEAR,flip_y:!0}),this.glTex.image=this.canvas,this.mesh=new Jax.Mesh.Quad({width:this.width,height:this.height,color:[1,1,1,.5],material:new Jax.Material({layers:[{type:"Position"},{type:"Texture",instance:this.glTex}]})})}var r;return t(n,e),r=function(e,t,n,r){var i,s;e.beginPath(),e.moveTo(0,n-t[0]*n);for(i=s=0;0<=r?s<=r:s>=r;i=0<=r?++s:--s)e.lineTo(i,n-t[i]*n);return e.stroke(),e.closePath()},n.prototype.render=function(e,t){var n,i,s,o,u,a,f,l;this.fps=e.getFramesPerSecond(),this.ups=e.getUpdatesPerSecond(),i=this.fps/this.max_fps,a=this.ups/this.max_ups,i===Number.POSITIVE_INFINITY&&(i=1e3),a===Number.POSITIVE_INFINITY&&(a=1e3);if(this.current===this._max_queue_size)for(s=f=0,l=this.current;0<=l?f<=l:f>=l;s=0<=l?++f:--f)this.fps_points[s]=this.fps_points[s+1],this.ups_points[s]=this.ups_points[s+1];else this.current++;return this.ema?(this.current===0?(n=0,u=0):(n=this.fps_points[this.current-1],u=this.ups_points[this.current-1]),this.fps_points[this.current]=i*this.ema_exponent+n*(1-this.ema_exponent),this.ups_points[this.current]=a*this.ema_exponent+u*(1-this.ema_exponent)):(this.fps_points[this.current]=i,this.ups_points[this.current]=a),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="rgba(64, 64, 64, 0.7)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.textBaseline="middle",this.ctx.fillStyle="rgba(0, 32, 0, 1)",this.ctx.fillText("25",this._marker_offset,this._three_quarter_height,this._12_pcnt_height),this.ctx.fillStyle="rgba(0, 32, 0, 1)",this.ctx.fillText("50",this._marker_offset,this._two_quarter_height,this._12_pcnt_height),this.ctx.fillStyle="rgba(0, 32, 0, 1)",this.ctx.fillText("75",this._marker_offset,this._one_quarter_height,this._12_pcnt_height),!this.ema||this.current>=this.ema?(this.ctx.strokeStyle="red",r(this.ctx,this.fps_points,this.height,this.current),this.ctx.strokeStyle="blue",r(this.ctx,this.ups_points,this.height,this.current),this.ctx.textBaseline="bottom",this.ctx.fillStyle="red",this.ctx.fillText(""+Math.round(this.fps)+" FPS",this._fps_label_left,this.height,this._max_data_width),this.ctx.fillStyle="blue",this.ctx.fillText(""+Math.round(this.ups)+" UPS",this._ups_label_left,this.height,this._max_data_width)):(this.ctx.fillStyle="rgba(0, 0, 0, 1)",this.ctx.fillText("Gathering data...",10,this.height/2,this.width-20)),this.glTex.refresh(e),this.ortho||(this.camera.ortho({left:0,right:e.canvas.width,bottom:0,top:e.canvas.height}),this.ortho=this.camera.getProjectionMatrix(),this.identity=mat4.identity()),o=e.matrix_stack,o.push(),mat4.set(this.ortho,o.getProjectionMatrix()),o.loadViewMatrix(this.identity),o.multModelMatrix(this.camera.getTransformationMatrix()),this.mesh.render(e,this,t),o.pop()},n}(Jax.Model)}.call(this),function(){}.call(this),function(){}.call(this),function(){var e;e=function(){function e(e,t){this.src=e,this.mangler=t}return e.prototype.findVariables=function(){var e,t,n,r,i,s;s=[],r=/(shared[\s\t\n]+|)(varying|uniform|attribute)[\s\t\n]+(\w+)[\s\t\n]+(((\w+)([\s\t\n]*,[\s\t\n]*|))+)[\s\t\n]*;/,i=this.src;while(e=r.exec(i))n=e.index,t=e.index+e[0].length,s.push({shared:!!e[1],qualifier:e[2],type:e[3],names:e[4].split(/, ?/),match:e}),i=i.slice(0,n)+i.slice(t);return s},e.prototype.findFunctions=function(){var e,t,n,r,i,s,o,u;t=[],s=/(shared[\s\t\n]+|)(\w+)[\s\t\n]+(\w+)[\s\t\n]*\([\s\t\n]*[\s\t\n]*(.*?)[\s\t\n]*\)[\s\t\n]*{/,u=this.src;while(n=s.exec(u))i=n.index,r=n.index+n[0].length,o=n[4],r+=Jax.Util.scan(u.slice(r),"}","{").length+1,e=u.slice(i,r),u=u.slice(0,i)+u.slice(r),t.push({shared:!!n[1],signature:o,full:e,type:n[2],name:n[3]});return t},e.prototype.getMangledMain=function(){var e,t,n,r;t=this.findFunctions();for(n=0,r=t.length;n<r;n++){e=t[n];if(e.name==="main")return e.mangledName=e.name+this.mangler,e}return null},e.prototype.map=function(){var e,t,n,r,i,s,o,u,a;n={},t=this.findVariables();for(i=0,o=t.length;i<o;i++){e=t[i],a=e.names;for(s=0,u=a.length;s<u;s++)r=a[s],e.shared?n[r]=r:n[r]=r+this.mangler}return n},e.prototype.mangle=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;f=this.src,o=this.findVariables();for(c=0,v=o.length;c<v;c++){t=o[c],i=[],b=t.names;for(h=0,m=b.length;h<m;h++){a=b[h];if(t.shared){if((new RegExp(""+a+"(,|;)")).test(e))continue;i.push(a)}else i.push(a+this.mangler)}i.length>0?(i=i.join(", "),l=[t.qualifier,t.type,i].join(" "),l+=";"):l="",f=f.replace(t.match[0],l);if(t.shared)continue;w=t.names;for(p=0,g=w.length;p<g;p++){a=w[p],r=a+this.mangler;while(u=(new RegExp("(^|\\W)"+a+"(\\W|$)")).exec(f))f=f.replace(u[0],u[1]+r+u[2])}}o=this.findFunctions();for(d=0,y=o.length;d<y;d++){t=o[d],t.shared?r=t.name:r=t.name+this.mangler,s=t.signature.replace(t.name,r),n=t.full.replace(t.signature,s),n=n.replace(/shared[\s\t\n]+/,""),f=f.replace(t.full,n);if(t.shared)continue;while(u=(new RegExp("(^|\\W)"+t.name+"(\\W|$)")).exec(f))f=f.replace(u[0],u[1]+r+u[2])}return f},e}(),Jax.Shader=function(){function t(e){this.name=e!=null?e:"generic",this.id=Jax.guid(),this.sources=[],this.main=new Array}return t.include(Jax.EventEmitter),t.prototype.processExportsAndImports=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;i=[],d=/export[\s\t\n]*\(/,a=0,r=0;while(u=d.exec(e.slice(a)))l=u.index+a,f=l+u[0].length,h=Jax.Util.scan(e.slice(f)),f+=h.length+1,n=/^(.*?)[\s\t\n]*,[\s\t\n]*(.*?)[\s\t\n]*,[\s\t\n]*(.*)$/.exec(h),i.push({fullMatch:e.slice(l,f),type:n[1],name:n[2],mangledName:"export_"+n[2]+r++,value:n[3],offsetStart:l,offsetEnd:f}),a=f;d=/import[\s\t\n]*\(/;for(a=m=E=e.length-1;E<=0?m<=0:m>=0;a=E<=0?++m:--m)if(u=d.exec(e.slice(a))){l=u.index+a,f=l+u[0].length,h=Jax.Util.scan(e.slice(f)),f+=h.length+1,e[f]===";"&&f++,o=/^(.*?)[\s\t\n]*,[\s\t\n]*(.*)$/.exec(h),o={fullMatch:e.slice(l,f),name:o[1],value:o[2],offsetStart:l,offsetEnd:f},p="";for(g=0,b=i.length;g<b;g++)n=i[g],n.name===o.name&&n.offsetStart<o.offsetStart&&(v=o.value.replace(new RegExp(o.name,"g"),n.mangledName),p+=v+";\n");e=e.replace(o.fullMatch,p)}t="";for(y=0,w=i.length;y<w;y++)n=i[y],t+=""+n.type+" "+n.mangledName+";\n",s=n.mangledName+" = "+n.value,e=e.replace(n.fullMatch,s);return(u=/precision.*?\n/.exec(e))?(c=u.index+u[0].length,e=e.slice(0,c)+t+e.slice(c)):e=t+e,e},t.prototype.toLines=function(){return this.toString().split("\n")},t.prototype.toString=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;f=new Array,x=this.main;for(b=0,E=x.length;b<E;b++)a=x[b],f.push(a);g="",T=this.sources;for(u=w=0,S=T.length;w<S;u=++w)y=T[u],g+=y.mangle(g),g+="\n",(l=y.getMangledMain())&&f.push(l.mangledName+"();");e=this.processExportsAndImports(g+("void main(void) {\n  "+f.join("\n  ")+"\n}")),s={};while(c=/cache[\s\t\n]*\([\s\t\n]*([^,]+?)[\s\t\n]*,[\s\t\n]*(.*?)[\s\t\n]*\)[\s\t\n]*\{/.exec(e)){i=c[1].trim(),r=c[2].trim(),d=c.index,p=d+c[0].length,m=Jax.Util.scan(e.slice(p),"}","{"),p+=m.length+1,t=e.slice(d,p),n="";if(s[r]){if(s[r].type!==i)throw new Error("Cached variable "+r+" has a conflicting type: "+i+" (already defined as a "+s[r].type+")")}else s[r]={name:r,type:i},n+=m;e=e.slice(0,d)+n+e.slice(p)}o="";for(h in s)t=s[h],o+=t.type+" "+t.name+";\n";return(c=/precision.*?\n/.exec(e))?(v=c.index+c[0].length,e=e.slice(0,v)+o+e.slice(v)):e=o+e,e.indexOf("precision")===-1?"precision mediump float;\n\n"+e:e},t.prototype.insert=function(t,n,r){var i;return this.sources.splice(r,0,i=new e(t,n)),this.fireEvent("changed"),i.map()},t.prototype.append=function(e,t){return this.insert(e,t,this.sources.length)},t}()}.call(this),function(){var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};e=function(e,t){var n,r,i;i=[];for(n in t)r=t[n],i.push(e[n]=r);return i},Jax.Shader.CompileError=function(e){function t(e){t.__super__.constructor.call(this),this.message=e}return n(t,e),t}(Jax.Error),Jax.Shader.Program=function(){function e(e){var t=this;this.name=e!=null?e:"generic",this._guid||(this._guid=Jax.guid()),this._discovered={},this._isCompiled={},this._glShaders={},this._variables={},this.shaders=[],this.vertex=new Jax.Shader(""+this.name+"-v"),this.vertex.addEventListener("changed",function(){return t.invalidate()}),this.fragment=new Jax.Shader(""+this.name+"-f"),this.fragment.addEventListener("changed",function(){return t.invalidate()}),this.ensureDefaultWriters(this.vertex,this.fragment)}return e.prototype.buildBacktrace=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d;a=((h=e.getShaderInfoLog(t))!=null?h.split(/\n/):void 0)||[],f=/\d+:(\d+):(.*)/,i=function(){var e,t,n;n=[];for(e=0,t=a.length;e<t;e++)u=a[e],n.push(f.exec(u));return n}();for(o=l=0,p=n.length;0<=p?l<p:l>p;o=0<=p?++l:--l){u=n[o],s=o+1,s<10?s="  "+s:s<100&&(s=" "+s),a.push(""+s+" : "+u);for(r=c=0,d=i.length;0<=d?c<d:c>d;r=0<=d?++c:--c)i[r]&&parseInt(i[r][1])===o+1&&(a.push("   :: ERROR : "+i[r][2]),i.splice(r-1,1),r=0)}return a},e.prototype.getInfo=function(e,t){return{shaderType:t,maxVertexAttribs:e.getParameter(GL_MAX_VERTEX_ATTRIBS),maxVertexUniformVectors:e.getParameter(GL_MAX_VERTEX_UNIFORM_VECTORS),maxVaryingVectors:e.getParameter(GL_MAX_VARYING_VECTORS),maxCombinedTextureImageUnits:e.getParameter(GL_MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentTextureImageUnits:e.getParameter(GL_MAX_TEXTURE_IMAGE_UNITS),maxFragmentUniformVectors:e.getParameter(GL_MAX_FRAGMENT_UNIFORM_VECTORS),shadingLanguageVersion:e.getParameter(GL_SHADING_LANGUAGE_VERSION),gl:e}},e.prototype.compileShader=function(e,t,n,r){var i,s;s=(new EJS({text:t.toString()})).render(this.getInfo(e,r)),e.shaderSource(n,s),e.compileShader(n);if(!e.getShaderParameter(n,GL_COMPILE_STATUS))throw i=this.buildBacktrace(e,n,s.split(/\n/)),new Jax.Shader.CompileError("Shader "+t.name+" failed to compile\n\n"+i.join("\n"))},e.prototype.ensureDefaultWriters=function(e,t){e.main.length===0&&e.main.push("gl_Position = vec4(1.0, 1.0, 1.0, 1.0);");if(t.main.length===0)return t.main.push("gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);")},e.prototype.insert=function(e,t,n){var r,i,s,o,u,a;s=Jax.guid(),o={},a=this.vertex.insert(e,s,n),r=this.fragment.insert(t,s,n);for(i in r)u=r[i],o[i]=u;for(i in a)u=a[i],o[i]=u;return o},e.prototype.loadDescriptor=function(e){var t,n,r,i,s;return{}},e.prototype.saveDescriptor=function(e,t){var n,r,i,s;return n=e._shaderDescriptors||(e._shaderDescriptors={}),s=this.vertex.id,r=this.fragment.id,i=this._guid,n[s]=t.vertex,n[r]=t.fragment,n[i]=t.program,t},e.prototype.glShader=function(e,t){var n,r;return(r=this._glShaders[e.id])||(n=e.gl,r=this._glShaders[e.id]={}),t?r[t]:r},e.prototype.compile=function(e){var t,n,r;n=e.gl,t=this.loadDescriptor(e),r=this.glShader(e);if(t.program)r.program=t.program,r.vertex=t.vertex,r.fragment=t.fragment;else{t.program=r.program=n.createProgram(),t.program._guid=Jax.guid(),t.vertex?r.vertex=t.vertex:(t.vertex=r.vertex=n.createShader(GL_VERTEX_SHADER),t.vertex._guid=Jax.guid(),this.compileShader(n,this.vertex,r.vertex,"vertex")),t.fragment?r.fragment=t.fragment:(t.fragment=r.fragment=n.createShader(GL_FRAGMENT_SHADER),t.fragment._guid=Jax.guid(),this.compileShader(n,this.fragment,r.fragment,"fragment")),n.attachShader(r.program,r.vertex),n.attachShader(r.program,r.fragment),n.linkProgram(r.program);if(!n.getProgramParameter(r.program,GL_LINK_STATUS))throw new Error("Could not initialize shader!\n\n"+n.getProgramInfoLog(r.program));this.saveDescriptor(e,t)}return this._variables[e.id]={},this._discovered[e.id]=!1,this._isCompiled[e.id]=!0},e.prototype.isCompiled=function(e){return this._isCompiled[e.id]},e.prototype.bind=function(e){return this.isCompiled(e)||this.compile(e),e.gl.useProgram(this.glShader(e).program)},e.prototype.invalidate=function(){var e,t,n;n=this._isCompiled;for(e in n)t=n[e],this._isCompiled[e]=!1;return this},e.prototype.discoverUniforms=function(e,t){var n,r,i,s,o,u,a,f,l,c;this.isCompiled(e)||this.compile(e),a=(f=this._variables)[c=e.id]||(f[c]={}),n=e.gl,u=this.glShader(e).program,o=n.getProgramParameter(u,GL_ACTIVE_UNIFORMS);for(r=l=0;0<=o?l<o:l>o;r=0<=o?++l:--l)i=n.getActiveUniform(u,r),s=n.getUniformLocation(u,i.name),a[i.name]={location:s,qualifier:"uniform",name:i.name,type:i.type,size:i.size};return a},e.prototype.discoverAttributes=function(e,t){var n,r,i,s,o,u,a,f,l,c;this.isCompiled(e)||this.compile(e),n=e.gl,u=this.glShader(e).program,a=(f=this._variables)[c=e.id]||(f[c]={}),o=n.getProgramParameter(u,GL_ACTIVE_ATTRIBUTES);for(r=l=0;0<=o?l<o:l>o;r=0<=o?++l:--l)i=n.getActiveAttrib(u,r),s=n.getAttribLocation(u,i.name),a[i.name]={location:s,qualifier:"attribute",enabled:!1,name:i.name,type:i.type,size:i.size};return a},e.prototype.discoverVariables=function(e){if(this._discovered[e.id])return;return this.isCompiled(e)||this.compile(e),this._variables[e.id]={},this.discoverUniforms(e),this.discoverAttributes(e),this._discovered[e.id]=!0,this._variables[e.id]},e.prototype.variables=function(e){return this.discoverVariables(e)},e.prototype.discovered=function(e){return this._discovered[e.id]},e.prototype.setAttribute=function(e,t,n){var r;return r=e.gl,t.enabled||(r.enableVertexAttribArray(t.location),t.enabled=!0),n.bind(e),r.vertexAttribPointer(t.location,n.itemSize,n.dataType||GL_FLOAT,!1,0,n.offset||0)},e.prototype.setUniform=function(e,t,n){var r;r=e.gl;switch(t.type){case GL_FLOAT:return(n!=null?n.length:void 0)?r.uniform1fv(t.location,n):r.uniform1f(t.location,n);case GL_BOOL:return(n!=null?n.length:void 0)?r.uniform1iv(t.location,n):r.uniform1i(t.location,n);case GL_INT:return(n!=null?n.length:void 0)?r.uniform1iv(t.location,n):r.uniform1i(t.location,n);case GL_FLOAT_VEC2:return r.uniform2fv(t.location,n);case GL_FLOAT_VEC3:return r.uniform3fv(t.location,n);case GL_FLOAT_VEC4:return r.uniform4fv(t.location,n);case GL_BOOL_VEC2:return r.uniform2iv(t.location,n);case GL_INT_VEC2:return r.uniform2iv(t.location,n);case GL_BOOL_VEC3:return r.uniform3iv(t.location,n);case GL_INT_VEC3:return r.uniform3iv(t.location,n);case GL_BOOL_VEC4:return r.uniform4iv(t.location,n);case GL_INT_VEC4:return r.uniform4iv(t.location,n);case GL_SAMPLER_2D:return r.uniform1i(t.location,n);case GL_SAMPLER_CUBE:return r.uniform1i(t.location,n);case GL_FLOAT_MAT2:return r.uniformMatrix2fv(t.location,!1,n);case GL_FLOAT_MAT3:return r.uniformMatrix3fv(t.location,!1,n);case GL_FLOAT_MAT4:return r.uniformMatrix4fv(t.location,!1,n);default:throw new Error("Unexpected uniform type: "+t)}},e.prototype.set=function(e,t){var n,r,i,s,o,u,a;this.discovered(e.id)||this.discoverVariables(e),a=this._variables[e.id],r=e.gl,s=0;for(i in t){o=t[i],u=a[i];if(u){if(o===void 0){u.qualifier==="attribute"&&u.enabled&&(r.disableVertexAttribArray(u.location),u.enabled=!1);continue}if(o instanceof Jax.Texture)r.activeTexture(GL_TEXTURE0+s),o.isValid(e)||o.refresh(e),r.bindTexture(o.options.target,o.getHandle(e)),o=s++;else if(o!=null?o.toVec4:void 0)o=o.toVec4();try{u.qualifier==="attribute"?this.setAttribute(e,u,o):this.setUniform(e,u,o)}catch(f){throw n=""+u.qualifier+" "+Jax.Util.enumName(u.type)+" "+u.name,new Error("Error occurred setting "+n+" to `"+JSON.stringify(o)+"`: "+f.message)}}}return!0},e.prototype.disable=function(e){var t,n,r,i,s;if(!(i=this._variables[e.id]))return;t=e.gl,s=[];for(n in i)r=i[n],r.enabled?s.push(t.disableVertexAttribArray(r.location)):s.push(void 0);return s},e}()}.call(this),function(){var e=[].slice;Jax.Material=function(){function t(t,n){var r,i,s,o,u,a,f,l,c,h,p,d;this.name=n!=null?n:"generic",this._localizedShader=!1,this.layers=[];if(this.__proto__.constructor.__shader){this.shader=this.__proto__.constructor.__shader,d=this.__proto__.constructor.getLayers();for(u=0,c=d.length;u<c;u++)i=d[u],this.layers.push(new i.__proto__.constructor(i))}else{this.shader=this.__proto__.constructor.__shader=new Jax.Shader.Program(this.name),s=[],l=this.__proto__.constructor.getLayers();for(a=0,h=l.length;a<h;a++)i=l[a],s.push(this.addLayer(i,!1));l.splice.apply(l,[0,l.length].concat(e.call(s)))}this.assigns={},t=Jax.Util.normalizeOptions(t,{});for(r in t){o=t[r];switch(r){case"layers":for(f=0,p=o.length;f<p;f++)i=o[f],this.addLayer(i);break;default:this[r]=o}}}return t.__shader=null,t.getLayers=function(){var e,t,n,r,i,s;n=this.__super__;if(this.__layers){if(!n)return this.__layers;if(this.__layers!==n.constructor.getLayers())return this.__layers}e=[];if(n){r=n.constructor.getLayers();for(i=0,s=r.length;i<s;i++)t=r[i],e.push(t)}return this.__layers=e,e},t.addLayer=function(e){return this.getLayers().push(e)},t.define("vertex",{get:function(){return this.shader.vertex}}),t.define("fragment",{get:function(){return this.shader.fragment}}),t.prototype.findLayer=function(e){var t,n,r,i;i=this.layers;for(n=0,r=i.length;n<r;n++){t=i[n];if(t instanceof e)return t}return null},t.prototype.localizeShader=function(){var e,t,n,r,i;if(this._localizedShader)return;this._localizedShader=!0,this.shader=new Jax.Shader.Program(this.shader.name+"-localized-"+Jax.guid()),i=[this.layers,[]],t=i[0],this.layers=i[1];for(n=0,r=t.length;n<r;n++)e=t[n],this.addLayer(e);return!0},t.prototype.insertLayer=function(e,t,n){var r,i;n==null&&(n=!0),n&&this.localizeShader(),typeof t=="string"&&(t={type:t});if(t instanceof Jax.Material.Layer)return t.attachTo(this,e),this.layers.splice(e,0,t),t;t=Jax.Util.normalizeOptions(t,{}),r=Jax.Material.Layer[t.type];if(!r){if(!Jax.Material[t.type])throw new Error(""+this.name+": Material layer type "+t.type+" could not be found");console.log(""+this.name+": Material layer type "+t.type+" could not be found "+"within namespace Jax.Material.Layer, but an object of the same name "+"was found within namespace Jax.Material. Please note that this is "+"deprecated usage, and material layers should appear within namespace "+"Jax.Material.Layer."),r=Jax.Material[t.type]}t.shader||(t.shader=r.shader||Jax.Util.underscore(t.type)),i=new r(t);if(i instanceof Jax.Material)throw new Error(""+this.name+": Custom material layers now inherit from Jax.Material.Layer instead of Jax.Material.");return i.attachTo(this,e),this.layers.splice(e,0,i),i},t.prototype.addLayer=function(e,t){return t==null&&(t=!0),this.insertLayer(this.layers.length,e,t)},t.prototype.clearAssigns=function(){var e,t;e=this.assigns;for(t in e)e[t]=void 0;return!0},t.prototype.renderMesh=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;s=0,o=0,t.data.context=e,h=this.layers;for(f=0,c=h.length;f<c;f++)i=h[f],i.material=this,i.prepare&&i.prepare(e,t,n),a=i.numPasses(e,t,n),a>o&&(o=a);this.clearAssigns(),t.data.context=e,this.shader.bind(e),r=e.gl;for(u=l=0;0<=o?l<o:l>o;u=0<=
o?++l:--l){if(!this.preparePass(e,t,n,u,s))continue;s++,this.drawBuffers(e,t,u)}return s>1&&(r.blendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA),r.depthFunc(GL_LESS)),s},t.prototype.preparePass=function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p;i==null&&(i=0),p=this.layers;for(c=0,h=p.length;c<h;c++){u=p[c];if((f=u.setup(e,t,n,r))===!1)return!1;a=u.variableMap;for(o in f)l=f[o],a[o]&&(o=a[o]),l!==void 0&&(this.assigns[o]=l)}return i===1&&(s=e.gl,s.blendFunc(GL_ONE,GL_ONE),s.depthFunc(GL_EQUAL)),this.shader.set(e,this.assigns,r===0),!0},t.prototype.drawBuffers=function(e,t,n){var r,i,s,o,u,a;n==null&&(n=0);if(!this._alreadyWarned){this._alreadyWarned=!0,u=this.shader.variables(e);for(s in u)o=u[s],o.value===void 0&&console.log("Warning: material "+this.name+" did not set a value for shader variable "+o.name)}if((r=t.getIndexBuffer())&&r.length)return n===0&&r.bind(e),e.gl.drawElements(t.draw_mode,r.length,r.dataType,0);if(i=(a=t.data.vertexBuffer)!=null?a.length:void 0)return e.gl.drawArrays(t.draw_mode,0,i)},t.prototype.render=function(e,t,n){var r;r=0;while(t)r+=this.renderMesh(e,t,n),t=t.submesh;return r},t.instances={},t.resources={},t.__isMaterial=!0,t.find=function(e){var t,n,r;if(Jax.Material.instances[e])return Jax.Material.instances[e];if(!(n=Jax.Material.resources[e]))throw new Error("Material '"+e+"' could not be found!");switch((r=n.type)!=null?r.toString().toUpperCase():void 0){case"CUSTOM":t=Jax.Material.Custom;break;case"LEGACY":t=Jax.Material.Legacy;break;case"SURFACE":t=Jax.Material.Surface;break;case"HALO":t=Jax.Material.Halo;break;case"WIRE":t=Jax.Material.Wire;break;default:(t=Jax.Material[n.type]&&t.__isMaterial)||(console.log(""+e+": Material type "+n.type+" is invalid. Please note that its meaning "+"changed in Jax v3.0; it should be one of 'Surface', 'Legacy', 'Wire', 'Custom'."),console.log("Type of material "+e+" is defaulting to 'Legacy'."),t=Jax.Material.Legacy)}if(!t)throw new Error(""+e+": Material type "+n.type+" is not yet implemented.");return Jax.Material.instances[e]=new t(n,e)},t.addResources=function(e){var t,n,r;r=[];for(n in e)t=e[n],r.push(Jax.Material.resources[n]=t);return r},t.clearResources=function(){return Jax.Material.resources={},Jax.Material.instances={}},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Custom=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Jax.Material)}.call(this),function(){Jax.Material.Layer=function(){function e(e,t){var n,r,i;if(e!=null?e.setVariables:void 0)this.setVariables=e!=null?e.setVariables:void 0;this.assigns=new Jax.Material.ShaderVariableMap;if(e){e.shader&&(r=Jax.shader_data(e.shader))&&(r.fragment||r.vertex)?this._shaderSource=r:(r=e)&&(r.fragment||r.vertex)&&(this._shaderSource=r);for(n in e)i=e[n],this[n]=i}this._shaderSource||((r=this.__proto__.constructor.shaderSource)!==void 0?this._shaderSource=r:(r=Jax.shader_data(Jax.Util.underscore(this.__proto__.constructor.name)))&&(r.fragment||r.vertex)&&(this._shaderSource=r)),t&&this.attachTo(t)}var t;return t=function(e,t){var n,r;return r=(e.common||"")+(e[t]||""),n={SHADER_TYPE:t},(new EJS({text:r})).render(n)},e.prototype.attachTo=function(e,n){var r,i,s;return i={},this._shaderSource&&(s=t(this._shaderSource,"vertex"),r=t(this._shaderSource,"fragment"),i=e.shader.insert(s,r,n)),this.variableMap=i},e.prototype.numPasses=function(e){return 1},e.prototype.clearAssigns=function(){var e,t;t=this.assigns;for(e in t)t[e]=void 0;return!0},e.prototype.setup=function(e,t,n,r){var i,s;s=null,this.clearAssigns();if(this.setVariables){i=this.setVariables(e,t,n,this.assigns,r);if(i===!1)return!1}return this.assigns},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.IlluminationLayer=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.numPasses=function(e){return e.world.lights.length+1},n.prototype.setVariables=function(e,t,n,r,i){var s;r.PASS=i;if(!i)return;return s=e.world.lights[i-1],s.isInRange(n)?this.illuminate(e,t,n,r,s):!1},n.prototype.illuminate=function(e,t,n,r,i){},n}(Jax.Material.Layer)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Legacy=function(e){function n(e,t){var r,i,s,o,u,a,f,l,c;e&&(s=e.layers,delete e.layers),n.__super__.constructor.call(this,e,t);if(s)for(u=0,f=s.length;u<f;u++)i=s[u],i.type==="Lighting"?(i.type="LambertDiffuse",this.addLayer(i),i.type="PhongSpecular",this.addLayer(i)):this.addLayer(i);for(r in e){o=e[r],c=this.layers;for(a=0,l=c.length;a<l;a++)i=c[a],i[r]=o}}return t(n,e),n.addLayer("Position"),n.addLayer("VertexColor"),n}(Jax.Material.Custom)}.call(this),function(){Jax.Material.ShaderVariableMap=function(){function e(){}return e.prototype.set=function(e,t){var n,r,i;this.alreadyWarned||(this.alreadyWarned=!0,console.log("`vars.set` and `vars.texture` are both deprecated. Instead, you should just set variable values directly on the `vars` object. For example, to set a shader variable named `color` to the value [1, 1, 1, 1], use the syntax: vars.color = [1, 1, 1, 1]`"));if(t===void 0){i=[];for(n in e){r=e[n];if(r===void 0)continue;i.push(this[n]=r)}return i}n=e,r=t;if(r!==void 0)return this[n]=r},e.prototype.texture=function(e,t,n){return this.set(e,t)},e.define("set",{enumerable:!1}),e.define("texture",{enumerable:!1}),e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Surface=function(e){function n(e,t){var r,i,s,o,u,a,f,l,c;this._intensity={},i=this,Object.defineProperty(this._intensity,"ambient",{get:function(){return this._ambient},set:function(e){var t,n;return(t=i.findLayer(Jax.Material.Layer.WorldAmbient))!=null&&(t.intensity=e),(n=i.findLayer(Jax.Material.Layer.LightAmbient))!=null&&(n.intensity=e),this._ambient=e}}),Object.defineProperty(this._intensity,"diffuse",{get:function(){return this._diffuse},set:function(e){var t;return(t=i.findLayer(Jax.Material.Layer.LambertDiffuse))!=null&&(t.intensity=e),this._diffuse=e}}),Object.defineProperty(this._intensity,"specular",{get:function(){return this._specular},set:function(e){var t;return(t=i.findLayer(Jax.Material.Layer.PhongSpecular))!=null&&(t.intensity=e),this._specular=e}}),this._color={},i=this,Object.defineProperty(this._color,"ambient",{get:function(){return this._ambient},set:function(e){var t,n;return(t=i.findLayer(Jax.Material.Layer.WorldAmbient))!=null&&(t.color=Jax.Color.parse(e)),(n=i.findLayer(Jax.Material.Layer.LightAmbient))!=null&&(n.color=Jax.Color.parse(e)),this._ambient=e}}),Object.defineProperty(this._color,"diffuse",{get:function(){return this._diffuse},set:function(e){var t;return(t=i.findLayer(Jax.Material.Layer.LambertDiffuse))!=null&&(t.color=Jax.Color.parse(e)),this._diffuse=e}}),Object.defineProperty(this._color,"specular",{get:function(){return this._specular},set:function(e){var t;return(t=i.findLayer(Jax.Material.Layer.PhongSpecular))!=null&&(t.color=Jax.Color.parse(e)),this._specular=e}}),e||(e={}),e.intensity===void 0&&(e.intensity=1),e.color===void 0&&(e.color="#fff"),e.shininess===void 0&&(e.shininess=60),e.pcf===void 0&&(e.pcf=!0),n.__super__.constructor.call(this,e,t);if(e){if(e.textures){l=e.textures;for(o=0,a=l.length;o<a;o++)s=l[o],this.addLayer({type:"Texture",texture:s})}if(e.normalMaps){c=e.normalMaps;for(u=0,f=c.length;u<f;u++)r=c[u],this.insertLayer(0,{type:"NormalMap",texture:r})}}}return t(n,e),n.addLayer("Position"),n.addLayer("VertexColor"),n.addLayer("WorldAmbient"),n.addLayer("LightAmbient"),n.addLayer("LambertDiffuse"),n.addLayer("PhongSpecular"),n.addLayer("ShadowMap"),n.addLayer("Attenuation"),n.addLayer("ClampColor"),n.define("intensity",{get:function(){return this._intensity},set:function(e){var t;t=this._intensity;if(typeof e=="number")return t.ambient=t.diffuse=t.specular=e;e.ambient!==void 0&&(t.ambient=e.ambient),e.diffuse!==void 0&&(t.diffuse=e.diffuse);if(e.specular!==void 0)return t.specular=e.specular}}),n.define("color",{get:function(){return this._color},set:function(e){var t,n;t=this._color,n=typeof e!="object"||e.ambient===void 0&&e.diffuse===void 0&&e.specular===void 0;if(n)return t.ambient=t.diffuse=t.specular=e;e.ambient!==void 0&&(t.ambient=e.ambient),e.diffuse!==void 0&&(t.diffuse=e.diffuse);if(e.specular!==void 0)return t.specular=e.specular}}),n.define("shininess",{get:function(){return this._shininess},set:function(e){var t;return(t=this.findLayer(Jax.Material.Layer.PhongSpecular))!=null&&(t.shininess=e),this._shininess=e}}),n.define("pcf",{get:function(){return this._pcf},set:function(e){var t;return(t=this.findLayer(Jax.Material.Layer.ShadowMap))!=null&&(t.pcf=e),this._pcf=e}}),n}(Jax.Material.Custom)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Wire=function(e){function n(e,t){this.transparent=!0,n.__super__.constructor.call(this,e,t)}return t(n,e),n.addLayer("Wire"),n}(Jax.Material.Surface)}.call(this),function(){Jax.Camera=function(){function e(e){this.rotation=quat4.identity(),this._position=vec3.create(),this.matrices={mv:mat4.identity(),imv:mat4.identity(),p:mat4.identity(),n:mat3.identity()},this.reset(),this.setFixedYawAxis(!0,vec3.UNIT_Y),this._isValid=!1,this._viewVector=vec3.create(),this._upVector=vec3.create(),this._rightVector=vec3.create(),e&&(e.position&&(this._position=e.position),e.direction&&(this.direction=e.direction))}var t,n,r,i,s,o,u,a,f,l,c;return e.include(Jax.EventEmitter),r=vec3.create([0,0,-1]),t=vec3.create([1,0,0]),n=vec3.create([0,1,0]),e.getter("frustum",function(){return this._frustum||(this._frustum=new Jax.Frustum(this.matrices.imv,this.matrices.p)),this.isValid()||this.validate(),this._stale&&this.recalculateMatrices(),this._frustum.isValid()||this._frustum.validate(),this._frustum}),u=vec3.create(),s=vec3.create(),o=vec3.create(),i=quat4.create(),e.define("direction",{get:function(){return this.isValid()||this.validate(),this._viewVector},set:function(e){var t,n,r,a;return a=vec3.set(e,u),vec3.scale(a,-1),vec3.normalize(a),this._fixedYaw?(t=vec3.normalize(vec3.cross(this._fixedYawAxis,a,s)),r=vec3.normalize(vec3.cross(a,t,o)),quat4.fromAxes(a,t,r,this.rotation)):(n=vec3.toQuatRotation(this.direction,a,i),quat4.multiply(n,this.rotation,this.rotation)),quat4.normalize(this.rotation),this.invalidate(),this.fireEvent("updated")}}),e.getter("right",function(){return this.isValid()||this.validate(),this._rightVector}),e.getter("up",function(){return this.isValid()||this.validate(),this._upVector}),e.define("position",{get:function(){return this._position},set:function(e){var t;return vec3.set(e,this._position),this._stale=!0,(t=this._frustum)!=null&&t.invalidate(),this.fireEvent("updated")}}),e.prototype.invalidate=function(){var e;return this._isValid=!1,this._stale=!0,(e=this._frustum)!=null?e.invalidate():void 0},e.prototype.isValid=function(){return this._isValid},e.prototype.recalculateMatrices=function(){return this.isValid()||this.validate(),this._stale=!1,mat4.fromRotationTranslation(this.rotation,this.position,this.matrices.mv),mat4.inverse(this.matrices.mv,this.matrices.imv),mat4.toInverseMat3(this.matrices.mv,this.matrices.n),mat3.transpose(this.matrices.n),this.fireEvent("matrixUpdated")},e.prototype.validate=function(){return this._isValid=!0,this._viewVector=quat4.multiplyVec3(this.rotation,r,this._viewVector),this._rightVector=quat4.multiplyVec3(this.rotation,t,this._rightVector),this._upVector=quat4.multiplyVec3(this.rotation,n,this._upVector)},e.prototype.setFixedYawAxis=function(e,t){this._fixedYaw=e;if(t)return this._fixedYawAxis=t},e.prototype.ortho=function(e){return e.left||(e.left=-1),e.right||(e.right=1),e.top||(e.top=1),e.bottom||(e.bottom=-1),e.far||(e.far=200),e.near||(e.near=.1),mat4.ortho(e.left,e.right,e.bottom,e.top,e.near,e.far,this.matrices.p),this.projection={width:e.right-e.left,height:e.top-e.bottom,depth:e.far-e.near,left:e.left,right:e.right,top:e.top,bottom:e.bottom,near:e.near,far:e.far,type:"orthographic"},this.fireEvent("matrixUpdated")},e.prototype.perspective=function(e){var t;e||(e={});if(!e.width)throw new Error("Expected a screen width in Jax.Camera#perspective");if(!e.height)throw new Error("Expected a screen height in Jax.Camera#perspective");return e.fov||(e.fov=45),e.near||(e.near=.1),e.far||(e.far=200),t=e.width/e.height,mat4.perspective(e.fov,t,e.near,e.far,this.matrices.p),this.projection={width:e.width,height:e.height,near:e.near,far:e.far,fov:e.fov,type:"perspective"},this.fireEvent("matrixUpdated")},l=vec3.create(),f=quat4.create(),e.prototype.rotate=function(e,t,n,r){var i;return n===void 0?i=t:(i=l,i[0]=t,i[1]=n,i[2]=r),this.rotateWorld(e,quat4.multiplyVec3(this.rotation,i,i))},e.prototype.rotateWorld=function(e,t,n,r){var i,s;return n===void 0?s=t:(s=l,s[0]=t,s[1]=n,s[2]=r),i=quat4.fromAngleAxis(e,s,f),quat4.normalize(i),quat4.multiply(i,this.rotation,this.rotation),this.invalidate(),this.fireEvent("updated"),this},e.prototype.pitch=function(e){var t;return t=this.right,this.rotateWorld(e,t)},e.prototype.yaw=function(e){var t;return this._fixedYaw?t=this._fixedYawAxis:t=this.up,this.rotateWorld(e,t)},e.prototype.roll=function(e){var t;return t=this.direction,this.rotateWorld(e,t)},e.prototype.reorient=function(e,t){return t&&(this.position=t),this.direction=e,this},e.prototype.lookAt=function(e,t){var n;return t?this.position=t:t=this.position,n=this.direction,this.direction=vec3.subtract(e,t,n)},e.prototype.getTransformationMatrix=function(){return this._stale&&this.recalculateMatrices(),this.matrices.mv},e.prototype.getInverseTransformationMatrix=function(){return this._stale&&this.recalculateMatrices(),this.matrices.imv},e.prototype.getNormalMatrix=function(){return this._stale&&this.recalculateMatrices(),this.matrices.n},e.prototype.getProjectionMatrix=function(){return this._stale&&this.recalculateMatrices(),this.matrices.p},c=vec4.create(),e.prototype.unproject=function(e,t,n){var r,i,s,o,u,a,f;return n!==void 0?(r=c,s=this.getTransformationMatrix(),u=this.getProjectionMatrix(),f=[0,0,this.projection.width,this.projection.height],i=mat4.inverse(s,mat4.create()),mat4.multiply(u,i,i),mat4.inverse(i,i)?(r[0]=(e-f[0])/f[2]*2-1,r[1]=(t-f[1])/f[3]*2-1,r[2]=2*n-1,r[3]=1,o=r,mat4.multiplyVec4(i,r,o),o[3]===0?null:(a=vec3.create(),o[3]=1/o[3],a[0]=o[0]*o[3],a[1]=o[1]*o[3],a[2]=o[2]*o[3],a)):null):[this.unproject(e,t,0),this.unproject(e,t,1)]},e.prototype.strafe=function(e){return this.move(e,this.right),this},a=vec3.create(),e.prototype.move=function(e,t){return t||(t=this.direction),vec3.add(vec3.scale(t,e,a),this.position,this.position),this.invalidate(),this.fireEvent("updated"),this},e.prototype.projectMovement=function(e,t,n){var r,i;return t||(t=0),n||(n=vec3.create()),i=vec3.scale(this.direction,e),r=vec3.scale(this.right,t),vec3.set(this.position,n),vec3.add(i,n,n),vec3.add(r,n,n),n},e.prototype.reset=function(){return this.position[0]=this.position[1]=this.position[2]=0,this.rotation[0]=this.rotation[1]=this.rotation[2]=0,this.rotation[3]=1,this.invalidate(),this.fireEvent("updated")},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Frustum=function(e){function n(e,t){var r;this.modelview=e,this.projection=t,n.__super__.constructor.call(this),this.planes=function(){var e,t;t=[];for(r=e=0;e<6;r=++e)t.push(new Jax.Geometry.Plane);return t}(),this.invalidate()}var r,i,s,o,u,a,f,l,c,h;return t(n,e),n.include(Jax.EventEmitter),h=[0,1,2,3,4,5],u=h[0],s=h[1],r=h[2],a=h[3],i=h[4],o=h[5],n.OUTSIDE=Jax.Geometry.Plane.BACK,n.INTERSECT=Jax.Geometry.Plane.INTERSECT,n.INSIDE=Jax.Geometry.Plane.FRONT,n.getter("mesh",function(){var e,t,n=this;return this._mesh?this._mesh:(e=this._mesh=new Jax.Mesh.Lines({init:function(e,t){var n,r,i;i=[];for(n=r=0;r<28;n=++r)e.push(0,0,0),i.push(t.push(1,1,0,1));return i}}),t=function(){var t,r,i,s;i=e.data.vertexBuffer,t=n.extents();for(r=s=0;s<=2;r=++s)i[0+r]=t.ntl[r],i[3+r]=t.ntr[r],i[6+r]=t.ntr[r],i[9+r]=t.nbr[r],i[12+r]=t.ntr[r],i[15+r]=t.nbr[r],i[18+r]=t.nbr[r],i[21+r]=t.nbl[r],i[24+r]=t.nbl[r],i[27+r]=t.ntl[r],i[30+r]=t.ftl[r],i[33+r]=t.ftr[r],i[36+r]=t.ftr[r],i[39+r]=t.fbr[r],i[42+r]=t.ftr[r],i[45+r]=t.fbr[r],i[48+r]=t.fbr[r],i[51+r]=t.fbl[r],i[54+r]=t.fbl[r],i[57+r]=t.ftl[r],i[60+r]=t.ntl[r],i[63+r]=t.ftl[r],i[66+r]=t.nbl[r],i[69+r]=t.fbl[r],i[72+r]=t.ntr[r],i[75+r]=t.ftr[r],i[78+r]=t.nbr[r],i[81+r]=t.fbr[r];return e.data.invalidate()},this.addEventListener("updated",t),t(),e)}),c=vec3.create(),n.prototype.point=function(e,t,n){var r,i,s,o,u;this.validate(),t!==void 0&&(o=[e,t,n],c[0]=o[0],c[1]=o[1],c[2]=o[2],e=c),u=this.planes;for(i=0,s=u.length;i<s;i++){r=u[i];if(r.distance(e)<0)return Jax.Frustum.OUTSIDE}return Jax.Frustum.INSIDE},n.prototype.sphere=function(e,t,n,r){var i,s,o,u,a,f,l;this.validate(),n!==void 0&&(t=r,f=[e,t,n],c[0]=f[0],c[1]=f[1],c[2]=f[2],e=c),o=Jax.Frustum.INSIDE,l=this.planes;for(u=0,a=l.length;u<a;u++){s=l[u],i=s.distance(e);if(i<-t)return Jax.Frustum.OUTSIDE;i<t&&(o=Jax.Frustum.INTERSECT)}return o},n.prototype.cube=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;this.validate(),s=0,v=[e[0]+t,e[0]-t],a=v[0],u=v[1],m=[e[1]+n,e[1]-n],l=m[0],f=m[1],g=[e[2]+r,e[2]-r],h=g[0],c=g[1],y=this.planes;for(p=0,d=y.length;p<d;p++){o=y[p],i=0,o.classify(a,l,h)>0&&i++,o.classify(u,l,h)>0&&i++,o.classify(a,f,h)>0&&i++,o.classify(u,f,h)>0&&i++,o.classify(a,l,c)>0&&i++,o.classify(u,l,c)>0&&i++,o.classify(a,f,c)>0&&i++,o.classify(u,f,c)>0&&i++;if(i===0)return Jax.Frustum.OUTSIDE;i===8&&s++}return s===6?Jax.Frustum.INSIDE:Jax.Frustum.INTERSECT},n.prototype.pointVisible=function(e,t,n){return this.point(e,t,n)!==Jax.Frustum.OUTSIDE},n.prototype.sphereVisible=function(e,t,n,r){return this.sphere(e,t,n,r)!==Jax.Frustum.OUTSIDE},n.prototype.cubeVisible=function(e,t,n,r){return this.cube(e,t,n,r)!==Jax.Frustum.OUTSIDE},n.prototype.invalidate=function(){return this._isValid=!1},n.prototype.isValid=function(){return this._isValid},n.prototype.validate=function(){if(this.isValid())return;return this.extractFrustum(),this._isValid=!0,this.fireEvent("updated")},f=mat4.create(),l=vec3.create(),n.prototype.calcExtent=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e[3]=1,mat4.multiplyVec4(f,e),e[3]===0?(e[0]=e[1]=e[2]=0,e):(e[3]=1/e[3],e[0]=e[0]*e[3],e[1]=e[1]*e[3],e[2]=e[2]*e[3],e)},n.prototype.extents=function(){var e,t;return this.isValid()?this._extractedExtents:(e=this._extractedExtents||(this._extractedExtents={ntl:vec4.create(),ntr:vec4.create(),nbl:vec4.create(),nbr:vec4.create(),ftl:vec4.create(),ftr:vec4.create(),fbl:vec4.create(),fbr:vec4.create()}),t=f,mat4.multiply(this.projection,this.modelview,t),mat4.inverse(t),this.calcExtent(e.ntl,-1,1,-1),this.calcExtent(e.ntr,1,1,-1),this.calcExtent(e.nbl,-1,-1,-1),this.calcExtent(e.nbr,1,-1,-1),this.calcExtent(e.ftl,-1,1,1),this.calcExtent(e.ftr,1,1,1),this.calcExtent(e.fbl,-1,-1,1),this.calcExtent(e.fbr,1,-1,1),this._extractedExtents)},n.prototype.extractFrustum=function(){var e;return e=this.extents(),this.planes[a].set(e.ntr,e.ntl,e.ftl),this.planes[r].set(e.nbl,e.nbr,e.fbr),this.planes[s].set(e.ntl,e.nbl,e.fbl),this.planes[u].set(e.nbr,e.ntr,e.fbr),this.planes[o].set(e.ntl,e.ntr,e.nbr),this.planes[i].set(e.ftr,e.ftl,e.fbl)},n.prototype.render=function(e,t){return this.mesh.render(e,this,t)},n}(Jax.Model)}.call(this),function(){Jax.Octree=function(){function e(e,t,n,r,i){this.splitThreshold=e!=null?e:2,this.mergeThreshold=t!=null?t:1,this.depth=n!=null?n:0,this.size=r!=null?r:1,this.parent=i,this._isParent=!1,this._isSubdivided=!1,this.children=[],this.objectCount=0,this.nestedObjectCount=0,this.objects={},this.nestedObjects={},this.position=vec3.create()}var t;return e.getter("mesh",function(){return this._mesh||(this._mesh=new Jax.Mesh.LineCube(this.size,this.position))}),e.prototype.isParent=function(){return this._isParent},e.prototype.isSubdivided=function(){return this._isSubdivided},e.prototype.enlarge=function(){var e,t,n,r;this.size*=2,r=this.children;for(t=0,n=r.length;t<n;t++)e=r[t],e&&(this.recalculateChildPosition(e),e.enlarge(),e.reEvaluateObjects());return this.subdivide(),this.reEvaluateObjects(),this.mesh.halfSize=this.size,this.mesh.offset=this.position,this.mesh.invalidate()},e.prototype.subdivide=function(){return this._isSubdivided=!0},t=vec3.create(),e.prototype.getChildInQuadrant=function(e){var n;return(n=this.children[this.quadrant(e,t)])?n:(n=new Jax.Octree(this.splitThreshold,this.mergeThreshold,this.depth+1,this.size*.5,this),vec3.scale(t,this.size*.5),vec3.add(t,this.position,n.position),this.children[this.quadrant(e)]=n)},e.prototype.recalculateChildPosition=function(e){return this.quadrant(e.position,t),vec3.scale(t,this.size*.5),vec3.add(t,this.position,e.position)},e.prototype.canContain=function(e){var t,n,r,i,s;return t=e.position,n=((s=e.mesh)!=null?s.bounds.radius:void 0)||.1,r=this.position,i=this.size,n>i?!1:t[0]>r[0]+i?!1:t[0]<r[0]-i?!1:t[1]>r[1]+i?!1:t[1]<r[1]-i?!1:t[2]>r[2]+i?!1:t[2]<r[2]-i?!1:!0},e.prototype.trackNestedObject=function(e){return this.nestedObjects[e.__unique_id]||(this.nestedObjects[e.__unique_id]=e,this.nestedObjectCount++),this.parent&&this.parent.trackNestedObject(e),e},e.prototype.untrackNestedObject=function(e){return this.nestedObjects[e.__unique_id]&&(delete this.nestedObjects[e.__unique_id],this.nestedObjectCount--,this.nestedObjectCount<=this.mergeThreshold&&this.merge()),this.parent&&this.parent.untrackNestedObject(e),e},e.prototype.addToSelf=function(e){return this.objects[e.__unique_id]||(this.objects[e.__unique_id]=e,this.objectCount++,this.objectCount>=this.splitThreshold&&this.split()),this.trackNestedObject(e)},e.prototype.add=function(e){return!this.hasBeenMerged()&&this.canContain(e)?this.isSubdivided()?this.addToChild(e)||this.addToSelf(e):this.addToSelf(e):this.parent?this.parent.add(e):(this.enlarge(),this.add(e))},e.prototype.hasBeenMerged=function(){return this.parent&&!this.parent.isSubdivided()},e.prototype.remove=function(e){return this.objects[e.__unique_id]&&(delete this.objects[e.__unique_id],this.objectCount--),this.untrackNestedObject(e)},e.prototype.split=function(){var e,t,n;this.subdivide(),n=this.objects;for(e in n)t=n[e],this.addToChild(t);return!0},e.prototype.reEvaluateObjects=function(){var e,t,n;if(this.isSubdivided()){n=this.objects;for(e in n)t=n[e],this.addToChild(t)}return!0},e.prototype.merge=function(){var e,t,n,r,i,s,o;this._isSubdivided=!1,s=this.children;for(r=0,i=s.length;r<i;r++)e=s[r],e!=null&&e.clear();this.objectCount=this.nestedObjectCount,o=this.nestedObjects;for(t in o)n=o[t],this.objects[t]=n;return!0},e.prototype.clear=function(){var e,t,n,r,i,s,o,u;s=this.nestedObjects;for(t in s)n=s[t],delete this.nestedObjects[t];o=this.objects;for(t in o)n=o[t],delete this.objects[t];u=this.children;for(r=0,i=u.length;r<i;r++)e=u[r],e!=null&&e.clear();return this._isSubdivided=!1,this.objectCount=this.nestedObjectCount=0},e.prototype.addToChild=function(e){var t;return t=this.getChildInQuadrant(e.position),t.canContain(e)?(this.objects[e.__unique_id]&&(delete this.objects[e.__unique_id],this.objectCount--),this._isParent=!0,t.add(e),this.trackNestedObject(e),!0):!1},e.prototype.quadrant=function(e,t){var n,r;return n=this.position,r=0,e[0]>n[0]&&(r|=1),e[1]>n[1]&&(r|=2),e[2]>n[2]&&(r|=4),t&&(t[0]=r&1?1:-1,t[1]=r&2?1:-1,t[2]=r&4?1:-1),r},e.prototype.find=function(e){var t,n,r,i,s;if(this.objects[e.__unique_id])return this;s=this.children;for(r=0,i=s.length;r<i;r++){t=s[r];if(t&&t.nestedObjects[e.__unique_id])if(n=t.find(e))return n}return null},e.prototype.update=function(e){var t,n,r;n=this.find(e),r=!1;while(n&&!n.canContain(e))r=!0,t=e.__unique_id,n.nestedObjects[t]&&(delete n.nestedObjects[t],n.nestedObjectCount--),n.objects[t]&&(delete n.objects[t],n.objectCount--),n.nestedObjectCount<=n.mergeThreshold&&n.merge(),n=n.parent;if(!r)return;return n||(n=this),n.add(e),!0},e.prototype.traverse=function(e,t){var n,r,i,s,o,u,a,f,l;if(this.nestedObjectCount===0)return;if(t(this)===!1)return;return this.isSubdivided()&&(n=this.quadrant(e),(r=this.children[n])!=null&&r.traverse(e,t),(i=this.children[n^1])!=null&&i.traverse(e,t),(s=this.children[n^2])!=null&&s.traverse(e,t),(o=this.children[n^4])!=null&&o.traverse(e,t),(u=this.children[n^3])!=null&&u.traverse(e,t),(a=this.children[n^5])!=null&&a.traverse(e,t),(f=this.children[n^6])!=null&&f.traverse(e,t),(l=this.children[n^7])!=null&&l.traverse(e,t)),!0},e}()}.call(this),function(){Jax.World=function(){function e(e){var t,n;this.context=e,this.renderOctree=!1,this.lights=[],this._objects={},this.ambientColor=new Jax.Color(.05,.05,.05,1),this._objectsArray=[],this._renderQueue=[],this._sortPosition=vec3.create(),this._cameras=[],this.cameras=1,this.octree=new Jax.Octree(20,10),this._octreeModel=new Jax.Model({octree:this.octree}),n=this,this.invalidateShadowMaps=function(){var e,t,r,i,s;t=this;if(t.castShadow){s=n.lights;for(r=0,i=s.length;r<i;r++){e=s[r];if(!e.shadowmap||!e.isInRange(t))continue;e.shadowmap.invalidate()}}return!0},this.updateOctree=function(){return n.octree.update(this)},t=vec3.create(),this._queueSorter=function(e,r){var i,s,o,u,a;return i=n._sortPosition,s=vec3.length(vec3.subtract(e.position,i,t))-(((u=e.mesh)!=null?u.bounds.radius:void 0)||0),o=vec3.length(vec3.subtract(r.position,i,t))-(((a=r.mesh)!=null?a.bounds.radius:void 0)||0),s-o}}var t,n,r;return e.include(Jax.EventEmitter),e.define("ambientColor",{get:function(){return this._ambientColor},set:function(e){return this._ambientColor=Jax.Color.parse(e),this.fireEvent("ambientChanged")}}),e.getter("objects",function(){var e,t,n,r,i;console.log("The getter `objects` is deprecated; please use `getObjects()` instead.\nNote that the latter returns an array, where the former used to be a\ngeneric object."),console.log((new Error).stack),t={},i=this.getObjects();for(n=0,r=i.length;n<r;n++)e=i[n],t[e.__unique_id]=e;return t}),e.define("cameras",{get:function(){return this._cameras},set:function(e){var t,n,r;e<1&&(e=1),n=this._cameras.length,this._cameras.length=e;if(e>n)for(t=r=n;n<=e?r<e:r>e;t=n<=e?++r:--r)this._cameras[t]=new Jax.Camera;return this.fireEvent("numCamerasChanged")}}),e.prototype.render=function(e,t){return e&&(e instanceof Jax.Material||(e=Jax.Material.find(e))),this.renderOpaques(e,t)+this.renderTransparencies(e)},e.prototype.renderTransparencies=function(e){var t,n;t=this.context,n=this._renderQueue;if(n.length){n=n.sort(this._queueSorter);while(n.length)n.pop().render(t,e)}return n.length},e.prototype.renderOrEnqueue=function(e,t){var n,r,i,s,o;n=this.context,o=this._renderQueue,s=0;for(r in t)i=t[r],i.transparent||i.mesh&&i.mesh.transparent?o.push(i):(i.render(n,e),s++);return s},e.prototype.renderOpaques=function(e,t){var n;return n=0,this._sortPosition[0]=this._sortPosition[1]=this._sortPosition[2]=0,mat4.multiplyVec3(this.context.matrix_stack.getInverseModelViewMatrix(),this._sortPosition),t!==!1?n+=this.renderOpaquesInOctree(e):n+=this.renderOrEnqueue(e,this.octree.nestedObjects),n+this.renderOrEnqueue(e,this._objects)},e.prototype.renderOpaquesInOctree=function(e){var t,n,r,i,s,o,u,a=this;return r=0,t=this.context,n=t.activeCamera.frustum,s=this._renderQueue,u=[this.renderOctree,this.octreeModel],o=u[0],i=u[1],this.octree.traverse(this._sortPosition,function(s){var u,f,l,c;c=s.size*2;switch(n.cube(s.position,c,c,c)){case Jax.Frustum.OUTSIDE:return!1;case Jax.Frustum.INSIDE:f=s.nestedObjectCount,l=s.nestedObjects,u=!1;break;default:f=s.objectCount,l=s.objects,u=!0}return o&&f&&s.mesh.render(t,i,e),r+=a.renderOrEnqueue(e,l),u}),r},e.prototype.getPickBuffer=function(){return this.pickBuffer||(this.pickBuffer=new Jax.Framebuffer({depth:!0,width:this.context.canvas.width,height:this.context.canvas.height}))},e.prototype.addLight=function(e){return e instanceof Jax.Light||(e=Jax.Light.find(e)),this.lights.push(e),this.fireEvent("lightAdded"),e},e.prototype.removeLight=function(e){return this.lights.splice(this.lights.indexOf(e)),this.fireEvent("lightRemoved"),e},e.prototype.addObject=function(e,t){var n;return n=(!t||t.addToOctree!==!1&&t.cull!==!1)&&e.cull!==!1&&e.mesh&&e.mesh.cull!==!1,n?(this.octree.add(e),e.addEventListener("transformed",this.updateOctree),this.fireEvent("objectAddedToOctree")):this._objects[e.__unique_id]=e,this.getObjects().push(e),this.fireEvent("objectAdded"),e.castShadow!==!1&&(this.invalidateShadowMaps.apply(e),e.addEventListener("transformed",this.invalidateShadowMaps)),e},e.prototype.getObject=function(e){var t,n,r,i;if(t=this._objects[e])return t;i=this.getObjects();for(n=0,r=i.length;n<r;n++){t=i[n];if(t.__unique_id===e)return t}return null},e.prototype.removeObject=function(e){var t,n;delete this._objects[e.__unique_id],n=this.getObjects(),n.splice(n.indexOf(e),1),this.invalidateShadowMaps.apply(e),e.removeEventListener("transformed",this.invalidateShadowMaps),e.removeEventListener("transformed",this.updateOctree);if(t=this.octree.find(e))t.remove(e),this.fireEvent("objectRemovedFromOctree");return this.fireEvent("objectRemoved"),e},n={},t=function(e,t,n,r){return""+e.toFixed(6)+","+t.toFixed(6)+","+n.toFixed(6)+","+r.toFixed(6)},e.prototype.parsePickData=function(e,t){var n,r,i,s;for(n=i=2,s=e.length;i<s;n=i+=4)e[n]>0&&(r=Jax.Util.decodePickingColor(e[n-2],e[n-1],e[n],e[n+1]),r!==void 0&&t.indexOf(r)===-1&&t.push(r));return t},e.prototype.pickRegionalIndices=function(e,r,i,s,o){var u,a,f,l,c,h,p,d,v,m;return o==null&&(o=[]),v=[Math.min(e,i),Math.min(r,s)],h=v[0],p=v[1],m=[Math.max(e,i)-h,Math.max(r,s)-p],c=m[0],f=m[1],o.length=0,u=this.context,a=n[d=t(h,p,c,f)]||(n[d]=new Uint8Array(c*f*4)),l=this.getPickBuffer(),l.bind(u),l.viewport(u),u.gl.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),u.gl.disable(GL_BLEND),this.render("picking"),u.gl.enable(GL_BLEND),u.gl.readPixels(h,p,c,f,GL_RGBA,GL_UNSIGNED_BYTE,a),a.data&&(a=a.data),l.unbind(u),u.viewport(),this.parsePickData(a,o)},e.prototype.pickRegion=function(e,t,n,r,i){var s,o,u,a;i==null&&(i=[]),o=this.pickRegionalIndices(e,t,n,r,i);for(s=u=0,a=o.length;0<=a?u<a:u>a;s=0<=a?++u:--u)o[s]=Jax.Model.__instances[o[s]];return o},r=new Array(1),e.prototype.pickIndex=function(e,t){return this.pickRegionalIndices(e,t,e+1,t+1,r)[0]},e.prototype.pick=function(e,t){return this.pickRegion(e,t,e+1,t+1,r)[0]},e.prototype.countObjects=function(){return this.getObjects().length},e.prototype.getObjects=function(){return this._objectsArray},e.prototype.update=function(e){var t,n,r,i,s;i=this.getObjects(),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(typeof t.update=="function"?t.update(e):void 0);return s},e.prototype.dispose=function(e){var t,n,r,i,s,o,u,a;e==null&&(e=!0);if(e){u=this.getObjects().slice(0);for(r=0,s=u.length;r<s;r++)n=u[r],this.removeObject(n),n.dispose(this.context)}a=this.lights.splice(0);for(i=0,o=a.length;i<o;i++)t=a[i],this.removeLight(t),t.dispose(this.context);return this.ambientColor=new Jax.Color(.05,.05,.05,1),this.fireEvent("disposed"),!0},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.POINT_LIGHT=1,Jax.SPOT_LIGHT=2,Jax.DIRECTIONAL_LIGHT=3,Jax.Light=function(e){function n(e){if(this.__proto__.constructor.name==="Light")if(e!=null?e.type:void 0){switch(e.type){case"SPOT_LIGHT":case Jax.SPOT_LIGHT:e.type="Spot";break;case"POINT_LIGHT":case Jax.POINT_LIGHT:e.type="Point";break;case"DIRECTIONAL_LIGHT":case Jax.DIRECITONAL_LIGHT:e.type="Directional"}if(Jax.Light[e.type])return new Jax.Light[e.type](e)}this.shadows=!0,this.enabled=!0,this._color=new Jax.Light.Color,this._attenuation=new Jax.Light.Attenuation,this.spotExponent=32,this.innerSpotAngle=Math.PI/8.75,this.outerSpotAngle=Math.PI/8,this.energy=(e!=null?e.energy:void 0)===void 0?1:e.energy,n.__super__.constructor.call(this,e)}var r,i;return t(n,e),n.define("color",{get:function(){return this._color},set:function(e){return this._color=new Jax.Light.Color(e)}}),n.define("attenuation",{get:function(
){return this._attenuation},set:function(e){return this._attenuation=new Jax.Light.Attenuation(e)}}),n.define("direction",{get:function(){return this.camera.direction},set:function(e){return this.camera.direction=e}}),n.define("position",{get:function(){return this.camera.position},set:function(e){return this.camera.position=e}}),n.define("innerSpotAngle",{get:function(){return this._innerSpotAngle},set:function(e){return this._innerSpotAngle=e,this._innerSpotAngleCos=Math.cos(e)}}),n.define("outerSpotAngle",{get:function(){return this._outerSpotAngle},set:function(e){return this._outerSpotAngle=e,this._outerSpotAngleCos=Math.cos(e)}}),n.define("outerSpotAngleCos",{get:function(){return this._outerSpotAngleCos}}),n.define("innerSpotAngleCos",{get:function(){return this._innerSpotAngleCos}}),i=vec3.create(),n.prototype.isInRange=function(e){var t,n,r,s,o;return r=((o=e.mesh)!=null?o.bounds.radius:void 0)||0,n=e.position,t=vec3.length(vec3.subtract(n,this.position,i))-r,s=this.maxEffectiveRange(),s===-1||s>=t},n.prototype.dispose=function(e){var t;return(t=this.shadowmap)!=null?t.dispose(e):void 0},n.prototype.rotate=function(e,t,n,r){return this.camera.rotate(e,t,n,r)},n.prototype.eyeDirection=function(e,t){return vec3.normalize(mat3.multiplyVec3(e,this.camera.direction,t))},n.prototype.eyePosition=function(e,t){return mat4.multiplyVec3(e,this.camera.position,t)},r=10/256,n.prototype.maxEffectiveRange=function(e){var t,n;e==null&&(e=1),t=this.attenuation;if(t.constant<0||t.linear<0||t.quadratic<0||t.constant<1/r&&t.linear===0&&t.quadratic===0)return-1;n=e;while(this.calculateIntensity(n)>r)n+=e;return n},n.prototype.calculateIntensity=function(e){return 1/(this.attenuation.constant+this.attenuation.linear*e+this.attenuation.quadratic*e*e)},n}(Jax.Model),Jax.Scene||(Jax.Scene={}),Jax.Scene.LightSource=function(e){function n(e){r(),n.__super__.constructor.call(this,e)}var r;return t(n,e),r=function(){return console.log("Please note that Jax.LightSource has been deprecated; it is now just Jax.Light."),console.log("(You should also rename `app/assets/jax/resources/light_sources` to `app/assets/jax/resources/lights`.)")},n.find=function(){var e;return r(),(e=Jax.Light).find.apply(e,arguments)},n.addResources=function(){var e;return r(),(e=Jax.Light).addResources.apply(e,arguments)},n}(Jax.Light),Jax.getGlobal().LightSource=Jax.LightSource=Jax.Scene.LightSource}.call(this),function(){var e=[].slice;Jax.Light.Attenuation=function(){function t(t){var n;this.constant=0,this.linear=1,this.quadratic=0,(t!=null?t.length:void 0)?(n=e.call(t),this.constant=n[0],this.linear=n[1],this.quadratic=n[2]):((t!=null?t.constant:void 0)!==void 0&&(this.constant=t.constant),(t!=null?t.linear:void 0)!==void 0&&(this.linear=t.linear),(t!=null?t.quadratic:void 0)!==void 0&&(this.quadratic=t.quadratic))}return t}()}.call(this),function(){Jax.Light.Color=function(){function e(e){this.diffuse=new Jax.Color(.7,.7,.7,1),this.specular=new Jax.Color(1,1,1,1),this.ambient=new Jax.Color(0,0,0,1),(e!=null?e.length:void 0)||(e!=null?e.toVec4:void 0)?(this.diffuse=Jax.Color.parse(e),this.specular=Jax.Color.parse(e),this.ambient=Jax.Color.parse(e)):((e!=null?e.diffuse:void 0)!==void 0&&(this.diffuse=Jax.Color.parse(e.diffuse)),(e!=null?e.specular:void 0)!==void 0&&(this.specular=Jax.Color.parse(e.specular)),(e!=null?e.ambient:void 0)!==void 0&&(this.ambient=Jax.Color.parse(e.ambient)))}return e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Light.Directional=function(e){function n(e){n.__super__.constructor.call(this,e),this.innerSpotAngle=Math.PI,this.outerSpotAngle=Math.PI,this.type=Jax.DIRECTIONAL_LIGHT,this.shadowmap=new Jax.ShadowMap.Directional(this)}return t(n,e),n.define("attenuation",{get:function(){return this._realAttenuation||(this._realAttenuation=new Jax.Light.Attenuation({constant:1,linear:0,quadratic:0}))}}),n}(Jax.Light)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Light.Point=function(e){function n(e){n.__super__.constructor.call(this,e),this.innerSpotAngle=Math.PI,this.outerSpotAngle=Math.PI,this.type=Jax.POINT_LIGHT,this.shadowmap=new Jax.ShadowMap.Point(this)}return t(n,e),n}(Jax.Light)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Light.Spot=function(e){function n(e){n.__super__.constructor.call(this,e),this.type=Jax.SPOT_LIGHT,this.shadowmap=new Jax.ShadowMap.Spot(this)}return t(n,e),n}(Jax.Light)}.call(this),function(){Jax.ShadowMap=function(){function e(e){var t=this;this.light=e,this._shadowMatrix=mat4.create(),this._projectionMatrix=mat4.create(),this._isValid=!1,this.light.camera.addEventListener("updated",function(){return t.invalidate()}),this.biasMatrix=mat4.identity(),this.clearColor=[0,0,0,0],this.cullFace=GL_FRONT,mat4.translate(this.biasMatrix,[.5,.5,.5]),mat4.scale(this.biasMatrix,[.5,.5,.5])}var t;return e.getter("shadowMatrix",function(){return this.isValid()||this.validate(),this._shadowMatrix}),e.getter("projectionMatrix",function(){return this.isValid()||this.validate(),this._projectionMatrix}),e.prototype.bindTextures=function(e,t,n){var r;return t[n]=(r=this.shadowmapFBO)!=null?r.getTexture(e,0):void 0},e.prototype.setupProjection=function(e){throw new Error("ShadowMap type "+this.__proto__.constructor.name+" did not initialize its projection matrix!")},e.prototype.validate=function(e){var t;if(e&&!this._isValid)return this._initialized||(t=e.gl.getParameter(e.gl.MAX_RENDERBUFFER_SIZE),t>1024&&(t=1024),this.width=this.height=t,this.shadowmapFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:!0,color:GL_RGBA}),this._initialized=!0),this.setupProjection(this._projectionMatrix,e),mat4.set(this.light.camera.getInverseTransformationMatrix(),this._shadowMatrix),mat4.multiply(this._projectionMatrix,this._shadowMatrix,this._shadowMatrix),this._isValid=!0,this.illuminate(e),mat4.multiply(this.biasMatrix,this._shadowMatrix,this._shadowMatrix)},e.prototype.invalidate=function(){return this._isValid=this._isUpToDate=!1},e.prototype.dispose=function(e){var t,n;return(t=this.shadowmapFBO)!=null&&t.dispose(e),(n=this.illuminationFBO)!=null?n.dispose(e):void 0},e.prototype.isValid=function(){return this._isValid},e.prototype.setupMatrices=function(e){return e.loadModelMatrix(mat4.IDENTITY),e.loadViewMatrix(this.shadowMatrix),e.loadProjectionMatrix(mat4.IDENTITY)},e.prototype.isDualParaboloid=function(){return!1},e.prototype.illuminate=function(e,t,n,r){var i,s,o=this;return t==null&&(t="depthmap"),n==null&&(n=this.shadowmapFBO),r==null&&(r=!1),s=e.gl,i=s.getParameter(GL_COLOR_CLEAR_VALUE),n.bind(e,function(){n.viewport(e),s.clearColor.apply(s,o.clearColor),s.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),s.disable(GL_BLEND),s.enable(GL_POLYGON_OFFSET_FILL),o.cullFace&&s.cullFace(o.cullFace),s.polygonOffset(2,2),e.matrix_stack.push(),o.setupMatrices(e.matrix_stack),e.world.render(t,!1),e.matrix_stack.pop();if(r)return s.readPixels(0,0,o.width,o.height,GL_RGBA,GL_UNSIGNED_BYTE,o.illuminationData)}),s.clearColor.apply(s,i),e.viewport(),s.polygonOffset(0,0),s.disable(GL_POLYGON_OFFSET_FILL),s.cullFace(GL_BACK),s.enable(GL_BLEND)},t=[],e.prototype.isIlluminated=function(e,n){var r;return this.validate(n),this.illuminationFBO||(this.illuminationFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:!0,color:GL_RGBA})),this.illuminationData||(this.illuminationData=new Uint8Array(this.width*this.height*4)),r=this.cullFace,this.cullFace=null,this.illuminate(n,"picking",this.illuminationFBO,!0),this.cullFace=r,n.world.parsePickData(this.illuminationData,t),t.indexOf(e.__unique_id)!==-1},e}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.ShadowMap.Directional=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r;return t(n,e),r=vec3.create(),n.prototype.setupProjection=function(e,t){var n,i,s,o,u,a,f,l,c,h,p,d;r[0]=r[1]=r[2]=0,n=0,h=t.world.getObjects();for(a=0,l=h.length;a<l;a++){o=h[a];if(!o.castShadow)continue;n+=1,vec3.add(o.camera.position,r,r)}if(n>0){vec3.scale(r,1/n),this.light.camera.position=r,u=0,i=vec3.create(),p=t.world.getObjects();for(f=0,c=p.length;f<c;f++){o=p[f];if(!o.castShadow)continue;s=vec3.length(vec3.subtract(r,o.camera.position,i))+((d=o.mesh)!=null?d.bounds.radius:void 0),u<s&&(u=s)}return u===0&&(u=1),mat4.ortho(-u,u,-u,u,-u,u,e)}return mat4.ortho(-1,1,-1,1,-1,1,e)},n}(Jax.ShadowMap)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice;Jax.ShadowMap.Point=function(e){function r(){var e;e=1<=arguments.length?n.call(arguments,0):[],r.__super__.constructor.apply(this,e),this.clearColor=[0,0,0,0],mat4.identity(this.biasMatrix)}var i;return t(r,e),r.prototype.illuminate=function(e,t,n){var i;return t==null&&(t="paraboloid-depthmap"),n==null&&(n=this.shadowmapFBO),this.backFBO||(this.backFBO=new Jax.Framebuffer({width:this.width,height:this.height,depth:!0,color:GL_RGBA})),t=Jax.Material.find(t),i=t.findLayer(Jax.Material.Layer.Paraboloid),i.paraboloidNear=this.paraboloidNear,i.paraboloidFar=this.paraboloidFar,this.cullFace=GL_FRONT,i.direction=1,r.__super__.illuminate.call(this,e,t,n),this.cullFace=GL_BACK,i.direction=-1,r.__super__.illuminate.call(this,e,t,this.backFBO)},r.prototype.dispose=function(e){var t;return r.__super__.dispose.call(this,e),(t=this.backFBO)!=null?t.dispose(e):void 0},r.prototype.isDualParaboloid=function(){return!0},r.prototype.bindTextures=function(e,t,n,i){return r.__super__.bindTextures.call(this,e,t,n),t[i]=this.backFBO.getTexture(e,0)},i=vec3.create(),r.prototype.setupProjection=function(e,t){var n,r,s,o,u,a,f,l;mat4.identity(e),o=0,f=t.world.getObjects();for(s in f)u=f[s],vec3.subtract(this.light.position,u.camera.position,i),n=vec3.length(i)+((l=u.mesh)!=null?l.bounds.radius:void 0),n>o&&(o=n);return a=o/100||.1,r=this.light.maxEffectiveRange(a),r===-1&&(r=o),this.paraboloidNear=.1,this.paraboloidFar=r},r}(Jax.ShadowMap)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.ShadowMap.Spot=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var r;return t(n,e),r=vec3.create(),n.prototype.setupProjection=function(e,t){var n,i,s,o,u,a,f,l,c,h,p;a=0,h=t.world.getObjects();for(u in h)l=h[u],vec3.subtract(this.light.position,l.camera.position,r),i=vec3.length(r)+((p=l.mesh)!=null?p.bounds.radius:void 0),i>a&&(a=i);return c=a/100||.1,s=this.light.maxEffectiveRange(c),s===-1&&(s=a),o=this.light.outerSpotAngle*180/Math.PI*2,f=.1,n=this.width/this.height,mat4.perspective(o,n,f,s,e)},n}(Jax.ShadowMap)}.call(this),function(){Jax.Controller.create("ssao",{index:function(){var e;return this.world.ambientColor="#fff",e=new Jax.Mesh.Sphere({radius:1}),this.world.addObject(new Jax.Model({mesh:e,position:[-1,0,-1]})),this.world.addObject(new Jax.Model({mesh:e,position:[1,0,-1]})),this.world.addObject(new Jax.Model({mesh:e,position:[-1,0,1]})),this.world.addObject(new Jax.Model({mesh:e,position:[1,0,1]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Quad({size:5}),position:[0,-1,0],direction:[0,-1,0]})),this.activeCamera.lookAt([0,0,0],[10,10,10])}})}.call(this),function(e,t){"use strict";function n(e,t,r){var i=this;if(i==null||i.constructor!=n)return new n(e,t,r);x(e,"Object")?r=e:x(e,"Function")?(r=t,t=e):x(t,"Object")?(r=t,t=null,i.name=e):i.name=e,M(i,r),i.id||(i.id=++pt),i.fn==null&&(i.fn=t),i.stats=D(i.stats),i.times=D(i.times)}function r(e){var t=this;if(t==null||t.constructor!=r)return new r(e);t.benchmark=e,ft(t)}function i(e){var t=this;return t==null||t.constructor!=i?new i(e):e instanceof i?e:H(t,{timeStamp:+(new Date)},typeof e=="string"?{type:e}:e)}function s(e,t){var n=this;if(n==null||n.constructor!=s)return new s(e,t);x(e,"Object")?t=e:n.name=e,M(n,t)}function o(){var e,t=-1,n=arguments.length,r=l.call(this),i=r.length;while(++t<n){e=arguments[t];if(x(e,"Array"))for(var s=0,o=e.length;s<o;s++,i++)s in e&&(r[i]=e[s]);else r[i++]=e}return r}function u(e,t,n){var r=e+t,i=n?n.length:0,s=e-1,o=e+i,u=this,a=Array(t),f=l.call(u,r);while(++s<r)s in u&&(a[s-e]=u[s],delete u[s]);s=e-1;while(++s<o)u[s]=n[s-e];e=s--,o=Ft(0,(u.length>>>0)-t+i);while(++s<o)s-e in f?u[s]=f[s-e]:delete u[s];t=t>i?t-i:0;while(t--)delete u[o+t];return u.length=o,a}function a(){var e,t,n=-1,r=Object(this),i=r.length>>>0,s=jt(i/2);if(i>1)while(++n<s)e=i-n-1,t=e in r?r[e]:Ct,n in r?r[e]=r[n]:delete r[e],t!=Ct?r[n]=t:delete r[n];return r}function f(){return u.call(this,0,1)[0]}function l(e,t){var n=-1,r=Object(this),i=r.length>>>0,s=[];e=h(e),e=e<0?Ft(i+e,0):It(e,i),e--,t=t==null?i:h(t),t=t<0?Ft(i+t,0):It(t,i);while((++n,++e)<t)e in r&&(s[n]=r[e]);return s}function c(e,t){var n=Object(this),r=n.length>>>0;return e=h(e),e=e<0?Ft(r+e,0):It(e,r),t=It(Ft(h(t),0),r-e),u.call(n,e,t,l.call(arguments,2))}function h(e){return e=+e,e===0||!isFinite(e)?e||0:e-e%1}function p(){var e=Object(this);return u.call(e,0,0,arguments),e.length}function d(e,t){return function(){e.apply(t,arguments)}}function v(){return v=function(e,t){var r,i=vt?define.amd:n,s=Ct+"createFunction";return O((vt?"define.amd.":"Benchmark.")+s+"=function("+e+"){"+t+"}"),r=i[s],delete i[s],r},v=Mt.browser&&(v("",'return"'+Ct+'"')||L)()==Ct?v:Function,v.apply(null,arguments)}function m(e,t){e._timerId=setTimeout(t,e.delay*1e3)}function g(e){Nt.appendChild(e),Nt.innerHTML=""}function y(){var e,n,r=!0,i=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];return function(t,i){function s(){this.valueOf=0}s.prototype.valueOf=0;for(i in new s)t+=i=="valueOf"?1:0;for(i in arguments)i=="0"&&(r=!1);n=t==2,e=!t}(0),y=function(s,o,u){u||(u={});var a=s;s=Object(s);var f,l,c,h,p=!a,v=u.which,m=v=="all",g=-1,y=s,b=s.length,w=m||v=="own",E={},T=x(s,"Function"),N=u.bind;N!==t&&(o=d(o,N));if(m&&Mt.getAllKeys)for(g=0,c=yt(s),b=c.length;g<b;g++){l=c[g];if(o(s[l],l,s)===!1)break}else{for(l in s)if(p=(!T||l!="prototype")&&(!n||!q(E,l)&&(E[l]=!0))&&(!w||w&&q(s,l))&&o(s[l],l,s)===!1)break;if(!p&&(r&&S(s)||(Pt||Ht)&&x(s,"String")&&(y=Pt?s.split(""):s)))while(++g<b)if(p=o(y[g],String(g),s)===!1)break;if(!p&&e){f=s.constructor,h=f&&f.prototype&&f.prototype.constructor===f;for(g=0;g<7;g++){l=i[g];if((!h||l!="constructor")&&q(s,l)&&o(s[l],l,s)===!1)break}}}return a},y.apply(null,arguments)}function b(e){return!q(e,"toString")&&(/^[\s(]*function[^(]*\(([^\s,)]+)/.exec(e)||0)[1]||""}function w(e){return $(e,function(e,t){return e+t})/e.length||0}function E(e,t){var n=t;return C(e)?n=String(e):Mt.decompilation&&(n=(/^[^{]+\{([\s\S]*)}\s*$/.exec(e)||0)[1]),(n||"").replace(/^\s+|\s+$/g,"")}function S(){return S=function(e){return Tt.call(e)=="[object Arguments]"},Dt&&(S=function(e){return q(e,"callee")&&(!St||!St.call(e,"callee"))}),S(arguments[0])}function x(e,t){return e!=null&&Tt.call(e)=="[object "+t+"]"}function T(e,t){var n=e!=null?typeof e[t]:"number";return!/^(?:boolean|number|string|undefined)$/.test(n)&&(n=="object"?!!e[t]:!0)}function N(e){var t,n=!!e&&Tt.call(e)=="[object Object]";n&&Dt&&(n=!S(e));if(n){t=e.constructor;if(n=x(t,"Function")&&t instanceof t)y(e,function(e,t){n=t}),n=n===!0||q(e,n)}return n}function C(e){return q(e,"toString")||x(e,"String")}function k(e){return function(){var t=[this];return t.push.apply(t,arguments),e.apply(null,t)}}function L(){}function A(e){try{var t=mt&&gt(e)}catch(n){}return t||null}function O(e){var t=vt?define.amd:n,r=dt.createElement("script"),i=dt.getElementsByTagName("script")[0],s=i.parentNode,o=Ct+"runScript",u="("+(vt?"define.amd.":"Benchmark.")+o+"||function(){})();";try{r.appendChild(dt.createTextNode(u+e)),t[o]=function(){g(r)}}catch(a){s=s.cloneNode(!1),i=null,r.text=e}s.insertBefore(r,i),delete t[o]}function M(e,t){t=H({},e.constructor.options,t),e.options=F(t,function(t,n){t!=null&&(/^on[A-Z]/.test(n)?j(n.split(" "),function(n){e.on(n.slice(2).toLowerCase(),t)}):q(e,n)||(e[n]=D(t)))})}function _(){var e=this,t=e.benchmark,n=t._original;n.aborted?(e.teardown(),t.running=!1,ct(e)):++e.cycles<t.count?m(t,function(){t.compiled.call(e,_t)}):(_t.stop(e),e.teardown(),m(t,function(){ct(e)}))}function D(e){function t(e){this.raw=e}function n(n,r){if(n&&n.constructor==t)return;if(n===Object(n))E[E.length++]={key:r,parent:o,source:e};else try{o[r]=n}catch(i){}}function r(e){var n=Ct;while(e[n]&&e[n].constructor!=t)n+=1;return n}var i,s,o,u,a,f,l,c,h,p,d,v,m,g={value:e},b=0,w=[],E={length:0},S=[];do{l=g.key,p=g.parent,v=g.source,o=e=v?v[l]:g.value,i=s=a=!1;if(e===Object(e)){if(x(e.deepClone,"Function"))o=e.deepClone();else{u=e.constructor;switch(Tt.call(e)){case"[object Array]":o=new u(e.length);break;case"[object Boolean]":o=new u(e==1);break;case"[object Date]":o=new u(+e);break;case"[object Object]":N(e)&&(o=new u);break;case"[object Number]":case"[object String]":o=new u(e);break;case"[object RegExp]":o=u(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":""))}}if(o&&o!=e&&!(a=v&&Mt.descriptors&&bt(v,l),i=a&&(a.get||a.set))){if(f=Et(e))h=r(e),e[h]&&(s=o=e[h].raw);else for(m=0,c=S.length;m<c;m++){g=S[m];if(g.object===e){s=o=g.clone;break}}s||(f?(e[h]=new t(o),w.push({key:h,object:e})):S.push({clone:o,object:e}),y(e,n,{which:"all"}))}}p?i||a&&!(a.configurable&&a.enumerable&&a.writable)?("value"in a&&(a.value=o),xt(p,l,a)):p[l]=o:d=o}while(g=E[b++]);for(b=0,c=w.length;b<c;b++)g=w[b],delete g.object[g.key];return d}function P(e,t,n){var r=e;e=Object(e);var i=t,s=-1,o=e.length,u=!!e.snapshotItem&&!!(o=e.snapshotLength),a=(Pt||Ht)&&x(e,"String"),f=u||a||"item"in e,l=e;if(o===o>>>0){if(f){t=function(e,t){return i.call(this,e,t,l)};if(a)e=e.split("");else{e=[];while(++s<o)e[s]=u?r.snapshotItem(s):r[s]}}j(e,t,n)}else F(e,t,n);return r}function H(e,t){var n=e;return delete arguments[0],j(arguments,function(e){y(e,function(e,t){n[t]=e})}),n}function B(e,t,n){var r;if(t=="successful")t=function(e){return e.cycles&&isFinite(e.hz)};else if(t=="fastest"||t=="slowest")r=B(e,"successful").sort(function(e,n){return e=e.stats,n=n.stats,(e.mean+e.moe>n.mean+n.moe?1:-1)*(t=="fastest"?1:-1)}),r=B(r,function(e){return r[0].compare(e)==0});return r||$(e,function(r,i,s){return t.call(n,i,s,e)?(r.push(i),r):r},[])}function j(e,n,r){var i=-1,s=(e=Object(e)).length>>>0;r!==t&&(n=d(n,r));while(++i<s)if(i in e&&n(e[i],i,e)===!1)break;return e}function F(e,t,n){return y(e,t,{bind:n,which:"own"})}function I(e){return e=String(e).split("."),e[0].replace(/(?=(?:\d{3})+$)(?!\b)/g,",")+(e[1]?"."+e[1]:"")}function q(){return q=function(e,t){var n=e!=null&&(e.constructor||Object).prototype;return!!n&&t in Object(e)&&!(t in n&&e[t]===n[t])},x(wt,"Function")?q=function(e,t){return e!=null&&wt.call(e,t)}:{}.__proto__==Object.prototype&&(q=function(e,t){var n=!1;return e!=null&&(e=Object(e),e.__proto__=[e.__proto__,e.__proto__=null,n=t in e][0]),n}),q.apply(this,arguments)}function R(e,t,n){var r=h(n),i=(e=Object(e)).length>>>0;r=(r<0?Ft(0,i+r):r)-1;while(++r<i)if(r in e&&t===e[r])return r;return-1}function U(e,t){return F(t,function(t,n){e=e.replace(RegExp("#\\{"+n.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")+"\\}","g"),t)}),e}function z(e,r){function o(){var e,n=a(p);return n&&(p.on("complete",u),e=p.events.complete,e.splice(0,0,e.pop())),b[v]=x(p&&p[r],"Function")?p[r].apply(p,h):t,!n&&u()}function u(t){var n,r=p,s=a(r);s&&(r.off("complete",u),r.emit("complete")),g.type="cycle",g.target=r,n=i(g),y.onCycle.call(e,n);if(!n.aborted&&c()!==!1){p=d?e[0]:b[v];if(a(p))m(p,o);else{if(!s)return!0;while(o());}}else g.type="complete",y.onComplete.call(e,i(g));if(!t)return!1;t.aborted=!0}function a(e){var t=h[0]&&h[0].async;return Object(e).constructor==n&&r=="run"&&((t==null?e.options.async:t)&&Mt.timeout||e.defer)}function c(){var t=b.length;if(d){do++v>0&&f.call(e);while((t=e.length)&&!("0"in e))}else while(++v<t&&!(v in b));return(d?t:v<t)?v:v=!1}var h,p,d,v=-1,g={currentTarget:e},y={onStart:L,onCycle:L,onComplete:L},b=X(e,function(e){return e});x(r,"String")?h=l.call(arguments,2):(y=H(y,r),r=y.name,h=x(h="args"in y?y.args:[],"Array")?h:[h],d=y.queued);if(c()!==!1){p=b[v],g.type="start",g.target=p,y.onStart.call(e,i(g));if(e.aborted&&e.constructor==s&&r=="run")g.type="cycle",y.onCycle.call(e,i(g)),g.type="complete",y.onComplete.call(e,i(g));else if(a(p))m(p,o);else while(o());}return b}function W(e,t,n){var r=[],i=(e=Object(e)).length,s=i===i>>>0;return n||(n=": "),P(e,function(e,t){r.push(s?e:t+n+e)}),r.join(t||",")}function X(e,t,n){return $(e,function(r,i,s){return r[s]=t.call(n,i,s,e),r},Array(Object(e).length>>>0))}function V(e,n){return X(e,function(e){return e==null?t:e[n]})}function $(e,t,n){var r=arguments.length<3;return j(e,function(i,s){n=r?(r=!1,i):t(n,i,s,e)}),n}function J(){var e,t=this,n=kt.resetSuite;if(t.running){e=i("abort"),t.emit(e);if(!e.cancelled||n)kt.abortSuite=!0,t.reset(),delete kt.abortSuite,n||(t.aborted=!0,z(t,"abort"))}return t}function K(e,t,r){var s=this,o=n(e,t,r),u=i({type:"add",target:o});return(s.emit(u),!u.cancelled)&&s.push(o),s}function Q(e){var t=this,n=new t.constructor(H({},t.options,e));return F(t,function(e,t){q(n,t)||(n[t]=e&&x(e.clone,"Function")?e.clone():D(e))}),n}function G(e){var t=this,n=new t.constructor;return n.push.apply(n,B(t,e)),n}function Y(){var e,t=this,n=kt.abortSuite;return t.running&&!n?(kt.resetSuite=!0,t.abort(),delete kt.resetSuite):(t.aborted||t.running)&&(t.emit(e=i("reset")),!e.cancelled)&&(t.running=!1,n||z(t,"reset")),t}function Z(e){var t=this;return t.reset(),t.running=!0,e||(e={}),z(t,{name:"run",args:e,queued:e.queued,onStart:function(e){t.emit(e)},onCycle:function(e){var n=e.target;n.error&&t.emit({type:"error",target:n}),t.emit(e),e.aborted=t.aborted},onComplete:function(e){t.running=!1,t.emit(e)}}),t}function et(e){var t,n=this,r=i(e),s=n.events,o=(arguments[0]=r,arguments);return r.currentTarget||(r.currentTarget=n),r.target||(r.target=n),delete r.result,s&&(t=q(s,r.type)&&s[r.type])&&j(t.slice(),function(e){return(r.result=e.apply(n,o))===!1&&(r.cancelled=!0),!r.aborted}),r.result}function tt(e){var t=this,n=t.events||(t.events={});return q(n,e)?n[e]:n[e]=[]}function nt(e,t){var n=this,r=n.events;return r&&P(e?e.split(" "):r,function(e,n){var i;typeof e=="string"&&(n=e,e=q(r,n)&&r[n]),e&&(t?(i=R(e,t),i>-1&&e.splice(i,1)):e.length=0)}),n}function rt(e,t){var n=this,r=n.events||(n.events={});return j(e.split(" "),function(e){(q(r,e)?r[e]:r[e]=[]).push(t)}),n}function it(){var e,t=this,n=kt.reset;if(t.running){e=i("abort"),t.emit(e);if(!e.cancelled||n)kt.abort=!0,t.reset(),delete kt.abort,Mt.timeout&&(clearTimeout(t._timerId),delete t._timerId),n||(t.aborted=!0,t.running=!1)}return t}function st(e){var t=this,n=new t.constructor(H({},t,e));return n.options=H({},t.options,e),F(t,function(e,t){q(n,t)||(n[t]=D(e))}),n}function ot(e){function t(e,t){return $(t,function(t,n){return t+(n>e?0:n<e?1:.5)},0)}function n(e,n){return $(e,function(e,r){return e+t(r,n)},0)}function r(e){return(e-f*l/2)/Rt(f*l*(f+l+1)/12)}var i,s,o=this,u=o.stats.sample,a=e.stats.sample,f=u.length,l=a.length,c=Ft(f,l),h=It(f,l),p=n(u,a),d=n(a,u),v=It(p,d);return o==e?0:f+l>30?(s=r(v),Bt(s)>1.96?s>0?-1:1:0):(i=c<5||h<3?0:Ot[c][h-3],v<=i?v==p?1:-1:0)}function ut(){var e,t,n=this,r=0,s={length:0},o={length:0};if(n.running&&!kt.abort)kt.reset=!0,n.abort(),delete kt.reset;else{e={destination:n,source:H({},n.constructor.prototype,n.options)};do F(e.source,function(t,n){var r,i=e.destination,u=i[n];if(t&&typeof t=="object"){if(x(t,"Array"))x(u,"Array")||(r=u=[]),u.length!=t.length&&(r=u=u.slice(0,t.length),u.length=t.length);else if(!u||typeof u!="object")r=u={};r&&(s[s.length++]={destination:i,key:n,value:u}),o[o.length++]={destination:u,source:t}}else t!==u&&t!=null&&!x(t,"Function")&&(s[s.length++]={destination:i,key:n,value:t})});while(e=o[r++]);s.length&&(n.emit(t=i("reset")),!t.cancelled)&&j(s,function(e){e.destination[e.key]=e.value})}return n}function at(){var e=this,t=e.error,n=e.hz,r=e.id,i=e.stats,s=i.sample.length,o=Mt.java?"+/-":"",u=e.name||(isNaN(r)?r:"<Test #"+r+">");return t?u+=": "+W(t):u+=" x "+I(n.toFixed(n<100?2:0))+" ops/sec "+o+i.rme.toFixed(2)+"% ("+s+" run"+(s==1?"":"s")+" sampled)",u}function ft(){function t(e){var t,n,r=30,i=1e3,s=_t.ns,o=[];while(r--){if(e=="us"){i=1e6;if(s.stop){s.start();while(!(t=s.microseconds()));}else{n=_t.ns();while(!(t=s()-n));}}else if(e=="ns"){i=1e9,n=s.nanoTime();while(!(t=s.nanoTime()-n));}else{n=new s;while(!(t=new s-n));}if(!(t>0)){o.push(Infinity);break}o.push(t)}return w(o)/i}function i(e){return U(e,u).replace(/\$/g,/\d+/.exec(Ct))}var s,o=n.options,u={begin:"s$=new n$",end:"r$=(new n$-s$)/1e3",uid:Ct},a=[{ns:_t.ns,res:Ft(.0015,t("ms")),unit:"ms"}];ft=function(e){var t;e instanceof r&&(t=e,e=t.benchmark);var n=e._original,u=n.fn,a=t?b(u)||"deferred":"",f=C(u),l={setup:E(n.setup,i("m$.setup()")),fn:E(u,i("f$("+a+")")),fnArg:a,teardown:E(n.teardown,i("m$.teardown()"))},c=n.compiled,h=n.count=e.count,p=Mt.decompilation||f,d=n.id,m=!l.fn&&!f,g=n.name||(typeof d=="number"?"<Test #"+d+">":d),y=_t.ns,w=0;e.minTime=n.minTime||(n.minTime=n.options.minTime=o.minTime);if(s)try{y.nanoTime()}catch(S){y=_t.ns=new s.Packages.nano}if(!c){c=n.compiled=v(i("t$"),U(i(t?'var d$=this,#{fnArg}=d$,m$=d$.benchmark._original,f$=m$.fn,su$=m$.setup,td$=m$.teardown;if(!d$.cycles){d$.fn=function(){var #{fnArg}=d$;if(typeof f$=="function"){try{#{fn}\n}catch(e$){f$(d$)}}else{#{fn}\n}};d$.teardown=function(){d$.cycles=0;if(typeof td$=="function"){try{#{teardown}\n}catch(e$){td$()}}else{#{teardown}\n}};if(typeof su$=="function"){try{#{setup}\n}catch(e$){su$()}}else{#{setup}\n};t$.start(d$);}d$.fn();return{}':'var r$,s$,m$=this,f$=m$.fn,i$=m$.count,n$=t$.ns;#{setup}\n#{begin};while(i$--){#{fn}\n}#{end};#{teardown}\nreturn{elapsed:r$,uid:"#{uid}"}'),l));try{if(m)throw new Error('The test "'+g+'" is empty. This may be the result of dead code removal.');t||(n.count=1,c=(c.call(n,_t)||{}).uid==Ct&&c,n.count=h)}catch(S){c=null,e.error=S||new Error(String(S)),n.count=h}if(p&&!c&&!t&&!m){c=v(i("t$"),U(i((e.error&&!f?"var r$,s$,m$=this,f$=m$.fn,i$=m$.count":"function f$(){#{fn}\n}var r$,s$,m$=this,i$=m$.count")+",n$=t$.ns;#{setup}\n#{begin};m$.f$=f$;while(i$--){m$.f$()}#{end};"+"delete m$.f$;#{teardown}\nreturn{elapsed:r$}"),l));try{n.count=1,c.call(n,_t),n.compiled=c,n.count=h,delete e.error}catch(S){n.count=h,e.error?c=null:(n.compiled=c,e.error=S||new Error(String(S)))}}}return e.compiled=c,e.error||(w=c.call(t||n,_t).elapsed),w},P(dt&&dt.applets||[],function(e){return!(_t.ns=s="nanoTime"in e&&e)});try{typeof _t.ns.nanoTime()=="number"&&a.push({ns:_t.ns,res:t("ns"),unit:"ns"})}catch(f){}try{(_t.ns=new(e.chrome||e.chromium).Interval)&&a.push({ns:_t.ns,res:t("us"),unit:"us"})}catch(f){}(_t.ns=(A("microtime")||{now:0}).now)&&a.push({ns:_t.ns,res:t("us"),unit:"us"}),_t=$(a,function(e,t){return t.res<e.res?t:e}),_t.unit!="ns"&&s&&(s=g(s));if(_t.res==Infinity)throw new Error("Benchmark.js was unable to find a working timer.");return _t.unit=="ns"?H(u,{begin:"s$=n$.nanoTime()",end:"r$=(n$.nanoTime()-s$)/1e9"}):_t.unit=="us"&&H(u,_t.ns.stop?{begin:"s$=n$.start()",end:"r$=n$.microseconds()/1e6"}:{begin:"s$=n$()",end:"r$=(n$()-s$)/1e6"}),_t.start=v(i("o$"),i("var n$=this.ns,#{begin};o$.elapsed=0;o$.timeStamp=s$")),_t.stop=v(i("o$"),i("var n$=this.ns,s$=o$.timeStamp,#{end};o$.elapsed=r$")),o.minTime||(o.minTime=Ft(_t.res/2/.01,.05)),ft.apply(null,arguments)}function lt(e,t){function n(t){while(t--)f.push(e.clone({_original:e,events:{abort:[r],cycle:[r],error:[r],start:[r]}}))}function r(t){var n=this,r=t.type;e.running?r=="start"?n.count=e.initCount:(r=="error"&&(e.error=n.error),r=="abort"?(e.abort(),e.emit("cycle")):(t.currentTarget=t.target=e,e.emit(t))):e.aborted&&(n.events.abort.length=0,n.abort())}function i(t){var r,i,s,c,h,p,d,v,m=t.target,g=e.aborted,y=+(new Date),b=l.push(m.times.period),E=b>=a&&(o+=y-m.times.timeStamp)/1e3>e.maxTime,S=e.times,x=function(e,t){return e+qt(t-s,2)};if(g||m.hz==Infinity)E=!(b=l.length=f.length=0);g||(s=w(l),v=$(l,x,0)/(b-1)||0,p=Rt(v),d=p/Rt(b),i=b-1,r=At[Math.round(i)||1]||At.infinity,c=d*r,h=c/s*100||0,H(e.stats,{deviation:p,mean:s,moe:c,rme:h,sem:d,variance:v}),E&&(e.initCount=u,e.running=!1,g=!0,S.elapsed=(y-S.timeStamp)/1e3),e.hz!=Infinity&&(e.hz=1/s,S.cycle=s*e.count,S.period=s)),f.length<2&&!E&&n(1),t.aborted=g}t||(t={});var s=t.async,o=0,u=e.initCount,a=e.minSamples,f=[],l=e.stats.sample;n(a),z(f,{name:"run",args:{async:s},queued:!0,onCycle:i,onComplete:function(){e.emit("complete")}})}function ct(e,t){t||(t={});var n;e instanceof r&&(n=e,e=e.benchmark);var s,o,u,a,f,l,c=t.async,h=e._original,p=e.count,d=e.times;e.running&&(o=++e.cycles,s=n?n.elapsed:ft(e),f=e.minTime,o>h.cycles&&(h.cycles=o),e.error&&(a=i("error"),a.message=e.error,e.emit(a),a.cancelled||e.abort())),e.running&&(h.times.cycle=d.cycle=s,l=h.times.period=d.period=s/p,h.hz=e.hz=1/l,h.initCount=e.initCount=p,e.running=s<f,e.running&&(!s&&(u=Lt[e.cycles])!=null&&(p=jt(4e6/u)),p<=e.count&&(p+=Math.ceil((f-s)/l)),e.running=p!=Infinity)),a=i("cycle"),e.emit(a),a.aborted&&e.abort(),e.running?(e.count=p,n?e.compiled.call(n,_t):c?m(e,function(){ct(e,t)}):ct(e)):(Mt.browser&&O(Ct+"=1;delete "+Ct),e.emit("complete"))}function ht(e){var t=this,n=i("start");return t.running=!1,t.reset(),t.running=!0,t.count=t.initCount,t.times.timeStamp=+(new Date),t.emit(n),n.cancelled||(e={async:((e=e&&e.async)==null?t.async:e)&&Mt.timeout},t._original?t.defer?r(t):ct(t,e):lt(t,e)),t}var pt=0,dt=T(e,"document")&&document,vt=typeof define=="function"&&typeof define.amd=="object"&&define.amd&&define,mt=typeof exports=="object"&&exports&&(typeof global=="object"&&global&&global==global.global&&(e=global),exports),gt=typeof require=="function"&&require,yt=Object.getOwnPropertyNames,bt=Object.getOwnPropertyDescriptor,wt={}.hasOwnProperty,Et=Object.isExtensible||function(){return!0},St={}.propertyIsEnumerable,xt=Object.defineProperty,Tt={}.toString,Nt=dt&&dt.createElement("div"),Ct="uid"+ +(new Date),kt={},Lt={1:4096,2:512,3:64,4:8,5:0},At={1:12.706,2:4.303,3:3.182,4:2.776,5:2.571,6:2.447,7:2.365,8:2.306,9:2.262,10:2.228,11:2.201,12:2.179,13:2.16,14:2.145,15:2.131,16:2.12,17:2.11,18:2.101,19:2.093,20:2.086,21:2.08,22:2.074,23:2.069,24:2.064,25:2.06,26:2.056,27:2.052,28:2.048,29:2.045,30:2.042,infinity:1.96},Ot={5:[0,1,2],6:[1,2,3,5],7:[1,3,5,6,8],8:[2,4,6,8,10,13],9:[2,4,7,10,12,15,17],10:[3,5,8,11,14,17,20,23],11:[3,6,9,13,16,19,23,26,30],12:[4,7,11,14,18,22,26,29,33,37],13:[4,8,12,16,20,24,28,33,37,41,45],14:[5,9,13,17,22,26,31,36,40,45,50,55],15:[5,10,14,19,24,29,34,39,44,49,54,59,64],16:[6,11,15,21,26,31,37,42,47,53,59,64,70,75],17:[6,11,17,22,28,34,39,45,51,57,63,67,75,81,87],18:[7,12,18,24,30,36,42,48,55,61,67,74,80,86,93,99],19:[7,13,19,25,32,38,45,52,58,65,72,78,85,92,99,106,113],20:[8,14,20,27,34,41,48,55,62,69,76,83,90,98,105,112,119,127],21:[8,15,22,29,36,43,50,58,65,73,80,88,96,103,111,119,126,134,142],22:[9,16,23,30,38,45,53,61,69,77,85,93,101,109,117,125,133,141,150,158],23:[9,17,24,32,40,48,56,64,73,81,89,98,106,115,123,132,140,149,157,166,175],24:[10,17,25,33,42,50,59,67,76,85,94,102,111,120,129,138,147,156,165,174,183,192],25:[10,18,27,35,44,53,62,71,80,89,98,107,117,126,135,145,154,163,173,182,192,201,211],26:[11,19,28,37,46,55,64,74,83,93,102,112,122,132,141,151,161,171,181,191,200,210,220,230],27:[11,20,29,38,48,57,67,77,87,97,107,118,125,138,147,158,168,178,188,199,209,219,230,240,250],28:[12,21,30,40,50,60,70,80,90,101,111,122,132,143,154,164,175,186,196,207,218,228,239,250,261,272],29:[13,22,32,42,52,62,73,83,94,105,116,127,138,149,160,171,182,193,204,215,226,238,249,260,271,282,294],30:[13,23,33,43,54,65,76,87,98,109,120,131,143,154,166,177,189,200,212,223,235,247,258,270,282,293,305,317]},Mt={};(function(){Mt.air=x(e.runtime,"ScriptBridgingProxyObject"),Mt.argumentsClass=x(arguments,"Arguments"),Mt.browser=dt&&T(e,"navigator"),Mt.charByIndex="x"[0]+Object("x")[0]=="xx",Mt.charByOwnIndex=Mt.charByIndex&&q("x","0"),Mt.java=x(e.java,"JavaPackage"),Mt.timeout=T(e,"setTimeout")&&T(e,"clearTimeout");try{Mt.decompilation=
Function("return ("+function(e){return{x:""+(1+e)+"",y:0}}+")")()(0).x==="1"}catch(t){Mt.decompilation=!1}try{var n={};Mt.descriptors=(xt(n,n,n),"value"in bt(n,n))}catch(t){Mt.descriptors=!1}try{Mt.getAllKeys=/\bvalueOf\b/.test(yt(Object.prototype))}catch(t){Mt.getAllKeys=!1}})();var _t={ns:Date,start:null,stop:null},Dt=!Mt.argumentsClass,Pt=!Mt.charByIndex,Ht=!Mt.charByOwnIndex,Bt=Math.abs,jt=Math.floor,Ft=Math.max,It=Math.min,qt=Math.pow,Rt=Math.sqrt;H(n,{options:{async:!1,defer:!1,delay:.005,id:t,initCount:1,maxTime:5,minSamples:5,minTime:0,name:t,onAbort:t,onComplete:t,onCycle:t,onError:t,onReset:t,onStart:t},platform:A("platform")||e.platform||{description:e.navigator&&navigator.userAgent||null,layout:null,product:null,name:null,manufacturer:null,os:null,prerelease:null,version:null,toString:function(){return this.description||""}},version:"1.0.0-pre",support:Mt,deepClone:D,each:P,extend:H,filter:B,forEach:j,forOwn:F,formatNumber:I,hasKey:(q(n,""),q),indexOf:R,interpolate:U,invoke:z,join:W,map:X,pluck:V,reduce:$}),H(n.prototype,{count:0,cycles:0,hz:0,compiled:t,error:t,fn:t,aborted:!1,running:!1,setup:L,teardown:L,stats:{moe:0,rme:0,sem:0,deviation:0,mean:0,sample:[],variance:0},times:{cycle:0,elapsed:0,period:0,timeStamp:0},abort:it,clone:st,compare:ot,emit:et,listeners:tt,off:nt,on:rt,reset:ut,run:ht,toString:at}),H(r.prototype,{benchmark:null,cycles:0,elapsed:0,timeStamp:0,resolve:_}),H(i.prototype,{aborted:!1,cancelled:!1,currentTarget:t,result:t,target:t,timeStamp:0,type:""}),s.options={name:t},H(s.prototype,{length:0,aborted:!1,running:!1,forEach:k(j),indexOf:k(R),invoke:k(z),join:[].join,map:k(X),pluck:k(V),pop:[].pop,push:[].push,sort:[].sort,reduce:k($),abort:J,add:K,clone:Q,emit:et,filter:G,listeners:tt,off:nt,on:rt,reset:Y,run:Z,concat:o,reverse:a,shift:f,slice:l,splice:c,unshift:p}),H(n,{Deferred:r,Event:i,Suite:s}),mt?typeof module=="object"&&module&&module.exports==mt?(module.exports=n).Benchmark=n:mt.Benchmark=n:vt?define("benchmark",function(){return n}):e.Benchmark=n,Mt.air&&ft({_original:{fn:L,count:1,options:{}}})}(this),function(){var e,t;e=5,t=null,Jax.Controller.create("benchmark",{index:function(){return t=document.getElementById("benchmark-log")||function(){var e;return e=document.createElement("div"),e.setAttribute("id","benchmark-log"),$(e).css("font-family","monospace"),document.body.appendChild(e),$(e)}(),this.benchmark_complete()},instantiation:function(){var e,n;return e=this,n=new Benchmark.Suite,n.add("Jax.Mesh.Cube (new)",function(){return(new Jax.Mesh.Cube).data.vertexBuffer}),n.on("cycle",function(e,n){return t.html((t.html()||"")+("<p>Instantiation - "+e.target+"</p>"))}),n.on("complete",function(){return t.html((t.html()||"")+("<p>Instantiation - Fastest is "+this.filter("fastest").pluck("name")+"</p>")),e.rendering()}),n.run({async:!0})},rendering:function(){var e,n,r,i,s=this;return r=this,i=new Benchmark.Suite,e=new Jax.Model,n=new Jax.Mesh.Cube,n.data.vertexBuffer,i.add("Jax.Mesh.Cube (new)",function(){return n.render(s.context,e)}),i.on("cycle",function(e,n){return t.html((t.html()||"")+("<p>Rendering - "+e.target+"</p>"))}),r=this,i.on("complete",function(){return t.html((t.html()||"")+("<p>Rendering - Fastest is "+this.filter("fastest").pluck("name")+"</p>")),r.benchmark_complete()}),i.run({async:!0})},update:function(t){var n,r,i;return t*=.5,this._rotation||(this._rotation=0),this._rotation+=t,r=this._position||(this._position=vec3.create()),n=this._origin||(this._origin=vec3.create()),i=e/2+1,r[0]=Math.cos(this._rotation)*i,r[1]=0,r[2]=Math.sin(this._rotation)*i,this.context.player.camera.lookAt(n,r)},benchmark_complete:function(){var t,n,r,i,s,o,u;i=e,r=0,this.world.addLight(new Jax.Light.Directional),this.player.camera.position=[0,0,10];for(t=s=0;0<=i?s<=i:s>=i;t=0<=i?++s:--s)for(n=o=0;0<=i?o<=i:o>=i;n=0<=i?++o:--o)for(r=u=0;0<=i?u<=i:u>=i;r=0<=i?++u:--u)this.world.addObject(new Jax.Model({position:[t-2.5,n-2.5,r-2.5],castShadow:!1,mesh:new Jax.Mesh.Sphere({radius:.25,color:[1,1,1,1],material:new Jax.Material.Surface({intensity:{diffuse:1.25},color:{diffuse:[t/i,n/i,r/i,1]}})})}));return this.world.addObject(new Jax.Framerate({ema:!1}))}})}.call(this),function(){Jax.Controller.create("cones",{update:function(e){var t,n,r,i;n=this.world.getObjects();for(r=0,i=n.length;r<i;r++)t=n[r],t.camera.yaw(e*.4);return null},index:function(){return this.world.ambientColor="#fff",this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Cone({sides:3,size:.5,material:new Jax.Material.Wire}),position:[-1,0,-3]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Cone({sides:4,size:.5,material:new Jax.Material.Wire}),position:[0,0,-3]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Cone({sides:8,size:.5,material:new Jax.Material.Wire}),position:[1,0,-3]}))}})}.call(this),function(){var e,t;t={forward:0,backward:0,left:0,right:0},e=Math.sqrt(2)/2,Jax.Controller.create("lighting",{index:function(){return this.world.addObject(new Jax.Framerate),this.teapot=this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Teapot({size:10}),position:[0,0,-25]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Quad({size:75}),position:[0,-15,-50],castShadow:!1})),this.spot=this.world.addLight(new Jax.Light.Spot({position:[0,0,30],direction:[0,0,-1],attenuation:{constant:0,linear:.04,quadratic:0},spotExponent:1,innerSpotAngle:Math.PI/8.75,outerSpotAngle:Math.PI/8,color:{ambient:[0,0,0,1],diffuse:[1,1,1,1],specular:[1,1,1,1]}})),this.point=this.world.addLight(new Jax.Light.Point({attenuation:{constant:0,linear:0,quadratic:.00175},color:{ambient:[0,0,0,1],diffuse:[1,0,0,1],specular:[1,0,0,1]},position:[-20,0,0],direction:[20,0,-25]})),this.directional=this.world.addLight(new Jax.Light.Directional({direction:[-1,-1,-1],attenuation:{constant:1,linear:0,quadratic:0},color:{ambient:[0,0,0,1],diffuse:[0,0,1,1],specular:[0,0,1,1]}})),this.context.activeCamera.position=[0,15,50],this.context.activeCamera.lookAt([0,0,0])},mouse_dragged:function(e){var t;return t=this.teapot.camera.position,t[0]+=e.diffx*.1,t[2]+=e.diffy*.1,this.teapot.camera.position=t},update:function(t){var n,r,i,s;if(!(i=this.spot))return;return r=Math.PI/4,n=this.rotationPerSecond||r,s=i.direction,s[0]>e?this.rotationPerSecond=r:s[0]<-e&&(this.rotationPerSecond=-r),i.rotate(n*t,0,1,0)}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Controller.create("noise",{index:function(){var e,n;return Jax.Material.Layer.T=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.shaderSource={fragment:"uniform float time;\n\nvoid main(void) {\n  float n = snoise(vec4(gl_FragCoord.xyz * 0.025, time)) * 0.5 + 0.5;\n  gl_FragColor = vec4(n, n, n, 1.0);\n}"},n.prototype.setVariables=function(e,t,n,r,i){return r.time=e.uptime},n}(Jax.Material.Layer),e=new Jax.Material.Surface({layers:[{type:"Noise"},{type:"T"}]}),n=new Jax.Mesh.Cube({material:e}),this.world.addObject(new Jax.Framerate({ema:!1})),this.world.addObject(new Jax.Model({position:[0,0,-3],mesh:n,update:function(e){return this.camera.rotate(e*.25,1,.75,.5)}}))}})}.call(this),function(){Jax.Controller.create("octree",{mouse_dragged:function(e){return this._cam.yaw(.1*e.diffx),this._cam.frustum},key_pressed:function(e){return this._other?(this.context.activeCamera=this._other,this._other=null):(this._other=this.context.activeCamera,this.context.activeCamera=this._cam)},update:function(e){var t,n,r,i;i=this.octree.nestedObjects;for(t in i)n=i[t],n.rot+=e*.75,r=n.position,r[0]=Math.sin(n.rot)*n.radius,r[2]=Math.cos(n.rot)*n.radius,n.camera.position=r,this.octree.update(n);return!0},index:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=this;this.world.addObject(new Jax.Framerate),this.world.ambientColor=[1,1,1,1],this.octree=u=new Jax.Octree(1,-1),p=0,l=[-2,-1,0,1,2];for(g=0,w=l.length;g<w;g++){d=l[g];for(y=0,E=l.length;y<E;y++){v=l[y];for(m=b=-1;b<=1;m=++b)p+=Math.PI*2/12.5,f=Math.sqrt(d*d+v*v)*4,a=[Math.sin(p)*f,m*2,Math.cos(p)*f],u.add(new Jax.Model({rot:p,radius:f,position:a,mesh:new Jax.Mesh.Sphere({radius:.25+(Math.random()*.25-.125),slices:8,stacks:8,color:[Math.abs(d)/2,Math.abs(v)/2,1,1]})}))}}return this.world.addObject(new Jax.Model({position:[0,0,4.5],mesh:new Jax.Mesh.Cube({size:.25,color:"#fff"})})),this._cam=t=new Jax.Camera,t.perspective({near:1,far:10,width:this.context.canvas.width,height:this.context.canvas.height}),t.position=[0,0,4.5],this.world.addObject(t.frustum),n=this.context,r=i=null,o=s=0,c=h=null,e=function(e){var n,r,i,u;s++,i=e.size;switch(t.frustum.cube(e.position,i,i,i)){case Jax.Frustum.OUTSIDE:return!1;default:e.objectCount&&e.mesh.render(c,S,h),u=e.objects;for(n in u)r=u[n],o++,r.render(c,h);return!0}},this.world.addObject(new Jax.Model({render:function(n,a){c=n,h=a,o=0,s=0,u.traverse(t.position,e);if(i===null||i>o)i=o;if(r===null||r<o)r=o;return $("#jax-banner").html("Objects rendered: "+o+"; nodes traversed: "+s+"; records: ["+i+", "+r+"]")}})),this.context.activeCamera.ortho({near:1,far:250,left:-10,right:10,top:10,bottom:-10}),this.context.activeCamera.lookAt([0,0,0],[0,27,0])}})}.call(this),function(){Jax.Controller.create("oz3d-normal",{update:function(e){return this.rot=(this.rot||(this.rot=0))+e,this.obj.camera.yaw(e*.1)},mouse_dragged:function(e){var t;return t=this.light.position,t[0]+=e.diffx*.1,t[2]+=e.diffy*.1,this.light.position=t,this.lighto.position=t},key_pressed:function(e){return this.useSpecular=!this.useSpecular,this.obj.mesh.material.findLayer(Jax.Material.Layer.NormalMap).specularChannel=this.useSpecular},index:function(){var e,t,n;return this.useSpecular=!0,console.log("Normal mapping test:"),console.log("  Drag mouse to move light source."),console.log(""),console.log("  Normal map's alpha channel contains a specular map."),console.log("  Specular map is enabled by default. Press any key to toggle."),console.log("  When enabled, the mortar between bricks should have 0 specular."),this.activeCamera.position=[32,-13.52,55.4],this.activeCamera.direction=[-0.65,.2,-0.73],e=[10,-10,45],this.light=this.world.addLight(new Jax.Light.Point({shadows:!1,attenuation:{constant:1,linear:0,quadratic:0},position:e,color:{ambient:[.2,.2,.2,1],diffuse:[.9,.9,.9,1],specular:[.9,.6,.6,1]}})),this.lighto=this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Sphere({slices:6,stacks:6,radius:.5,material:new Jax.Material.Surface({color:"#fff",intensity:100})}),position:e})),t=new Jax.Material.Surface({shininess:20,color:{ambient:[.6,.6,.6,1],diffuse:[.6,.6,.6,1],specular:[1,.9,.9,1]},normalMaps:[{path:"/textures/oz3d_normal_and_specular_map.png",min_filter:GL_NEAREST,mag_filter:GL_NEAREST,specularChannel:!0,scale:4}]}),this.obj=n=this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Sphere({material:t,slices:20,stacks:20,radius:40}),position:[0,0,0]})),n.camera.pitch(Math.PI/2)}})}.call(this),function(){var e;e={forward:0,backward:0,left:0,right:0},Jax.Controller.create("oz3d",{update:function(e){var t,n,r;return r=.15*e,this._rotation=(this._rotation||0)-r,t=this._pos=this._pos||vec3.create(),n=Math.sqrt(850),t[0]=Math.sin(this._rotation)*n,t[1]=20,t[2]=Math.cos(this._rotation)*n,this.context.activeCamera.position=t,this.context.activeCamera.lookAt([0,4.5,0])},mouse_dragged:function(e){this.light.camera.move(e.diffy/100,[0,1,0]),this.light.camera.move(e.diffx/100,[0,0,1]);if(!(this.light instanceof Jax.Light.Directional))return this.lighto.camera.position=this.light.camera.position},key_released:function(e){this.world.lights.length=0;switch(++this.lightType%3){case 0:this.light=new Jax.Light.Point(this.lightOptions);break;case 1:this.light=new Jax.Light.Directional(this.lightOptions);break;case 2:this.light=new Jax.Light.Spot(this.lightOptions)}return this.world.addLight(this.light)},index:function(){return this.world.addObject(new Jax.Framerate({ema:!1})),this.world.ambientColor=[.1,.1,.1,1],this.lightType=1,this.lightOptions={attenuation:{linear:.25},position:[0,15,10],color:{ambient:[0,0,0,1],diffuse:[1,1,1,1],specular:[1,1,1,1]}},this.light_mat=new Jax.Material.Surface({shininess:0,intensity:{ambient:100}}),this.lighto=this.world.addObject(new Jax.Model({position:this.lightOptions.position,castShadow:!1,receiveShadow:!1,illuminated:!1,mesh:new Jax.Mesh.Sphere({radius:.2,material:this.light_mat})})),this.lighto.camera.lookAt([0,0,-3]),this.lightOptions.direction=this.lighto.camera.getViewVector(),this.light=this.world.addLight(new Jax.Light.Directional(this.lightOptions)),this.context.activeCamera.position=[-15,20,25],this.context.activeCamera.direction=[.55,-0.5,-1],this.floor_mat=new Jax.Material.Surface({shininess:60,color:{diffuse:[.4,.9,.4,1],specular:[.4,.4,.4,1]}}),this.torus_mat=new Jax.Material.Surface({shininess:60,color:{diffuse:[1,.5,.5,1],specular:[.6,.6,.6,1]}}),this.sphere_mat=new Jax.Material.Surface({shininess:60,color:{diffuse:[.5,.5,.9,1],specular:[.4,.4,.4,1]}}),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Plane({size:50,segments:20,material:this.floor_mat}),castShadow:!1,direction:[0,1,0]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Torus({outer_radius:5,inner_radius:1.5,material:this.torus_mat}),position:[-7,5,0],direction:[0,1,0]})),this.world.addObject(new Jax.Model({mesh:new Jax.Mesh.Sphere({radius:4,stacks:40,slices:40,material:this.sphere_mat}),position:[7,4,0]}))}})}.call(this),function(){Jax.Controller.create("wire",{index:function(){var e;return e=new Jax.Mesh.Teapot({material:new Jax.Material.Wire}),this.point=this.world.addLight(new Jax.Light.Point({shadows:!1,attenuation:{constant:0,linear:0,quadratic:.00175},color:{ambient:[0,0,0,1],diffuse:[1,0,0,1],specular:[1,0,0,1]},position:[-20,0,0],direction:[20,0,-25]})),this.world.addLight(new Jax.Light.Directional({shadows:!1,direction:[-1,-1,-1]})),this.world.addObject(new Jax.Framerate({ema:!1})),this.world.addObject(new Jax.Model({position:[0,0,-3],mesh:e,update:function(e){return this.camera.rotate(e*.25,1,.75,.5)}}))}})}.call(this),function(){Jax.views.push("ssao/index",function(){var e;return this.fb||(this.fb=new Jax.Framebuffer({width:1024,height:1024,color:GL_RGBA,depth:!0})),this.fb.bind(this.context),this.fb.viewport(this.context),this.context.gl.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),this.world.render(),this.fb.unbind(this.context),this.context.viewport(),this.context.gl.clear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),this.quad||(this.quad=new Jax.Model({mesh:new Jax.Mesh.Quad,position:[0,0,-0.2]})),e=Jax.Material.find("ssao"),e.findLayer(Jax.Material.Layer.SSAO).input=this.fb.getDepthTexture(this.context),e.render(this.context,this.quad.mesh,this.quad)})}.call(this),Jax.shader_data("lib").lights="#define MAX_LIGHTS 1\n\nshared uniform vec4 LightDiffuseColor;\nshared uniform vec3 EyeSpaceLightDirection;\nshared uniform vec3 EyeSpaceLightPosition;\nshared uniform int LightType;\nshared uniform float LightSpotInnerCos;\nshared uniform float LightSpotOuterCos;\nshared uniform vec4 LightSpecularColor;\n",Jax.shader_data("attenuation").fragment='<%= Jax.import_shader_code("lib", "lights") %>\n\nshared uniform int PASS;\nshared uniform float ConstantAttenuation;\nshared uniform float LinearAttenuation;\nshared uniform float QuadraticAttenuation;\n\nvoid main(void) {\n  if (PASS != 0) {\n    cache(float, LightDistanceFromSurface) { LightDistanceFromSurface = 1.0; }\n\n    float multiplier = 1.0;\n    import(AttenuationMultiplier, multiplier *= AttenuationMultiplier);\n\n    // the SkipAttenuation stuff will be optimized out by the compiler since it will\n    // be essentially become a set of constant expressions\n    int skipAttenuation = 0;\n    import(SkipAttenuation, skipAttenuation += SkipAttenuation);\n  \n    if (skipAttenuation == 0)\n      gl_FragColor.rgb *= multiplier / (ConstantAttenuation +\n                                 LinearAttenuation * LightDistanceFromSurface +\n                                 QuadraticAttenuation * pow(LightDistanceFromSurface, 2.0));\n  }\n}\n',function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Attenuation=function(e){function n(e){n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.numPasses=function(e){return e.world.lights.length+1},n.prototype.setVariables=function(e,t,n,r,i){var s;r.PASS=i;if(!i)return;return s=e.world.lights[i-1],r.ConstantAttenuation=s.attenuation.constant,r.LinearAttenuation=s.attenuation.linear,r.QuadraticAttenuation=s.attenuation.quadratic},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("clamp_color").fragment="void main(void) { gl_FragColor = clamp(gl_FragColor, 0.0, 1.0); }\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.ClampColor=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Jax.Material.Layer)}.call(this),Jax.shader_data("depthmap").common="shared uniform mat4 pMatrix;\n",Jax.shader_data("functions").depth_map="vec4 pack_depth(in float depth)\n{\n  vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n  vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n  vec4 res = fract(depth * bit_shift);\n  res -= res.xxyz * bit_mask;\n  return res;\n}\n\nfloat unpack_depth(in vec4 rgba_depth)\n{\n  vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  float depth = dot(rgba_depth, bit_shift);\n  return depth;\n}\n",Jax.shader_data("depthmap").fragment='<%= Jax.import_shader_code("functions", "depth_map") %>\n\nvoid main(void) {\n  vec4 pos = gl_FragCoord;\n  gl_FragColor = pack_depth(pos.z);\n}\n',function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Depthmap=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){if(!n.castShadow)return!1},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("fog").common="const float LOG2 = 1.442695;\n\nuniform vec4 FogColor;\nuniform int Algorithm;\nuniform float Scale;\nuniform float End;\nuniform float Start;\nuniform float Density;\n\nvarying float vDistance;\n\nshared uniform mat4 ModelViewProjectionMatrix;\n",Jax.shader_data("fog").fragment="void main() {\n  /*\n  I used to use gl_FragCoord.z / gl_FragCoord.w but noted that\n  at least on my machine, it didn't interpolate cleanly; I don't\n  know how best to define the issue but it seemed at first similar\n  to a contrast or gamma issue. Switching to my own varying fixes\n  the issue.\n  */\n  \n  float fog;\n\n  if (Algorithm == <%= Jax.LINEAR %>) {\n    fog = smoothstep(Start, End, vDistance);\n  } else if (Algorithm == <%= Jax.EXPONENTIAL %>) {\n    fog = exp(-Density * vDistance);\n    fog = 1.0 - clamp(fog, 0.0, 1.0);\n  } else if (Algorithm == <%= Jax.EXP2 %>) {\n    fog = exp2(-Density * Density * vDistance * vDistance * LOG2);\n    fog = 1.0 - clamp(fog, 0.0, 1.0);\n  }\n  \n  gl_FragColor.rgb = mix(gl_FragColor.rgb, FogColor.rgb, fog);\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.LINEAR=1,Jax.EXPONENTIAL=2,Jax.EXP2=3,Jax.Material.Layer.Fog=function(e){function n(e){e||(e={}),this.start=e.start,this.end=e.end,this.density=e.density||.0025,this.algorithm=e.algorithm||Jax.EXP2,this.color=e.color||Jax.Color.parse("#fff"),this.color=Jax.Util.colorize(this.color),this._positionMap={position:"VERTEX_POSITION"},n.__super__.constructor.call(this,e);switch(this.algorithm){case Jax.LINEAR:case Jax.EXPONENTIAL:case Jax.EXP2:break;case"LINEAR":case"EXPONENTIAL":case"EXP2":e.algorithm=Jax[e.algorithm];break;default:throw new Error("Jax: Fog algorithm must be one of LINEAR, EXPONENTIAL, or EXP2")}}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){var s,o;return this.start?r.Start=this.start:r.Start=((s=e.activeCamera.projection)!=null?s.near:void 0)||.1,this.end?r.End=this.end:r.End=((o=e.activeCamera.projection)!=null?o.far:void 0)||200,r.Scale=1/(r.End-r.Start),r.Algorithm=this.algorithm,r.Density=this.density,r.FogColor=this.color,r.ModelViewProjectionMatrix=e.matrix_stack.getModelViewProjectionMatrix(),t.data.set(this._positionMap)},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("fog").vertex="shared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  vDistance = (ModelViewProjectionMatrix * VERTEX_POSITION).z;\n}\n",Jax.shader_data("functions").lights="/* see http://jax.thoughtsincomputation.com/2011/05/webgl-apps-crashing-on-windows-7/ */\n//const struct LightSource {\n//  int enabled;\n//  int type;\n//  vec3 position; // in world space\n//  vec3 direction; // in world space\n//  vec4 ambient, diffuse, specular;\n//  float constant_attenuation, linear_attenuation, quadratic_attenuation;\n//  float spotExponent, spotCosCutoff;\n//};\n\nshared uniform bool LIGHT_ENABLED;\nshared uniform int LIGHT_TYPE;\nshared uniform vec3 LIGHT_POSITION, LIGHT_DIRECTION;\nshared uniform vec4 LIGHT_AMBIENT, LIGHT_DIFFUSE, LIGHT_SPECULAR;\nshared uniform float LIGHT_ATTENUATION_CONSTANT, LIGHT_ATTENUATION_LINEAR, LIGHT_ATTENUATION_QUADRATIC,\n                     LIGHT_SPOT_EXPONENT, LIGHT_SPOT_COS_CUTOFF;\n\nfloat calcAttenuation(in vec3 ecPosition3,\n                      out vec3 lightDirection)\n{\n//  lightDirection = vec3(vnMatrix * -light.position) - ecPosition3;\n  lightDirection = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  float d = length(lightDirection);\n  \n  return 1.0 / (LIGHT_ATTENUATION_CONSTANT + LIGHT_ATTENUATION_LINEAR * d + LIGHT_ATTENUATION_QUADRATIC * d * d);\n}\n\nvoid DirectionalLight(in vec3 normal,\n                      inout vec4 ambient,\n                      inout vec4 diffuse,\n                      inout vec4 specular)\n{\n  vec3 nLDir = normalize(vnMatrix * -normalize(LIGHT_DIRECTION));\n  vec3 halfVector = normalize(nLDir + vec3(0,0,1));\n  float pf;\n    \n  float NdotD  = max(0.0, dot(normal, nLDir));\n  float NdotHV = max(0.0, dot(normal, halfVector));\n    \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n    \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\n/* Use when attenuation != (1,0,0) */\nvoid PointLightWithAttenuation(in vec3 ecPosition3,\n                               in vec3 normal,\n                               inout vec4 ambient,\n                               inout vec4 diffuse,\n                               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n\n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n\n/* Use for better performance when attenuation == (1,0,0) */\nvoid PointLightWithoutAttenuation(in vec3 ecPosition3,\n                                  in vec3 normal,\n                                  inout vec4 ambient,\n                                  inout vec4 diffuse,\n                                  inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float d;     // distance from surface to light source\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  VP = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  d = length(VP);\n  VP = normalize(VP);\n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\nvoid SpotLight(in vec3 ecPosition3,\n               in vec3 normal,\n               inout vec4 ambient,\n               inout vec4 diffuse,\n               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  float spotDot; // cosine of angle between spotlight\n  float spotAttenuation; // spotlight attenuation factor\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  // See if point on surface is inside cone of illumination\n  spotDot = dot(-VP, normalize(vnMatrix*LIGHT_DIRECTION));\n  if (spotDot < LIGHT_SPOT_COS_CUTOFF)\n    spotAttenuation = 0.0;\n  else spotAttenuation = pow(spotDot, LIGHT_SPOT_EXPONENT);\n  \n  attenuation *= spotAttenuation;\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n",Jax.shader_data("functions").noise="/**\n * Classic and 'improved' (simplex) Perlin noise.\n *\n * This implementation attempts to use texture-based lookups if the client\n * hardware can support it. This is no problem in fragment shaders but can\n * be an issue in vertex shaders, where VTL is not supported by about 20%\n * of clients.\n *\n * In the event this is a vertex shader *and* the client doesn't support\n * VTL, the functions will fall back to 'ashima' noise\n * (https://github.com/ashima/webgl-noise) for a slower, non-texture-based\n * implementation.\n **/\n\n \n<% if (shaderType != 'vertex' || maxVertexTextureImageUnits > 0) { %>\n  /*\n   * Author: Stefan Gustavson (stegu@itn.liu.se) 2004, 2005, 2012\n   * Stefan's original implementation: http://www.itn.liu.se/~stegu/simplexnoise/\n   */\n\n\n  /*\n   * 2D, 3D and 4D Perlin noise, classic and simplex, in a GLSL fragment shader.\n   *\n   * Classic noise is implemented by the functions:\n   * float noise(vec2 P)\n   * float noise(vec3 P)\n   * float noise(vec4 P)\n   *\n   * Simplex noise is implemented by the functions:\n   * float snoise(vec2 P)\n   * float snoise(vec3 P)\n   * float snoise(vec4 P)\n   *\n   * Author: Stefan Gustavson ITN-LiTH (stegu@itn.liu.se) 2004-12-05\n   * Simplex indexing functions by Bill Licea-Kane, ATI (bill@ati.com)\n   * Modified to use same texture for 2D, 3D and 4D 2012-03-27.\n   *\n   * You may use, modify and redistribute this code free of charge,\n   * provided that the author's names and this notice appear intact.\n   */\n\n  /*\n   * The value of classic 4D noise goes above 1.0 and below -1.0 at some\n   * points. Not much and only very sparsely, but it happens. This is a\n   * long standing bug from Perlin's original software implementation,\n   * so I left it untouched.\n   */\n\n\n  /*\n   * \"gradTexture\" is a 256x256 RGBA texture that is used for both the\n   * permutations, encoded in A, and the 2D, 3D and 4D gradients,\n   * encoded in RGB with x in R, y in B and z and w combined in B.\n   * For details, see the main C program.\n   */\n  shared uniform sampler2D gradTexture;\n\n  /*\n   * To create offsets of one texel and one half texel in the\n   * texture lookup, we need to know the texture image size.\n   */\n  #define ONE 0.00390625\n  #define ONEHALF 0.001953125\n  // The numbers above are 1/256 and 0.5/256, change accordingly\n  // if you change the code to use another texture size.\n\n\n  /*\n   * The interpolation function for classic noise. This could be a 1D texture\n   * lookup to possibly gain some speed, but it's not the main part of the\n   * algorithm, and the texture bandwidth is pretty choked up as it is.\n   */\n  shared float fade(float t) {\n    // return t*t*(3.0-2.0*t); // Old fade, yields discontinuous second derivative\n    return t*t*t*(t*(t*6.0-15.0)+10.0); // Improved fade, yields C2-continuous noise\n  }\n\n  /*\n   * Efficient simplex indexing functions by Bill Licea-Kane, ATI. Thanks!\n   * (This was originally implemented as a 1D texture lookup. Nice to avoid that.)\n   */\n  shared void simplex( const in vec3 P, out vec3 offset1, out vec3 offset2 )\n  {\n    vec3 offset0;\n \n    vec2 isX = step( P.yz, P.xx ); // P.x >= P.y ? 1.0 : 0.0;  P.x >= P.z ? 1.0 : 0.0;\n    offset0.x  = isX.x + isX.y;    // Accumulate all P.x >= other channels in offset.x\n    offset0.yz = 1.0 - isX;        // Accumulate all P.x <  other channels in offset.yz\n\n    float isY = step( P.z, P.y );  // P.y >= P.z ? 1.0 : 0.0;\n    offset0.y += isY;              // Accumulate P.y >= P.z in offset.y\n    offset0.z += 1.0 - isY;        // Accumulate P.y <  P.z in offset.z\n \n    // offset0 now contains the unique values 0,1,2 in each channel\n    // 2 for the channel greater than other channels\n    // 1 for the channel that is less than one but greater than another\n    // 0 for the channel less than other channels\n    // Equality ties are broken in favor of first x, then y\n    // (z always loses ties)\n\n    offset2 = clamp( offset0, 0.0, 1.0 );\n    // offset2 contains 1 in each channel that was 1 or 2\n    offset1 = clamp( offset0-1.0, 0.0, 1.0 );\n    // offset1 contains 1 in the single channel that was 1\n  }\n\n  shared void simplex( const in vec4 P, out vec4 offset1, out vec4 offset2, out vec4 offset3 )\n  {\n    vec4 offset0;\n \n    vec3 isX = step( P.yzw, P.xxx );        // See comments in 3D simplex function\n    offset0.x = isX.x + isX.y + isX.z;\n    offset0.yzw = 1.0 - isX;\n\n    vec2 isY = step( P.zw, P.yy );\n    offset0.y += isY.x + isY.y;\n    offset0.zw += 1.0 - isY;\n \n    float isZ = step( P.w, P.z );\n    offset0.z += isZ;\n    offset0.w += 1.0 - isZ;\n\n    // offset0 now contains the unique values 0,1,2,3 in each channel\n\n    offset3 = clamp( offset0, 0.0, 1.0 );\n    offset2 = clamp( offset0-1.0, 0.0, 1.0 );\n    offset1 = clamp( offset0-2.0, 0.0, 1.0 );\n  }\n\n\n  /*\n   * 2D classic Perlin noise. Fast, but less useful than 3D noise.\n   */\n  shared float noise(vec2 P)\n  {\n    vec2 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled and offset for texture lookup\n    vec2 Pf = fract(P);             // Fractional part for interpolation\n\n    // Noise contribution from lower left corner\n    vec2 grad00 = texture2D(gradTexture, Pi).rg * 4.0 - 2.0;\n    float n00 = dot(grad00, Pf);\n\n    // Noise contribution from lower right corner\n    vec2 grad10 = texture2D(gradTexture, Pi + vec2(ONE, 0.0)).rg * 4.0 - 2.0;\n    float n10 = dot(grad10, Pf - vec2(1.0, 0.0));\n\n    // Noise contribution from upper left corner\n    vec2 grad01 = texture2D(gradTexture, Pi + vec2(0.0, ONE)).rg * 4.0 - 2.0;\n    float n01 = dot(grad01, Pf - vec2(0.0, 1.0));\n\n    // Noise contribution from upper right corner\n    vec2 grad11 = texture2D(gradTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 2.0;\n    float n11 = dot(grad11, Pf - vec2(1.0, 1.0));\n\n    // Blend contributions along x\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade(Pf.x));\n\n    // Blend contributions along y\n    float n_xy = mix(n_x.x, n_x.y, fade(Pf.y));\n\n    // We're done, return the final noise value.\n    return 1.7 * n_xy;\n  }\n\n\n  /*\n   * 3D classic noise. Slower, but a lot more useful than 2D noise.\n   */\n  shared float noise(vec3 P)\n  {\n    vec3 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                    // and offset 1/2 texel to sample texel centers\n    vec3 Pf = fract(P);     // Fractional part for interpolation\n\n    // Noise contributions from (x=0, y=0), z=0 and z=1\n    float perm00 = texture2D(gradTexture, Pi.xy).a ;\n    vec3  grad000 = texture2D(gradTexture, vec2(perm00, Pi.z)).rgb * 4.0 - 2.0;\n    grad000.z = floor(grad000.z); // Remove small variations due to w\n    float n000 = dot(grad000, Pf);\n    vec3  grad001 = texture2D(gradTexture, vec2(perm00, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad001.z = floor(grad001.z); // Remove small variations due to w\n    float n001 = dot(grad001, Pf - vec3(0.0, 0.0, 1.0));\n\n    // Noise contributions from (x=0, y=1), z=0 and z=1\n    float perm01 = texture2D(gradTexture, Pi.xy + vec2(0.0, ONE)).a ;\n    vec3  grad010 = texture2D(gradTexture, vec2(perm01, Pi.z)).rgb * 4.0 - 2.0;\n    grad010.z = floor(grad010.z); // Remove small variations due to w\n    float n010 = dot(grad010, Pf - vec3(0.0, 1.0, 0.0));\n    vec3  grad011 = texture2D(gradTexture, vec2(perm01, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad011.z = floor(grad011.z); // Remove small variations due to w\n    float n011 = dot(grad011, Pf - vec3(0.0, 1.0, 1.0));\n\n    // Noise contributions from (x=1, y=0), z=0 and z=1\n    float perm10 = texture2D(gradTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n    vec3  grad100 = texture2D(gradTexture, vec2(perm10, Pi.z)).rgb * 4.0 - 2.0;\n    grad100.z = floor(grad100.z); // Remove small variations due to w\n    float n100 = dot(grad100, Pf - vec3(1.0, 0.0, 0.0));\n    vec3  grad101 = texture2D(gradTexture, vec2(perm10, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad101.z = floor(grad101.z); // Remove small variations due to w\n    float n101 = dot(grad101, Pf - vec3(1.0, 0.0, 1.0));\n\n    // Noise contributions from (x=1, y=1), z=0 and z=1\n    float perm11 = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a ;\n    vec3  grad110 = texture2D(gradTexture, vec2(perm11, Pi.z)).rgb * 4.0 - 2.0;\n    grad110.z = floor(grad110.z); // Remove small variations due to w\n    float n110 = dot(grad110, Pf - vec3(1.0, 1.0, 0.0));\n    vec3  grad111 = texture2D(gradTexture, vec2(perm11, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad111.z = floor(grad111.z); // Remove small variations due to w\n    float n111 = dot(grad111, Pf - vec3(1.0, 1.0, 1.0));\n\n    // Blend contributions along x\n    vec4 n_x = mix(vec4(n000, n001, n010, n011),\n                   vec4(n100, n101, n110, n111), fade(Pf.x));\n\n    // Blend contributions along y\n    vec2 n_xy = mix(n_x.xy, n_x.zw, fade(Pf.y));\n\n    // Blend contributions along z\n    float n_xyz = mix(n_xy.x, n_xy.y, fade(Pf.z));\n\n    // We're done, return the final noise value.\n    return n_xyz;\n  }\n\n\n  /*\n   * 4D classic noise. Slow, but very useful. 4D simplex noise is a lot faster.\n   *\n   * This function performs 8 texture lookups and 16 dependent texture lookups,\n   * 16 dot products, 4 mix operations and a lot of additions and multiplications.\n   * Needless to say, it's not super fast. But it's not dead slow either.\n   */\n  shared float noise(vec4 P)\n  {\n    vec4 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                    // and offset 1/2 texel to sample texel centers\n    vec4 Pf = fract(P);      // Fractional part for interpolation\n\n    // \"n0000\" is the noise contribution from (x=0, y=0, z=0, w=0), and so on\n    float perm00xy = texture2D(gradTexture, Pi.xy).a ;\n    float perm00zw = texture2D(gradTexture, Pi.zw).a ;\n    vec4 grad0000 = texture2D(gradTexture, vec2(perm00xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad0000.z = floor(grad0000.z); // Remove slight variation from w\n    grad0000.w = fract(grad0000.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0000 = dot(grad0000, Pf);\n\n    float perm01zw = texture2D(gradTexture, Pi.zw  + vec2(0.0, ONE)).a ;\n    vec4 grad0001 = texture2D(gradTexture, vec2(perm00xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad0001.z = floor(grad0001.z); // Remove slight variation from w\n    grad0001.w = fract(grad0001.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0001 = dot(grad0001, Pf - vec4(0.0, 0.0, 0.0, 1.0));\n\n    float perm10zw = texture2D(gradTexture, Pi.zw  + vec2(ONE, 0.0)).a ;\n    vec4 grad0010 = texture2D(gradTexture, vec2(perm00xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad0010.z = floor(grad0010.z); // Remove slight variation from w\n    grad0010.w = fract(grad0010.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0010 = dot(grad0010, Pf - vec4(0.0, 0.0, 1.0, 0.0));\n\n    float perm11zw = texture2D(gradTexture, Pi.zw  + vec2(ONE, ONE)).a ;\n    vec4 grad0011 = texture2D(gradTexture, vec2(perm00xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad0011.z = floor(grad0011.z); // Remove slight variation from w\n    grad0011.w = fract(grad0011.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0011 = dot(grad0011, Pf - vec4(0.0, 0.0, 1.0, 1.0));\n\n    float perm01xy = texture2D(gradTexture, Pi.xy + vec2(0.0, ONE)).a ;\n    vec4 grad0100 = texture2D(gradTexture, vec2(perm01xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad0100.z = floor(grad0100.z); // Remove slight variation from w\n    grad0100.w = fract(grad0100.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0100 = dot(grad0100, Pf - vec4(0.0, 1.0, 0.0, 0.0));\n\n    vec4 grad0101 = texture2D(gradTexture, vec2(perm01xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad0101.z = floor(grad0101.z); // Remove slight variation from w\n    grad0101.w = fract(grad0101.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0101 = dot(grad0101, Pf - vec4(0.0, 1.0, 0.0, 1.0));\n\n    vec4 grad0110 = texture2D(gradTexture, vec2(perm01xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad0110.z = floor(grad0110.z); // Remove slight variation from w\n    grad0110.w = fract(grad0110.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0110 = dot(grad0110, Pf - vec4(0.0, 1.0, 1.0, 0.0));\n\n    vec4  grad0111 = texture2D(gradTexture, vec2(perm01xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad0111.z = floor(grad0111.z); // Remove slight variation from w\n    grad0111.w = fract(grad0111.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n0111 = dot(grad0111, Pf - vec4(0.0, 1.0, 1.0, 1.0));\n\n    float perm10xy = texture2D(gradTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n    vec4  grad1000 = texture2D(gradTexture, vec2(perm10xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad1000.z = floor(grad1000.z); // Remove slight variation from w\n    grad1000.w = fract(grad1000.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1000 = dot(grad1000, Pf - vec4(1.0, 0.0, 0.0, 0.0));\n\n    vec4  grad1001 = texture2D(gradTexture, vec2(perm10xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad1001.z = floor(grad1001.z); // Remove slight variation from w\n    grad1001.w = fract(grad1001.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1001 = dot(grad1001, Pf - vec4(1.0, 0.0, 0.0, 1.0));\n\n    vec4  grad1010 = texture2D(gradTexture, vec2(perm10xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad1010.z = floor(grad1010.z); // Remove slight variation from w\n    grad1010.w = fract(grad1010.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1010 = dot(grad1010, Pf - vec4(1.0, 0.0, 1.0, 0.0));\n\n    vec4  grad1011 = texture2D(gradTexture, vec2(perm10xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad1011.z = floor(grad1011.z); // Remove slight variation from w\n    grad1011.w = fract(grad1011.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1011 = dot(grad1011, Pf - vec4(1.0, 0.0, 1.0, 1.0));\n\n    float perm11xy = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a ;\n    vec4  grad1100 = texture2D(gradTexture, vec2(perm11xy, perm00zw)).rgbb * 4.0 - 2.0;\n    grad1100.z = floor(grad1100.z); // Remove slight variation from w\n    grad1100.w = fract(grad1100.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1100 = dot(grad1100, Pf - vec4(1.0, 1.0, 0.0, 0.0));\n\n    vec4  grad1101 = texture2D(gradTexture, vec2(perm11xy, perm01zw)).rgbb * 4.0 - 2.0;\n    grad1101.z = floor(grad1101.z); // Remove slight variation from w\n    grad1101.w = fract(grad1101.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1101 = dot(grad1101, Pf - vec4(1.0, 1.0, 0.0, 1.0));\n\n    vec4  grad1110 = texture2D(gradTexture, vec2(perm11xy, perm10zw)).rgbb * 4.0 - 2.0;\n    grad1110.z = floor(grad1110.z); // Remove slight variation from w\n    grad1110.w = fract(grad1110.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1110 = dot(grad1110, Pf - vec4(1.0, 1.0, 1.0, 0.0));\n\n    vec4  grad1111 = texture2D(gradTexture, vec2(perm11xy, perm11zw)).rgbb * 4.0 - 2.0;\n    grad1111.z = floor(grad1111.z); // Remove slight variation from w\n    grad1111.w = fract(grad1111.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float n1111 = dot(grad1111, Pf - vec4(1.0, 1.0, 1.0, 1.0));\n\n    // Blend contributions along x\n    float fadex = fade(Pf.x);\n    vec4 n_x0 = mix(vec4(n0000, n0001, n0010, n0011),\n                    vec4(n1000, n1001, n1010, n1011), fadex);\n    vec4 n_x1 = mix(vec4(n0100, n0101, n0110, n0111),\n                    vec4(n1100, n1101, n1110, n1111), fadex);\n\n    // Blend contributions along y\n    vec4 n_xy = mix(n_x0, n_x1, fade(Pf.y));\n\n    // Blend contributions along z\n    vec2 n_xyz = mix(n_xy.xy, n_xy.zw, fade(Pf.z));\n\n    // Blend contributions along w\n    float n_xyzw = mix(n_xyz.x, n_xyz.y, fade(Pf.w));\n\n    // We're done, return the final noise value.\n    return n_xyzw;\n  }\n\n\n  /*\n   * 2D simplex noise. Somewhat slower but much better looking than classic noise.\n   */\n  shared float snoise(vec2 P) {\n\n  // Skew and unskew factors are a bit hairy for 2D, so define them as constants\n  // This is (sqrt(3.0)-1.0)/2.0\n  #define F2 0.366025403784\n  // This is (3.0-sqrt(3.0))/6.0\n  #define G2 0.211324865405\n\n    // Skew the (x,y) space to determine which cell of 2 simplices we're in\n   	float s = (P.x + P.y) * F2;   // Hairy factor for 2D skewing\n    vec2 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y) * G2; // Hairy factor for unskewing\n    vec2 P0 = Pi - t; // Unskew the cell origin back to (x,y) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec2 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Find out whether we are above or below the x=y diagonal to\n    // determine which of the two triangles we're in.\n    vec2 o1;\n    if(Pf0.x > Pf0.y) o1 = vec2(1.0, 0.0);  // +x, +y traversal order\n    else o1 = vec2(0.0, 1.0);               // +y, +x traversal order\n\n    // Noise contribution from simplex origin\n    vec2 grad0 = texture2D(gradTexture, Pi).rg * 4.0 - 2.0;\n    float t0 = 0.5 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from middle corner\n    vec2 Pf1 = Pf0 - o1 + G2;\n    vec2 grad1 = texture2D(gradTexture, Pi + o1*ONE).rg * 4.0 - 2.0;\n    float t1 = 0.5 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from last corner\n    vec2 Pf2 = Pf0 - vec2(1.0-2.0*G2);\n    vec2 grad2 = texture2D(gradTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 2.0;\n    float t2 = 0.5 - dot(Pf2, Pf2);\n    float n2;\n    if(t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 100.0 * (n0 + n1 + n2);\n  }\n\n\n  /*\n   * 3D simplex noise. Comparable in speed to classic noise, better looking.\n   */\n  shared float snoise(vec3 P) {\n\n  // The skewing and unskewing factors are much simpler for the 3D case\n  #define F3 0.333333333333\n  #define G3 0.166666666667\n\n    // Skew the (x,y,z) space to determine which cell of 6 simplices we're in\n   	float s = (P.x + P.y + P.z) * F3; // Factor for 3D skewing\n    vec3 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y + Pi.z) * G3;\n    vec3 P0 = Pi - t; // Unskew the cell origin back to (x,y,z) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec3 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // To find out which of the six possible tetrahedra we're in, we need to\n    // determine the magnitude ordering of x, y and z components of Pf0.\n    vec3 o1;\n    vec3 o2;\n    simplex(Pf0, o1, o2);\n\n    // Noise contribution from simplex origin\n    float perm0 = texture2D(gradTexture, Pi.xy).a;\n    vec3  grad0 = texture2D(gradTexture, vec2(perm0, Pi.z)).rgb * 4.0 - 2.0;\n    grad0.z = floor(grad0.z); // Remove small variations due to w\n    float t0 = 0.6 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from second corner\n    vec3 Pf1 = Pf0 - o1 + G3;\n    float perm1 = texture2D(gradTexture, Pi.xy + o1.xy*ONE).a;\n    vec3  grad1 = texture2D(gradTexture, vec2(perm1, Pi.z + o1.z*ONE)).rgb * 4.0 - 2.0;\n    grad1.z = floor(grad1.z); // Remove small variations due to w\n    float t1 = 0.6 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from third corner\n    vec3 Pf2 = Pf0 - o2 + 2.0 * G3;\n    float perm2 = texture2D(gradTexture, Pi.xy + o2.xy*ONE).a;\n    vec3  grad2 = texture2D(gradTexture, vec2(perm2, Pi.z + o2.z*ONE)).rgb * 4.0 - 2.0;\n    grad2.z = floor(grad2.z); // Remove small variations due to w\n    float t2 = 0.6 - dot(Pf2, Pf2);\n    float n2;\n    if (t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n  \n    // Noise contribution from last corner\n    vec3 Pf3 = Pf0 - vec3(1.0-3.0*G3);\n    float perm3 = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a;\n    vec3  grad3 = texture2D(gradTexture, vec2(perm3, Pi.z + ONE)).rgb * 4.0 - 2.0;\n    grad3.z = floor(grad3.z); // Remove small variations due to w\n    float t3 = 0.6 - dot(Pf3, Pf3);\n    float n3;\n    if(t3 < 0.0) n3 = 0.0;\n    else {\n      t3 *= t3;\n      n3 = t3 * t3 * dot(grad3, Pf3);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 20.0 * (n0 + n1 + n2 + n3);\n  }\n\n\n  /*\n   * 4D simplex noise. A lot faster than classic 4D noise, and better looking.\n   */\n\n  shared float snoise(vec4 P) {\n\n  // The skewing and unskewing factors are hairy again for the 4D case\n  // This is (sqrt(5.0)-1.0)/4.0\n  #define F4 0.309016994375\n  // This is (5.0-sqrt(5.0))/20.0\n  #define G4 0.138196601125\n\n    // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n   	float s = (P.x + P.y + P.z + P.w) * F4; // Factor for 4D skewing\n    vec4 Pi = floor(P + s);\n    float t = (Pi.x + Pi.y + Pi.z + Pi.w) * G4;\n    vec4 P0 = Pi - t; // Unskew the cell origin back to (x,y,z,w) space\n    Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n    vec4 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n    // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n    // To find out which of the 24 possible simplices we're in, we need to\n    // determine the magnitude ordering of x, y, z and w components of Pf0.\n    vec4 o1;\n    vec4 o2;\n    vec4 o3;\n    simplex(Pf0, o1, o2, o3);  \n\n    // Noise contribution from simplex origin\n    float perm0xy = texture2D(gradTexture, Pi.xy).a;\n    float perm0zw = texture2D(gradTexture, Pi.zw).a;\n    vec4 grad0 = texture2D(gradTexture, vec2(perm0xy, perm0zw)).rgbb * 4.0 - 2.0;\n    grad0.z = floor(grad0.z); // Remove slight variation from w\n    grad0.w = fract(grad0.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t0 = 0.6 - dot(Pf0, Pf0);\n    float n0;\n    if (t0 < 0.0) n0 = 0.0;\n    else {\n      t0 *= t0;\n      n0 = t0 * t0 * dot(grad0, Pf0);\n    }\n\n    // Noise contribution from second corner\n    vec4 Pf1 = Pf0 - o1 + G4;\n    o1 = o1 * ONE;\n    float perm1xy = texture2D(gradTexture, Pi.xy + o1.xy).a;\n    float perm1zw = texture2D(gradTexture, Pi.zw + o1.zw).a;\n    vec4 grad1 = texture2D(gradTexture, vec2(perm1xy, perm1zw)).rgbb * 4.0 - 2.0;\n    grad1.z = floor(grad1.z); // Remove slight variation from w\n    grad1.w = fract(grad1.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t1 = 0.6 - dot(Pf1, Pf1);\n    float n1;\n    if (t1 < 0.0) n1 = 0.0;\n    else {\n      t1 *= t1;\n      n1 = t1 * t1 * dot(grad1, Pf1);\n    }\n  \n    // Noise contribution from third corner\n    vec4 Pf2 = Pf0 - o2 + 2.0 * G4;\n    o2 = o2 * ONE;\n    float perm2xy = texture2D(gradTexture, Pi.xy + o2.xy).a;\n    float perm2zw = texture2D(gradTexture, Pi.zw + o2.zw).a;\n    vec4 grad2 = texture2D(gradTexture, vec2(perm2xy, perm2zw)).rgbb * 4.0 - 2.0;\n    grad2.z = floor(grad2.z); // Remove slight variation from w\n    grad2.w = fract(grad2.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t2 = 0.6 - dot(Pf2, Pf2);\n    float n2;\n    if (t2 < 0.0) n2 = 0.0;\n    else {\n      t2 *= t2;\n      n2 = t2 * t2 * dot(grad2, Pf2);\n    }\n  \n    // Noise contribution from fourth corner\n    vec4 Pf3 = Pf0 - o3 + 3.0 * G4;\n    o3 = o3 * ONE;\n    float perm3xy = texture2D(gradTexture, Pi.xy + o3.xy).a;\n    float perm3zw = texture2D(gradTexture, Pi.zw + o3.zw).a;\n    vec4 grad3 = texture2D(gradTexture, vec2(perm3xy, perm3zw)).rgbb * 4.0 - 2.0;\n    grad3.z = floor(grad3.z); // Remove slight variation from w\n    grad3.w = fract(grad3.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t3 = 0.6 - dot(Pf3, Pf3);\n    float n3;\n    if (t3 < 0.0) n3 = 0.0;\n    else {\n      t3 *= t3;\n      n3 = t3 * t3 * dot(grad3, Pf3);\n    }\n  \n    // Noise contribution from last corner\n    vec4 Pf4 = Pf0 - vec4(1.0-4.0*G4);\n    float perm4xy = texture2D(gradTexture, Pi.xy + vec2(ONE, ONE)).a;\n    float perm4zw = texture2D(gradTexture, Pi.zw + vec2(ONE, ONE)).a;\n    vec4  grad4 = texture2D(gradTexture, vec2(perm4xy, perm4zw)).rgbb * 4.0 - 2.0;\n    grad4.z = floor(grad4.z); // Remove slight variation from w\n    grad4.w = fract(grad4.w + 0.25) * 4.0 - 1.0; // Extract w from joint encoding\n    float t4 = 0.6 - dot(Pf4, Pf4);\n    float n4;\n    if(t4 < 0.0) n4 = 0.0;\n    else {\n      t4 *= t4;\n      n4 = t4 * t4 * dot(grad4, Pf4);\n    }\n\n    // Sum up and scale the result to cover the range [-1,1]\n    return 27.0 * (n0 + n1 + n2 + n3 + n4);\n  }\n\n\n<%\n} else {\n// non-texture-based implementation:\n// Ian McEwan, Ashima Arts.\n// Copyright (C) 2011 Ashima Arts. All rights reserved.\n// Distributed under the MIT License. See LICENSE file.\n%>\n\nshared vec4 permute(vec4 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nshared vec3 permute(vec3 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nshared float permute(float x)\n{\n  return floor(mod(((x*34.0)+1.0)*x, 289.0));\n}\n\nshared vec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nshared float taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nshared vec4 grad4(float j, vec4 ip)\n{\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n}\n\nshared vec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nshared vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nshared vec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nshared float cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nshared float pnoise(vec2 P, vec2 rep)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise\nshared float cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nshared float pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise\nshared float cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n// Classic Perlin noise, periodic version\nshared float cnoise(vec4 P, vec4 rep)\n{\n  vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n  vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\nshared float snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i = floor(v + dot(v, C.yy) );\n  vec2 x0 = v - i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod(i, 289.0); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Inlined for speed: m *= taylorInvSqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x = a0.x * x0.x + h.x * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nshared float snoise(vec3 v)\n{\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\n  // x1 = x0 - i1 + 1.0 * C.xxx;\n  // x2 = x0 - i2 + 2.0 * C.xxx;\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod(i, 289.0 );\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nshared float snoise(vec4 v)\n{\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\n                        0.276393202250021, // 2 * G4\n                        0.414589803375032, // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n  // (sqrt(5) - 1)/4 = F4, used once below\n  #define F4 0.309016994374947451\n\n// First corner\n  vec4 i = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v - i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n// i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\n  // x1 = x0 - i1 + 0.0 * C.xxxx\n  // x2 = x0 - i2 + 0.0 * C.xxxx\n  // x3 = x0 - i3 + 0.0 * C.xxxx\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n  // Permutations\n  i = mod(i, 289.0);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n  // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n  // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0, ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n  // Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n  // Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}\n\n<% } %>\n"
,Jax.shader_data("functions").paraboloid="void mapToParaboloid(inout vec4 position, float zNear, float zFar) {\n  float L = length(position.xyz);\n  position /= L;\n  position.z += 1.0;\n  position.xy /= position.z;\n  position.z = (L - zNear) / (zFar - zNear);\n  position.w = 1.0;\n}\n",Jax.shader_data("gamma_correction").fragment="uniform float GammaCorrectionFactor;\n\nvoid main(void) {\n  if (GammaCorrectionFactor == 0.0) {\n    // sRGB\n    vec3 c = gl_FragColor.rgb;\n    gl_FragColor.rgb = (step(0.0031308, c)*1.055*pow(c, vec3(1.0/2.4))-0.055) +\n                       (step(-0.0031308, -c)*12.92*c);\n  } else {\n    gl_FragColor.rgb = pow(gl_FragColor.rgb,\n                       vec3(GammaCorrectionFactor));\n  }\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.GammaCorrection=function(e){function n(e){n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){return this.gamma===void 0?r.GammaCorrectionFactor=1/2.2:isNaN(this.gamma)?r.GammaCorrectionFactor=0:r.GammaCorrectionFactor=1/this.gamma},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("lambert_diffuse").common='<%= Jax.import_shader_code("lib", "lights") %>\n\nshared uniform int PASS;\nshared uniform float MaterialDiffuseIntensity;\nshared uniform vec4 MaterialDiffuseColor;\nshared uniform mat3 NormalMatrix;\nshared uniform mat4 ModelViewMatrix;\n\nshared varying vec3 vEyeSpaceSurfaceNormal, vEyeSpaceSurfacePosition;\n',Jax.shader_data("lambert_diffuse").fragment="// Lambert formula: L dot N * C * Il,\n//   where L is direction from surface to light, N is normal, C is color, Il is light intensity\n// This shader holds alpha constant at 1.0 and is intended to be blended\n// additively with a prior ambient pass. Light intensity is held constant \n// at 1.0 and attenuation is calculated in a different layer.\n\nvoid main(void) {\n  // no output on ambient pass\n  if (PASS != 0) {\n    cache(vec3, NormalizedEyeSpaceSurfaceNormal) {\n      bool useVertexNormal = true;\n      import(UseVertexNormal, useVertexNormal = UseVertexNormal);\n      vec3 normal = vec3(0.0, 0.0, 0.0);\n      if (useVertexNormal) normal = vEyeSpaceSurfaceNormal;\n      import(Normal, normal = normal + Normal);\n      NormalizedEyeSpaceSurfaceNormal = normalize(normal);\n    }\n  \n    vec3 L;\n    float d = 1.0;\n    if (LightType == <%= Jax.DIRECTIONAL_LIGHT %>) {\n      L = -EyeSpaceLightDirection;\n      d = 1.0;\n    } else {\n      L = EyeSpaceLightPosition - vEyeSpaceSurfacePosition;\n      d = length(L);\n      L /= d;\n    }\n  \n    cache(float, SpotAttenuation) {\n      float cosCurAngle = dot(-L, EyeSpaceLightDirection);\n      float cosInnerMinusOuterAngle = LightSpotInnerCos - LightSpotOuterCos;\n      SpotAttenuation = clamp((cosCurAngle - LightSpotOuterCos) / cosInnerMinusOuterAngle, 0.0, 1.0);\n    }\n  \n    // this is cached here so that attenuation can get a handle on it\n    // FIXME we probably need a better interface for this sort of thing\n    cache(float, LightDistanceFromSurface) { LightDistanceFromSurface = d; }\n  \n    vec3 C =  LightDiffuseColor.rgb * MaterialDiffuseColor.rgb *\n              MaterialDiffuseColor.a * MaterialDiffuseIntensity;\n\n    float lambert = max(dot(NormalizedEyeSpaceSurfaceNormal, L), 0.0);\n    vec4 color = vec4(lambert * C * SpotAttenuation, 1.0);\n    import(VertexColor, color *= VertexColor);\n    gl_FragColor += color;\n  }\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.LambertDiffuse=function(e){function n(e){n.__super__.constructor.call(this,e),this.meshDataMap={vertices:"VERTEX_POSITION",normals:"VERTEX_NORMAL"},this.eyeDir=vec3.create(),this.eyePos=vec3.create()}return t(n,e),n.prototype.illuminate=function(e,t,n,r,i){return r.LightDiffuseColor=i.color.diffuse,r.LightSpotExponent=i.spotExponent,r.LightSpotInnerCos=i.innerSpotAngleCos,r.LightSpotOuterCos=i.outerSpotAngleCos,r.LightType=i.type,r.EyeSpaceLightDirection=i.eyeDirection(e.matrix_stack.getViewNormalMatrix(),this.eyeDir),r.EyeSpaceLightPosition=i.eyePosition(e.matrix_stack.getViewMatrix(),this.eyePos),r.NormalMatrix=e.matrix_stack.getNormalMatrix(),r.MaterialDiffuseIntensity=this.intensity,r.MaterialDiffuseColor=this.color,r.ModelViewMatrix=e.matrix_stack.getModelViewMatrix(),t.data.set(r,this.meshDataMap)},n}(Jax.Material.IlluminationLayer)}.call(this),Jax.shader_data("lambert_diffuse").vertex="shared attribute vec4 VERTEX_COLOR, VERTEX_POSITION;\nshared attribute vec3 VERTEX_NORMAL;\n\nvoid main(void) {\n  if (PASS != 0) {\n    /* These variables are cached so that other shaders can replace their values */\n    cache(vec3, VertexNormal) { VertexNormal = VERTEX_NORMAL; }\n    cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n    /* exports can also be used to modify the normal */\n    vec3 normal = VertexNormal;\n    import(VertexNormal, normal = normalize(normal + VertexNormal));\n    vEyeSpaceSurfaceNormal = NormalMatrix * normal;\n    vEyeSpaceSurfacePosition = (ModelViewMatrix * VertexPosition).xyz;\n  }\n}\n",Jax.shader_data("light_ambient").fragment="shared uniform int PASS;\nshared uniform float MaterialAmbientIntensity;\nshared uniform vec4 MaterialAmbientColor;\nshared uniform vec4 LightAmbientColor;\n\nvoid main(void) {\n  // no output on ambient pass\n  if (PASS != 0) {\n    vec3 material = MaterialAmbientIntensity * MaterialAmbientColor.rgb * MaterialAmbientColor.a;\n    vec4 color = vec4(LightAmbientColor.rgb * LightAmbientColor.a * material, 1.0);\n    import(VertexColor, color *= VertexColor);\n    gl_FragColor += color;\n  }\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.LightAmbient=function(e){function n(e){this.color=Jax.Color.parse("#ffff"),n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.illuminate=function(e,t,n,r,i){return r.MaterialAmbientIntensity=this.intensity,r.LightAmbientColor=i.color.ambient,r.MaterialAmbientColor=this.color},n}(Jax.Material.IlluminationLayer)}.call(this),Jax.shader_data("noise").fragment='<%= Jax.import_shader_code("functions", "noise") %>\n',function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Noise=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){return Jax.noise.isPrepared(e)||Jax.noise.prepare(e),r.gradTexture=Jax.noise.grad},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("noise").vertex='<%= Jax.import_shader_code("functions", "noise") %>\n',Jax.shader_data("normal_map").common="uniform sampler2D Texture;\nuniform float TextureScaleX, TextureScaleY;\nuniform bool UseSpecularChannel;\n\nshared varying vec2 vTexCoords;\n\nshared uniform mat3 NormalMatrix;\nshared uniform int PASS;\n\nvarying mat3 vTangentMatrix;\n\nvarying vec3 vN, vT, vB;\n",Jax.shader_data("normal_map").exports=Jax.shader_data("normal_map").exports||{},Jax.shader_data("normal_map").exports.SpecularIntensity="float",Jax.shader_data("normal_map").fragment="void main() {\n  vec4 rgba = texture2D(Texture, vTexCoords *\n                vec2(TextureScaleX, TextureScaleY));\n  vec3 bump = normalize(rgba.xyz * 2.0 - 1.0);\n  \n  vec3 t = normalize(vT);\n  vec3 n = normalize(vN);\n  vec3 b = normalize(vB);\n  \n  // inverse\n  // float r0 = t.x, r1 = b.x, r2 = n.x,\n  //       r3 = t.y, r4 = b.y, r5 = n.y,\n  //       r6 = t.z, r7 = b.z, r8 = b.z;\n  \n  float r0 = t.x, r1 = t.y, r2 = t.z,\n        r3 = b.x, r4 = b.y, r5 = b.z,\n        r6 = n.x, r7 = n.y, r8 = n.z;\n  mat3 tangentMatrix = mat3(r0, r1, r2, r3, r4, r5, r6, r7, r8);\n  \n  bump = normalize(tangentMatrix * bump);\n  // vertex normal is already encoded in the tangent matrix\n  export(bool, UseVertexNormal, false);\n  export(vec3, Normal, bump);\n  \n  // Alpha channel may contain a specular map\n  float specular = 1.0;\n  if (UseSpecularChannel) specular = rgba.a;\n  export(float, SpecularIntensity, specular);\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Texture=function(e){function n(e){var t;e&&e.instance?t=e.instance:e&&e.texture?t=e.texture:e&&(t=e),t instanceof Jax.Texture||(t=new Jax.Texture(t)),n.__super__.constructor.call(this),this.texture=t,this.dataMap={textures:"VERTEX_TEXCOORDS"}}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){return r.TextureScaleX=this.texture.options.scale_x||this.texture.options.scale||1,r.TextureScaleY=this.texture.options.scale_y||this.texture.options.scale||1,r.Texture=this.texture,t.data.set(r,this.dataMap)},n}(Jax.Material.Layer)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.NormalMap=function(e){function n(e){this.specularChannel=!(!e||!e.specularChannel&&!e.texture.specularChannel),n.__super__.constructor.call(this,e),this.dataMap.tangents="VERTEX_TANGENT",this.dataMap.normals="VERTEX_NORMAL",this.dataMap.vertices="VERTEX_POSITION"}return t(n,e),n.prototype.setVariables=function(e,t,r,i,s){return n.__super__.setVariables.call(this,e,t,r,i,s),i.NormalMatrix=e.matrix_stack.getNormalMatrix(),i.UseSpecularChannel=this.specularChannel,!0},n}(Jax.Material.Layer.Texture)}.call(this),Jax.shader_data("normal_map").vertex='<%= Jax.import_shader_code("lib", "lights") %>\n\nshared attribute vec4 VERTEX_POSITION;\nshared attribute vec2 VERTEX_TEXCOORDS;\nshared attribute vec3 VERTEX_NORMAL;\nshared attribute vec4 VERTEX_TANGENT;\nshared attribute vec3 VERTEX_BITANGENT;\n\nvoid main(void) {\n  if (PASS != 0) {\n    vTexCoords = VERTEX_TEXCOORDS;\n    \n    vec3 n = VERTEX_NORMAL;\n    vec3 t = VERTEX_TANGENT.xyz;\n    vec3 b = cross(n, t) * VERTEX_TANGENT.w;\n    \n    vN = NormalMatrix * n;\n    vT = NormalMatrix * t;\n    vB = NormalMatrix * b;\n  }\n}\n',Jax.shader_data("paraboloid").common="shared uniform mat4 ModelView;\n\nuniform float Near, Far;\nuniform float Direction;\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Paraboloid=function(e){function n(e){n.__super__.constructor.call(this,e),this._meshMap={vertices:"VERTEX_POSITION"}}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){var s;s=this.direction;if(s!==1&&s!==-1)throw new Error("`direction` must be either 1 or -1");return t.data.set(r,this._meshMap),r.ModelView=e.matrix_stack.getModelViewMatrix(),r.Near=this.paraboloidNear||1,r.Far=this.paraboloidFar||1,r.Direction=s},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("paraboloid").vertex='<%= Jax.import_shader_code("functions", "paraboloid") %>\n\nshared attribute vec4 VERTEX_POSITION;\n                \nvoid main(void) {\n  vec4 position = ModelView * VERTEX_POSITION;\n  position /= position.w;\n  position.z *= Direction;\n  mapToParaboloid(position, Near, Far);\n  gl_Position = position;\n}\n',Jax.shader_data("phong_specular").common='<%= Jax.import_shader_code("lib", "lights") %>\n\nshared uniform int PASS;\nshared uniform float MaterialSpecularIntensity;\nshared uniform float MaterialShininess;\nshared uniform vec4 MaterialSpecularColor;\nshared uniform mat4 ModelViewMatrix;\nshared uniform mat3 NormalMatrix;\n\nshared varying vec3 vEyeSpaceSurfaceNormal;\nshared varying vec3 vEyeSpaceSurfacePosition;\n',Jax.shader_data("phong_specular").fragment="// Phong formula: Is = Sm x Sl x pow( max(R dot E, 0.0), f )\n//   where Sl is the light specular color, Sm is the material specular color,\n//     E is the view vector, and R is the reflected light vector.\n//\n// This shader holds alpha constant at 1.0 and is intended to be blended\n// additively with a prior ambient pass.\n\nvoid main(void) {\n  // no output on ambient pass\n  if (PASS != 0) {\n    cache(vec3, NormalizedEyeSpaceSurfaceNormal) {\n      bool useVertexNormal = true;\n      import(UseVertexNormal, useVertexNormal = UseVertexNormal);\n      vec3 normal = vec3(0.0, 0.0, 0.0);\n      if (useVertexNormal) normal = vEyeSpaceSurfaceNormal;\n      import(Normal, normal = normal + Normal);\n      NormalizedEyeSpaceSurfaceNormal = normalize(normal);\n    }\n  \n    vec3 L;\n    if (LightType == <%= Jax.DIRECTIONAL_LIGHT %>) {\n      L = -EyeSpaceLightDirection;\n    } else {\n      L = normalize(EyeSpaceLightPosition - vEyeSpaceSurfacePosition);\n    }\n\n    cache(float, SpotAttenuation) {\n      float cosCurAngle = dot(-L, EyeSpaceLightDirection);\n      float cosInnerMinusOuterAngle = LightSpotInnerCos - LightSpotOuterCos;\n      SpotAttenuation = clamp((cosCurAngle - LightSpotOuterCos) / cosInnerMinusOuterAngle, 0.0, 1.0);\n    }\n\n    float lambert = dot(NormalizedEyeSpaceSurfaceNormal, L);\n    if (lambert > 0.0) {\n      vec3 R = reflect(L, NormalizedEyeSpaceSurfaceNormal);\n      vec3 C = MaterialSpecularColor.rgb * LightSpecularColor.rgb;\n      vec3 E = normalize(vEyeSpaceSurfacePosition);\n      float specularIntensity = MaterialSpecularIntensity;\n      import(SpecularIntensity, specularIntensity *= SpecularIntensity);\n      gl_FragColor += vec4(C * SpotAttenuation * specularIntensity * pow(clamp(dot(R, E), 0.0, 1.0), MaterialShininess), 1.0);\n    }\n  }\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.PhongSpecular=function(e){function n(e){n.__super__.constructor.call(this,e),this.meshDataMap={vertices:"VERTEX_POSITION",normals:"VERTEX_NORMAL"},this.eyeDir=vec3.create(),this.eyePos=vec3.create()}return t(n,e),n.prototype.illuminate=function(e,t,n,r,i){return r.LightSpecularColor=i.color.specular,r.EyeSpaceLightDirection=i.eyeDirection(e.matrix_stack.getViewNormalMatrix(),this.eyeDir),r.LightType=i.type,r.LightSpotExponent=i.spotExponent,r.LightSpotInnerCos=i.innerSpotAngleCos,r.LightSpotOuterCos=i.outerSpotAngleCos,r.EyeSpaceLightPosition=i.eyePosition(e.matrix_stack.getViewMatrix(),this.eyePos),r.ModelViewMatrix=e.matrix_stack.getModelViewMatrix(),r.NormalMatrix=e.matrix_stack.getNormalMatrix(),r.MaterialShininess=this.shininess,r.MaterialSpecularIntensity=this.intensity,r.MaterialSpecularColor=this.color,t.data.set(r,this.meshDataMap)},n}(Jax.Material.IlluminationLayer)}.call(this),Jax.shader_data("phong_specular").vertex="shared attribute vec4 VERTEX_COLOR, VERTEX_POSITION;\nshared attribute vec3 VERTEX_NORMAL;\n\nvoid main(void) {\n  if (PASS != 0) {\n    /* These variables are cached so that other shaders can replace their values */\n    cache(vec3, VertexNormal) { VertexNormal = VERTEX_NORMAL; }\n    cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n    /* exports can also be used to modify the normal */\n    vec3 normal = VertexNormal;\n    import(VertexNormal, normal = normalize(normal + VertexNormal));\n    vEyeSpaceSurfaceNormal = NormalMatrix * normal;\n    vEyeSpaceSurfacePosition = (ModelViewMatrix * VertexPosition).xyz;\n  }\n}\n",Jax.shader_data("picking").common="uniform float INDEX;\nvarying vec4 vPickingColor;\n",Jax.shader_data("picking").fragment="void main(void) {\n  if (INDEX == -1.0) discard;\n  gl_FragColor = vPickingColor;\n}\n",Jax.Material.Layer.Picking=Jax.Class.create(Jax.Material.Layer,{initialize:function($super,e){$super({shader:"picking"})},setVariables:function(e,t,n,r){model_index=n.__unique_id,model_index===undefined&&(model_index=-1),r.INDEX=model_index}}),Jax.shader_data("picking").vertex="void main(void) {\n  /*\n    Note that the agorithm here must be followed exactly on the JS side in order\n    to reconstitute the index when it is read.\n    \n    This supports 65,535 objects. If more are needed, we could feasibly open up\n    the alpha channel, as long as blending is disabled. Need to do more tests\n    on this first, however.\n  */\n  \n  \n  // equivalent to [ int(INDEX/256), INDEX % 256 ] / 255. The last division\n  // is necessary to scale to the [0..1] range.\n  \n  float d = 1.0 / 255.0;\n  float f = floor(INDEX / 256.0);\n  vPickingColor = vec4(f * d, (INDEX - 256.0 * f) * d, 1.0, 1.0);\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Position=function(e){function n(e){n.__super__.constructor.call(this,e),this.meshMap={vertices:"VERTEX_POSITION"}}return t(n,e),n.prototype.setVariables=function(e,t,n,r){return t.data.set(r,this.meshMap),r.ModelViewProjectionMatrix=e.matrix_stack.getModelViewProjectionMatrix()},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("position").vertex="shared uniform mat4 ModelViewProjectionMatrix;\nshared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  cache(vec4, VertexPosition) { VertexPosition = VERTEX_POSITION; }\n  gl_Position = ModelViewProjectionMatrix * VertexPosition;\n}\n",Jax.shader_data("shadow_map").common='<%= Jax.import_shader_code("lib", "lights") %>\n\nshared uniform int PASS;\nshared uniform mat4 mMatrix, pMatrix;\n\nshared uniform bool IsDualParaboloid;\nshared uniform bool SHADOWMAP_ENABLED;\nshared uniform sampler2D SHADOWMAP0, SHADOWMAP1;\nshared uniform mat4 SHADOWMAP_MATRIX;\nshared uniform bool SHADOWMAP_PCF_ENABLED;\nshared uniform float ParaboloidNear, ParaboloidFar;\nshared uniform float SHADOWMAP_WIDTH, SHADOWMAP_HEIGHT;\n\nshared varying vec4 vShadowCoord;\n',Jax.shader_data("shadow_map").exports=Jax.shader_data("shadow_map").exports||{},Jax.shader_data("shadow_map").exports.AttenuationMultiplier="float",Jax.shader_data("shadow_map").fragment='\n\n<%= Jax.import_shader_code("functions", "paraboloid") %>\n<%= Jax.import_shader_code("functions", "depth_map") %>\n\nvec4 shadowCoord;\n\n/*\n  Since we set the clear color to transparent while rendering the\n  shadowmap, no depth recorded in texture means nothing blocked the\n  light.\n  \n  This is what allows us to do testing beyond the view frustum\n  of the shadow matrix, so at the cost of a branching operation it\'s\n  much more accurate when some objects such as the floor are\n  excluded from casting shadows.\n*/\n\nfloat dp_lookup(vec2 offset, sampler2D shadowmap) {\n  vec4 rgba_depth = texture2D(shadowmap, shadowCoord.xy * 0.5 + 0.5 + offset);\n  float shadowDepth = unpack_depth(rgba_depth);\n  if (shadowDepth == 0.0) return 1.0;\n  if (shadowDepth - shadowCoord.z > -0.005)\n    return 1.0;\n  else\n    return 0.0;\n}\n      \nfloat depth_lookup(vec2 offset, sampler2D shadowmap) {\n  vec4 rgba_depth = texture2D(shadowmap, shadowCoord.xy + offset);\n  float d = unpack_depth(rgba_depth);\n  if (d == 0.0) return 1.0;\n  if (shadowCoord.z - d > 0.00002)\n    return 0.0;\n  else\n    return 1.0;\n}\n\nvoid main() {\n  /* if (a && b) is broken on some hardware, use if (all(bvec)) instead */\n  if (PASS != 0) {\n    float visibility, dx, dy;\n    bool front;\n\n    if (SHADOWMAP_ENABLED) {\n      shadowCoord = vShadowCoord / vShadowCoord.w;\n      visibility = 0.0;\n      dx = 1.0 / SHADOWMAP_WIDTH;\n      dy = 1.0 / SHADOWMAP_HEIGHT;\n      front = false;\n\n      // for PCF, nested loops break on some ATI cards, so the loop must be unrolled\n      // explicitly. Luckily we have EJS....\n\n      if (IsDualParaboloid) {\n        if (shadowCoord.z > 0.0) front = true;\n        else shadowCoord.z *= -1.0;\n        mapToParaboloid(shadowCoord, ParaboloidNear, ParaboloidFar);\n        shadowCoord.z = shadowCoord.z * 0.5 + 0.5;\n        \n        if (front) {\n          if (SHADOWMAP_PCF_ENABLED) {\n            <% for (var x = -1.5; x <= 1.5; x += 1.5) { %>\n              <% for (var y = -1.5; y <= 1.5; y += 1.5) { %>\n                visibility += dp_lookup(vec2(<%= x.toFixed(6) %> * dx, <%= y.toFixed(6) %> * dy), SHADOWMAP0);\n              <% } %>\n            <% } %>\n            visibility /= 9.0;\n          } else {\n            visibility += dp_lookup(vec2(0.0, 0.0), SHADOWMAP0);\n          }\n        } else {\n          if (SHADOWMAP_PCF_ENABLED) {\n            <% for (var x = -1.5; x <= 1.5; x += 1.5) { %>\n              <% for (var y = -1.5; y <= 1.5; y += 1.5) { %>\n                visibility += dp_lookup(vec2(<%= x.toFixed(6) %> * dx, <%= y.toFixed(6) %> * dy), SHADOWMAP1);\n              <% } %>\n            <% } %>\n            visibility /= 9.0;\n          } else {\n            visibility += dp_lookup(vec2(0.0, 0.0), SHADOWMAP1);\n          }\n        }\n      } else {\n        if (SHADOWMAP_PCF_ENABLED) {\n          <% for (var x = -1.5; x <= 1.5; x += 1.5) { %>\n            <% for (var y = -1.5; y <= 1.5; y += 1.5) { %>\n              visibility += depth_lookup(vec2(<%= x.toFixed(6) %> * dx, <%= y.toFixed(6) %> * dy), SHADOWMAP0);\n            <% } %>\n          <% } %>\n          visibility /= 9.0;\n        } else {\n          visibility += depth_lookup(vec2(0.0, 0.0), SHADOWMAP0);\n        }\n      }\n    } else {\n      visibility = 1.0;\n    }\n\n    export(float, AttenuationMultiplier, visibility);\n  }\n}\n',function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.ShadowMap=function(e){function n(e){this.pcf=!0,this.meshMap={vertices:"VERTEX_POSITION"},n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.numPasses=function(e){return e.world.lights.length+1},n.prototype.prepare=function(e,t,n){var r,i,s,o;for(r=s=1,o=this.numPasses(e);1<=o?s<o:s>o;r=1<=o?++s:--s)i=e.world.lights[r-1],i.shadows&&i.shadowmap&&i.shadowmap.validate(e);return!0},n.prototype.setVariables=function(e,t,n,r,i){var s;r.PASS=i,r.SHADOWMAP_ENABLED=!1;if(!i)return;s=e.world.lights[i-1],r.SHADOWMAP_ENABLED=s.shadows&&!!s.shadowmap&&n.receiveShadow,r.mMatrix=e.matrix_stack.getModelMatrix(),t.data.set(r,this.meshMap);if(r.SHADOWMAP_ENABLED)return r.ParaboloidNear=s.shadowmap.paraboloidNear||1,r.ParaboloidFar=s.shadowmap.paraboloidFar||200,r.SHADOWMAP_PCF_ENABLED=this.pcf,r.SHADOWMAP_MATRIX=s.shadowmap.shadowMatrix,r.SHADOWMAP_WIDTH=s.shadowmap.width,r.SHADOWMAP_HEIGHT=s.shadowmap.height,r.IsDualParaboloid=s.shadowmap.isDualParaboloid(),s.shadowmap.bindTextures(e,r,"SHADOWMAP0","SHADOWMAP1")},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("shadow_map").vertex="shared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  if (PASS != 0) {\n    if (SHADOWMAP_ENABLED)\n      vShadowCoord = SHADOWMAP_MATRIX * mMatrix * VERTEX_POSITION;\n  }\n}\n",Jax.shader_data("ssao").common="varying vec2 uv;\n",Jax.shader_data("ssao").fragment="uniform sampler2D Input;\n\nvoid main(void) {\n  gl_FragColor = texture2D(Input, uv);\n  \n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.SSAO=function(e){function n(e){n.__super__.constructor.call(this,e),this._dataMap={vertices:"VERTEX_POSITION"}}var r,i;return t(n,e),i=r=null,n.prototype.setVariables=function(e,t,n,r,i){return r.Input=this.input,t.data.set(r,this._dataMap),!0},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("ssao").vertex="shared attribute vec4 VERTEX_POSITION;\n\nvoid main(void) {\n  gl_Position.xy = VERTEX_POSITION.xy * 2.0;\n  gl_Position.z = -1.0;\n  gl_Position.w = 1.0;\n  uv = VERTEX_POSITION.xy + vec2(0.5, 0.5);\n}\n",Jax.shader_data("texture").common="uniform sampler2D Texture;\nuniform float TextureScaleX, TextureScaleY;\n\nshared varying vec2 vTexCoords;\n",Jax.shader_data("texture").fragment="void main() {\n  vec4 t = texture2D(Texture, vTexCoords * vec2(TextureScaleX, TextureScaleY));\n  gl_FragColor *= t;\n}\n",Jax.shader_data("texture").vertex="shared attribute vec2 VERTEX_TEXCOORDS;\n\nvoid main(void) {\n  vTexCoords = VERTEX_TEXCOORDS;\n}\n",Jax.shader_data("vertex_color").common="shared uniform int PASS;\n\nshared varying vec4 vColor;\n",Jax.shader_data("vertex_color").exports=Jax.shader_data("vertex_color").exports||{},Jax.shader_data("vertex_color").exports.VertexColor="vec4",Jax.shader_data("vertex_color").fragment="void main(void) {\n  export(vec4, VertexColor, vColor);\n  gl_FragColor = vColor;\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.VertexColor=function(e){function n(e){n.__super__.constructor.call(this,e),this.dataMap={colors:"VERTEX_COLOR"}}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){return r.PASS=i,t.data.set(r,this.dataMap)},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("vertex_color").vertex="shared attribute vec4 VERTEX_COLOR;\n\nvoid main(void) {\n  vColor = VERTEX_COLOR;\n}\n",Jax.shader_data("wire").common="/*\nSingle-pass wire frame implementation - see http://cgg-journal.com/2008-2/06/index.html\n*/\n\n\nvarying vec3 dist;\n",Jax.shader_data("wire").fragment="// uniform vec4 WireColor;\n// uniform vec4 FillColor;\n\nvoid main(void)\n{\n  // Undo perspective correction.\n	vec3 dist_vec = dist * gl_FragCoord.w;\n	\n  // Compute the shortest distance to the edge\n	float d =min(dist_vec[0],min(dist_vec[1],dist_vec[2]));\n	\n	// Compute line intensity and then fragment color\n 	float I = exp2(-2.0*d*d);\n 	\n  const vec4 fillColor = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 wireColor = gl_FragColor;\n 	\n 	gl_FragColor = I*wireColor + (1.0 - I)*fillColor;\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.Wire=function(e){function n(e){this._dataMap={vertices:"position",p2verts:"p1_3d",p3verts:"p2_3d"},this._winScale=[0,0],n.__super__.constructor.call(this,e)}return t(n,e),Jax.Mesh.Data.endpoints.p2verts=4,Jax.Mesh.Data.endpoints.p3verts=3,n.prototype.prepare=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;if(!t.data.wired){v=t.data.indexBuffer,f=t.data.colorBuffer,m=t.data.normalBuffer,w=t.data.textureCoordsBuffer,T=t.data.vertexBuffer,l=new Jax.Mesh.Data(v.length*3),l.wired=!0;for(c=N=0,C=v.length;N<C;c=N+=3)k=[c,c+1,c+2],h=k[0],p=k[1],d=k[2],L=[v[h],v[p],v[d]],r=L[0],i=L[1],s=L[2],A=[r*3,i*3,s*3],E=A[0],S=A[1],x=A[2],O=[r*4,i*4,s*4],o=O[0],u=O[1],a=O[2],M=[r*2,i*2,s*3],g=M[0],y=M[1],b=M[2],l.vertexBuffer[h*3]=T[E],l.vertexBuffer[h*3+1]=T[E+1],l.vertexBuffer[h*3+2]=T[E+2],l.normalBuffer[h*3]=m[E],l.normalBuffer[h*3+1]=m[E+1],l.normalBuffer[h*3+2]=m[E+2],l.colorBuffer[h*4]=f[o],l.colorBuffer[h*4+1]=f[o+1],l.colorBuffer[h*4+2]=f[o+2],l.colorBuffer[h*4+3]=f[o+3],l.textureCoordsBuffer[h*2]=w[g],l.textureCoordsBuffer[h*2+1]=w[g+1],l.p2verts[h*4]=T[S],l.p2verts[h*4+1]=T[S+1],l.p2verts[h*4+2]=T[S+2],l.p2verts[h*4+3]=0,l.p3verts[h*3]=T[x],l.p3verts[h*3+1]=T[x+1],l.p3verts[h*3+2]=T[x+2],l.vertexBuffer[p*3]=T[S],l.vertexBuffer[p*3+1]=T[S+1],l.vertexBuffer[p*3+2]=T[S+2],l.normalBuffer[p*3]=m[S],l.normalBuffer[p*3+1]=m[S+1],l.normalBuffer[p*3+2]=m[S+2],l.colorBuffer[p*4]=f[u],l.colorBuffer[p*4+1]=f[u+1],l.colorBuffer[p*4+2]=f[u+2],l.colorBuffer[p*4+3]=f[u+3],l.textureCoordsBuffer[p*2]=w[y],l.textureCoordsBuffer[p*2+1]=w[y+1],l.p2verts[p*4]=T[x],l.p2verts[p*4+1]=T[x+1],l.p2verts[p*4+2]=T[x+2],l.p2verts[p*4+3]=1,l.p3verts[p*3]=T[E],l.p3verts[p*3+1]=T[E+1],l.p3verts[p*3+2]=T[E+2],l.vertexBuffer[d*3]=T[x],l.vertexBuffer[d*3+1]=T[x+1],l.vertexBuffer[d*3+2]=T[x+2],l.normalBuffer[d*3]=m[x],l.normalBuffer[d*3+1]=m[x+1],l.normalBuffer[d*3+2]=m[x+2],l.colorBuffer[d*4]=f[a],l.colorBuffer[d*4+1]=f[a+1],l.colorBuffer[d*4+2]=f[a+2],l.colorBuffer[d*4+3]=f[a+3],l.textureCoordsBuffer[d*2]=w[b],l.textureCoordsBuffer[d*2+1]=w[b+1],l.p2verts[d*4]=T[E],l.p2verts[d*4+1]=T[E+1],l.p2verts[d*4+2]=T[E+2],l.p2verts[d*4+3]=2,l.p3verts[d*3]=T[S],l.p3verts[d*3+1]=T[S+1],l.p3verts[d*3+2]=T[S+2];return t.data=l}},n.prototype.setVariables=function(e,t,n,r,i){var s;return t.data.set(r,this._dataMap),s=[e.canvas.width/2,e.canvas.height/2],this._winScale[0]=s[0],this._winScale[1]=s[1],r.WIN_SCALE=this._winScale,r.MVP=e.matrix_stack.getModelViewProjectionMatrix()},n}(Jax.Material.Layer)}.call(this),Jax.shader_data("wire").vertex="uniform vec2 WIN_SCALE;\nuniform mat4 MVP;\n\nattribute vec4 position;\nattribute vec4 p1_3d;\nattribute vec4 p2_3d;\n\nvoid main(void)\n{\n	 // We store the vertex id (0,1, or 2) in the w coord of the vertex\n	 // which then has to be restored to w=1.\n	 float swizz = p1_3d.w;\n	 vec4 p1_3d_ = p1_3d;\n	 p1_3d_.w = 1.0;\n	 \n	 // Compute the vertex position in the usual fashion.\n   gl_Position = MVP * position;\n   \n	 // p0 is the 2D position of the current vertex.\n	 vec2 p0 = gl_Position.xy/gl_Position.w;\n	 \n	 // Project p1 and p2 and compute the vectors v1 = p1-p0\n	 // and v2 = p2-p0\n	 p1_3d_ = MVP * p1_3d_;\n	 vec2 v1 = WIN_SCALE*(p1_3d_.xy / p1_3d_.w - p0);\n	 vec4 p2_3d_ = MVP * p2_3d;\n	 vec2 v2 = WIN_SCALE*(p2_3d_.xy / p2_3d_.w - p0);\n	 \n	 // Compute 2D area of triangle.\n	 float area2 = abs(v1.x*v2.y - v1.y * v2.x);\n	 \n   // Compute distance from vertex to line in 2D coords\n   float h = area2/length(v1-v2);\n   \n   // ---\n   // The swizz variable tells us which of the three vertices\n   // we are dealing with. The ugly comparisons would not be needed if\n   // swizz was an int.\n   if(swizz<0.1)\n      dist = vec3(h,0,0);\n   else if(swizz<1.1)\n      dist = vec3(0,h,0);\n   else\n      dist = vec3(0,0,h);\n      \n   // ----\n   // Quick fix to defy perspective correction\n   dist *= gl_Position.w;\n}\n",Jax.shader_data("world_ambient").common="shared uniform int PASS;\nshared uniform float MaterialAmbientIntensity;\nshared uniform vec4 WorldAmbientColor;\nshared uniform vec4 MaterialAmbientColor;\n",Jax.shader_data("world_ambient").fragment="void main(void) {\n  if (PASS == 0) {\n    // ambient pass only\n    vec3 material = MaterialAmbientIntensity * MaterialAmbientColor.rgb * MaterialAmbientColor.a;\n    gl_FragColor.rgb *= WorldAmbientColor.rgb * WorldAmbientColor.a * material;\n  }\n}\n",function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Jax.Material.Layer.WorldAmbient=function(e){function n(e){this.intensity=1,this.color=Jax.Color.parse("#ffff"),n.__super__.constructor.call(this,e)}return t(n,e),n.prototype.setVariables=function(e,t,n,r,i){return r.PASS=i,r.WorldAmbientColor=e.world.ambientColor.toVec4(),r.MaterialAmbientColor=this.color,r.MaterialAmbientIntensity=this.intensity},n}(Jax.Material.Layer)}.call(this),(typeof Material=="undefined"?Jax.Material:Material).addResources({basic:{type:"Custom",layers:[{type:"Basic"}]}}),(typeof Material=="undefined"?Jax.Material:Material).addResources({"default":{type:"Surface",intensity:{ambient:1,diffuse:1,specular:1},shininess:60,color:{ambient:"#ffffff",diffuse:"#cccccc",specular:"#ffffff"}}}),(typeof Material=="undefined"?Jax.Material:Material).addResources({depthmap:{type:"Custom",layers:[{type:"Position"},{type:"Depthmap"}]}}),(typeof Material=="undefined"?Jax.Material:Material).addResources({"paraboloid-depthmap":{type:"Custom",layers:[{type:"Paraboloid"},{type:"Depthmap"}]}}),(typeof Material=="undefined"?Jax.Material:Material).addResources({picking:{type:"Custom",layers:[{type:"Position"},{type:"Picking"}]}}),(typeof Material=="undefined"?Jax.Material:Material).addResources({ssao:{type:"Custom",layers:[{type:"SSAO"}]}}),function(){}.call(this),function(){function e(e,t,n){return t?"`"+e.name+"#"+n.replace(/\./g,"#")+"` has been deprecated. "+"Please use `"+e.name+"#"+t.replace(/\./g,"#")+"` instead.":"`"+e.name+"#"+n.replace(/\./g,"#")+"` has been deprecated. "+"Please see the documentation."
}function t(e,t,n){var r=!1;return t&&(r=t.charAt(t.length-1)==="=",t=t.replace(/=$/,"")),function(){var e,i=this;if(!t)throw new Error(n);var s=t.split(".");while(s.length>1){i=i[s.shift()];if(i===undefined)throw new Error(n)}s=s[0];if(e=i[s])return Jax.deprecate.level>0?console.log((new Error(n)).stack):console.log(n),e instanceof Function?e.apply(this,arguments):r?arguments.length>1?i[s]=arguments:i[s]=arguments[0]:e}}Jax.deprecate=function(n,r,i,s){if(!n)throw new Error("Can't deprecate '"+r+"' without an owner");var o=n.prototype||n,u=t(r,i,s||e(n,i,r));o[r]=u},Jax.deprecateProperty=function(n,r,i,s){if(!n)throw new Error("Can't deprecate '"+r+"' without an owner");var o=n.prototype||n,u=t(r,i,s||e(n,i,r));Object.defineProperty(o,r,{get:u,set:u})}}(),Jax.deprecate.level=1,Jax.Camera&&(Jax.deprecate(Jax.Camera,"getFrustum","frustum"),Jax.deprecate(Jax.Camera,"getPosition","position"),Jax.deprecate(Jax.Camera,"getDirection","direction"),Jax.deprecate(Jax.Camera,"getViewVector","direction"),Jax.deprecate(Jax.Camera,"getRightVector","right"),Jax.deprecate(Jax.Camera,"getUpVector","up"),Jax.deprecate(Jax.Camera,"setDirection","direction="),Jax.deprecate(Jax.Camera,"setViewVector","direction="),Jax.deprecate(Jax.Camera,"setPosition","position="),Jax.deprecate(Jax.Camera,"orient","reorient")),Jax.World&&Jax.deprecate(Jax.World,"addLightSource","addLight"),Jax.Light&&Jax.deprecate(Jax.Light,"getPosition","position"),Jax.Mesh&&(Jax.Mesh.Base&&(Jax.deprecate(Jax.Mesh.Base,"getVertexBuffer",'data.set(vars, {vertices: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Base,"getNormalBuffer",'data.set(vars, {normals: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Base,"getColorBuffer",'data.set(vars, {colors: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Base,"getTextureCoordsBuffer",'data.set(vars, {texture: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Base,"getTangentBuffer",'data.set(vars, {tangents: "shaderVariableName"})')),Jax.Mesh.Triangles&&(Jax.deprecate(Jax.Mesh.Triangles,"getVertexBuffer",'data.set(vars, {vertices: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Triangles,"getNormalBuffer",'data.set(vars, {normals: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Triangles,"getColorBuffer",'data.set(vars, {colors: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Triangles,"getTextureCoordsBuffer",'data.set(vars, {texture: "shaderVariableName"})'),Jax.deprecate(Jax.Mesh.Triangles,"getTangentBuffer",'data.set(vars, {tangents: "shaderVariableName"})'))),Jax.View&&(Jax.deprecateProperty(Jax.View,"gl","context.gl","The @gl property of Jax views has been deprecated. Please use @context.renderer instead. If @context.renderer cannot do what you need, then use @context.gl, but bear in mind that this will become a deprecated property sometime in the future, after @context.renderer becomes more capable."),Jax.deprecate(Jax.View,"glClear","gl.clear")),Jax.deprecate(vec3,"distance","dist"),Jax.RouteSet&&Jax.deprecate(Jax.RouteSet,"root",null,"Jax.RouteSet#root is deprecated. Instead, please use\n  `new Jax.Context(canvas, {root:'controller/action'})`\nor redirect explicitly with \n  `context.redirectTo('controller/action')`"),Jax.Framebuffer&&(Jax.deprecate(Jax.Framebuffer,"getTextureBuffer","getTexture"),Jax.deprecate(Jax.Framebuffer,"getTextureBufferHandle","getTextureHandle")),Jax.Context&&(Jax.deprecate(Jax.Context,"loadModelMatrix","matrix_stack.loadModelMatrix"),Jax.deprecate(Jax.Context,"loadViewMatrix","matrix_stack.loadViewMatrix"),Jax.deprecate(Jax.Context,"loadProjectionMatrix","matrix_stack.loadProjectionMatrix"),Jax.deprecate(Jax.Context,"multModelMatrix","matrix_stack.multModelMatrix"),Jax.deprecate(Jax.Context,"multViewMatrix","matrix_stack.multViewMatrix"),Jax.deprecate(Jax.Context,"multProjectionMatrix","matrix_stack.multProjectionMatrix"),Jax.deprecate(Jax.Context,"getModelMatrix","matrix_stack.getModelMatrix"),Jax.deprecate(Jax.Context,"getViewMatrix","matrix_stack.getViewMatrix"),Jax.deprecate(Jax.Context,"getProjectionMatrix","matrix_stack.getProjectionMatrix"),Jax.deprecate(Jax.Context,"getInverseModelMatrix","matrix_stack.getInverseModelMatrix"),Jax.deprecate(Jax.Context,"getNormalMatrix","matrix_stack.getNormalMatrix"),Jax.deprecate(Jax.Context,"getInverseViewMatrix","matrix_stack.getInverseViewMatrix"),Jax.deprecate(Jax.Context,"getModelViewMatrix","matrix_stack.getModelViewMatrix"),Jax.deprecate(Jax.Context,"getInverseModelViewMatrix","matrix_stack.getInverseModelViewMatrix"),Jax.deprecate(Jax.Context,"getModelViewProjectionMatrix","matrix_stack.getModelViewProjectionMatrix"),Jax.deprecate(Jax.Context,"getInverseProjectionMatrix","matrix_stack.getInverseProjectionMatrix"),Jax.deprecateProperty(Jax.Context,"current_controller","controller"),Jax.deprecateProperty(Jax.Context,"current_view","view"),Jax.deprecate(Jax.Context,"afterRender"),Jax.deprecate(Jax.Context,"afterUpdate"),Jax.deprecate(Jax.Context,"glClearColor","gl.clearColor"),Jax.deprecate(Jax.Context,"glGetContextAttributes","gl.getContextAttributes"),Jax.deprecate(Jax.Context,"glIsContextLost","gl.isContextLost"),Jax.deprecate(Jax.Context,"glGetSupportedExtensions","gl.getSupportedExtensions"),Jax.deprecate(Jax.Context,"glGetExtension","gl.getExtension"),Jax.deprecate(Jax.Context,"glActiveTexture","gl.activeTexture"),Jax.deprecate(Jax.Context,"glAttachShader","gl.attachShader"),Jax.deprecate(Jax.Context,"glBindAttribLocation","gl.bindAttribLocation"),Jax.deprecate(Jax.Context,"glBindBuffer","gl.bindBuffer"),Jax.deprecate(Jax.Context,"glBindFramebuffer","gl.bindFramebuffer"),Jax.deprecate(Jax.Context,"glBindRenderbuffer","gl.bindRenderbuffer"),Jax.deprecate(Jax.Context,"glBindTexture","gl.bindTexture"),Jax.deprecate(Jax.Context,"glBlendColor","gl.blendColor"),Jax.deprecate(Jax.Context,"glBlendEquation","gl.blendEquation"),Jax.deprecate(Jax.Context,"glBlendEquationSeparate","gl.blendEquationSeparate"),Jax.deprecate(Jax.Context,"glBlendFunc","gl.blendFunc"),Jax.deprecate(Jax.Context,"glBlendFuncSeparate","gl.blendFuncSeparate"),Jax.deprecate(Jax.Context,"glBufferData","gl.bufferData"),Jax.deprecate(Jax.Context,"glBufferSubData","gl.bufferSubData"),Jax.deprecate(Jax.Context,"glCheckFramebufferStatus","gl.checkFramebufferStatus"),Jax.deprecate(Jax.Context,"glClear","gl.clear"),Jax.deprecate(Jax.Context,"glClearColor","gl.clearColor"),Jax.deprecate(Jax.Context,"glClearDepth","gl.clearDepth"),Jax.deprecate(Jax.Context,"glClearStencil","gl.clearStencil"),Jax.deprecate(Jax.Context,"glColorMask","gl.colorMask"),Jax.deprecate(Jax.Context,"glCompileShader","gl.compileShader"),Jax.deprecate(Jax.Context,"glCompressedTexImage2D","gl.compressedTexImage2D"),Jax.deprecate(Jax.Context,"glCompressedTexSubImage2D","gl.compressedTexSubImage2D"),Jax.deprecate(Jax.Context,"glCopyTexImage2D","gl.copyTexImage2D"),Jax.deprecate(Jax.Context,"glCopyTexSubImage2D","gl.copyTexSubImage2D"),Jax.deprecate(Jax.Context,"glCreateBuffer","gl.createBuffer"),Jax.deprecate(Jax.Context,"glCreateFramebuffer","gl.createFramebuffer"),Jax.deprecate(Jax.Context,"glCreateProgram","gl.createProgram"),Jax.deprecate(Jax.Context,"glCreateRenderbuffer","gl.createRenderbuffer"),Jax.deprecate(Jax.Context,"glCreateShader","gl.createShader"),Jax.deprecate(Jax.Context,"glCreateTexture","gl.createTexture"),Jax.deprecate(Jax.Context,"glCullFace","gl.cullFace"),Jax.deprecate(Jax.Context,"glDeleteBuffer","gl.deleteBuffer"),Jax.deprecate(Jax.Context,"glDeleteFramebuffer","gl.deleteFramebuffer"),Jax.deprecate(Jax.Context,"glDeleteProgram","gl.deleteProgram"),Jax.deprecate(Jax.Context,"glDeleteRenderbuffer","gl.deleteRenderbuffer"),Jax.deprecate(Jax.Context,"glDeleteShader","gl.deleteShader"),Jax.deprecate(Jax.Context,"glDeleteTexture","gl.deleteTexture"),Jax.deprecate(Jax.Context,"glDepthFunc","gl.depthFunc"),Jax.deprecate(Jax.Context,"glDepthMask","gl.depthMask"),Jax.deprecate(Jax.Context,"glDetachShader","gl.detachShader"),Jax.deprecate(Jax.Context,"glDisable","gl.disable"),Jax.deprecate(Jax.Context,"glDisableVertexAttribArray","gl.disableVertexAttribArray"),Jax.deprecate(Jax.Context,"glDrawArrays","gl.drawArrays"),Jax.deprecate(Jax.Context,"glDrawElements","gl.drawElements"),Jax.deprecate(Jax.Context,"glEnable","gl.enable"),Jax.deprecate(Jax.Context,"glEnableVertexAttribArray","gl.enableVertexAttribArray"),Jax.deprecate(Jax.Context,"glFinish","gl.finish"),Jax.deprecate(Jax.Context,"glFlush","gl.flush"),Jax.deprecate(Jax.Context,"glFramebufferRenderbuffer","gl.framebufferRenderbuffer"),Jax.deprecate(Jax.Context,"glFramebufferTexture2D","gl.framebufferTexture2D"),Jax.deprecate(Jax.Context,"glFrontFace","gl.frontFace"),Jax.deprecate(Jax.Context,"glGenerateMipmap","gl.generateMipmap"),Jax.deprecate(Jax.Context,"glGetActiveAttrib","gl.getActiveAttrib"),Jax.deprecate(Jax.Context,"glGetActiveUniform","gl.getActiveUniform"),Jax.deprecate(Jax.Context,"glGetAttachedShaders","gl.getAttachedShaders"),Jax.deprecate(Jax.Context,"glGetAttribLocation","gl.getAttribLocation"),Jax.deprecate(Jax.Context,"glGetBufferParameter","gl.getBufferParameter"),Jax.deprecate(Jax.Context,"glGetParameter","gl.getParameter"),Jax.deprecate(Jax.Context,"glGetError","gl.getError"),Jax.deprecate(Jax.Context,"glGetFramebufferAttachmentParameter","gl.getFramebufferAttachmentParameter"),Jax.deprecate(Jax.Context,"glGetProgramParameter","gl.getProgramParameter"),Jax.deprecate(Jax.Context,"glGetProgramInfoLog","gl.getProgramInfoLog"),Jax.deprecate(Jax.Context,"glGetRenderbufferParameter","gl.getRenderbufferParameter"),Jax.deprecate(Jax.Context,"glGetShaderParameter","gl.getShaderParameter"),Jax.deprecate(Jax.Context,"glGetShaderPrecisionFormat","gl.getShaderPrecisionFormat"),Jax.deprecate(Jax.Context,"glGetShaderInfoLog","gl.getShaderInfoLog"),Jax.deprecate(Jax.Context,"glGetShaderSource","gl.getShaderSource"),Jax.deprecate(Jax.Context,"glGetTexParameter","gl.getTexParameter"),Jax.deprecate(Jax.Context,"glGetUniform","gl.getUniform"),Jax.deprecate(Jax.Context,"glGetUniformLocation","gl.getUniformLocation"),Jax.deprecate(Jax.Context,"glGetVertexAttrib","gl.getVertexAttrib"),Jax.deprecate(Jax.Context,"glGetVertexAttribOffset","gl.getVertexAttribOffset"),Jax.deprecate(Jax.Context,"glHint","gl.hint"),Jax.deprecate(Jax.Context,"glIsBuffer","gl.isBuffer"),Jax.deprecate(Jax.Context,"glIsEnabled","gl.isEnabled"),Jax.deprecate(Jax.Context,"glIsFramebuffer","gl.isFramebuffer"),Jax.deprecate(Jax.Context,"glIsProgram","gl.isProgram"),Jax.deprecate(Jax.Context,"glIsRenderbuffer","gl.isRenderbuffer"),Jax.deprecate(Jax.Context,"glIsShader","gl.isShader"),Jax.deprecate(Jax.Context,"glIsTexture","gl.isTexture"),Jax.deprecate(Jax.Context,"glLineWidth","gl.lineWidth"),Jax.deprecate(Jax.Context,"glLinkProgram","gl.linkProgram"),Jax.deprecate(Jax.Context,"glPixelStorei","gl.pixelStorei"),Jax.deprecate(Jax.Context,"glPolygonOffset","gl.polygonOffset"),Jax.deprecate(Jax.Context,"glReadPixels","gl.readPixels"),Jax.deprecate(Jax.Context,"glRenderbufferStorage","gl.renderbufferStorage"),Jax.deprecate(Jax.Context,"glSampleCoverage","gl.sampleCoverage"),Jax.deprecate(Jax.Context,"glScissor","gl.scissor"),Jax.deprecate(Jax.Context,"glShaderSource","gl.shaderSource"),Jax.deprecate(Jax.Context,"glStencilFunc","gl.stencilFunc"),Jax.deprecate(Jax.Context,"glStencilFuncSeparate","gl.stencilFuncSeparate"),Jax.deprecate(Jax.Context,"glStencilMask","gl.stencilMask"),Jax.deprecate(Jax.Context,"glStencilMaskSeparate","gl.stencilMaskSeparate"),Jax.deprecate(Jax.Context,"glStencilOp","gl.stencilOp"),Jax.deprecate(Jax.Context,"glStencilOpSeparate","gl.stencilOpSeparate"),Jax.deprecate(Jax.Context,"glTexImage2D","gl.texImage2D"),Jax.deprecate(Jax.Context,"glTexParameterf","gl.texParameterf"),Jax.deprecate(Jax.Context,"glTexParameteri","gl.texParameteri"),Jax.deprecate(Jax.Context,"glTexSubImage2D","gl.texSubImage2D"),Jax.deprecate(Jax.Context,"glUniform1f","gl.uniform1f"),Jax.deprecate(Jax.Context,"glUniform1fv","gl.uniform1fv"),Jax.deprecate(Jax.Context,"glUniform1i","gl.uniform1i"),Jax.deprecate(Jax.Context,"glUniform1iv","gl.uniform1iv"),Jax.deprecate(Jax.Context,"glUniform2f","gl.uniform2f"),Jax.deprecate(Jax.Context,"glUniform2fv","gl.uniform2fv"),Jax.deprecate(Jax.Context,"glUniform2i","gl.uniform2i"),Jax.deprecate(Jax.Context,"glUniform2iv","gl.uniform2iv"),Jax.deprecate(Jax.Context,"glUniform3f","gl.uniform3f"),Jax.deprecate(Jax.Context,"glUniform3fv","gl.uniform3fv"),Jax.deprecate(Jax.Context,"glUniform3i","gl.uniform3i"),Jax.deprecate(Jax.Context,"glUniform3iv","gl.uniform3iv"),Jax.deprecate(Jax.Context,"glUniform4f","gl.uniform4f"),Jax.deprecate(Jax.Context,"glUniform4fv","gl.uniform4fv"),Jax.deprecate(Jax.Context,"glUniform4i","gl.uniform4i"),Jax.deprecate(Jax.Context,"glUniform4iv","gl.uniform4iv"),Jax.deprecate(Jax.Context,"glUniformMatrix2fv","gl.uniformMatrix2fv"),Jax.deprecate(Jax.Context,"glUniformMatrix3fv","gl.uniformMatrix3fv"),Jax.deprecate(Jax.Context,"glUniformMatrix4fv","gl.uniformMatrix4fv"),Jax.deprecate(Jax.Context,"glUseProgram","gl.useProgram"),Jax.deprecate(Jax.Context,"glValidateProgram","gl.validateProgram"),Jax.deprecate(Jax.Context,"glVertexAttrib1f","gl.vertexAttrib1f"),Jax.deprecate(Jax.Context,"glVertexAttrib1fv","gl.vertexAttrib1fv"),Jax.deprecate(Jax.Context,"glVertexAttrib2f","gl.vertexAttrib2f"),Jax.deprecate(Jax.Context,"glVertexAttrib2fv","gl.vertexAttrib2fv"),Jax.deprecate(Jax.Context,"glVertexAttrib3f","gl.vertexAttrib3f"),Jax.deprecate(Jax.Context,"glVertexAttrib3fv","gl.vertexAttrib3fv"),Jax.deprecate(Jax.Context,"glVertexAttrib4f","gl.vertexAttrib4f"),Jax.deprecate(Jax.Context,"glVertexAttrib4fv","gl.vertexAttrib4fv"),Jax.deprecate(Jax.Context,"glVertexAttribPointer","gl.vertexAttribPointer"),Jax.deprecate(Jax.Context,"glViewport","gl.viewport")),function(){}.call(this);